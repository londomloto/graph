!function(){function t(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function e(t){return{left:function(e,n,r,i){for(arguments.length<3&&(r=0),arguments.length<4&&(i=e.length);r<i;){var o=r+i>>>1;t(e[o],n)<0?r=o+1:i=o}return r},right:function(e,n,r,i){for(arguments.length<3&&(r=0),arguments.length<4&&(i=e.length);r<i;){var o=r+i>>>1;t(e[o],n)>0?i=o:r=o+1}return r}}}_.float=parseFloat,_.gcd=function(t){if(2===t.length){for(var e,n=t[0],r=t[1];r>0;)e=r,r=n%r,n=e;return n}var i,o=t[0],s=t.length;for(i=1;i<s;i++)o=_.gcd([o,t[i]]);return o},_.lcm=function(t){if(2===t.length){var e=t[0],n=t[1];return e*(n/_.gcd([e,n]))}var r,i=t[0],o=t.length;for(r=1;r<o;r++)i=_.lcm([i,t[r]]);return i},_.format=function(){var t=_.toArray(arguments),e=t.shift();return e.replace(/{(\d+)}/g,function(e,n){return"undefined"!=typeof t[n]?t[n]:e})},_.insert=function(t,e,n){return Array.prototype.splice.apply(t,[e,0].concat(n)),t},_.move=function(t,e,n){for(var r=t.length;e<0;)e+=r;for(;n<0;)n+=r;if(n>=r)for(var i=n-r;i--+1;)t.push(void 0);
return t.splice(n,0,t.splice(e,1)[0]),t},_.permute=function(t,e){return _.isFunction(e)?_.reduce(t,function(t,n,r){return t[e(r,n)]=n,t},[]):_.isArray(e)?_.reduce(e,function(n,r,i){return n[i]=t[e[i]],n},[]):t},_.bisector=function(n){return e(1===n.length?function(e,r){return t(n(e),r)}:n)},_.ascendingKey=function(t){return"function"==typeof t?function(e,n){return t(e)<t(n)?-1:t(e)>t(n)?1:t(e)>=t(n)?0:NaN}:function(e,n){return e[t]<n[t]?-1:e[t]>n[t]?1:e[t]>=n[t]?0:NaN}},_.isIE=function(){var t=global.navigator,e=(t&&t.userAgent||"").toLowerCase(),n=e.indexOf("MSIE ");return!!(n>0||e.match(/Trident.*rv\:11\./))&&parseInt(e.substring(n+5,e.indexOf(".",n)))}}(),function(){var t="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")(),e=document,n=(location,navigator),r=100,i=1e3,o=[];t.Graph=function(t){o.push(t)},Graph.VERSION="1.0.0",Graph.AUTHOR="Kreasindo Cipta Teknologi",Graph.cached={},Graph.config={base:"../",locale:"id",
svg:{version:"1.1"},xmlns:{svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",html:"http://www.w3.org/1999/xhtml"},font:{family:"Segoe UI",size:"12px",line:1},resizer:{image:"resize-control.png",size:17}},Graph.setup=function(t,e){_.isPlainObject(t)?_.extend(Graph.config,t):Graph.config[t]=e},Graph.string={ID_VECTOR:"graph-vector-id",ID_SHAPE:"graph-shape-id",ID_LINK:"graph-link-id",ID_PORT:"graph-port-id"},Graph.styles={VECTOR:"graph-elem",PAPER:"graph-paper",VIEWPORT:"graph-viewport",SHAPE:"graph-shape",SHAPE_BLOCK:"comp-block",SHAPE_LABEL:"comp-label",SHAPE_HEADER:"comp-header",SHAPE_CHILD:"comp-child",SHAPE_DRAG:"shape-draggable",LINK_HEAD:"graph-link-head",LINK_TAIL:"graph-link-tail"},Graph.icons={ZOOM_IN:"ion-android-add",ZOOM_OUT:"ion-android-remove",ZOOM_RESET:"ion-pinpoint",SHAPE:"bpmn-icon-start-event-none",SHAPE_LANE:"bpmn-icon-participant",SHAPE_LINK:"ion-android-share-alt",SHAPE_ACTION:"bpmn-icon-task",SHAPE_ROUTER:"bpmn-icon-gateway-none",LANE_ABOVE:"bpmn-icon-lane-insert-above",
LANE_BELOW:"bpmn-icon-lane-insert-below",CONFIG:"bpmn-icon-screw-wrench",LINK:"bpmn-icon-connection-multi",TRASH:"bpmn-icon-trash",SEND_TO_BACK:"font-icon-send-back",SEND_TO_FRONT:"font-icon-bring-front",MOVE_UP:"ion-android-arrow-up",MOVE_DOWN:"ion-android-arrow-down",ROUTER_OR:"bpmn-icon-gateway-or",ROUTER_XOR:"bpmn-icon-gateway-xor",ROUTER_NONE:"bpmn-icon-gateway-none",ROUTER_PARALLEL:"bpmn-icon-gateway-parallel"},Graph.doc=function(){},Graph.global=function(){},Graph.isHTML=function(t){return t instanceof HTMLElement},Graph.isSVG=function(t){return t instanceof SVGElement},Graph.isElement=function(t){return t instanceof Graph.dom.Element},Graph.isMac=function(){return/mac/i.test(n.platform)},Graph.ns=function(e){var n=Graph.lookup("Graph","ns",e);if(n.clazz)return n.clazz;var r,i,o=_.split(e,"."),s=t,a=o.length;for(i=0;i<a;i++)r=o[i],s[r]=s[r]||{},s=s[r];return _.isFunction(s)&&(n.clazz=s),s},Graph.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){
var e=16*Math.random()|0,n="x"==t?e:3&e|8;return n.toString(16)})},Graph.hash=function(t){var e,n,r=2166136261;for(e=0,n=t.length;e<n;e++)r^=t.charCodeAt(e),r+=(r<<1)+(r<<4)+(r<<7)+(r<<8)+(r<<24);return("0000000"+(r>>>0).toString(16)).substr(-8)},Graph.create=function(t,e){},Graph.factory=function(t,e){return e=[t].concat(e),new(Function.prototype.bind.apply(t,e))},Graph.expand=function(t,e,n){var r=t.constructor.prototype,i=e.constructor.prototype;n=_.defaultTo(e),_.forOwn(i,function(t,e){_.isFunction(t)&&_.isUndefined(r[e])&&!function(t,e){r[t]=_.bind(e,n)}(e,t)})},Graph.extend=function(t,e){return _.isPlainObject(t)&&(e=t,t=Graph.lang.Class),t.extend(e)},Graph.mixin=function(t,e){this.extend(t,e,t)},Graph.lookup=function(t,e){var n,i,o=_.toArray(arguments);return t=o.shift(),e=_.join(o,"|"),n=Graph.cached[t]=Graph.cached[t]||{},i="Regex.event"==t?null:r,n[e]?n[e].credit=i:n[e]={credit:i,remove:function(t,e){return function(){delete Graph.cached[t][e]}}(t,e)},_.debounce(function(t){_.forOwn(n,function(e,r){
r!=t&&null!==n[r].credit&&(n[r].credit--,n[r].credit<=0&&delete n[r])})})(e),n[e]},Graph.memoize=function(t){return function e(){var n=_.toArray(arguments),r=_.join(n,"␀"),o=e.cache=e.cache||{},s=e.saved=e.saved||[];if(!_.isUndefined(o[r])){for(var a=0,p=s.length;a<p;a++)if(s[a]==r){s.push(s.splice(a,1)[0]);break}return o[r]}return s.length>=i&&delete o[s.shift()],s.push(r),o[r]=t.apply(this,n),o[r]}},Graph.defer=function(){return $.Deferred()},Graph.when=$.when,Graph.paper=function(t,e,n){return Graph.factory(Graph.svg.Paper,[t,e,n])},Graph.svg=function(t){var e,n=_.toArray(arguments);return t=n.shift(),e=Graph.factory(Graph.svg[_.capitalize(t)],n),n=null,e},Graph.shape=function(t,e){var n,r,i;return i=t.lastIndexOf("."),t=t.substr(0,i)+"."+_.capitalize(t.substr(i+1)),n=Graph.ns("Graph.shape."+t),r=Graph.factory(n,e),i=t=n=null,r},Graph.layout=function(t){},Graph.router=function(t){},Graph.link=function(t){},Graph.plugin=function(t){},Graph.diagram=function(t,e){var n;return n=Graph.diagram.type[_.capitalize(t)],
Graph.factory(n,[e])},Graph.diagram.type={},Graph.diagram.util={},Graph.diagram.pallet={},Graph.pallet=function(t,e){var n;return n=Graph.diagram.pallet[_.capitalize(t)],Graph.factory(n,[e])},Graph.topic={subscribers:{},publish:function(t,e,n){var r=Graph.topic.subscribers,i=r[t]||[];_.forEach(i,function(t){t&&t.call(null,e,n)})},subscribe:function(t,e){if(_.isPlainObject(t)){var n=[];return _.forOwn(t,function(t,e){!function(t,e){var r=Graph.topic.subscribe(t,e);n.push({topic:t,sub:r})}(e,t)}),{unsubscribe:function(t){return function(e){if(e){var n=_.find(t,function(t){return t.topic==e});n&&n.sub.unsubscribe()}else _.forEach(t,function(t){t.sub.unsubscribe()})}}(n)}}var r=Graph.topic.subscribers;return r[t]=r[t]||[],r[t].push(e),{unsubscribe:function(t,e){return function(){Graph.topic.unsubscribe(t,e)}}(t,e)}},unsubscribe:function(t,e){for(var n=Graph.topic.subscribers,r=n[t]||[],i=r.length-1;i>=0;i--)r[i]===e&&r.splice(i,1)}},Graph.message=function(t,e){e=_.defaultTo(e,"info"),Graph.topic.publish("graph:message",{
type:e,message:t})},t.graphConfig&&Graph.setup(t.graphConfig),Graph._=function(t){return t},Graph.ns("Graph.lang"),Graph.ns("Graph.collection"),Graph.ns("Graph.registry"),Graph.ns("Graph.data"),Graph.ns("Graph.popup"),Graph.ns("Graph.shape.activity"),Graph.ns("Graph.shape.common"),Graph(function(){var t=$(e);t.on("mousedown",function(t){var e,n=$(t.target),r=n.data(Graph.string.ID_VECTOR);r?(r=Graph.registry.vector.get(r),e=r.paper(),Graph.cached.paper=e?e.guid():null):Graph.cached.paper=null,r=e=null}),t=null}),function(t,e){var n,r=function(){t.removeEventListener(e,r,!1),t.readyState="complete"},i=function(){_.forEach(o,function(t){t()})},s=function(){"complete"!=t.readyState?n=_.delay(function(){clearTimeout(n),n=null,s()},10):i()};null==t.readyState&&t.addEventListener&&(t.addEventListener(e,r,!1),t.readyState="loading"),s()}(e,"DOMContentLoaded")}(),function(){var t=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,e=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/gi,n=/,?([achlmqrstvxz]),?/gi,r=/(\-?[0-9.]+)\s*,\s*(\-?[0-9.]+)/g,i=/((matrix|translate|rotate|scale|skewX|skewY)*\((\-?\d+\.?\d*e?\-?\d*[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+\))+/g,o=/[\w\.\-]+/g,r=/(\-?[0-9.]+)\s*,\s*(\-?[0-9.]+)/g,s=10,a=6,p=12,h=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],c=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472];
Graph.util={deg:function(t){return Math.round(180*t/Math.PI%360*1e3)/1e3},rad:function(t){return t%360*Math.PI/180},angle:function(t,e){var n=t.x-e.x,r=t.y-e.y;return n||r?(180+180*Math.atan2(-r,-n)/Math.PI+360)%360:0},theta:function(t,e){var n,r,i=-(e.y-t.y),o=e.x-t.x;return n=0==i.toFixed(10)&&0==o.toFixed(10)?0:Math.atan2(i,o),n<0&&(n=2*Math.PI+n),r=180*n/Math.PI,r=r%360+(r<0?360:0)},taxicab:function(t,e){var n=t.x-e.x,r=t.y-e.y;return n*n+r*r},hypo:function(t,e){return Math.sqrt(t*t+e*e)},sign:function(t){return t<0?-1:1},quadrant:function(t,e){return t>=0&&e>=0?1:t>=0&&e<0?4:t<0&&e<0?3:2},gradient:function(t,e){return e.x==t.x?e.y>t.y?1/0:-(1/0):e.y==t.y?e.x>t.x?0:-0:(e.y-t.y)/(e.x-t.x)},snapValue:function(t,e,n){if(n=_.defaultTo(n,10),_.isArray(e)){for(var r=e.length;r--;)if(Math.abs(e[r]-t)<=n)return e[r]}else{e=+e;var i=t%e;if(i<n)return t-i;if(i>t-n)return t-i+e}return t},pointbox:function(t,e,n){_.isPlainObject(t)&&(n=e,e=t.y,t=t.x),n=n||0;var r=t-n,i=e-n,o=t+n,s=e+n,a=o-r,p=s-i;
return{x:r,y:i,x2:o,y2:s,width:a,height:p}},pointAlign:function(t,e,n){return!(!t||!e)&&(n=n||2,Math.abs(t.x-e.x)<=n?"h":Math.abs(t.y-e.y)<=n&&"v")},pointDistance:function(t,e){return t&&e?Graph.util.hypo(t.x-e.x,t.y-e.y):-1},isPointEquals:function(t,e){return t.x==e.x&&t.y==e.y},isPointOnLine:function(t,e,n){if(!t||!e||!n)return!1;var r=(e.x-t.x)*(n.y-t.y)-(e.y-t.y)*(n.x-t.x),i=Graph.util.pointDistance(t,e);return Math.abs(r/i)<2},polar2point:function(t,e,n){var r,i,o;return _.isUndefined(n)&&(n=Graph.point(0,0)),r=Math.abs(t*Math.cos(e)),i=Math.abs(t*Math.sin(e)),o=Graph.util.deg(e),o<90?i=-i:o<180?(r=-r,i=-i):o<270&&(r=-r),Graph.point(n.props.x+r,n.props.y+i)},isBoxContainsPoint:function(t,e){return e.x>=t.x&&e.x<=t.x2&&e.y>=t.y&&e.y<=t.y2},isBoxIntersect:function(t,e){var n=Graph.util.isBoxContainsPoint;return n(e,{x:t.x,y:t.y})||n(e,{x:t.x2,y:t.y})||n(e,{x:t.x,y:t.y2})||n(e,{x:t.x2,y:t.y2})||n(t,{x:e.x,y:e.y})||n(t,{x:e.x2,y:e.y})||n(t,{x:e.x,y:e.y2})||n(t,{x:e.x2,y:e.y2})||(t.x<e.x2&&t.x>e.x||e.x<t.x2&&e.x>t.x)&&(t.y<e.y2&&t.y>e.y||e.y<t.y2&&e.y>t.y);
},boxOrientation:function(t,e,n,r){n=_.defaultTo(n,0),r=_.defaultTo(r,n);var i=t.y2+r<=e.y,o=t.x-n>=e.x2,s=t.y-r>=e.y2,a=t.x2+n<=e.x,p=i?"top":s?"bottom":null,h=a?"left":o?"right":null;return h&&p?p+"-"+h:h||p||"intersect"},expandBox:function(t,e,n){return e=_.defaultTo(e,0),n=_.defaultTo(n,0),t.x-=e,t.x2+=e,t.y-=n,t.y2+=n,t.width=t.x2-t.x,t.height=t.y2-t.y,t},groupBox:function(t){var e=[],n=[],r=[],i=[];return t.length?(_.forEach(t,function(t){e.push(t.x),n.push(t.y),r.push(t.x+t.width),i.push(t.y+t.height)}),e=_.min(e),n=_.min(n),r=_.max(r),i=_.max(i),{x:e,y:n,x2:r,y2:i,width:r-e,height:i-n}):{x:0,y:0,x2:0,y2:0,width:0,height:0}},midpoint:function(t,e){return{x:(t.x+e.x)/2,y:(t.y+e.y)/2}},movepoint:function(t,e,n){var r=Graph.util.rad(Graph.util.theta(e,t)),i=Math.cos(r)*n,o=-Math.sin(r)*n;return t.x+=i,t.y+=o,t},lineBendpoints:function(t,e,n){var r,i,o=[],s=t.x,a=t.y,p=e.x,h=e.y;return n=n||"h:h","h:v"==n?o=[{x:p,y:a}]:"v:h"==n?o=[{x:s,y:h}]:"h:h"==n?(r=Math.round((p-s)/2+s),o=[{x:r,
y:a},{x:r,y:h}]):"v:v"==n?(i=Math.round((h-a)/2+a),o=[{x:s,y:i},{x:p,y:i}]):o=[],o},lineIntersection:function(t,e,n,r,i,o,s,a){if(Math.max(t,n)<Math.min(i,s)||Math.min(t,n)>Math.max(i,s)||Math.max(e,r)<Math.min(o,a)||Math.min(e,r)>Math.max(o,a))return null;var p=(t*r-e*n)*(i-s)-(t-n)*(i*a-o*s),h=(t*r-e*n)*(o-a)-(e-r)*(i*a-o*s),c=(t-n)*(o-a)-(e-r)*(i-s);if(!c)return null;var l=p/c,u=h/c,d=+l.toFixed(2),f=+u.toFixed(2);return d<+Math.min(t,n).toFixed(2)||d>+Math.max(t,n).toFixed(2)||d<+Math.min(i,s).toFixed(2)||d>+Math.max(i,s).toFixed(2)||f<+Math.min(e,r).toFixed(2)||f>+Math.max(e,r).toFixed(2)||f<+Math.min(o,a).toFixed(2)||f>+Math.max(o,a).toFixed(2)?null:{x:l,y:u}},perpendicular:function(t,e,n){var r,i,o,s;r=Graph.util.gradient(t,e),i=0===r?0:-1/r,o=Math.atan(i);var s=n*Math.cos(o),a=(t.x+e.x)/2,p=(t.y+e.y)/2,h=p-a*i,c=a+s,l=i*c+h;return{from:{x:a,y:p},to:{x:c,y:l}}},points2path:function(t){var e=_.map(t,function(t,e){var n=0===e?"M":"L";return[n,t.x,t.y]});return Graph.util.segments2path(e);
},path2points:function(t){var e=Graph.util.path2segments(t);return _.map(e,function(t,e){return"M"==t[0]||"L"==t[0]?{x:t[1],y:t[2]}:{x:t[5],y:t[6]}})},segments2path:function(t){return _.join(t||[],",").replace(n,"$1")},path2segments:function(n){if(!n)return[];var r=Graph.lookup("Graph.util","path2segments",n),i={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},o=[];return r.segments?_.cloneDeep(r.segments):(n.replace(t,function(t,n,r){var s=[],a=n.toLowerCase();if(r.replace(e,function(t,e){e&&s.push(+e)}),"m"==a&&s.length>2&&(o.push(_.concat([n],s.splice(0,2))),a="l",n="m"==n?"l":"L"),"r"==a)o.push(_.concat([n],s));else for(;s.length>=i[a]&&(o.push(_.concat([n],s.splice(0,i[a]))),i[a]););}),r.segments=_.cloneDeep(o),o)},polygon2dots:function(t){var e=[];return t.replace(r,function(t,n,r){e.push([_.float(n),_.float(r)])}),e},polygon2path:function(t){var e=Graph.util.polygon2dots(t);if(!e.length)return"M0,0";for(var t="M"+e[0][0]+","+e[0][1],n=1,r=e.length;n<r;n++)t+="L"+e[n][0]+","+e[n][1]+",";
return t=t.substring(0,t.length-1),t+="Z"},transform2segments:Graph.memoize(function(t){var e={matrix:!0,translate:!0,rotate:!0,scale:!0,skewX:!0,skewY:!0};t+="";var n=[],r=t.match(i);return r&&_.forEach(r,function(t){var r=t.match(o),i=r.shift();e[i]&&(r=_.map(r,function(t){return+t}),n.push([i].concat(r)))}),n}),curvebox:Graph.memoize(function(t,e,n,r,i,o,s,a){var p=_.join(arguments,"_"),h=Graph.lookup("Graph.util","curvebox",p);if(p=null,h.curvebox)return h.curvebox;for(var c,l,u,d,f,g,y,v,m=[],x=[[],[]],b=0;b<2;++b)if(0==b?(l=6*t-12*n+6*i,c=-3*t+9*n-9*i+3*s,u=3*n-3*t):(l=6*e-12*r+6*o,c=-3*e+9*r-9*o+3*a,u=3*r-3*e),Math.abs(c)<1e-12){if(Math.abs(l)<1e-12)continue;d=-u/l,0<d&&d<1&&m.push(d)}else y=l*l-4*u*c,v=Math.sqrt(y),y<0||(f=(-l+v)/(2*c),0<f&&f<1&&m.push(f),g=(-l-v)/(2*c),0<g&&g<1&&m.push(g));for(var G,w=m.length,k=w;w--;)d=m[w],G=1-d,x[0][w]=G*G*G*t+3*G*G*d*n+3*G*d*d*i+d*d*d*s,x[1][w]=G*G*G*e+3*G*G*d*r+3*G*d*d*o+d*d*d*a;return x[0][k]=t,x[1][k]=e,x[0][k+1]=s,x[1][k+1]=a,x[0].length=x[1].length=k+2,
h.curvebox={min:{x:Math.min.apply(0,x[0]),y:Math.min.apply(0,x[1])},max:{x:Math.max.apply(0,x[0]),y:Math.max.apply(0,x[1])}},h.curvebox}),curveLength:function(t,e,n,r,i,o,s,a,l){l=_.defaultTo(l,1),l=l>1?1:l<0?0:l;for(var u=l/2,d=0,f=0;f<p;f++){var g=u*h[f]+u,y=Graph.util.curvePolynom(g,t,n,i,s),v=Graph.util.curvePolynom(g,e,r,o,a),m=y*y+v*v;d+=c[f]*Math.sqrt(m)}return u*d},curvePolynom:function(t,e,n,r,i){var o=-3*e+9*n-9*r+3*i,s=t*o+6*e-12*n+6*r;return t*s-3*e+3*n},curveInterval:function(t,e,n,r,i,o,s,a,p){if(!(p<0||Graph.util.curveLength(t,e,n,r,i,o,s,a)<p)){var h,c=1,l=c/2,u=c-l,d=.01;for(h=Graph.util.curveLength(t,e,n,r,i,o,s,a,u);Math.abs(h-p)>d;)l/=2,u+=(h<p?1:-1)*l,h=Graph.util.curveLength(t,e,n,r,i,o,s,a,u);return u}},pointAtInterval:function(t,e,n,r,i,o,s,a,p){var h=1-p,c=Math.pow(h,3),l=Math.pow(h,2),u=p*p,d=u*p,f=c*t+3*l*p*n+3*h*p*p*i+d*s,g=c*e+3*l*p*r+3*h*p*p*o+d*a,y=t+2*p*(n-t)+u*(i-2*n+t),v=e+2*p*(r-e)+u*(o-2*r+e),m=n+2*p*(i-n)+u*(s-2*i+n),x=r+2*p*(o-r)+u*(a-2*o+r),b=h*t+p*n,G=h*e+p*r,_=h*i+p*s,w=h*o+p*a,k=90-180*Math.atan2(y-m,v-x)/Math.PI;
return k=90-180*Math.atan2(m-y,x-v)/Math.PI,{x:f,y:g,m:{x:y,y:v},n:{x:m,y:x},start:{x:b,y:G},end:{x:_,y:w},alpha:k}},curveIntersection:function(t,e,n){var r=Graph.util.curvebox.apply(null,t),i=Graph.util.curvebox.apply(null,e),o=0,s=[],a={x:r.min.x,y:r.min.y,x2:r.max.x,y2:r.max.y},p={x:i.min.x,y:i.min.y,x2:i.max.x,y2:i.max.y};if(!Graph.util.isBoxIntersect(a,p))return n?0:[];var h,c,l,u,d=Graph.util.curveLength.apply(null,t),f=Graph.util.curveLength.apply(null,e),g=~~(d/10),y=~~(f/10),v=[],m=[],x={};for(h=0;h<g+1;h++)l=h/g,u=Graph.util.pointAtInterval.apply(null,t.concat([l])),v.push({x:u.x,y:u.y,t:l});for(h=0;h<y+1;h++)l=h/y,u=Graph.util.pointAtInterval.apply(null,e.concat([l])),m.push({x:u.x,y:u.y,t:l});for(h=0;h<g;h++)for(c=0;c<y;c++){var b=v[h],G=v[h+1],_=m[c],w=m[c+1],k=Math.abs(G.x-b.x)<.001?"y":"x",C=Math.abs(w.x-_.x)<.001?"y":"x",S=Graph.util.lineIntersection(b.x,b.y,G.x,G.y,_.x,_.y,w.x,w.y);if(S){if(x[S.x.toFixed(4)]==S.y.toFixed(4))continue;x[S.x.toFixed(4)]=S.y.toFixed(4);var T=b.t+Math.abs((S[k]-b[k])/(G[k]-b[k]))*(G.t-b.t),E=_.t+Math.abs((S[C]-_[C])/(w[C]-_[C]))*(w.t-_.t);
T>=0&&T<=1.001&&E>=0&&E<=1.001&&(o++,s.push({x:S.x,y:S.y,t1:T,t2:E}))}}return n?o:s},convexSegment:function(t,e,n,r){if(!e||!n||!t)return null;var i=Graph.util.pointDistance(t,e),o=Graph.util.pointDistance(t,n);if(r=r||s,i>r&&o>r){var a,p=Graph.util.movepoint({x:t.x,y:t.y},e,-r/2),h=Graph.util.movepoint({x:t.x,y:t.y},n,-r/2),c=Graph.util.pointAlign(e,n,r/2);return"h"==c?a={x:t.x-r,y:t.y}:(p.y=e.y,h.y=n.y,a={x:t.x,y:t.y-r}),[["L",p.x,p.y],["Q",a.x,a.y,h.x,h.y]]}return null},smoothSegment:function(t,e,n,r){if(!e||!n||!t)return null;var i=Graph.util.pointDistance(t,e),o=Graph.util.pointDistance(t,n);if(r=r||a,i>r&&o>r){var s=Graph.util.movepoint({x:t.x,y:t.y},e,-r),p=Graph.util.movepoint({x:t.x,y:t.y},n,-r);return[["L",s.x,s.y],["Q",t.x,t.y,p.x,p.y]]}return null}}}(),function(){function t(t,e,n,r,i){var o=e.split(/\./),s=o.shift();r=_.defaultTo(r,!1),i=_.defaultTo(i,1500),t.listeners[s]=t.listeners[s]||[],t.listeners[s].push({eventType:e,priority:i,original:n,handler:_.bind(n,t),once:r})}function e(t,e,n){
var r,i,o=e.split(/\./),s=o.shift(),a=t.listeners[s]||[];i=Graph.lookup("Regex.event",e),i.rgex?r=i.rgex:(r=new RegExp(_.escapeRegExp(e),"i"),i.rgex=r);for(var p=a.length-1;p>=0;p--)r.test(a[p].eventType)&&(n?n===a[p].original&&a.splice(p,1):a.splice(p,1));a.length||delete t.listeners[s]}var n=Graph.lang.Class=function(){};n.options={},n.prototype.constructor=n,n.prototype.toString=function(){return"Graph.lang.Class"},n.extend=function(n){var r,i,o,s,a,p;return r=this.prototype,i=Object.create(r),p={},_.forOwn(n,function(t,e){_.isFunction(t)?(i[e]=t,"constructor"==e&&(o=t)):p[e]=t}),o||(o=r.constructor),a=function(){if(!this.__initialized__){this.__initialized__=!0,this.listeners={};var t,e,n=this.superclass;for(e in p)this[e]=_.cloneDeep(p[e]);for(;n;){if(t=n.options)for(e in t)void 0!==this[e]?this[e]=_.merge(_.cloneDeep(t[e]),this[e]):this[e]=_.cloneDeep(t[e]);n=n.prototype.superclass}}o&&o.apply(this,arguments)},s=o.toString().match(/(function)?([^\{=]+)/),s="function"+s[2],a.toString=function(){
return s},a.extend=r.constructor.extend,a.options=p,a.prototype=i,a.prototype.constructor=a,a.prototype.superclass=r.constructor,a.prototype.on=function(e,n,r,i){if(_.isPlainObject(e)){var o,s;for(o in e)s=e[o],_.isFunction(s)?t(this,o,s):t(this,o,s.handler,s.once,s.priority)}else t(this,e,n,r,i);return this},a.prototype.one=function(e,n){if(_.isPlainObject(e)){var r,i;for(r in e)i=e[r],_.isFunction(i)?t(this,r,i,!0):t(this,r,i.handler,!0,i.priority)}else t(this,e,n,!0);return this},a.prototype.off=function(t,n){var r=t.split(/\s/);if(r.length>1)for(var i=0,o=r.length;i<o;i++)e(this,r[i]);else e(this,t,n);return this},a.prototype.fire=function(t,e){var n,r,i,o,s,a,p,h,c=[],l=[];e=e||{},_.isString(t)?n=new Graph.lang.Event(t,e):(n=t,n.originalData=e,t=n.originalType||n.type),n.publisher=this,c.push(n),r=t.split(/\./),i=r.shift(),o=(this.listeners[i]||[]).slice();var a=Graph.lookup("Regex.event",t);if(a.rgex?s=a.rgex:(s=new RegExp(_.escapeRegExp(t),"i"),a.rgex=s),o.length)for(h=0,p=o.length;h<p;h++)i==o[h].eventType?(o[h].once&&l.push(o[h]),
o[h].handler.apply(o[h].handler,c)):s.test(o[h].eventType)&&(o[h].once&&l.push(o[h]),o[h].handler.apply(o[h].handler,c));if(l.length)for(h=0,p=l.length;h<p;h++)this.off(l[h].eventType,l[h].original)},a}}(),function(){var t=Graph.lang.Error=function(t){this.message=t;var e=new Error;this.stack=e.stack,e=null};t.options={message:""},t.extend=Graph.lang.Class.extend,t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t.prototype.name="Graph.lang.Error",t.prototype.message="",Graph.error=function(t){return new Graph.lang.Error(t)},Graph.isError=function(t){return t instanceof Graph.lang.Error}}(),function(t,e){var n=Graph.lang.Event=function(t,e){this.type=t,this.originalData=null,this.cancelBubble=!1,this.defaultPrevented=!1,this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.init(e)};n.options={type:null,originalData:null,cancelBubble:!1,defaultPrevented:!1,propagationStopped:!1,immediatePropagationStopped:!1},n.extend=Graph.lang.Class.extend,n.prototype.constructor=n,
n.prototype.init=function(e){e&&(this.originalData=e,t.assign(this,e||{}))},n.prototype.stopPropagation=function(){this.cancelBubble=this.propagationStopped=!0},n.prototype.stopImmediatePropagation=function(){this.immediatePropagationStopped=this.propagationStopped=!0},n.prototype.preventDefault=function(){this.defaultPrevented=!0},n.prototype.toString=function(){return"Graph.lang.Event"},Graph.event=function(t,e){return new Graph.lang.Event(t,e)},Graph.isEvent=function(t){return t instanceof Graph.lang.Event},Graph.event.ESC=27,Graph.event.ENTER=13,Graph.event.DELETE=46,Graph.event.SHIFT=16,Graph.event.fix=function(t){return e.event.fix(t)},Graph.event.original=function(t){return t.originalEvent||t},Graph.event.position=function(t){return{x:t.clientX,y:t.clientY}},Graph.event.relative=function(t,e){var n=Graph.event.position(t),r=e.matrix().clone().invert(),i={x:r.x(n.x,n.y),y:r.y(n.x,n.y)};return r=null,i},Graph.event.isPrimaryButton=function(t){var e=Graph.event.original(t);return!e.button;
},Graph.event.hasPrimaryModifier=function(t){if(!Graph.event.isPrimaryButton(t))return!1;var e=Graph.event.original(t);return Graph.isMac()?e.metaKey:e.ctrlKey},Graph.event.hasSecondaryModifier=function(t){var e=Graph.event.original(t);return Graph.event.isPrimaryButton(t)&&e.shiftKey}}(_,jQuery),function(){function t(t,e){return e*Math.round(t/e)}var e=Graph.lang.Point=function(t,e){var n;this.props={x:0,y:0},_.isPlainObject(t)?(n=t,t=n.x,e=n.y):_.isString(t)&&(n=_.split(_.trim(t),","),t=_.toNumber(n[0]),e=_.toNumber(n[1])),this.props.x=t,this.props.y=e};e.options={props:{x:0,y:0}},e.extend=Graph.lang.Class.extend,e.prototype=Object.create(Graph.lang.Class.prototype),e.prototype.constructor=e,e.prototype.superclass=Graph.lang.Class,e.prototype.x=function(t){return _.isUndefined(t)?this.props.x:(this.props.x=t,this)},e.prototype.y=function(t){return _.isUndefined(t)?this.props.y:(this.props.y=t,this)},e.prototype.distance=function(t){var e=this.props.x-t.props.x,n=this.props.y-t.props.y;
return Math.sqrt(Math.pow(n,2)+Math.pow(e,2))},e.prototype.manhattan=function(t){return Math.abs(t.props.x-this.props.x)+Math.abs(t.props.y-this.props.y)},e.prototype.angle=function(t){return Graph.util.angle(a.toJson(),t.toJson())},e.prototype.triangle=function(t,e){return this.angle(e)-t.angle(e)},e.prototype.theta=function(t){return Graph.util.theta(this.toJson(),t.toJson())},e.prototype.difference=function(t){return new Graph.lang.Point(this.props.x-t.props.x,this.props.y-t.props.y)},e.prototype.alignment=function(t){return Graph.util.pointAlign(this.toJson(),t.toJson())},e.prototype.bbox=function(){var t=this.props.x,e=this.props.y;return Graph.bbox({x:t,y:e,x2:t,y2:e,width:0,height:0})},e.prototype.bearing=function(t){var e=new Graph.lang.Line(this,t),n=e.bearing();return e=null,n},e.prototype.snap=function(e,n){return n=_.defaultTo(n,e),this.props.x=t(this.props.x,e),this.props.y=t(this.props.y,n),this},e.prototype.move=function(t,e){var n=Graph.util.rad(t.theta(this));return this.expand(Math.cos(n)*e,-Math.sin(n)*e),
this},e.prototype.expand=function(t,e){return this.props.x+=t,this.props.y+=e,this},e.prototype.round=function(t){return this.props.x=t?this.props.x.toFixed(t):Math.round(this.props.x),this.props.y=t?this.props.y.toFixed(t):Math.round(this.props.y),this},e.prototype.equals=function(t){return this.props.x==t.props.x&&this.props.y==t.props.y},e.prototype.rotate=function(t,e){var n=Graph.util.rad(t),r=this.props.x-(e?e.props.x:0),i=this.props.y-(e?e.props.y:0),o=Math.sin(n),s=Math.cos(n),a=r*s+i*o,p=r*-o+i*s;return this.props.x=this.props.x+a,this.props.y=this.props.y+p,this},e.prototype.transform=function(t){var e=this.props.x,n=this.props.y;return this.props.x=t.x(e,n),this.props.y=t.y(e,n),this},e.prototype.polar=function(){},e.prototype.adhereToBox=function(t){return t.contains(this)?this:(this.props.x=Math.min(Math.max(this.props.x,t.props.x),t.props.x+t.props.width),this.props.y=Math.min(Math.max(this.props.y,t.props.y),t.props.y+t.props.height),this)},e.prototype.stringify=function(t){
return t=_.defaultTo(t,","),this.props.x+t+this.props.y},e.prototype.toString=function(){return"Graph.lang.Point"},e.prototype.toValue=function(){return this.stringify()},e.prototype.toJson=function(){return{x:this.props.x,y:this.props.y}},e.prototype.clone=function(){return new e(this.props.x,this.props.y)},Graph.isPoint=function(t){return t instanceof Graph.lang.Point},Graph.point=function(t,e){return new Graph.lang.Point(t,e)}}(),function(){var t=Graph.lang.Line=function(t,e){var n=_.toArray(arguments);this.props={start:{x:0,y:0},end:{x:0,y:0}},4===n.length?(_.assign(this.props.start,{x:n[0],y:n[1]}),_.assign(this.props.end,{x:n[2],y:n[3]})):(this.props.start=n[0].toJson(),this.props.end=n[1].toJson())};t.options={props:{start:{x:0,y:0},end:{x:0,y:0}}},t.extend=Graph.lang.Class.extend,t.prototype.constructor=t,t.prototype.start=function(){return Graph.point(this.props.start.x,this.props.start.y)},t.prototype.end=function(){return Graph.point(this.props.end.x,this.props.end.y)},t.prototype.bearing=function(){
var t=["NE","E","SE","S","SW","W","NW","N"],e=this.props.start.x,n=this.props.start.y,r=this.props.end.x,i=this.props.end.y,o=Graph.util.rad(n),s=Graph.util.rad(i),a=e,p=r,h=Graph.util.rad(p-a),c=Math.sin(h)*Math.cos(s),l=Math.cos(o)*Math.sin(s)-Math.sin(o)*Math.cos(s)*Math.cos(h);return index=Graph.util.deg(Math.atan2(c,l))-22.5,index<0&&(index+=360),index=parseInt(index/45),t[index]},t.prototype.intersect=function(t){return null!==this.intersection(t)},t.prototype.intersection=function(t,e){var n=this.props.start.x,r=this.props.start.y,i=this.props.end.x,o=this.props.end.y,s=t.props.start.x,a=t.props.start.y,p=t.props.end.x,h=t.props.end.y,c=Graph.util.lineIntersection(n,r,i,o,s,a,p,h);return c?e?c:Graph.point(c.x,c.y):c},t.prototype.toString=function(){return"Graph.lang.Line"},Graph.line=function(t){var e=_.toArray(arguments);return Graph.factory(Graph.lang.Line,e)},Graph.isLine=function(t){return t instanceof Graph.lang.Line}}(),function(){var t=Graph.lang.Curve=function(t){if(this.segments=_.isString(t)?Graph.util.path2segments(t):_.cloneDeep(t),
"M"!=this.segments[0][0]&&this.segments.unshift(["M",this.segments[0][1],this.segments[0][2]]),1===this.segments.length&&"M"===this.segments[0][0]){var e=this.segments[0][1],n=this.segments[0][2];this.segments.push(["C",e,n,e,n,e,n])}};t.options={segments:[]},t.extend=Graph.lang.Class.extend,t.prototype.constructor=t,t.prototype.segments=[],t.prototype.x=function(){return this.segments[1][5]},t.prototype.y=function(){return this.segments[1][6]},t.prototype.length=function(t){var e=this.segments[0].slice(1).concat(this.segments[1].slice(1)).concat([t]);return Graph.util.curveLength.apply(null,e)},t.prototype.t=function(t){var e=this.segments[0].slice(1).concat(this.segments[1].slice(1)).concat([t]);return Graph.util.curveInterval.apply(null,e)},t.prototype.pointAt=function(t,e){var n=this.segments[0].slice(1).concat(this.segments[1].slice(1)).concat([t]),r=Graph.util.pointAtInterval.apply(null,n);if(e)return r;var i=Graph.point(r.x,r.y);return r.x=r.y=void 0,_.extend(i,r)},t.prototype.intersection=function(t,e){
var n=this.segments[0].slice(1).concat(this.segments[1].slice(1)),r=t.segments[0].slice(1).concat(t.segments[1].slice(1)),i=Graph.util.curveIntersection(n,r);if(e)return i;var o=_.map(i,function(t){return Graph.point(t.x,t.y)});return o},t.prototype.intersectnum=function(t){var e=this.segments[0].slice(1).concat(this.segments[1].slice(1)),n=t.segments[0].slice(1).concat(t.segments[1].slice(1));return Graph.util.curveIntersection(e,n,!0)},t.prototype.bbox=function(){var t=[this.segments[0][1],this.segments[0][2]].concat(this.segments[1].slice(1)),e=Graph.util.curvebox.apply(null,t);return Graph.bbox({x:e.min.x,y:e.min.y,x2:e.max.x,y2:e.max.y,width:e.max.x-e.min.x,height:e.max.y-e.min.y})},t.prototype.clone=function(){var t=_.cloneDeep(this.segments);return new Graph.lang.Curve(t)},t.prototype.toValue=function(){return Graph.util.segments2path(this.segments)},t.prototype.toString=function(){return"Graph.lang.Curve"},Graph.curve=function(t){return new Graph.lang.Curve(t)},Graph.isCurve=function(t){
return t instanceof Graph.lang.Curve}}(),function(){var t=Graph.lang.BBox=function(t){this.props=_.extend({x:0,y:0,x2:0,y2:0,width:0,height:0},t||{})};t.options={props:{x:0,y:0,x2:0,y2:0,width:0,height:0}},t.extend=Graph.lang.Class.extend,t.prototype=Object.create(Graph.lang.Class.prototype),t.prototype.constructor=t,t.prototype.superclass=Graph.lang.Class,t.prototype.shape=function(){var t=this.props;return new Graph.lang.Path([["M",t.x,t.y],["l",t.width,0],["l",0,t.height],["l",-t.width,0],["z"]])},t.prototype.origin=function(t){t=_.defaultTo(t,!1);var e=this.props.x,n=this.props.y;return t?{x:e,y:n}:Graph.point(e,n)},t.prototype.center=function(t){t=_.defaultTo(t,!1);var e=this.props.x+this.props.width/2,n=this.props.y+this.props.height/2;return t?{x:e,y:n}:Graph.point(e,n)},t.prototype.corner=function(t){t=_.defaultTo(t,!1);var e=this.props.x+this.props.width,n=this.props.y+this.props.height;return t?{x:e,y:n}:Graph.point(e,n)},t.prototype.width=function(){return this.props.width},t.prototype.height=function(){
return this.props.height},t.prototype.clone=function(){var e=_.extend({},this.props);return new t(e)},t.prototype.contains=function(t){var e,n=!0,r=this.props,i=[];if(Graph.isPoint(t))i=[[t.props.x,t.props.y]];else if(Graph.isVector(t))i=t.vertices(!0);else if(Graph.isBBox(t))i=[[t.props.x,t.props.y],[t.props.x2,t.props.y2]];else{var o=_.toArray(arguments);2===o.length&&(i=[o])}if(i.length)for(var s=i.length;s--&&(e=i[s],n=e[0]>=r.x&&e[0]<=r.x2&&e[1]>=r.y&&e[1]<=r.y2););return n},t.prototype.expand=function(t,e,n,r){var i,o;return _.isUndefined(e)?(i=Math.abs(t),t=-i,e=-i,n=2*i,r=2*i):(i=Math.abs(t),o=Math.abs(e),t=-i,e=-o,n=2*i,r=2*o),this.props.x+=t,this.props.y+=e,this.props.width+=n,this.props.height+=r,this},t.prototype.translate=function(t,e){return this.props.x+=t,this.props.y+=e,this.props.x2+=t,this.props.y2+=e,this},t.prototype.transform=function(t){var e=this.props.x,n=this.props.y;return this.props.x=t.x(e,n),this.props.y=t.y(e,n),e=this.props.x2,n=this.props.y2,this.props.x2=t.x(e,n),
this.props.y2=t.y(e,n),this.props.width=this.props.x2-this.props.x,this.props.height=this.props.y2-this.props.y,this},t.prototype.intersect=function(t){var e=this,n=e.props,r=t.toJson();return t.contains(n.x,n.y)||t.contains(n.x2,n.y)||t.contains(n.x,n.y2)||t.contains(n.x2,n.y2)||e.contains(r.x,r.y)||e.contains(r.x2,r.y)||e.contains(r.x,r.y2)||e.contains(r.x2,r.y2)||(n.x<r.x2&&n.x>r.x||r.x<n.x2&&r.x>n.x)&&(n.y<r.y2&&n.y>r.y||r.y<n.y2&&r.y>n.y)},t.prototype.sideNearestPoint=function(t){var e=t.props.x,n=t.props.y,r=this.props.x,i=this.props.y,o=this.props.width,s=this.props.height,a=e-r,p=r+o-e,h=n-i,c=i+s-n,l=a,u="left";return p<l&&(l=p,u="right"),h<l&&(l=h,u="top"),c<l&&(l=c,u="bottom"),u},t.prototype.pointNearestPoint=function(t){if(this.contains(t)){var e=this.sideNearestPoint(t);switch(e){case"right":return Graph.point(this.props.x+this.props.width,t.props.y);case"left":return Graph.point(this.props.x,t.props.y);case"bottom":return Graph.point(t.props.x,this.props.y+this.props.height);
case"top":return Graph.point(t.props.x,this.props.y)}}return t.clone().adhereToBox(this)},t.prototype.toJson=function(){return _.clone(this.props)},t.prototype.toString=function(){return"Graph.lang.BBox"},t.prototype.toValue=function(){var t=this.props;return _.format("{0},{1} {2},{3} {4},{5} {6},{7}",t.x,t.y,t.x+t.width,t.y,t.x+t.width,t.y+t.height,t.x,t.y+t.height)},Graph.isBBox=function(t){return t instanceof Graph.lang.BBox},Graph.bbox=function(t){return new Graph.lang.BBox(t)}}(),function(){function t(t,e,o){var s,a,p={T:1,Q:1};if(!t)return["C",e.x,e.y,e.x,e.y,e.x,e.y];switch(!(t[0]in p)&&(e.qx=e.qy=null),t[0]){case"M":e.X=t[1],e.Y=t[2];break;case"A":t=["C"].concat(i.apply(0,[e.x,e.y].concat(t.slice(1))));break;case"S":"C"==o||"S"==o?(s=2*e.x-e.bx,a=2*e.y-e.by):(s=e.x,a=e.y),t=["C",s,a].concat(t.slice(1));break;case"T":"Q"==o||"T"==o?(e.qx=2*e.x-e.qx,e.qy=2*e.y-e.qy):(e.qx=e.x,e.qy=e.y),t=["C"].concat(r(e.x,e.y,e.qx,e.qy,t[1],t[2]));break;case"Q":e.qx=t[1],e.qy=t[2],t=["C"].concat(r(e.x,e.y,t[1],t[2],t[3],t[4]));
break;case"L":t=["C"].concat(n(e.x,e.y,t[1],t[2]));break;case"H":t=["C"].concat(n(e.x,e.y,t[1],e.y));break;case"V":t=["C"].concat(n(e.x,e.y,e.x,t[1]));break;case"Z":t=["C"].concat(n(e.x,e.y,e.X,e.Y))}return t}function e(t,e){for(var n=[],r=_.defaultTo,i=0,o=t.length;o-2*!e>i;i+=2){var s=[{x:r(t[i-2],0),y:r(t[i-1],0)},{x:r(t[i],0),y:r(t[i+1],0)},{x:r(t[i+2],0),y:r(t[i+3],0)},{x:r(t[i+4],0),y:r(t[i+5],0)}];e?i?o-4==i?s[3]={x:r(t[0],0),y:r(t[1],0)}:o-2==i&&(s[2]={x:r(t[0],0),y:r(t[1],0)},s[3]={x:r(t[2],0),y:r(t[3],0)}):s[0]={x:r(t[o-2],0),y:r(t[o-1],0)}:o-4==i?s[3]=s[2]:i||(s[0]={x:r(t[i],0),y:r(t[i+1],0)}),n=[(-s[0].x+6*s[1].x+s[2].x)/6,(-s[0].y+6*s[1].y+s[2].y)/6,(s[1].x+6*s[2].x-s[3].x)/6,(s[1].y+6*s[2].y-s[3].y)/6,s[2].x,s[2].y]}return n}function n(t,e,n,r){return[t,e,n,r,n,r]}function r(t,e,n,r,i,o){var s=1/3,a=2/3;return[s*t+a*n,s*e+a*r,s*i+a*n,s*o+a*r,i,o]}function i(t,e,n,r,o,s,a,p,h,c){var l,u=120*Math.PI/180,d=Math.PI/180*(+o||0),f=[],g=Graph.memoize(function(t,e,n){var r=t*Math.cos(n)-e*Math.sin(n),i=t*Math.sin(n)+e*Math.cos(n);
return{x:r,y:i}});if(c)k=c[0],C=c[1],_=c[2],w=c[3];else{l=g(t,e,-d),t=l.x,e=l.y,l=g(p,h,-d),p=l.x,h=l.y;var y=(Math.cos(Math.PI/180*o),Math.sin(Math.PI/180*o),(t-p)/2),v=(e-h)/2,m=y*y/(n*n)+v*v/(r*r);m>1&&(m=Math.sqrt(m),n=m*n,r=m*r);var x=n*n,b=r*r,G=(s==a?-1:1)*Math.sqrt(Math.abs((x*b-x*v*v-b*y*y)/(x*v*v+b*y*y))),_=G*n*v/r+(t+p)/2,w=G*-r*y/n+(e+h)/2,k=Math.asin(((e-w)/r).toFixed(9)),C=Math.asin(((h-w)/r).toFixed(9));k=t<_?Math.PI-k:k,C=p<_?Math.PI-C:C,k<0&&(k=2*Math.PI+k),C<0&&(C=2*Math.PI+C),a&&k>C&&(k-=2*Math.PI),!a&&C>k&&(C-=2*Math.PI)}var S=C-k;if(Math.abs(S)>u){var T=C,E=p,D=h;C=k+u*(a&&C>k?1:-1),p=_+n*Math.cos(C),h=w+r*Math.sin(C),f=i(p,h,n,r,o,0,a,E,D,[C,T,_,w])}S=C-k;var A=Math.cos(k),M=Math.sin(k),z=Math.cos(C),P=Math.sin(C),L=Math.tan(S/4),R=4/3*n*L,O=4/3*r*L,V=[t,e],B=[t+R*M,e-O*A],H=[p+R*P,h-O*z],I=[p,h];if(B[0]=2*V[0]-B[0],B[1]=2*V[1]-B[1],c)return[B,H,I].concat(f);f=[B,H,I].concat(f).join().split(",");for(var N=[],q=0,J=f.length;q<J;q++)N[q]=q%2?g(f[q-1],f[q],d).y:g(f[q],f[q+1],d).x;
return N}function o(t,e,n){var r,i,o,s,a,p,h,c,l,u,d,f,g,y,v,m,x,b=t.curve().segments,G=b.length,_=e.curve().segments,w=_.length,k=n?0:[];for(v=0;v<G;v++)if(g=b[v],"M"==g[0])r=a=g[1],i=p=g[2];else for("C"==g[0]?(l=[["M",r,i],g],d=[r,i].concat(g.slice(1)),r=g[5],i=g[6]):(l=[["M",r,i],["C",r,i,a,p,a,a]],d=[r,i,r,i,a,p,a,p],r=a,i=p),m=0;m<w;m++)if(y=_[m],"M"==y[0])o=h=y[1],s=c=y[2];else if("C"==y[0]?(u=[["M",o,s],y],f=[o,s].concat(y.slice(1)),o=y[5],s=y[6]):(u=[["M",o,s],["C",o,s,h,c,h,c]],f=[o,s,o,s,h,c,h,c],o=h,s=c),n)k+=Graph.util.curveIntersection(d,f,!0);else{x=Graph.util.curveIntersection(d,f);for(var C=0,S=x.length;C<S;C++)x[C].segment1=v,x[C].segment2=m,x[C].bezier1=l,x[C].bezier2=u;k=k.concat(x)}return k}var s=Graph.lang.Path=function(t){var e=[];e=Graph.isPath(t)?_.cloneDeep(t.segments):_.isArray(t)?_.cloneDeep(t):_.cloneDeep(Graph.util.path2segments(t)),this.segments=e};s.options={segments:[]},s.extend=Graph.lang.Class.extend,s.prototype.constructor=s,s.prototype.command=function(){
return Graph.util.segments2path(this.segments)},s.prototype.absolute=function(){if(!this.segments.length)return new s([["M",0,0]]);var t=Graph.lookup(this.toString(),"absolute",this.toValue()),n=this.segments;if(t.absolute)return t.absolute;var r=[],i=0,o=0,a=0,p=0,h=0;"M"==n[0][0]&&(i=+n[0][1],o=+n[0][2],a=i,p=o,h++,r[0]=["M",i,o]);for(var c,l,u,d=3==n.length&&"M"==n[0][0]&&"R"==n[1][0].toUpperCase()&&"Z"==n[2][0].toUpperCase(),f=h,g=n.length;f<g;f++){if(r.push(l=[]),u=n[f],u[0]!=_.toUpper(u[0]))switch(l[0]=_.toUpper(u[0]),l[0]){case"A":l[1]=u[1],l[2]=u[2],l[3]=u[3],l[4]=u[4],l[5]=u[5],l[6]=+(u[6]+i),l[7]=+(u[7]+o);break;case"V":l[1]=+u[1]+o;break;case"H":l[1]=+u[1]+i;break;case"R":c=_.concat([i,o],u.slice(1));for(var y=2,v=c.length;y<v;y++)c[y]=+c[y]+i,c[++y]=+c[y]+o;r.pop(),r=_.concat(r,[["C"].concat(e(c,d))]);break;case"M":a=+u[1]+i,p=+u[2]+o;default:for(var m=1,x=u.length;m<x;m++)l[m]=+u[m]+(m%2?i:o)}else if("R"==u[0])c=_.concat([i,o],u.slice(1)),r.pop(),r=_.concat(r,[["C"].concat(e(c,d))]),
l=_.concat(["R"],u.slice(-2));else for(var b=0,G=u.length;b<G;b++)l[b]=u[b];switch(l[0]){case"Z":i=a,o=p;break;case"H":i=l[1];break;case"V":o=l[1];break;case"M":a=l[l.length-2],p=l[l.length-1];default:i=l[l.length-2],o=l[l.length-1]}}return t.absolute=r=new s(r),r},s.prototype.start=function(){return this.pointAt(0)},s.prototype.end=function(){return this.pointAt(this.length())},s.prototype.head=function(){},s.prototype.tail=function(){},s.prototype.relative=function(){var t=Graph.lookup(this.toString(),"relative",this.toValue()),e=this.segments;if(t.relative)return t.relative;var n=[],r=0,i=0,o=0,a=0,p=0;"M"==e[0][0]&&(r=e[0][1],i=e[0][2],o=r,a=i,p++,n.push(["M",r,i]));for(var h=p,c=e.length;h<c;h++){var l=n[h]=[],u=e[h];if(u[0]!=_.toLower(u[0]))switch(l[0]=_.toLower(u[0]),l[0]){case"a":l[1]=u[1],l[2]=u[2],l[3]=u[3],l[4]=u[4],l[5]=u[5],l[6]=+(u[6]-r).toFixed(3),l[7]=+(u[7]-i).toFixed(3);break;case"v":l[1]=+(u[1]-i).toFixed(3);break;case"m":o=u[1],a=u[2];default:for(var d=1,f=u.length;d<f;d++)l[d]=+(u[d]-(d%2?r:i)).toFixed(3);
}else{l=res[h]=[],"m"==u[0]&&(o=u[1]+r,a=u[2]+i);for(var g=0,y=u.length;g<y;g++)res[h][g]=u[g]}var v=n[h].length;switch(n[h][0]){case"z":r=o,i=a;break;case"h":r+=+n[h][v-1];break;case"v":i+=+n[h][v-1];break;default:r+=+n[h][v-2],i+=+n[h][v-1]}}return t.relative=n=new s(n),n},s.prototype.curve=function(){function e(t,e){if(t[e].length>7){t[e].shift();for(var n=t[e];n.length;)o[e]="A",t.splice(e++,0,["C"].concat(n.splice(0,6)));t.splice(e,1),c=r.length}}var n=Graph.lookup(this.toString(),"curve",this.toValue());if(n.curve)return n.curve;for(var r=_.cloneDeep(this.absolute().segments),i={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},o=[],a="",p="",h=0,c=r.length;h<c;h++){r[h]&&(a=r[h][0]),"C"!=a&&(o[h]=a,h&&(p=o[h-1])),r[h]=t(r[h],i,p),"A"!=o[h]&&"C"==a&&(o[h]="C"),e(r,h);var l=r[h],u=l.length;i.x=l[u-2],i.y=l[u-1],i.bx=_.float(l[u-4])||i.x,i.by=_.float(l[u-3])||i.y}return n.curve=new s(r),n.curve},s.prototype.curve2curve=function(e){function n(t,e){if(t[e].length>7){t[e].shift();for(var n=t[e];n.length;)h[e]="A",
c[e]="A",t.splice(e++,0,["C"].concat(n.splice(0,6)));t.splice(e,1),f=_.max([i.length,o.length])}}function r(t,e,n,r,s){t&&e&&"M"==t[s][0]&&"M"!=e[s][0]&&(e.splice(s,0,["M",r.x,r.y]),n.bx=0,n.by=0,n.x=t[s][1],n.y=t[s][2],f=_.max([i.length,o&&o.length||0]))}for(var i=_.cloneDeep(this.absolute().segments),o=_.cloneDeep(new s(e).absolute().segments),a={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},p={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},h=[],c=[],l="",u="",d=0,f=_.max([i.length,o.length]);d<f;d++){i[d]&&(l=i[d][0]),"C"!=l&&(h[d]=l,d&&(u=h[d-1])),i[d]=t(i[d],a,u),"A"!=h[d]&&"C"==l&&(h[d]="C"),n(i,d),o[d]&&(l=o[d][0]),"C"!=l&&(c[d]=l,d&&(u=c[d-1])),o[d]=t(o[d],attrs2,pcom),"A"!=c[d]&&"C"==l&&(c[d]="C"),fixArc2(o,d),r(i,o,a,p,d),r(o,i,p,a,d);var g=i[d],y=o[d],v=g.length,m=y.length;a.x=g[v-2],a.y=g[v-1],a.bx=_.float(g[v-4])||a.x,a.by=_.float(g[v-3])||a.y,p.bx=_.float(y[m-4])||p.x,p.by=_.float(y[m-3])||p.y,p.x=y[m-2],p.y=y[m-1]}return[new s(i),new s(o)]},s.prototype.bbox=function(){if(!this.segments.length)return Graph.bbox({
x:0,y:0,width:0,height:0,x2:0,y2:0});var t=Graph.lookup(this.toString(),"bbox",this.toValue());if(t.bbox)return t.bbox;for(var e,n=this.curve().segments,r=0,i=0,o=[],s=[],a=0,p=n.length;a<p;a++)if(e=n[a],"M"==e[0])r=e[1],i=e[2],o.push(r),s.push(i);else{var h=Graph.util.curvebox(r,i,e[1],e[2],e[3],e[4],e[5],e[6]);o=o.concat(h.min.x,h.max.x),s=s.concat(h.min.y,h.max.y),r=e[5],i=e[6]}var c=_.min(o),l=_.min(s),u=_.max(o),d=_.max(s),f=u-c,g=d-l,y={x:c,y:l,x2:u,y2:d,width:f,height:g,cx:c+f/2,cy:l+g/2};return t.bbox=Graph.bbox(y),t.bbox},s.prototype.transform=function(t){if(t){var e=Graph.lookup(this.toString(),"transform",this.toValue(),t.toValue());if(e.transform)return e.transform;var n,r,i,o,a,p,h,c=_.cloneDeep(this.curve().segments);for(i=0,o=c.length;i<o;i++)for(h=c[i],a=1,p=h.length;a<p;a+=2)n=t.x(h[a],h[a+1]),r=t.y(h[a],h[a+1]),h[a]=n,h[a+1]=r;return e.transform=new s(c),e.transform}},s.prototype.lengthAt=function(t){},s.prototype.pointAt=function(t,e){var n,r,i,o,s,a,p,h=this.curve().segments;
e=_.defaultTo(e,!1),s=0;for(var c=0,l=h.length;c<l;c++)if(r=h[c],"M"==r[0])i=r[1],o=r[2];else{if(a=Graph.curve([["M",i,o],r]),p=a.length(),s+p>t)return n=a.pointAt(a.t(t-s),e),a=null,n;s+=p,i=r[5],o=r[6],a=null}return a=Graph.curve([["M",i,o],r]),n=a.pointAt(1,e),a=null,n},s.prototype.segmentAt=function(t){var e,n,r,i,o=this.curve().segments,s=-1,a=0;return _.forEach(o,function(o,p){if("M"==o[0])e=o[1],n=o[2];else{if(i=Graph.curve([["M",e,n],o]),e=i.x(),n=i.y(),r=i.length(),r+a>t)return s=p,!1;a+=r,i=null}}),s},s.prototype.length=function(){var t,e,n,r,i,o=this.curve().segments;r=0;for(var s=0,a=o.length;s<a;s++)t=o[s],"M"==t[0]?(e=t[1],n=t[2]):(i=Graph.curve([["M",e,n],t]),r+=i.length(),e=t[5],n=t[6],i=null);return r},s.prototype.slice=function(t,e){var n,r,i,o,s,a,p,h,c=this.curve().segments,l={};a=0,r="";for(var u=0,d=c.length;u<d;u++)i=c[u],"M"==i[0]?(o=i[1],s=i[2]):(p=Graph.curve([["M",o,s],i]),h=p.length(),a+h>length&&(n=p.pointAt(p.t(length-a)),r+=["C"+n.start.x,n.start.y,n.m.x,n.m.y,n.props.x,n.props.y],
l.start=Graph.path(r),r=["M"+n.props.x,n.props.y+"C"+n.n.x,n.n.y,n.end.x,n.end.y,i[5],i[6]].join()),a+=h,o=i[5],s=i[6],p=null),r+=i.shift()+i;return l.end=Graph.path(r),l},s.prototype.vertices=function(){var t=Graph.lookup(this.toString(),"vertices",this.toValue());if(t.vertices)return t.vertices;var e=this.segments,n=[];return _.forEach(e,function(t){var e,r,i=t.length;"Z"!=t[0]&&("M"==t[0]?(e=t[1],r=t[2]):(e=t[i-2],r=t[i-1]),n.push(Graph.point(e,r)))}),t.vertices=n,t.vertices},s.prototype.addVertext=function(t){var e,n,r,i,o=this.isSimple(),s=o?_.cloneDeep(this.segments):this.curve().segments,a=-1,p=t.props.x,h=t.props.y,c=0,l=0;return _.forEach(s,function(t,o){if("Z"!=t[0])if("M"==t[0])e=t[1],n=t[2];else if("L"==t[0]?(r=Graph.curve([["M",e,n],["C",e,n,e,n,t[1],t[2]]]),e=t[1],n=t[2]):(r=Graph.curve([["M",e,n],t]),e=r.x(),n=r.y()),i=r.clone(),i.segments[1][5]=p,i.segments[1][6]=h,c+=r.length(),l+=i.length(),l<=c)return a=o,!1}),a>-1&&(o?s.splice(a,0,["L",p,h]):s.splice(a,0,["C",p,h,p,h,p,h]),
this.segments=s),this},s.prototype.intersect=function(t){return o(this,t,!0)>0},s.prototype.intersection=function(t,e){var n=o(this,t);return e?n:_.map(n,function(t){var e=Graph.point(t.x,t.y);return e.segment1=t.segment1,e.segment2=t.segment2,e.bezier1=t.bezier1,e.bezier2=t.bezier2,e})},s.prototype.intersectnum=function(t){return o(this,t,!0)},s.prototype.alpha=function(t){},s.prototype.contains=function(t){var e,n,r,i,o;return i=t.props.x,o=t.props.y,e=this.bbox(),r=e.toJson(),n=new s([["M",i,o],["H",r.x2+10]]),e.contains(t)&&this.intersectnum(n)%2==1},s.prototype.nearest=function(t){var e,n,r,i,o,s=this.length(),a=20,p=1/0,h=Graph.util.taxicab;for(Graph.isPoint(t)&&(t=t.toJson()),o=0;o<s;o+=a)r=this.pointAt(o,!0),i=h(r,t),i<p&&(p=i,e=r,n=o);a/=2;for(var c,l,u,d,f,g;a>.5;)(u=n-a)>=0&&(f=h(c=this.pointAt(u,!0),t))<p?(e=c,n=u,p=f):(d=n+a)<=s&&(g=h(l=this.pointAt(d,!0),t))<p?(e=l,n=d,p=g):a/=2;return e.distance=n,e},s.prototype.isSimple=function(){var t=!0;return _.forEach(this.segments,function(e){
if(!/[MLZ]/i.test(e[0]))return t=!1,!1}),t},s.prototype.moveTo=function(t,e){var n=this.segments;return n.length?(n[0][0]="M",n[0][1]=t,n[0][2]=e):n=[["M",t,e]],this},s.prototype.lineTo=function(t,e,n){var r=this.segments;if(n=_.defaultTo(n,!0),r){var i=r.length-1;"M"==r[i][0]||n?r.push(["L",t,e]):(r[i][1]=t,r[i][2]=e)}return this},s.prototype.toString=function(){return"Graph.lang.Path"},s.prototype.toValue=function(){return Graph.util.segments2path(this.segments)},s.prototype.toArray=function(){return this.segments},s.prototype.clone=function(){var t=[];return _.forEach(this.segments,function(e){t.push(e.slice())}),new s(t)},Graph.isPath=function(t){return t instanceof Graph.lang.Path},Graph.path=function(t){return new Graph.lang.Path(t)}}(),function(){var t=Graph.lang.Matrix=function(t,e,n,r,i,o){this.props={},this.props.a=_.defaultTo(t,1),this.props.b=_.defaultTo(e,0),this.props.c=_.defaultTo(n,0),this.props.d=_.defaultTo(r,1),this.props.e=_.defaultTo(i,0),this.props.f=_.defaultTo(o,0);
};t.options={props:{a:1,b:0,c:0,d:1,e:0,f:0}},t.extend=Graph.lang.Class.extend,t.prototype.constructor=t,t.prototype.x=function(t,e){return t*this.props.a+e*this.props.c+this.props.e},t.prototype.y=function(t,e){return t*this.props.b+e*this.props.d+this.props.f},t.prototype.get=function(t){return+this.props[t].toFixed(4)},t.prototype.multiply=function(t,e,n,r,i,o){var s,a,p,h,c=[[],[],[]],l=[[this.props.a,this.props.c,this.props.e],[this.props.b,this.props.d,this.props.f],[0,0,1]],u=[[t,n,i],[e,r,o],[0,0,1]];for(Graph.isMatrix(t)&&(u=[[t.props.a,t.props.c,t.props.e],[t.props.b,t.props.d,t.props.f],[0,0,1]]),s=0;s<3;s++)for(a=0;a<3;a++){for(h=0,p=0;p<3;p++)h+=l[s][p]*u[p][a];c[s][a]=h}return this.props.a=c[0][0],this.props.b=c[1][0],this.props.c=c[0][1],this.props.d=c[1][1],this.props.e=c[0][2],this.props.f=c[1][2],this},t.prototype.invert=function(t){var e,n,r,i,o,s,a=this.props.a*this.props.d-this.props.b*this.props.c;return t=_.defaultTo(t,!1),e=this.props.d/a,n=-this.props.b/a,r=-this.props.c/a,
i=this.props.a/a,o=(this.props.c*this.props.f-this.props.d*this.props.e)/a,s=(this.props.b*this.props.e-this.props.a*this.props.f)/a,t?new Graph.matrix(e,n,r,i,o,s):(this.props.a=e,this.props.b=n,this.props.c=r,this.props.d=i,this.props.e=o,this.props.f=s,this)},t.prototype.translate=function(t,e){return t=_.defaultTo(t,0),e=_.defaultTo(e,0),this.multiply(1,0,0,1,t,e),this},t.prototype.rotate=function(t,e,n){if(void 0===t){var r=this.delta(0,1),i=(this.delta(1,0),180/Math.PI*Math.atan2(r.y,r.x)-90),o=Graph.util.rad(i);return{deg:i,rad:o}}t=Graph.util.rad(t),e=_.defaultTo(e,0),n=_.defaultTo(n,0);var s=+Math.cos(t).toFixed(9),a=+Math.sin(t).toFixed(9);return this.multiply(s,a,-a,s,e,n),this.multiply(1,0,0,1,-e,-n),this},t.prototype.scale=function(t,e,n,r){if(void 0===t){var i=this.props,t=Graph.util.hypo(i.a,i.b),e=Graph.util.hypo(i.c,i.d);return this.determinant()<0&&(t=-t),{x:t,y:e}}return e=_.defaultTo(e,t),(n||r)&&(n=_.defaultTo(n,0),r=_.defaultTo(r,0)),(n||r)&&this.multiply(1,0,0,1,n,r),
this.multiply(t,0,0,e,0,0),(n||r)&&this.multiply(1,0,0,1,-n,-r),this},t.prototype.determinant=function(){return this.props.a*this.props.d-this.props.b*this.props.c},t.prototype.delta=function(t,e){return{x:t*this.props.a+e*this.props.c+0,y:t*this.props.b+e*this.props.d+0}},t.prototype.data=function(){var t=this.delta(0,1),e=this.delta(1,0),n=180/Math.PI*Math.atan2(t.y,t.x)-90,r=Graph.util.rad(n),i=Math.cos(r),o=Math.sin(r),s=Graph.util.hypo(this.props.a,this.props.b),a=Graph.util.hypo(this.props.c,this.props.d),p=Graph.util.rad(n);return this.determinant()<0&&(s=-s),{x:this.props.e,y:this.props.f,dx:(this.props.e*i+this.props.f*o)/s,dy:(this.props.f*i+this.props.e*-o)/a,skewX:-n,skewY:180/Math.PI*Math.atan2(e.y,e.x),scaleX:s,scaleY:a,rotate:n,rad:p,sin:Math.sin(p),cos:Math.cos(p),a:this.props.a,b:this.props.b,c:this.props.c,d:this.props.d,e:this.props.e,f:this.props.f}},t.prototype.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get("a")+", M12="+this.get("c")+", M21="+this.get("b")+", M22="+this.get("d")+", Dx="+this.get("e")+", Dy="+this.get("f")+", sizingmethod='auto expand')";
},t.prototype.toArray=function(){return[[this.get("a"),this.get("c"),this.get("e")],[this.get("b"),this.get("d"),this.get("f")],[0,0,1]]},t.prototype.toValue=function(){return _.format("matrix({0},{1},{2},{3},{4},{5})",this.get("a"),this.get("b"),this.get("c"),this.get("d"),this.get("e"),this.get("f"))},t.prototype.toString=function(){return"Graph.lang.Matrix"},t.prototype.clone=function(){return new t(this.props.a,this.props.b,this.props.c,this.props.d,this.props.e,this.props.f)},Graph.isMatrix=function(t){return t instanceof Graph.lang.Matrix},Graph.matrix=function(t,e,n,r,i,o){return new Graph.lang.Matrix(t,e,n,r,i,o)}}(),function(){var t=Graph.collection.Point=function(t){this.items=t||[]};t.prototype.constructor=t,t.prototype.items=[],t.prototype.get=function(t){return this.items[t]},t.prototype.push=function(t){return this.items.push(t),t},t.prototype.pop=function(){var t=this.items.pop();return t},t.prototype.shift=function(){var t=this.items.shift();return t},t.prototype.first=function(){
return _.head(this.items)},t.prototype.last=function(){return _.last(this.items)},t.prototype.clear=function(){return this.items=[],this},t.prototype.modify=function(t,e,n){var r=this.items[t];return r.props.x=e,r.props.y=n,r},t.prototype.each=function(t){_.forEach(this.items,t)},t.prototype.toArray=function(){return this.items},t.prototype.toJson=function(){return _.map(this.items,function(t){return t.toJson()})}}(),function(){var t=Graph.collection.Vector=function(t){this.items=_.map(t||[],function(t){return t.guid()}),t=null};t.prototype.constructor=t,t.prototype.has=function(t){var e=t.guid();return _.indexOf(this.items,e)>-1},t.prototype.not=function(e){var n=e.guid(),r=_.filter(this.items,function(t){return t!=n});return new t(r)},t.prototype.size=function(){return this.items.length},t.prototype.index=function(t){var e=t.guid();return _.indexOf(this.items,e)},t.prototype.push=function(t){var e=t.guid();return this.items.push(e),this.items.length},t.prototype.pop=function(){var t=this.items.pop();
return Graph.registry.vector.get(t)},t.prototype.shift=function(){var t=this.items.shift();return Graph.registry.vector.get(t)},t.prototype.unshift=function(t){var e=t.guid();this.items.unshift(e)},t.prototype.insert=function(t,e){e===-1&&(e=0),this.items.splice(e,0,t.guid())},t.prototype.pull=function(t){var e=t.guid();_.pull(this.items,e)},t.prototype.clear=function(){this.items=[]},t.prototype.reverse=function(){return this.items.reverse(),this},t.prototype.each=function(t){_.forEach(this.items,function(e){var n=Graph.registry.vector.get(e);t.call(n,n)})},t.prototype.bbox=function(){for(var t,e,n=[],r=[],i=[],o=[],s=this.items.length-1;s>=0;s--)t=Graph.registry.vector.get(this.items[s]),e=t.bbox().toJson(),n.push(e.x),r.push(e.y),i.push(e.x+e.width),o.push(e.y+e.height);return n=_.min(n),r=_.min(r),i=_.max(i),o=_.max(o),Graph.bbox({x:n,y:r,x2:i,y2:o,width:i-n,height:o-r})},t.prototype.toArray=function(){return _.map(this.items,function(t){return Graph.registry.vector.get(t)})},t.prototype.toString=function(){
return"Graph.collection.Vector"};var e=["attr","remove"];_.forEach(e,function(e){!function(e){t.prototype[e]=function(){var t=_.toArray(arguments);return this.each(function(n){n[e].apply(n,t)}),this}}(e)})}(),function(){var t=Graph.collection.Shape=function(t){this.items=_.map(t,function(t){return t.guid()}),t=null};t.prototype.constructor=t,t.prototype.keys=function(){return this.items.slice()},t.prototype.size=function(){return this.items.length},t.prototype.index=function(t){var e=t.guid();return _.indexOf(this.items,e)},t.prototype.has=function(t){var e=t.guid();return _.indexOf(this.items,e)!==-1},t.prototype.find=function(t){var e=this.toArray();return _.find(e,t)},t.prototype.push=function(t){var e=this;return _.isArray(t)?_.forEach(t,function(t){var n=t.guid();e.items.push(n)}):e.items.push(t.guid()),e.items.length},t.prototype.pop=function(){var t=this.items.pop();return Graph.registry.shape.get(t)},t.prototype.shift=function(){var t=this.items.shift();return Graph.registry.shape.get(t);
},t.prototype.unshift=function(t){return this.items.unshift(t),t},t.prototype.pull=function(t){var e=t.guid();_.pull(this.items,e)},t.prototype.last=function(){return _.last(this.items)},t.prototype.each=function(t){var e=this;_.forEach(e.items,function(e,n){var r=Graph.registry.shape.get(e);r&&t.call(r,r,n)})},t.prototype.bbox=function(){for(var t,e,n,r=[],i=[],o=[],s=[],a=this.items.length-1;a>=0;a--)t=Graph.registry.shape.get(this.items[a]),e=t.component(),n=e.bbox().toJson(),r.push(n.x),i.push(n.y),o.push(n.x+n.width),s.push(n.y+n.height);return r=_.min(r),i=_.min(i),o=_.max(o),s=_.max(s),Graph.bbox({x:r,y:i,x2:o,y2:s,width:o-r,height:s-i})},t.prototype.toArray=function(){return _.map(this.items,function(t){return Graph.registry.shape.get(t)})},t.prototype.toString=function(){return"Graph.collection.Shape"}}(),function(){var t=Graph.collection.Tree=function(t){var e=this;e.nodes=t,e.key=function(t){return t},e.bisect=_.bisector(function(t){return e.key(t)}).left};t.prototype.get=function(t){
return this.nodes[t]},t.prototype.size=function(){return this.nodes.length},t.prototype.insert=function(t){var e=this.index(t),n=this.key(t);if(!this.nodes[e]||n!=this.key(this.nodes[e]))return this.nodes.splice(e,0,t),e},t.prototype.remove=function(t){var e=this.index(t);return this.nodes.splice(e,1),e},t.prototype.keygen=function(t){return this.key=t,this},t.prototype.index=function(t){return this.bisect(this.nodes,this.key(t))},t.prototype.order=function(){return this.nodes.sort(_.ascendingKey(this.key)),this},t.prototype.root=function(){return this.nodes[0]},t.prototype.cascade=function(t,e){for(var n=this.index(t),r=this.nodes,i=this.nodes.length,o=0,s=n;s<i;s++)e(r[s],o),o++},t.prototype.bubble=function(t,e){for(var n=this.index(t),r=this.nodes,i=0,o=n;o>=0;o--)e(r[o],i),i++},t.prototype.toArray=function(){return this.nodes.slice()}}(),function(){var t=Graph.collection.Link=function(t){this.items=_.map(t,function(t){return t.guid()}),t=null};t.prototype.constructor=t,t.prototype.keys=function(){
return this.items.slice()},t.prototype.size=function(){return this.items.length},t.prototype.index=function(t){var e=t.guid();return _.indexOf(this.items,e)},t.prototype.has=function(t){var e=t.guid();return _.indexOf(this.items,e)!==-1},t.prototype.find=function(t){var e=this.toArray();return _.find(e,t)},t.prototype.push=function(t){var e=this;return _.isArray(t)?_.forEach(t,function(t){var n=t.guid();e.items.push(n)}):e.items.push(t.guid()),e.items.length},t.prototype.pop=function(){var t=this.items.pop();return Graph.registry.link.get(t)},t.prototype.shift=function(){var t=this.items.shift();return Graph.registry.link.get(t)},t.prototype.unshift=function(t){return this.items.unshift(t),t},t.prototype.pull=function(t){var e=t.guid();_.pull(this.items,e)},t.prototype.last=function(){return _.last(this.items)},t.prototype.each=function(t){var e=this;_.forEach(e.items,function(e,n){var r=Graph.registry.link.get(e);r&&t.call(r,r,n)})},t.prototype.toArray=function(){return _.map(this.items,function(t){
return Graph.registry.link.get(t)})},t.prototype.toString=function(){return"Graph.collection.link"}}(),function(t,e){var n,r=/^<(svg|g|rect|text|path|line|tspan|circle|polygon|defs|marker)/i;Graph.dom=function(i,o,s){var a,p;if(void 0===n)try{n=new DOMParser}catch(t){n=null}return s=t.defaultTo(s,!1),void 0!==o&&Graph.isElement(o)&&(o=o.node()),t.isString(i)?r.test(i)?n&&(a='<g xmlns="'+Graph.config.xmlns.svg+'">'+i+"</g>",p=n.parseFromString(a,"text/xml").documentElement.childNodes[0],a=null,p=s?e(p):p):p=s?e(i,o):e(i,o)[0]:p=Graph.isHTML(i)||Graph.isSVG(i)?s?e(i):i:Graph.isElement(i)?s?i.query:i.query[0]:s?e(i,o):i,o=null,p},Graph.dom.clone=function(t,e){return t.cloneNode(e)};var i=Graph.dom.Element=function(t){this.query=e(t)};i.prototype.is=function(t){return this.query.is(t)},i.prototype.node=function(){return this.query[0]},i.prototype.length=function(){return this.query.length},i.prototype.group=function(t){return void 0===t?this.query.data("component-group"):(this.query.data("component-group",t),
this)},i.prototype.belong=function(t){return this.group()==t},i.prototype.attr=function(e,n){if(void 0===n)return this.query.attr(e);var r=this,i=this.query[0];if(Graph.isHTML(i))this.query.attr(e,n);else if(Graph.isSVG(i)){if(t.isPlainObject(e))return t.forOwn(e,function(t,e){r.attr(e,t)}),this;"xlink:"==e.substring(0,6)?i.setAttributeNS(Graph.config.xmlns.xlink,e.substring(6),t.toString(n)):i.setAttribute(e,t.toString(n))}return this},i.prototype.width=function(t){return void 0===t?this.query.width():(this.query.width(t),this)},i.prototype.outerHeight=function(t){return this.query.outerHeight(t)},i.prototype.height=function(t){return void 0===t?this.query.height():(this.query.height(t),this)},i.prototype.show=function(){return this.query.show(),this},i.prototype.hide=function(){return this.query.hide(),this},i.prototype.offset=function(){var t=this.query[0];if(Graph.isSVG(t)){var e=t.getBoundingClientRect();return{left:e.left,top:e.top,width:e.width,height:e.height}}return this.query.offset();
},i.prototype.position=function(){return this.query.position()},i.prototype.css=function(t,e){return void 0===e?this.query.css(t):(this.query.css(t,e),this)},i.prototype.addClass=function(e){var n=this.query[0];if(Graph.isHTML(n))this.query.addClass(e);else if(Graph.isSVG(n)){var r=t.chain([]).concat(t.split(n.className.baseVal||""," ")).concat(t.split(e," ")).uniq().join(" ").trim().value();n.className.baseVal=r}return this},i.prototype.removeClass=function(t){var e=this.query[0];return Graph.isHTML(e)&&this.query.removeClass(t),this},i.prototype.hasClass=function(e){var n=this.query[0];if(Graph.isHTML(n))return this.query.hasClass(e);if(Graph.isSVG(n)){var r=t.split(n.className.baseVal," ");return r.indexOf(e)>-1}return!1},i.prototype.find=function(t){return new Graph.dom.Element(this.query.find(t))},i.prototype.parent=function(){return new Graph.dom.Element(this.query.parent())},i.prototype.closest=function(t){return new Graph.dom.Element(this.query.closest(t))},i.prototype.append=function(t){
return void 0===t.query?this.query.append(t):this.query.append(t.query),this},i.prototype.prepend=function(t){return this.query.prepend(t.query),this},i.prototype.appendTo=function(t){return this.query.appendTo(t.query),this},i.prototype.prependTo=function(t){return this.query.prependTo(t.query),this},i.prototype.before=function(t){return this.query.before(t.query),this},i.prototype.after=function(t){return this.query.after(t.query),this},i.prototype.last=function(){return new Graph.dom.Element(this.query.last())},i.prototype.remove=function(){return this.query.remove(),this.query=null,this},i.prototype.detach=function(){return this.query=this.query.detach(),this},i.prototype.on=function(t,e,n,r,i){return this.query.on.call(this.query,t,e,n,r,i),this},i.prototype.off=function(t,e,n){return this.query.off.call(this.query,t,e,n),this},i.prototype.trigger=function(t,e){return this.query.trigger(t,e),this},i.prototype.val=function(t){return void 0===t?this.query.val():(this.query.val(t),this);
},i.prototype.text=function(t){return void 0===t?this.query.text():(this.query.text(t),this)},i.prototype.html=function(t){return void 0===t?this.query.html():(this.query.html(t),this)},i.prototype.focus=function(e,n){var r,i=this.query;return n=t.defaultTo(n,0),r=void 0!==this.query.attr("contenteditable")?t.delay(function(){if(clearTimeout(r),r=null,i[0].focus(),document.createRange&&window.getSelection){var t=document.createRange();t.selectNodeContents(i[0]);var e=window.getSelection();e.removeAllRanges(),e.addRange(t)}},n):t.delay(function(){clearTimeout(r),r=null,i.focus(),e&&i.select()},n),this},i.prototype.contextmenu=function(e){e=t.defaultTo(e,!0),e||this.query.on("contextmenu",function(t){return!1})},i.prototype.each=function(t){return this.query.each(t),this},i.prototype.empty=function(){return this.query.empty(),this},i.prototype.data=function(t,e){return void 0===e?this.query.data(t):(this.query.data(t,e),this)},i.prototype.prop=function(t,e){return void 0===e?this.query.data(t):(this.query.prop(t,e),
this)},i.prototype.scrollTop=function(t){return void 0===t?this.query.scrollTop():(this.query.scrollTop(t),this)},i.prototype.scrollLeft=function(t){return void 0===t?this.query.scrollLeft():(this.query.scrollLeft(t),this)},i.prototype.toString=function(){return"Graph.dom.Element"},i.guid=0,Graph.$=function(t,e){var n=Graph.dom(t,e,!0);return new Graph.dom.Element(n)}}(_,jQuery),function(){function t(e,n){var r,i=e.children().toArray();r=n.call(e,e),r=_.defaultTo(r,!0),r&&i.length&&_.forEach(i,function(e){t(e,n)})}function e(t,n){var r,i=t.parent();r=n.call(t,t),r=_.defaultTo(r,!0),r&&i&&e(i,n)}function n(t){return t.parentNode?"svg"==t.parentNode.nodeName?t.parentNode.getBoundingClientRect():n(t.parentNode):{top:0,left:0}}var r=Graph.svg.Vector=Graph.extend({tree:{container:null,paper:null,parent:null,children:null,next:null,prev:null},props:{id:null,guid:null,type:null,text:null,rotate:0,scaleX:1,scaleY:1,traversable:!0,selectable:!0,focusable:!1,snappable:!1,selected:!1,rendered:!1,state:null
},attrs:{style:null,class:null},plugins:{transformer:null,collector:null,definer:null,animator:null,resizer:null,reactor:null,dragger:null,dropper:null,network:null,history:null,panzoom:null,toolmgr:null,toolpad:null,snapper:null,editor:null},graph:{matrix:null,layout:null},cached:{bbox:null,bboxView:null,bboxPristine:null,matrixCurrent:null,matrixView:null,shapeView:null,position:null,offset:null},elem:null,constructor:function(t,e){var n,i=this;i.graph.matrix=Graph.matrix(),i.tree.children=new Graph.collection.Vector,n="graph-elem-"+ ++r.guid,e=_.extend({},i.attrs,e||{}),i.elem=Graph.$(document.createElementNS(Graph.config.xmlns.svg,t)),e.class?e.class=Graph.styles.VECTOR+" "+e.class:e.class=Graph.styles.VECTOR,i.attr(e),i.props.guid=i.props.id=n,i.props.type=t,n=null,i.elem.data(Graph.string.ID_VECTOR,i.props.guid),i.elem.attr("data-elem",i.props.guid),i.plugins.transformer=new Graph.plugin.Transformer(i).on("translate",_.bind(i.onTransformTranslate,i)).on("rotate",_.bind(i.onTransformRotate,i)).on("scale",_.bind(i.onTransformScale,i)),
i.isPaper()&&(i.plugins.toolmgr=new Graph.plugin.ToolManager(i).on("activate",_.bind(i.onActivateTool,i)).on("deactivate",_.bind(i.onDeactivateTool,i))),Graph.registry.vector.register(this)},matrix:function(t){return void 0===t?this.graph.matrix:(this.graph.matrix=t,this)},matrixView:function(){var t=this.cached.matrixView;if(!t){var e=this.paper();if(e){var n=e.viewport(),r=n.guid();t=Graph.matrix(),this.bubble(function(e){return e.guid()!=r&&void t.multiply(e.matrix())})}else t=this.matrix();this.cached.matrix=t}return t},matrixCurrent:function(){var t,e=this.node().getCTM();return e?(t=new Graph.lang.Matrix(e.a,e.b,e.c,e.d,e.e,e.f),e=null):t=this.matrix().clone(),t},layout:function(t){if(void 0===t)return this.graph.layout;var e,n;return t="default"==t?"layout":t,_.isString(t)?(e=Graph.layout[_.capitalize(t)],n=Graph.factory(e,[this])):_.isPlainObject(t)&&t.name&&(e=Graph.layout[_.capitalize(t.name)],delete t.name,n=Graph.factory(e,[this,t])),n.refresh(),this.graph.layout=n,this},reset:function(){
this.graph.matrix=Graph.matrix(),this.removeAttr("transform"),this.props.rotate=0,this.props.scale=0,this.dirty(!0),this.fire("reset",this.props),this.dragger&&this.dragger.rotate(0)},invalidate:function(t){this.cached[t]=null},state:function(t){return void 0===t?this.props.state:(this.props.state=t,this)},dirty:function(t){var e=this;if(void 0===t)return null===e.cached.bbox;if(t){for(var n in this.cached)e.cached[n]=null;var r=["resizer","network"];_.forEach(r,function(t){e.plugins[t]&&e.plugins[t].invalidate()})}return this},interactable:function(t){return this.plugins.reactor||(this.plugins.reactor=new Graph.plugin.Reactor(this,t)),this.plugins.reactor},animable:function(){var t=this;return t.plugins.animator||(t.plugins.animator=new Graph.plugin.Animator(t),t.plugins.animator.on({animstart:function(e){t.fire(e)},animating:function(e){t.fire(e)},animend:function(e){t.fire(e)}})),t.plugins.animator},resizable:function(t){return this.plugins.resizer?void 0!==t&&this.plugins.resizer.options(t):(this.plugins.resizer=new Graph.plugin.Resizer(this,t),
this.plugins.resizer.on({beforeresize:_.bind(this.onResizerBeforeResize,this),afterresize:_.bind(this.onResizerAfterResize,this)})),this.plugins.resizer},draggable:function(t){return this.plugins.dragger||(this.plugins.dragger=new Graph.plugin.Dragger(this,t),this.plugins.dragger.on({beforedrag:_.bind(this.onDraggerStart,this),drag:_.bind(this.onDraggerMove,this),afterdrag:_.bind(this.onDraggerEnd,this)})),this.plugins.dragger},zoomable:function(){return this.plugins.panzoom||(this.plugins.panzoom=new Graph.plugin.Panzoom(this),this.plugins.toolmgr.register("panzoom")),this.plugins.panzoom},droppable:function(){return this.plugins.dropper||(this.plugins.dropper=new Graph.plugin.Dropper(this),this.plugins.dropper.on({dropenter:_.bind(this.onDropperEnter,this),dropleave:_.bind(this.onDropperLeave,this)})),this.plugins.dropper},connectable:function(t){return this.plugins.network?void 0!==t&&this.plugins.network.options(t):this.plugins.network=new Graph.plugin.Network(this,t),this.plugins.network;
},traversable:function(t){return void 0===t?this.props.traversable:(this.props.traversable=t,this)},selectable:function(t){return void 0===t?this.props.selectable:(this.props.selectable=t,this)},clickable:function(t){return void 0===t?"none"!=this.attrs["pointer-events"]:(this.attr("pointer-events",t?"":"none"),this)},editable:function(t){var e=this;return this.plugins.editor||(this.plugins.editor=new Graph.plugin.Editor(this,t),this.plugins.editor.on({beforeedit:function(t){e.fire(t)},edit:function(t){e.fire(t)}})),this.plugins.editor},snappable:function(t){var e,n=this,r=n.paper();if(t=_.isBoolean(t)?{enabled:t}:_.extend({enabled:!0},t||{}),n.props.snappable=t.enabled,r?e=r.plugins.snapper:(r=Graph.svg.Paper.getDefaultInstance(),e=r.plugins.snapper,n.on("render",function(){n.paper().plugins.snapper.setup(n,t)})),!r)throw Graph.error("Unable to install snapper plugin. Paper doesn't rendered yet!");return e},id:function(){return this.props.id},guid:function(){return this.props.guid},node:function(){
return this.elem.node()},data:function(t,e){var n=this;return _.isPlainObject(t)?(_.forOwn(t,function(t,e){n.props[e]=t}),this):void 0===t&&void 0===e?n.props:void 0===e?n.props[t]:(n.props[t]=e,this)},attr:function(t,e){var n=this,r=n.node();return _.isPlainObject(t)?(_.forOwn(t,function(t,e){!function(t,e){n.attr(e,t)}(t,e)}),n):void 0===t?n.attrs:void 0===e?n.attrs[t]||"":(n.attrs[t]=e,null!==e&&("xlink:"==t.substring(0,6)?r.setAttributeNS(Graph.config.xmlns.xlink,t.substring(6),_.toString(e)):"class"==t?r.className.baseVal=_.toString(e):r.setAttribute(t,_.toString(e))),n)},removeAttr:function(t){return this.node().removeAttribute(t),this.attrs[t]&&delete this.attrs[t],this},style:function(t,e){var n=this;return _.isPlainObject(t)?(_.forOwn(t,function(t,e){n.style(e,t)}),this):(this.elem.css(t,e),this)},cursor:function(t){this.elem.css("cursor",t)},hasClass:function(t){return _.indexOf(_.split(this.attrs.class," "),t)>-1},addClass:function(t){var e=_.chain(this.attrs.class).split(" ").concat(_.split(t," ")).uniq().join(" ").trim().value();
return this.attr("class",e),this},removeClass:function(t){var e=_.split(this.attrs.class," "),n=_.isArray(t)?t:_.split(t," ");return _.pullAll(e,n),this.attr("class",_.join(e," ")),this},hide:function(){this.elem.hide()},show:function(){this.elem.show()},shape:function(){var t=new Graph.lang.Path([]);return t},shapeView:function(){var t=this.cached.shapeView;if(!t){var e=this.matrixView();t=this.shape().transform(e),this.cached.shapeView=t}return t},shapeRelative:function(){var t=this.parent(),e=t.matrixView().clone().invert(),n=this.matrixView().clone(),r=this.shape();return n.multiply(e),r=r.transform(n),n=e=t=null,r},vertices:function(t){var e,n,r,i;return t=_.defaultTo(t,!1),e=t?this.matrixCurrent():this.matrix(),n=this.shape().transform(e),r=n.segments,i=[],_.forEach(r,function(t){var e,n;"Z"!=t[0]&&(e=t[t.length-2],n=t[t.length-1],i.push([e,n]))}),i},dimension:function(){var t={},e=this.node();try{t=e.getBBox()}catch(n){t={x:e.clientLeft,y:e.clientTop,width:e.clientWidth,height:e.clientHeight
}}finally{t=t||{}}return t},offset:function(){var t=this.node(),e=t.getBoundingClientRect(),n={top:e.top,left:e.left,bottom:e.bottom,right:e.right,width:e.width,height:e.height};return n},position:function(){if(!this.cached.position){var t=this.node(),e=t.getBoundingClientRect(),r=n(t);this.cached.position={top:e.top-r.top,left:e.left-r.left,bottom:e.bottom-r.top,right:e.right-r.left,width:e.width,height:e.height}}return this.cached.position},bbox:function(){var t=this.cached.bbox;if(!t){var e=this.shape().transform(this.matrix());t=e.bbox(),this.cached.bbox=t}return t},bboxPristine:function(){var t=this.cached.bboxPristine;if(!t){var e=this.shape();t=e.bbox(),this.cached.bboxPristine=t}return t},bboxView:function(){var t=this.cached.bboxView;if(!t){var e=this.matrixView(),n=this.shape().transform(e);t=n.bbox(),this.cached.bboxView=t}return t},find:function(t){var e=this.elem.find(t),n=[];return e.each(function(t,e){n.push(Graph.registry.vector.get(e))}),new Graph.collection.Vector(n)},
render:function(t,e,n){var r,i=this,o=i.guid(),s=i.props.traversable;if(i.props.rendered)return i;if(t=_.defaultTo(t,i.paper()),e=_.defaultTo(e,"append"),t){switch(t.isPaper()&&(t=t.viewport()),i.tree.paper=t.tree.paper,s&&(i.tree.parent=t.guid()),e){case"before":if(!n)throw Graph.error("vector.render(): Sibling vector is undefined");n.elem.query.before(i.elem.query),s&&(r=t.children().index(n),t.children().insert(i,r));break;case"after":if(!n)throw Graph.error("vector.render(): Sibling vector is undefined");n.elem.query.after(i.elem.query),s&&(r=t.children().index(n),t.children().insert(i,r+1));break;case"append":t.elem.query.append(i.elem.query),s&&t.children().push(i);break;case"prepend":t.elem.query.prepend(i.elem.query),s&&t.children().unshift(i)}if(t.props.rendered){i.props.rendered=!0,i.fire("render");var a=t.isViewport()?t.paper():null;a&&Graph.registry.vector.setContext(o,i.tree.paper),i.cascade(function(t){t===i||t.props.rendered||(t.props.rendered=!0,t.tree.paper=i.tree.paper,
t.fire("render"),a&&Graph.registry.vector.setContext(t.props.guid,i.tree.paper))})}}return i},children:function(){return this.tree.children},attach:function(t,e){if(!this.isContainer())return this;if(e=_.defaultTo(e,"append"),t.isRendered()){var n=this.isPaper()?this.viewport():this,r=t.isTraversable();if(r){var i=t.parent();i&&(i.children().pull(t),t.tree.parent=null)}if(n.elem[e](t.elem),r){switch(e){case"append":n.children().push(t);break;case"prepend":n.children().unshift(t)}t.tree.parent=this.guid()}}else t.render(this,e);return this},detach:function(){return this.elem.detach(),this},append:function(t){return this.attach(t,"append")},prepend:function(t){return this.attach(t,"prepend")},relocate:function(t){t.isPaper()&&(t=t.viewport());var e=this.matrixView().clone();this.graph.matrix=e,this.attr("transform",e.toValue()),this.dirty(!0),t.append(this);var n=t.matrixView().clone(),r=this.matrix().clone();r.multiply(n.invert()),this.graph.matrix=r,this.attr("transform",r.toValue()),n=r=null,
this.dirty(!0)},ancestors:function(){var t=[],e=this.guid();return this.bubble(function(n){n.guid()!=e&&t.push(n)}),new Graph.collection.Vector(t)},descendants:function(){var t=[],e=this.guid();return this.cascade(function(n){n.guid()!=e&&t.push(n)}),new Graph.collection.Vector(t)},paper:function(){return this.isPaper()?this:Graph.registry.vector.get(this.tree.paper)},parent:function(){return Graph.registry.vector.get(this.tree.parent)},prev:function(){return Graph.registry.vector.get(this.tree.prev)},next:function(){return Graph.registry.vector.get(this.tree.next)},cascade:function(e){t(this,e)},bubble:function(t){return e(this,t)},remove:function(){var t=this.parent();this.fire("beforedestroy"),this.deselect();for(var e in this.plugins)this.plugins[e]&&(this.plugins[e].destroy(),this.plugins[e]=null);t&&t.children().pull(this),this.elem&&(this.elem.remove(),this.elem=null),Graph.registry.vector.unregister(this),this.fire("afterdestroy"),this.listeners=null},empty:function(){var t=this.guid();
return this.cascade(function(e){e.guid()!=t&&Graph.registry.vector.unregister(e)}),this.children().clear(),this.elem.empty(),this},select:function(){var t=this.paper(),e=!1;if(t){var n=t.collector();n.add(this),0===n.index(this)&&(e=!0)}else e=!0;return this.addClass("graph-selected"),this.props.selected=!0,e&&this.isResizable()&&this.resizable().resume(),this.fire("select",{initial:e}),this},deselect:function(){var t=this.paper(),e=!1;if(t){var n=t.collector();e=0===n.index(this),n.remove(this)}return this.removeClass("graph-selected"),this.props.selected=!1,this.isResizable()&&this.resizable().suspend(),this.fire("deselect",{initial:e}),this},collector:function(){return this._collector},transform:function(t){return this.plugins.transformer.transform(t)},translate:function(t,e){return this.plugins.transformer.translate(t,e)},scale:function(t,e,n,r){return void 0===t?this.matrixCurrent().scale():this.plugins.transformer.scale(t,e,n,r)},rotate:function(t,e,n){return this.plugins.transformer.rotate(t,e,n);
},animate:function(t,e,n,r){return this.plugins.animator?(this.plugins.animator.animate(t,e,n,r),this.plugins.animator):null},label:function(t){return this.elem.text(t),this},sendToFront:function(){return this.tree.paper?(this.paper().elem.append(this.elem),this):this},sendToBack:function(){return this.tree.paper?(this.paper().elem.prepend(this.elem),this):this},resize:function(t,e,n,r,i,o){return this},isContainer:function(){return this.isGroup()||this.isPaper()},isGroup:function(){return"g"==this.props.type},isPaper:function(){return"svg"==this.props.type},isViewport:function(){return this.props.viewport===!0},isTraversable:function(){return this.props.traversable},isSelectable:function(){return this.props.selectable},isDraggable:function(){return null!==this.plugins.dragger},isResizable:function(){return null!==this.plugins.resizer},isConnectable:function(){return!!this.plugins.network},isSnappable:function(){return this.props.snappable},isRendered:function(){return this.props.rendered;
},isSelected:function(){return this.props.selected===!0},tool:function(){return this.plugins.toolmgr},toString:function(){return"Graph.svg.Vector"},onResizerBeforeResize:function(t){this.fire(t)},onResizerAfterResize:function(t){this.dirty(!0),this.fire(t),Graph.topic.publish("vector:afterresize",t)},onDraggerStart:function(t){t.master=!0,this.fire(t);var e=this.collector();e&&e.syncBeforeDrag(this,t),this.plugins.resizer&&this.plugins.resizer.suspend(),this.plugins.editor&&this.plugins.editor.suspend()},onDraggerMove:function(t){t.master=!0;var e=this.collector();e&&e.syncDrag(this,t),this.fire(t)},onDraggerEnd:function(t){this.dirty(!0),t.master=!0,this.fire(t);var e=this.collector();e&&e.syncAfterDrag(this,t),Graph.topic.publish("vector:afterdrag",t)},onDropperEnter:function(t){this.fire(t)},onDropperLeave:function(t){this.fire(t)},onTransformRotate:function(t){if(this.dirty(!0),this.props.rotate=t.deg,this.fire("rotate",{deg:t.deg}),this.plugins.dragger){var e=this.matrixCurrent().rotate();
this.plugins.dragger.rotate(e.deg)}},onTransformTranslate:function(t){this.dirty(!0),this.fire("translate",{dx:t.dx,dy:t.dy})},onTransformScale:function(t){if(this.dirty(!0),this.props.scaleX=t.sx,this.props.scaleY=t.sy,this.fire("scale",{sx:t.sx,sy:t.sy}),this.plugins.dragger){var e=this.matrixCurrent().scale();this.plugins.dragger.scale(e.x,e.y)}},onActivateTool:function(t){var e=t.originalData;this.fire("activatetool",e)},onDeactivateTool:function(t){var e=t.originalData;this.fire("deactivatetool",e)}});r.guid=0,Graph.isVector=function(t){return t instanceof Graph.svg.Vector}}(),function(){Graph.svg.Ellipse=Graph.extend(Graph.svg.Vector,{constructor:function(t,e,n,r){this.superclass.prototype.constructor.call(this,"ellipse",{cx:t,cy:e,rx:n,ry:r})},shape:function(){var t=this.attrs;return Graph.path([["M",t.cx,t.cy],["m",0,-t.ry],["a",t.rx,t.ry,0,1,1,0,2*t.ry],["a",t.rx,t.ry,0,1,1,0,-2*t.ry],["z"]])},resize:function(t,e,n,r,i,o){var s,a,p=this.graph.matrix.clone().scale(t,e,n,r),h=this.props.rotate,c=p.x(this.attrs.cx,this.attrs.cy),l=p.y(this.attrs.cx,this.attrs.cy),u=this.attrs.rx*t,d=this.attrs.ry*e;
this.reset(),this.attr({cx:c,cy:l,rx:u,ry:d}),h&&this.rotate(h,c,l).commit();var f=this.bbox().toJson();return s=c-u-i,a=l-d-o,s=f.x,a=f.y,{matrix:p,translate:{dx:i,dy:o},scale:{sx:t,sy:e,cx:n,cy:r},rotate:{deg:h,cx:c,cy:l},magnify:{cx:s,cy:a}}},toString:function(){return"Graph.svg.Ellipse"}})}(),function(){Graph.svg.Circle=Graph.extend(Graph.svg.Vector,{constructor:function(t,e,n){var r=this;Graph.isPoint(t)&&(n=e,e=t.props.y,t=t.props.x),r.superclass.prototype.constructor.call(r,"circle",{cx:t,cy:e,r:n})},shape:function(){var t=this.attrs;return Graph.path([["M",t.cx,t.cy],["m",0,-t.r],["a",t.r,t.r,0,1,1,0,2*t.r],["a",t.r,t.r,0,1,1,0,-2*t.r],["z"]])},resize:function(t,e,n,r,i,o){var s,a,p,h=this.graph.matrix.clone(),c=this.props.rotate,l=this.attrs.cx,u=this.attrs.cy,d=this.attrs.r;return 1===e?(p=d*t,e=t):1===t?(p=d*e,t=e):t<e?(p=d*e,t=e):t>e&&(p=d*t,e=t),h.scale(t,e,n,r),s=h.x(l,u),a=h.y(l,u),this.reset(),this.attr({cx:s,cy:a,r:p}),c&&this.rotate(c,s,a).commit(),{matrix:h,translate:{
dx:i,dy:o},scale:{sx:t,sy:e,cx:n,cy:r},rotate:{deg:c,cx:s,cy:a}}},toString:function(){return"Graph.svg.Circle"}})}(),function(){Graph.svg.Rect=Graph.extend(Graph.svg.Vector,{constructor:function(t,e,n,r,i){var o=this;i=_.defaultTo(i,6),o.superclass.prototype.constructor.call(o,"rect",{x:_.defaultTo(t,0),y:_.defaultTo(e,0),rx:i,ry:i,width:_.defaultTo(n,0),height:_.defaultTo(r,0)}),o.origpath=o.shape()},attr:function(t,e){var n=this.superclass.prototype.attr.apply(this,[t,e]);return"rx"==t&&void 0!==e&&(this.attrs.r=this.attrs.rx),n},shape:function(){var t,e=this.attrs;return t=e.r?Graph.path([["M",e.x+e.r,e.y],["l",e.width-2*e.r,0],["a",e.r,e.r,0,0,1,e.r,e.r],["l",0,e.height-2*e.r],["a",e.r,e.r,0,0,1,-e.r,e.r],["l",2*e.r-e.width,0],["a",e.r,e.r,0,0,1,-e.r,-e.r],["l",0,2*e.r-e.height],["a",e.r,e.r,0,0,1,e.r,-e.r],["z"]]):Graph.path([["M",e.x,e.y],["l",e.width,0],["l",0,e.height],["l",-e.width,0],["z"]])},resize:function(t,e,n,r,i,o){var s,a,p,h,c=this.matrix().clone(),l=c.rotate().deg;return c.scale(t,e,n,r),
this.reset(),s=c.x(this.attrs.x,this.attrs.y),a=c.y(this.attrs.x,this.attrs.y),p=this.attrs.width*t,h=this.attrs.height*e,this.attr({x:s,y:a,width:p,height:h}),l&&this.rotate(l,s,a).commit(),{matrix:c,translate:{dx:i,dy:o},scale:{sx:t,sy:e,cx:n,cy:r},rotate:{deg:l,cx:s,cy:a}}},toString:function(){return"Graph.svg.Rect"}})}(),function(){Graph.svg.Path=Graph.extend(Graph.svg.Vector,{constructor:function(t){t||(t=[["M",0,0]]),t=_.isArray(t)?Graph.path(Graph.util.segments2path(t)).absolute().toValue():t instanceof Graph.lang.Path?t.toValue():Graph.path(t).absolute().toValue(),this.superclass.prototype.constructor.call(this,"path",{d:t})},shape:function(){return Graph.path(this.attrs.d)},segments:function(){return this.shape().segments},intersection:function(t,e){return this.shape().intersection(t.shape(),e)},intersectnum:function(t){return this.shape().intersectnum(t.shape())},angle:function(){var t=_.clone(this.segments()),e=t.length-1;"Z"==t[e][0]&&(e--,t.pop()),1===t.length&&(e++,t.push(["L",t[0][1],t[0][2]]));
var n=t[e][1]-t[e-1][1],r=t[e][2]-t[e-1][2];return(180+180*Math.atan2(-r,-n)/Math.PI+360)%360},slice:function(t,e){return this.shape().slice(t,e)},pointAt:function(t){return this.shape().pointAt(t)},length:function(){return this.shape().length()},addVertext:function(t){var e=this.shape();return e.addVertext(t),this.attr("d",e.command()),this},resize:function(t,e,n,r,i,o){var s=this.matrix().clone(),a=matrix.rotate(),p=a.deg,h=a.rad,c=(Math.sin(h),Math.cos(h),this.shape()),l=c.segments,u=l[0][1],d=l[0][2];return p&&s.rotate(-p,u,d),u=s.x(l[0][1],l[0][2]),d=s.y(l[0][1],l[0][2]),s.scale(t,e,n,r),_.forEach(l,function(t){var e,n,r,i;"Z"!=t[0]&&(e=t[t.length-2],n=t[t.length-1],r=s.x(e,n),i=s.y(e,n),t[t.length-2]=r,t[t.length-1]=i)}),this.reset(),this.attr("d",c.command()),p&&this.rotate(p,u,d).commit(!0),{matrix:s,x:u,y:d}},moveTo:function(t,e){var n=this.shape();return n.moveTo(t,e),this.attr("d",n.command()),this},lineTo:function(t,e,n){var r=this.shape();return r.lineTo(t,e,n),this.attr("d",r.command()),
this},tail:function(){var t=this.segments();return t.length?Graph.point(t[0][1],t[0][2]):null},head:function(){var t,e=this.segments();return e.length?(t=e.length-1,Graph.point(e[t][1],e[t][2])):null},toString:function(){return"Graph.svg.Path"}})}(),function(){Graph.svg.Polyline=Graph.extend(Graph.svg.Vector,{constructor:function(t){t=_.defaultTo(t,""),_.isArray(t)&&(t.length?(_.isPlainObject(t[0])&&(t=_.map(t,function(t){return t.x+","+t.y})),t=_.join(t,",")):t=""),this.superclass.prototype.constructor.call(this,"polyline",{points:t})},shape:function(){var t=Graph.util.polygon2path(this.attrs.points);return t=t.replace(/Z/i,""),Graph.path(t)},attr:function(t,e){return"points"==t&&_.isArray(e)&&(e=_.join(_.map(e,function(t){return t[0]+","+t[1]})," ")),this.superclass.prototype.attr.call(this,t,e)},toString:function(){return"Graph.svg.Polyline"}})}(),function(){Graph.svg.Polygon=Graph.extend(Graph.svg.Vector,{constructor:function(t){t=_.defaultTo(t,""),_.isArray(t)&&(t.length?(_.isPlainObject(t[0])&&(t=_.map(t,function(t){
return t.x+","+t.y})),t=_.join(t,",")):t=""),this.superclass.prototype.constructor.call(this,"polygon",{points:t})},attr:function(t,e){return"points"==t&&_.isArray(e)&&(e=_.join(e,",")),this.superclass.prototype.attr.call(this,t,e)},shape:function(){var t=Graph.util.polygon2path(this.attrs.points);return Graph.path(t)},resize:function(t,e,n,r,i,o){var s=this.graph.matrix.clone(),a=this.graph.matrix.clone(),p=this.props.rotate,h=this.shape().segments,c=[],l=h[0][1],u=h[0][2];return p&&(a.rotate(-p,h[0][1],h[0][2]),l=a.x(h[0][1],h[0][2]),u=a.y(h[0][1],h[0][2])),a.scale(t,e,n,r),s.scale(t,e,n,r),_.forEach(h,function(t){var e,n,r,i;"Z"!=t[0]&&(e=t[t.length-2],n=t[t.length-1],r=a.x(e,n),i=a.y(e,n),c.push(r+","+i))}),c=_.join(c," "),this.reset(),this.attr("points",c),p&&this.rotate(p,l,u).commit(),{matrix:s,translate:{dx:i,dy:o},scale:{sx:t,sy:e,cx:n,cy:r},rotate:{deg:p,cx:l,cy:u}}},toString:function(){return"Graph.svg.Polygon"}})}(),function(){Graph.svg.Group=Graph.extend(Graph.svg.Vector,{attrs:{
stroke:null,"stroke-width":null,class:null,fill:null,style:null},constructor:function(t,e){this.superclass.prototype.constructor.call(this,"g"),void 0!==t&&void 0!==e&&(this.graph.matrix.translate(t,e),this.attr("transform",this.graph.matrix.toValue()))},shape:function(){var t=this.dimension();return new Graph.lang.Path([["M",t.x,t.y],["l",t.width,0],["l",0,t.height],["l",-t.width,0],["z"]])},toString:function(){return"Graph.svg.Group"}})}(),function(){Graph.svg.Text=Graph.extend(Graph.svg.Vector,{attrs:{"text-anchor":"middle"},props:{id:"",guid:"",text:"",type:"text",rotate:0,lineHeight:1.1,fontSize:12,traversable:!0,focusable:!1,selectable:!0,selected:!1,rendered:!1},rows:[],constructor:function(t,e,n){this.superclass.prototype.constructor.call(this,"text",{x:_.defaultTo(t,0),y:_.defaultTo(e,0)}),this.attr({"font-size":Graph.config.font.size}),n&&this.write(n),this.on("render",_.bind(this.onTextRender,this))},attr:function(t,e){var n=this.superclass.prototype.attr.apply(this,[t,e]);return"font-size"==t&&void 0!==e&&(this.props.fontSize=_.parseInt(e)||12),
n},write:function(t){var e,n=this;return void 0===t?n.props.text:(e=(t||"").split("\n"),n.empty(),n.rows=[],_.forEach(e,function(t,e){n.addSpan(t)}),n.props.text=t,void(n.cached.bbox=null))},addSpan:function(t){var e,n=this;return t=_.defaultTo(t,""),e=Graph.$("<tspan/>"),e.text(t),n.elem.append(e),n.rows.push(e),e},arrange:function(){var t=this.rows,e=this.props.fontSize,n=this.props.lineHeight;this.bbox().toJson();if(t.length){for(var r=0,i=t.length;r<i;r++)r&&(t[r].attr("x",this.attrs.x),t[r].attr("dy",e*n));t[0].attr("dy",0),this.dirty(!0)}},wrap:function(t){var e,n,r=this.props.text,i=r.split(/\s+/).reverse(),o=[],s=0,a=this.props.lineHeight,p=this.attrs.x,h=this.attrs.y,c=0;for(this.empty(),this.rows=[],n=this.addSpan(),n.attr({x:p,y:h,dy:c+"em"});e=i.pop();)o.push(e),n.text(o.join(" ")),n.node().getComputedTextLength()>t&&(o.pop(),n.text(o.join(" ")),o=[e],n=this.addSpan(e),n.attr({x:p,y:h,dy:++s*a+"em"}))},center:function(t){if(t){var e,n,r,i,o,s=t.bbox().toJson(),a=this.matrix().rotate();
this.reset(),e=this.bbox().toJson(),n=s.width/2,r=s.height/2,i=e.x+e.width/2,o=e.y+e.height/2,a.deg?this.translate(n,r).rotate(a.deg).commit():this.translate(n,r).commit()}},shape:function(){var t=this.dimension();return new Graph.lang.Path([["M",t.x,t.y],["l",t.width,0],["l",0,t.height],["l",-t.width,0],["z"]])},toString:function(){return"Graph.svg.Text"},onTextRender:function(){var t=this;t.arrange()}})}(),function(){Graph.svg.Image=Graph.extend(Graph.svg.Vector,{attrs:{preserveAspectRatio:"none"},constructor:function(t,e,n,r,i){var o=this;o.superclass.prototype.constructor.call(o,"image",{"xlink:href":t,x:_.defaultTo(e,0),y:_.defaultTo(n,0),width:_.defaultTo(r,0),height:_.defaultTo(i,0)})},align:function(t,e){if("none"==t)return this.attr("preserveAspectRatio","none"),this;var n=this.attrs.preserveAspectRatio,r="";switch(n=/(meet|slice)/.test(n)?n.replace(/(.*)\s*(meet|slice)/i,"$2"):"",e=_.defaultTo(e,n),t=t.replace(/s+/," ").toLowerCase()){case"top left":case"left top":r="xMinYMin";
break;case"top center":case"center top":r="xMidYMin";break;case"top right":case"right top":r="xMaxYMin";break;case"left":r="xMinYMid";break;case"center":r="xMidYMid";break;case"right":r="xMaxYMid";break;case"bottom left":case"left bottom":r="xMinYMax";break;case"bottom center":case"center bottom":r="xMidYMax";break;case"bottom right":case"right bottom":r="xMaxYMax"}return n=r+(e?" "+e:""),this.attr("preserveAspectRatio",n),this},shape:function(){var t=this.attrs;return new Graph.lang.Path([["M",t.x,t.y],["l",t.width,0],["l",0,t.height],["l",-t.width,0],["z"]])},resize:function(t,e,n,r,i,o){var s=this.graph.matrix.clone().scale(t,e,n,r),a=this.graph.matrix.rotate();this.reset();var p=s.x(this.attrs.x,this.attrs.y),h=s.y(this.attrs.x,this.attrs.y),c=+this.attrs.width*t,l=+this.attrs.height*e;return this.attr({x:p,y:h,width:c,height:l}),this.rotate(a,p,h).commit(),{matrix:s,x:p,y:h}},toString:function(){return"Graph.svg.Image"}})}(),function(){Graph.svg.Line=Graph.extend(Graph.svg.Vector,{
constructor:function(t,e,n,r){var i=_.toArray(arguments);if(1===i.length){var o=i[0].start().toJson(),s=i[0].end().toJson();t=o.x,e=o.y,n=s.x,r=s.y}else 2===i.length&&(Graph.isPoint(i[0])?(t=i[0].props.x,e=i[0].props.y,n=i[1].props.x,r=i[1].props.y):(t=i[0].x,e=i[0].y,n=i[1].x,r=i[1].y));this.superclass.prototype.constructor.call(this,"line",{x1:_.defaultTo(t,0),y1:_.defaultTo(e,0),x2:_.defaultTo(n,0),y2:_.defaultTo(r,0)})},toString:function(){return"Graph.svg.Line"}})}(),function(){var t=Graph.svg.Paper=Graph.extend(Graph.svg.Vector,{attrs:{class:Graph.styles.PAPER},props:{id:null,guid:null,type:"paper",text:null,rotate:0,traversable:!1,selectable:!1,selected:!1,focusable:!1,rendered:!1,showOrigin:!0,zoomable:!0},components:{viewport:null},diagram:{enabled:!0,manager:null},constructor:function(e,n,r){var i=this;i.superclass.prototype.constructor.call(i,"svg",{xmlns:Graph.config.xmlns.svg,"xmlns:link":Graph.config.xmlns.xlink,version:Graph.config.svg.version}),_.assign(i.props,r||{}),i.style({
overflow:"hidden",position:"relative"}),i.interactable(),i.initLayout(),i.plugins.collector=new Graph.plugin.Collector(i),i.plugins.toolmgr.register("collector","plugin"),i.plugins.linker=new Graph.plugin.Linker(i),i.plugins.toolmgr.register("linker","plugin"),i.plugins.pencil=new Graph.plugin.Pencil(i),i.plugins.toolmgr.register("pencil","plugin"),i.plugins.definer=new Graph.plugin.Definer(i),i.plugins.snapper=new Graph.plugin.Snapper(i),i.plugins.toolpad=new Graph.plugin.Toolpad(i),i.diagram.enabled=!0,i.diagram.manager=new Graph.diagram.Manager(i),Graph.topic.subscribe("link:change",_.bind(i.listenLinkChange,i)),Graph.topic.subscribe("link:afterdestroy",_.bind(i.listenLinkAfterDestroy,i)),t.defaultInstance||(t.defaultInstance=i.guid())},initLayout:function(){var t=(new Graph.svg.Group).addClass(Graph.styles.VIEWPORT).selectable(!1);if(t.props.viewport=!0,this.components.viewport=t.guid(),this.props.showOrigin){var e=Graph.$('<g class="graph-elem graph-origin"><rect class="x" rx="1" ry="1" x="-16" y="-1" height="1" width="30"></rect><rect class="y" rx="1" ry="1" x="-1" y="-16" height="30" width="1"></rect><text class="t" x="-40" y="-10">(0, 0)</text></g>');
e.appendTo(t.elem),e=null}t.tree.paper=t.tree.parent=this.guid(),this.elem.append(t.elem),this.children().push(t),t.on("render",function(){t.cascade(function(e){e===t||e.props.rendered||(e.props.rendered=!0,e.tree.paper=t.tree.paper,e.fire("render"))})}),this.layout("default")},layout:function(t){var e=this.viewport();return void 0===t?e.graph.layout:(e.layout(t),this)},shape:function(t,e){var n=Graph.shape(t,e);return n.render(this),n},render:function(t){var e=this,n=e.viewport();e.guid();if(!e.props.rendered){if(t=Graph.$(t),t.append(e.elem),e.tree.container=t,e.elem.css({width:"100%",height:"100%"}),e.props.rendered=!0,e.fire("render"),n.props.rendered=!0,n.fire("render"),e.props.zoomable){e.zoomable();var r=_.debounce(function(){r.flush(),r=null,e.tool().activate("panzoom")},1e3);r()}return e}},container:function(){return this.tree.container},collector:function(){return this.plugins.collector},snapper:function(){return this.plugins.snapper},viewport:function(){return Graph.registry.vector.get(this.components.viewport);
},diagram:function(){return this.diagram.manager},scale:function(t,e,n,r){return void 0===t?this.viewport().matrix().scale():this.plugins.transformer.scale(t,e,n,r)},width:function(){return this.elem.width()},height:function(){return this.elem.height()},locateLink:function(t){var e=Graph.registry.link.get(t);e&&e.select(!1)},locateShape:function(t){var e=Graph.registry.shape.get(t);e&&e.select(!1)},toString:function(){return"Graph.svg.Paper"},listenLinkChange:_.debounce(function(){this.layout().arrangeLinks()},300),listenLinkAfterDestroy:_.debounce(function(){this.layout().arrangeLinks()},10)});t.defaultInstance=null,t.getDefaultInstance=function(){return Graph.registry.vector.get(t.defaultInstance)};var e={ellipse:"Ellipse",circle:"Circle",rect:"Rect",path:"Path",polyline:"Polyline",polygon:"Polygon",group:"Group",text:"Text",image:"Image",line:"Line"};_.forOwn(e,function(e,n){!function(e,n){t.prototype[n]=function(){var t=[e].concat(_.toArray(arguments)),n=Graph.svg.apply(null,t);return n.tree.paper=this.guid(),
n.render(this),t=null,n}}(e,n)})}(),function(){var t={},e={},n=function(){};n.prototype.constructor=n,n.prototype.register=function(e){var n=e.guid();this.get(n);t[n]=e},n.prototype.unregister=function(n){var r=n.guid();t[r]&&delete t[r],e[r]&&delete e[r]},n.prototype.setContext=function(n,r){t[n]&&(e[n]=r)},n.prototype.size=function(){return _.keys(t).length},n.prototype.toArray=function(){var e=_.keys(t);return _.map(e,function(e){return t[e]})},n.prototype.get=function(e){return _.isUndefined(e)?this.toArray():(e instanceof SVGElement?("tspan"==e.tagName&&(e=e.parentNode),e=Graph.$(e).data(Graph.string.ID_VECTOR)):e instanceof Graph.dom.Element&&(e=e.data(Graph.string.ID_VECTOR)),t[e])},n.prototype.collect=function(n){var r=[];for(var i in e)e[i]==n&&t[i]&&r.push(t[i]);return r},n.prototype.wipe=function(e){var n=e.guid();for(var r in t)t.hasOwnProperty(r)&&t[r].tree.paper==n&&delete t[r];t[n]&&delete t[n]},n.prototype.toString=function(){return"Graph.registry.Vector"},Graph.registry.vector=new n;
}(),function(){var t={},e={},n=function(){};n.prototype.constructor=n,n.prototype.register=function(e){var n=e.guid();t[n]=e},n.prototype.unregister=function(n){var r=n.guid();t[r]&&delete t[r],e[r]&&delete e[r]},n.prototype.setContext=function(n,r){t[n]&&(e[n]=r)},n.prototype.size=function(){return _.keys(t).length},n.prototype.has=function(e){return void 0!==t[e]},n.prototype.get=function(e){return void 0===e?this.toArray():(e instanceof SVGElement?e=Graph.$(e).data(Graph.string.ID_LINK):e instanceof Graph.dom.Element?e=e.data(Graph.string.ID_LINK):e instanceof Graph.svg.Vector&&(e=e.elem.data(Graph.string.ID_LINK)),t[e])},n.prototype.collect=function(n){var r=[];for(var i in e)e[i]==n&&t[i]&&r.push(t[i]);return r},n.prototype.toArray=function(){var e=_.keys(t);return _.map(e,function(e){return t[e]})},n.prototype.toString=function(){return"Graph.registry.Link"},Graph.registry.link=new n}(),function(){var t={},e={},n=function(){};n.prototype.constructor=n,n.prototype.register=function(e){
var n=e.guid();t[n]=e},n.prototype.setContext=function(n,r){t[n]&&(e[n]=r)},n.prototype.collect=function(n){var r=[];for(var i in e)e[i]==n&&t[i]&&r.push(t[i]);return r},n.prototype.unregister=function(n){var r=n.guid();t[r]&&(t[r]=null,delete t[r]),e[r]&&delete e[r]},n.prototype.size=function(){return _.keys(t).length},n.prototype.toArray=function(){var e=_.keys(t);return _.map(e,function(e){return t[e]})},n.prototype.get=function(e){return _.isUndefined(e)?this.toArray():(e instanceof SVGElement?("tspan"==e.tagName&&(e=e.parentNode),e=Graph.$(e).data(Graph.string.ID_SHAPE)):e instanceof Graph.dom.Element?e=e.data(Graph.string.ID_SHAPE):e instanceof Graph.svg.Vector&&(e=e.elem.data(Graph.string.ID_SHAPE)),t[e])},n.prototype.toString=function(){return"Graph.registry.Shape"},Graph.registry.shape=new n}(),function(){var t={},e=function(){};e.prototype.constructor=e,e.prototype.register=function(e){var n=e.guid();t[n]=e},e.prototype.unregister=function(e){var n=e.guid();t[n]&&delete t[n]},
e.prototype.get=function(e){return void 0===e?this.toArray():t[e]},e.prototype.toArray=function(){var e=_.keys(t);return _.map(e,function(e){return t[e]})},e.prototype.toString=function(){return"Graph.registry.Pallet"},Graph.registry.pallet=new e}(),function(){Graph.layout.Layout=Graph.extend({props:{fit:!0,view:null,width:0,height:0,router:{type:"orthogonal"},link:{smooth:!1,smoothness:6}},view:null,cached:{offset:null,position:null},constructor:function(t,e){_.assign(this.props,e||{}),this.props.view=t.guid()},view:function(){return Graph.registry.vector.get(this.props.view)},paper:function(){return this.view().paper()},invalidate:function(){},offset:function(){return this.position()},position:function(){var t,e,n=this.cached.position;return n||(t=this.view(),e=t.isViewport()?t.parent().node():t.node(),n=e.getBoundingClientRect(),this.cached.position=n),n},center:function(){var t=this.cached.center;if(!t){var e=this.position();t={x:e.width/2,y:e.height/2},this.cached.center=_.extend({},t);
}return t},scale:function(){return this.view().matrix().scale()},width:function(){var t,e,n;return t=this.view(),t.isViewport()?n=this.paper().width():(e=t.bbox(),n=e.width()),t=e=null,n},height:function(){var t,e,n;return t=this.view(),t.isViewport()?n=this.paper().height():(e=t.bbox(),n=e.height()),t=e=null,n},invalidate:function(){this.cached.offset=null,this.cached.center=null},grabVector:function(t){return Graph.registry.vector.get(t.target)},grabLink:function(t){return Graph.registry.link.get(t.target)},pointerLocation:function(t){var e=t.clientX,n=t.clientY,r=this.position(),i=this.view().matrix(),o=i.clone().invert(),s=i.scale(),a={x:o.x(e,n),y:o.y(e,n)};return a.x-=r.left/s.x,a.y-=r.top/s.y,i=o=null,a},screenLocation:function(t){var e=this.view().node().getScreenCTM();matrix=Graph.matrix(e.a,e.b,e.c,e.d,e.e,e.f);var n=matrix.x(t.x,t.y),r=matrix.y(t.x,t.y);return t.x=n,t.y=r,t},dragSnapping:function(){return{mode:"anchor",x:1,y:1}},routerType:function(){return this.props.router.type;
},createRouter:function(t,e,n){var r,i;return r=Graph.router[_.capitalize(this.props.router.type)],n=_.extend({},this.props.router,n||{}),i=Graph.factory(r,[this.view(),t,e,n])},createLink:function(t,e){var n,r;return n=Graph.link[_.capitalize(this.props.router.type)],e=_.extend({},this.props.link,e||{}),r=Graph.factory(n,[t,e])},refresh:function(t){this.fire("refresh")},arrangeLinks:function(){var t=this.view().paper().guid(),e=Graph.registry.link.collect(t);if(e.length){var n=[];_.forEach(e,function(t){t.cached.convex&&n.push(t.guid())});var r,i,o,s=new Graph.util.Sweeplink(e),a=s.findConvex();for(r in a)i=Graph.registry.link.get(r),i.reloadConvex(a[r]),i.reset(!0),o=_.indexOf(n,r),o>-1&&n.splice(o,1);n.length&&_.forEach(n,function(t){var e=Graph.registry.link.get(t);e.removeConvex(),e.reset(!0)}),s.destroy(),s=null}},arrangeShapes:function(){},toString:function(){return"Graph.layout.Layout"}})}(),function(){var t=Graph.router.Router=Graph.extend({props:{type:"directed",domain:null,source:null,
target:null},values:{start:null,end:null,waypoints:null},cached:{path:null,command:null,segments:null,bendpoints:null,bending:null,connect:null},constructor:function(t,e,n,r){_.assign(this.props,r||{}),this.props.domain=t.guid(),this.props.source=e.guid(),this.props.target=n.guid(),this.values.waypoints=[]},type:function(){return this.props.type},invalidate:function(){this.cached.path=null,this.cached.command=null,this.cached.segments=null,this.cached.bendpoints=null},domain:function(){return Graph.registry.vector.get(this.props.domain)},source:function(t){return void 0===t?Graph.registry.vector.get(this.props.source):(this.props.source=t.guid(),this)},target:function(t){return void 0===t?Graph.registry.vector.get(this.props.target):(this.props.target=t.guid(),this)},layout:function(){return this.domain().layout()},tail:function(){var t=_.first(this.values.waypoints);return t?_.extend({},t):null},head:function(){var t=_.last(this.values.waypoints);return t?_.extend({},t):null},center:function(){
var t=this.path(),e=t.pointAt(t.length()/2,!0);return t=null,e},execute:function(t){this.command(t),this.fire("route",{command:this.command()})},command:function(t){var e,n;return void 0===t?(t=this.cached.command,t||(e=this.segments(),t=Graph.util.segments2path(e),this.cached.command=t),t):(e=Graph.util.path2segments(t),n=_.map(e,function(t){return{x:t[1],y:t[2]}}),this.values.waypoints=n,this.invalidate(),e=n=null,this)},segments:function(){var t=this.cached.segments;return t||(t=[],_.forEach(this.values.waypoints,function(e,n){var r=0===n?"M":"L";t.push([r,e.x,e.y])}),this.cached.segments=t),t},waypoints:function(){return this.values.waypoints},bendpoints:function(){var t=this.cached.bendpoints;return t||(t=(this.values.waypoints||[]).slice(),this.cached.bendpoints=t),t},path:function(){var t=this.cached.path;return t||(t=Graph.path(this.command()),this.cached.path=t),t},modify:function(t,e,n){return this.values.waypoints[t].x=e,this.values.waypoints[t].y=n,this},commit:function(){return this.invalidate(),
this},route:function(){return this},repair:function(t,e){},reset:function(){this.invalidate(),this.values.waypoints=null},relocate:function(t,e){return _.forEach(this.values.waypoints,function(n){n.x+=t,n.y+=e}),this.commit(),this},initTrans:function(t){},updateTrans:function(t){},bending:function(){},connecting:function(){},stopTrans:function(t){},destroy:function(){this.reset()}});t.portCentering=function(t,e,n){return"x"==n&&(t.y=e.y),"y"==n&&(t.x=e.x),t},t.porting=function(e,n,r){var i,o,s=r?0:e.length-1,a=Graph.path(Graph.util.points2path(e)),p=n.intersection(a,!0);return i=e[s],p.length&&(p=t.sortIntersection(p),o=r?p[0]:p[p.length-1]),{index:s,point:i,port:o||i}},t.isRepairable=function(t){var e=t.length;return!(e<3)&&(e>4||!_.find(t,function(e,n){var r=t[n-1];return r&&Graph.util.pointDistance(e,r)<=5}))},t.getSegmentIndex=function(t,e){var n=0;return _.forEach(t,function(r,i){if(Graph.util.isPointOnLine(r,t[i+1],e))return n=i,!1}),n},t.sortIntersection=function(t){return _.sortBy(t,function(t){
var e=Math.floor(100*t.t2)||1;return e=100-e,e=(e<10?"0":"")+e,t.segment2+"#"+e})},t.getClosestIntersect=function(e,n,r){var i,o=Graph.path(Graph.util.points2path(e)),s=n.intersection(o,!0),a=1/0;return s.length&&(s=t.sortIntersection(s),_.forEach(s,function(t){var e=Graph.util.taxicab(t,r);e<=a&&(a=e,i=t)})),i},t.repairBendpoint=function(t,e,n){var r=Graph.util.pointAlign(e,t);switch(r){case"v":return{x:t.x,y:n.y};case"h":return{x:n.x,y:t.y}}return{x:t.x,y:t.y}},t.repairRoutes=function(e,n,r,i){var o=i[0],s=i.slice();return s[0]=r,s[1]=t.repairBendpoint(s[1],o,r),s},t.tidyRoutes=function(t){return _.filter(t,function(e,n){return!Graph.util.isPointOnLine(t[n-1],t[n+1],e)})}}(),function(){var t=Graph.router.Router;Graph.router.Directed=Graph.extend(t,{bendpoints:function(){var t=this.cached.bendpoints;if(!t){var e,n,r,i,o,s,a=this.path().curve().segments;t=[];for(var p=0,h=a.length;p<h;p++)e=a[p],0===p?(o=e[1],s=e[2],n=Graph.curve([["M",o,s],["C",o,s,o,s,o,s]]),i=n.pointAt(n.t(0),!0),i.index=p,
i.range=[0,0],i.space=0,t.push(i)):(n=Graph.curve([["M",o,s],e]),o=e[5],s=e[6],r=n.length(),i=n.pointAt(n.t(r/2),!0),i.index=p,i.range=[p-1,p],i.space=0,t.push(i),i=n.pointAt(n.t(r),!0),i.index=p,i.range=[p-1,p+1],i.space=1,t.push(i));this.cached.bendpoints=t}return t},route:function(t,e){var n=this.source(),r=n.connectable(),i=n.bboxView(),o=i.toJson(),s=this.target(),a=s.connectable(),p=s.bboxView(),h=p.toJson(),c=r.orientation(a),l=r.direction(a),u=!1,d=[];t||(t=i.center(!0)),e||(e=p.center(!0));var f,g;if(l){if("h:h"==l){switch(c){case"top-right":case"right":case"bottom-right":f={x:o.x,y:t.y},g={x:h.x+h.width,y:e.y};break;case"top-left":case"left":case"bottom-left":f={x:o.x+o.width,y:t.y},g={x:h.x,y:e.y}}u=!0}if("v:v"==l){switch(c){case"top-left":case"top":case"top-right":f={x:t.x,y:o.y+o.height},g={x:e.x,y:h.y};break;case"bottom-left":case"bottom":case"bottom-right":f={x:t.x,y:o.y},g={x:e.x,y:h.y+h.height}}u=!0}}d=u?[f,g]:[t,e];var y,v=Graph.path(Graph.util.points2path(d));return y=n.shapeView().intersection(v,!0),
y.length&&(d[0]=y[0]),y=s.shapeView().intersection(v,!0),y.length&&(d[1]=y[y.length-1]),this.values.waypoints=d,this.commit(),this.fire("route",{command:this.command()}),this},repair:function(e,n){var r=this.source(),i=r.bboxView(),o=this.target(),s=o.bboxView(),a=this.values.waypoints,p=a.length-1;e===r?a[0]=n:e===o&&(a[p]=n);var h;h=t.getClosestIntersect(a,r.shapeView(),s.center(!0)),h&&(a[0]=h),h=t.getClosestIntersect(a,o.shapeView(),i.center(!0)),h&&(a[p]=h),this.commit(),this.fire("route",{command:this.command()})},initTrans:function(t){var e=this.source(),n=this.target(),r=e.shapeView(),i=n.shapeView(),o=this.waypoints(),s=t.range.start,a=t.range.end,p=o[s],h=o[a],c=[];"BENDING"==t.trans&&(c=[o[s],o[a]]);var l=this.layout().position();t.snap.hor=[],t.snap.ver=[],_.forEach(c,function(e){e&&(t.snap.hor.push(e.y+l.top),t.snap.ver.push(e.x+l.left))}),"BENDING"==t.trans?this.cached.bending={source:e,target:n,rangeStart:s,rangeEnd:s,segmentStart:p,segmentEnd:h,original:o.slice(),sourcePath:r,
targetPath:i}:this.cached.connect={valid:!1,source:null,target:null,sourcePath:null,targetPath:null,original:o.slice()}},updateTrans:function(t,e){if("CONNECT"==t){var n=this.cached.connect,r=n.source,i=n.target;_.assign(n,e),r&&n.source?r.guid()!=n.source.guid()&&(n.sourcePath=n.source.shapeView()):!r&&n.source&&(n.sourcePath=n.source.shapeView()),i&&n.target?i.guid()!=n.target.guid()&&(n.targetPath=n.target.shapeView()):!i&&n.target&&(n.targetPath=n.target.shapeView())}},bending:function(t,e){var n=this.cached.bending,r=n.original.slice(),i=n.rangeStart,o=(n.rangeEnd,n.segmentStart),s=n.segmentEnd,a={x:t.point.x+t.delta.x,y:t.point.y+t.delta.y},p=Graph.util.pointAlign(o,a,10),h=Graph.util.pointAlign(s,a,10);"h"==p&&"v"==h?(a.x=o.x,a.y=s.y):"v"==p&&"h"==h?(a.y=o.y,a.x=s.x):"h"==p?a.x=o.x:"v"==p?a.y=o.y:"h"==h?a.x=s.x:"v"==h&&(a.y=s.y),t.event.x=a.x,t.event.y=a.y,r.splice(i+1,t.space,a),n.routes=r,this.cropBinding(t,e)},cropBinding:_.debounce(function(e,n){var r,i=this.cached.bending,o=i.routes,s=t.porting(o,i.sourcePath,!0),a=t.porting(o,i.targetPath),p=o.slice(s.index+1,a.index);
p.unshift(s.port),p.push(a.port),i.waypoints=p,n&&(r=Graph.util.points2path(p),n({command:r}))},0),connecting:function(t,e){var n,r=this.cached.connect,i=r.original.slice();n={x:t.point.x+t.delta.x,y:t.point.y+t.delta.y},i[t.index]=n,t.event.x=n.x,t.event.y=n.y,r.routes=i,this.cropConnect(t,e)},cropConnect:_.debounce(function(t,e){var n,r,i,o,s=this.cached.connect,a=s.routes;0===t.index?s.source&&(r=s.sourcePath):s.target&&(r=s.targetPath),r&&(i=Graph.path(Graph.util.points2path(a)),o=r.intersection(i,!0),o.length&&(a[t.index]=o[0])),s.waypoints=a,e&&(n=Graph.util.points2path(a),e({command:n}))},0),stopTrans:function(e){var n,r,i,o;"CONNECT"==e.trans?(n=this.cached.connect,i=n.waypoints,this.cached.connect.valid?(o=!0,this.source(n.source),this.target(n.target),this.fire("reroute",{source:n.source,target:n.target})):(i=n.original.slice(),o=!1)):"BENDING"==e.trans&&(r=this.cached.bending,i=r.waypoints,o=!0),o?this.values.waypoints=t.tidyRoutes(i):this.values.waypoints=i,this.commit(),this.cached.connect=null,
this.cached.bending=null},toString:function(){return"Graph.router.Directed"}})}(),function(){var t=Graph.router.Router;Graph.router.Orthogonal=Graph.extend(t,{bendpoints:function(){var t=this.cached.bendpoints;if(!t){var e,n,r,i,o,s,a=this.path().curve().segments,p=a.length-1;t=[];for(var h=0,c=a.length;h<c;h++)e=a[h],0===h?(o=e[1],s=e[2],n=Graph.curve([["M",o,s],["C",o,s,o,s,o,s]]),i=n.pointAt(n.t(0),!0),i.index=h,i.range=[h,h+1],i.space=0,t.push(i)):(n=Graph.curve([["M",o,s],e]),o=e[5],s=e[6],r=n.length(),i=n.pointAt(n.t(r/2),!0),i.index=h,i.range=[h-1,h],i.space=0,t.push(i),h===p&&(i=n.pointAt(n.t(r),!0),i.index=h,i.range=[h-1,h],i.space=0,t.push(i)));this.cached.bendpoints=t}return t},route:function(e,n){var r=this.source(),i=this.target(),o=r.connectable(),s=i.connectable(),a=r.bboxView(),p=a.toJson(),h=i.bboxView(),c=h.toJson(),l=o.orientation(s),u=o.direction(s),d=!1;e||(e=a.center(!0)),n||(n=h.center(!0)),this.values.start||this.values.end||(this.values.start=e,this.values.end=n);
var f,g;if(u){if("h:h"==u)switch(l){case"top-right":case"right":case"bottom-right":f={x:p.x+1,y:e.y},g={x:c.x+c.width-1,y:n.y},d=!0;break;case"top-left":case"left":case"bottom-left":f={x:p.x+p.width-1,y:e.y},g={x:c.x+1,y:n.y},d=!0}if("v:v"==u)switch(l){case"top-left":case"top":case"top-right":f={x:e.x,y:p.y+p.height-1},g={x:n.x,y:c.y+1},d=!0;break;case"bottom-left":case"bottom":case"bottom-right":f={x:e.x,y:p.y+1},g={x:n.x,y:c.y+c.height-1},d=!0;break;case"left":case"right":f={x:e.x,y:p.y+1},g={x:n.x,y:c.y+1};break;case"right":}}var y,v,m,x,b,G;if(d)x=r.shapeView(),b=Graph.path(Graph.util.points2path([f,g])),G=x.intersection(b,!0),G.length&&(G=G[0],Graph.util.isPointEquals(G,f)||(f=G)),x=i.shapeView(),G=x.intersection(b,!0),G.length&&(G=G[G.length-1],Graph.util.isPointEquals(G,g)||(g=G)),m=Graph.util.lineBendpoints(f,g,u),v=[f].concat(m).concat([g]),this.values.waypoints=t.tidyRoutes(v);else if(f&&g){switch(l){case"left":case"right":y=Graph.util.expandBox(Graph.util.groupBox([p,c]),0,20),
m=[{x:f.x,y:y.y},{x:g.x,y:y.y}]}b=Graph.path(Graph.util.points2path([f].concat(m).concat([g]))),v=[f].concat(m).concat([g]),this.values.waypoints=t.tidyRoutes(v)}else f=e,g=n,m=Graph.util.lineBendpoints(f,g,u),b=Graph.path(Graph.util.points2path([f].concat(m).concat([g]))),x=r.shapeView(),G=x.intersection(b,!0),G.length&&(f=G[0]),x=i.shapeView(),G=x.intersection(b,!0),G.length&&(g=G[G.length-1]),v=[f].concat(m).concat([g]),this.values.waypoints=t.tidyRoutes(v);return this.commit(),this.fire("route",{command:this.command()}),this},repair:function(e,n){var r=this.values.waypoints.slice();if(!t.isRepairable(r))return this.route();var i,o,s,a,p,h,c=this.target(),l=c.bboxView(),u=this.source(),d=u.bboxView();e===u?(i=d.toJson(),o=l.toJson(),s=d.center(!0),a=r):(i=l.toJson(),o=d.toJson(),s=l.center(!0),a=r.slice(),a.reverse()),p="h"==Graph.util.pointAlign(a[0],a[1])?"x":"y",t.portCentering(n,s,p),h=t.repairRoutes(i,o,n,a);var f,g,y,v;if(h){if(e===c&&h.reverse(),f=h.slice(),g=t.getClosestIntersect(h,u.shapeView(),l.center(!0)),
g&&(y=t.getSegmentIndex(h,g),f=f.slice(y+1),f.unshift(g)),g=t.getClosestIntersect(f,c.shapeView(),d.center(!0)),g&&(v=t.getSegmentIndex(f,g),f=f.slice(0,v+1),f.push(g),2===f.length)){var m=Graph.util.pointAlign(f[0],f[1]);"h"==m?f[1].x=f[0].x:"v"==m&&(f[1].y=f[0].y)}return this.values.waypoints=f,this.commit(),this.fire("route",{command:this.command()}),this}return this.route()},initTrans:function(e){var n=this.waypoints(),r=this.source(),i=this.target(),o=e.ranges.start,s=e.ranges.end,a=r.bboxView(),p=i.bboxView(),h=n[o],c=n[s],l=[];"BENDING"==e.trans&&(0===o&&t.portCentering(h,a.center(!0),e.axis),s===n.length-1&&t.portCentering(c,p.center(!0),e.axis),l=[n[o-1],h,c,n[s+1]],o<2&&l.unshift(a.center(!0)),s>n.length-3&&l.unshift(p.center(!0)));var u=this.layout().position(),d=[],f=[];if(e.snap.hor=[],e.snap.ver=[],_.forEach(l,function(t){t&&("y"==e.axis&&(d.push(t.y),e.snap.hor.push(t.y+u.top)),"x"==e.axis&&(f.push(t.x),e.snap.ver.push(t.x+u.left)))}),this.cached.connect=null,this.cached.bending=null,
"BENDING"==e.trans)this.cached.bending={source:r,target:i,original:n,rangeStart:o,rangeEnd:s,segmentStart:h,segmentEnd:c,sourceBound:a.toJson(),targetBound:p.toJson(),sourcePath:r.shapeView(),targetPath:i.shapeView(),snapH:d,snapV:f};else{var g=n.slice(),y=Graph.util.pointAlign(h,c,10);if(2===g.length){var v,m;v={x:(h.x+c.x)/2,y:(h.y+c.y)/2},m={x:v.x,y:v.y},g.splice(1,0,v,m),0!==e.index?(o+=2,s+=2,h=g[o],c=g[s],e.index+=2,e.point=_.extend({},c),e.event=_.extend({},c)):c=g[s]}this.cached.connect={valid:!1,source:null,target:null,sourcePath:null,targetPath:null,rangeStart:o,rangeEnd:s,segmentStart:h,segmentEnd:c,segmentAlign:y,original:g}}},updateTrans:function(t,e){if("CONNECT"==t){var n=this.cached.connect,r=n.source,i=n.target;_.assign(n,e),r&&n.source?r.guid()!=n.source.guid()&&(n.sourcePath=n.source.shapeView()):!r&&n.source&&(n.sourcePath=n.source.shapeView()),i&&n.target?i.guid()!=n.target.guid()&&(n.targetPath=n.target.shapeView()):!i&&n.target&&(n.targetPath=n.target.shapeView());
}},bending:function(t,e){var n,r,i=this.cached.bending,o=i.original.slice(),s=i.segmentStart,a=i.segmentEnd,p=i.rangeStart,h=i.rangeEnd;n={x:s.x+t.delta.x,y:s.y+t.delta.y},r={x:a.x+t.delta.x,y:a.y+t.delta.y},"x"==t.axis&&(t.event.x=(n.x+r.x)/2),"y"==t.axis&&(t.event.y=(n.y+r.y)/2);var c=Graph.util.snapValue(t.event.x,i.snapV),l=Graph.util.snapValue(t.event.y,i.snapH);t.event.x=c,t.event.y=l,"x"==t.axis&&(n.x=c,r.x=c),"y"==t.axis&&(n.y=l,r.y=l),o[p]=n,o[h]=r;var u,d,f=o.length,g=0;p<2&&(u=Graph.util.boxOrientation(i.sourceBound,Graph.util.pointbox(n)),1===p?"intersect"==u&&(o.shift(),o[0]=n,g--):"intersect"!=u&&(o.unshift(s),g++)),h>f-3&&(d=Graph.util.boxOrientation(i.targetBound,Graph.util.pointbox(r)),h===f-2?"intersect"==d&&(o.pop(),o[o.length-1]=r):"intersect"!=d&&o.push(a)),i.routes=o,i.newRangeStart=p+g,this.cropBending(e)},cropBending:_.debounce(function(e){var n,r=this.cached.bending,i=r.routes,o=t.porting(i,r.sourcePath,!0),s=t.porting(i,r.targetPath),a=i.slice(o.index+1,s.index);
a.unshift(o.port),a.push(s.port),r.waypoints=a,e&&(n=Graph.util.points2path(a),e({command:n}))},0),connecting:function(t,e){var n,r=this.cached.connect,i=r.original.slice(),o=r.segmentAlign,s=r.segmentStart,a=r.segmentEnd,p=r.rangeStart,h=r.rangeEnd;n={x:t.point.x+t.delta.x,y:t.point.y+t.delta.y};var c,l;0===t.index?(c={x:t.point.x+t.delta.x,y:t.point.y+t.delta.y},l="v"==o?{x:a.x,y:c.y}:{x:c.x,y:a.y}):(l={x:t.point.x+t.delta.x,y:t.point.y+t.delta.y},c="h"==o?{x:l.x,y:s.y}:{x:s.x,y:l.y}),i[p]=c,i[h]=l,t.event.x=n.x,t.event.y=n.y,r.routes=i,this.cropConnect(t,e)},cropConnect:_.debounce(function(t,e){var n=this.cached.connect,r=n.routes;if(n.valid){var i,o,s,a;0===t.index?n.source&&(o=n.sourcePath):n.target&&(o=n.targetPath),o&&(s=Graph.path(Graph.util.points2path(r)),a=o.intersection(s,!0),a.length&&(r[t.index]=a[0]))}n.waypoints=r,e&&(i=Graph.util.points2path(r),e({command:i}))},0),stopTrans:function(e){var n,r,i,o;"CONNECT"==e.trans?(n=this.cached.connect,i=n.waypoints,this.cached.connect.valid?(o=!0,
this.source(n.source),this.target(n.target),this.fire("reroute",{source:n.source,target:n.target})):(i=n.original.slice(),o=!1)):"BENDING"==e.trans&&(r=this.cached.bending,i=r.waypoints,o=!0),o?this.values.waypoints=t.tidyRoutes(i):this.values.waypoints=i,this.commit()},toString:function(){return"Graph.router.Orthogonal"}})}(),function(){function t(t,e,n){var r="on"+_.capitalize(e)+n,i=t[r];return r=null,i}var e=Graph.link.Link=Graph.extend({props:{id:null,guid:null,type:"normal",rendered:!1,selected:!1,label:"",labelDistance:.5,source:null,target:null,connected:!1,removed:!1,command:null},components:{block:null,coat:null,path:null,label:null,editor:null},cached:{bendpoints:null,controls:null,convex:null},handlers:{source:null,target:null},router:null,metadata:{icon:Graph.icons.SHAPE_LINK},constructor:function(t,n){var r;this.data(n||{}),r="graph-link-"+ ++e.guid,this.props.guid=r,this.router=t,this.initComponent(),this.initMetadata(),this.bindResource("source",t.source()),this.bindResource("target",t.target()),
this.router.on("route",_.bind(this.onRouterRoute,this)),this.router.on("reroute",_.bind(this.onRouterReroute,this)),Graph.registry.link.register(this)},data:function(t,e){if(void 0===t&&void 0===e)return this.props;var n,r,i={type:!0,params:!0,router_type:!0,client_id:!0,client_source:!0,client_target:!0,diagram_id:!0,source_id:!0,target_id:!0},o={label_distance:"labelDistance"};if(_.isPlainObject(t)){for(var n in t)i[n]||(r=o[n]||n,this.props[r]=t[n]);return this}return void 0===e?this.props[t]:(i[t]||(r=o[t]||t,this.props[r]=e),this)},initComponent:function(){var t,e,n,r,i,o=this.components;t=(new Graph.svg.Group).addClass("graph-link").selectable(!1),t.elem.data(Graph.string.ID_LINK,this.props.guid),t.addClass("link-"+this.props.type),e=(new Graph.svg.Path).addClass("graph-link-coat").render(t),e.data("text",this.props.label),e.elem.data(Graph.string.ID_LINK,this.props.guid),e.draggable({ghost:!0,manual:!0,batchSync:!1}),e.editable({width:150,height:80,offset:"pointer"}),e.on("pointerdown.link",_.bind(this.onCoatClick,this)),
e.on("select.link",_.bind(this.onCoatSelect,this)),e.on("deselect.link",_.bind(this.onCoatDeselect,this)),e.on("beforedrag.link",_.bind(this.onCoatBeforeDrag,this)),e.on("afterdrag.link",_.bind(this.onCoatAfterDrag,this)),e.on("edit.link",_.bind(this.onCoatEdit,this)),e.on("beforeedit.link",_.bind(this.onCoatBeforeEdit,this)),e.on("afterdestroy.link",_.bind(this.onCoatAfterDestroy,this)),n=(new Graph.svg.Path).addClass("graph-link-path").selectable(!1).clickable(!1).attr("marker-end","url(#marker-link-end)").render(t),"message"==this.props.type&&n.attr("marker-start","url(#marker-link-start-circle)"),n.elem.data(Graph.string.ID_LINK,this.props.guid),i=new Graph.svg.Text(0,0,"").addClass("graph-link-label").selectable(!1).render(t),i.draggable({ghost:!0}),i.on("render.link",_.bind(this.onLabelRender,this)),i.on("afterdrag.link",_.bind(this.onLabelAfterDrag,this));var s=i.interactable().vendor();s.on("doubletap",_.bind(this.onLabelDoubletap,this)),r=(new Graph.svg.Group).selectable(!1).render(t),
o.block=t.guid(),o.coat=e.guid(),o.path=n.guid(),o.label=i.guid(),o.editor=r.guid()},initMetadata:function(){this.metadata.tools=[{name:"config",icon:Graph.icons.CONFIG,title:Graph._("Click to config link"),enabled:!0,handler:_.bind(this.onConfigToolClick,this)},{name:"sendtofront",icon:Graph.icons.SEND_TO_FRONT,title:Graph._("Send to front"),enabled:!0,handler:_.bind(this.onFrontToolClick,this)},{name:"sendtoback",icon:Graph.icons.SEND_TO_BACK,title:Graph._("Send to back"),enabled:!0,handler:_.bind(this.onBackToolClick,this)},{name:"trash",icon:Graph.icons.TRASH,title:Graph._("Click to remove link"),enabled:!0,handler:_.bind(this.onTrashToolClick,this)}]},unbindResource:function(t){var e=this.props[t],n=this.handlers[t];if(e){var r=Graph.registry.vector.get(e);if(r&&n){var i,o;for(i in n)o=i+".link",r.off(o,n[i]),o=null}}return n=null,this},bindResource:function(e,n){var r=(this.router,this.handlers[e]);return this.unbindResource(e,n),r={},r.afterresize=_.bind(t(this,e,"AfterResize"),this),
r.select=_.bind(t(this,e,"Select"),this),r.rotate=_.bind(t(this,e,"Rotate"),this),r.beforedrag=_.bind(t(this,e,"BeforeDrag"),this,_,n),r.drag=_.bind(t(this,e,"Drag"),this),r.afterdrag=_.bind(t(this,e,"AfterDrag"),this),r.beforedestroy=_.bind(t(this,e,"BeforeDestroy"),this),this.handlers[e]=r,this.props[e]=n.guid(),n.on("afterresize.link",r.afterresize),n.on("rotate.link",r.rotate),n.on("select.link",r.select),n.on("beforedestroy",r.beforedestroy),n.isDraggable()&&(n.on("beforedrag.link",r.beforedrag),n.draggable().ghost()?n.on("afterdrag.link",r.afterdrag):n.on("drag.link",r.drag)),this},bindSource:function(t){return this.bindResource("source",t)},bindTarget:function(t){return this.bindResource("target",t)},unbindSource:function(t){return this.unbindResource("source")},unbindTarget:function(t){return this.unbindResource("target")},component:function(t){return void 0===t?Graph.registry.vector.get(this.components.block):Graph.registry.vector.get(this.components[t])},invalidate:function(t){
void 0!==t?this.cached[t]=null:this.cached.bendpoints=null},render:function(t){var e;this.component().render(t),e=t.paper(),e&&Graph.registry.link.setContext(this.guid(),e.guid())},id:function(){return this.props.id},guid:function(){return this.props.guid},type:function(t){if(void 0===t)return this.props.type;this.props.type=t;var e=this.component();"message"==t?this.component("path").attr("marker-start","url(#marker-link-start-circle)"):this.component("path").attr("marker-start",""),e.removeClass("link-normal link-message"),e.addClass("link-"+t)},connect:function(t,e){this.props.connected||(this.router.route(t,e),this.props.connected=!0)},connectByCommand:function(t){this.props.connected||(this.router.execute(t),this.props.connected=!0)},disconnect:function(t){this.props.connected&&(t=_.defaultTo(t,!0),this.props.connected=!1,t&&(this.router.reset(),this.reload(this.router.command())))},redraw:function(t){},reload:function(t,e){e=_.defaultTo(e,!1),t=t||"",this.component("coat").attr("d",t).dirty(!0),
this.component("path").attr("d",t),this.invalidate(),e||(this.refresh(),this.fire("change"),Graph.topic.publish("link:change"))},reloadConvex:function(t){this.cached.convex=t},removeConvex:function(){this.cached.convex=null},reset:function(t){var e=this.router.command();this.reload(e,t)},refresh:function(){if(this.props.label){var t=this.component("label");if(t.props.rendered){var e=this.router.path();if(e.segments.length){var n=t.bbox().toJson(),r=this.props.labelDistance||.5,i=this.router.layout().scale(),e=this.router.path(),o=e.pointAt(r*e.length(),!0),s=Graph.util.pointAlign(o.start,o.end,10);"h"==s?o.x+=n.width/2+10/i.x:o.y-=n.height-5/i.y,t.attr({x:o.x,y:o.y}),t.arrange(),e=null,o=null,t.dirty(!0)}else t.hide()}}},label:function(t){if(void 0===t)return this.props.label;this.props.label=t;var e=this.component("label"),n=this.component("coat");return e.write(t),e.arrange(),n.data("text",t),e.props.rendered&&this.refresh(),this},select:function(t){var e=this.router.source().paper();t=_.defaultTo(t,!1),
t&&e&&e.collector().clearCollection(),this.component("coat").select()},deselect:function(){this.component("coat").deselect()},renderControl:function(){},resumeControl:function(){var t=this,e=t.component("editor");t.cached.bendpoints||(t.cached.bendpoints=t.router.bendpoints(),t.renderControl()),e.elem.appendTo(this.component("block").elem)},suspendControl:function(){this.component("editor").elem.detach()},sendToFront:function(){var t=this.component().parent();this.component().elem.appendTo(t.elem)},relocate:function(t,e){this.router.relocate(t,e),this.reload(this.router.command())},relocateHead:function(t,e){var n=this.router.head();n&&(n.x+=t,n.y+=e,this.router.repair(this.router.target(),n))},relocateTail:function(t,e){var n=this.router.tail();n&&(n.x+=t,n.y+=e,this.router.repair(this.router.source(),n))},remove:function(){var t,e=this;if(!this.props.removed){this.props.removed=!0,this.disconnect(!1),this.unbindSource(),this.unbindTarget(),this.fire("beforedestroy",{link:this}),e.component("label").remove(),
e.cached.controls&&(_.forEach(e.cached.controls,function(t){var e=Graph.registry.vector.get(t);e&&e.remove()}),e.cached.controls=null),e.component("editor").remove(),e.component("path").remove(),e.component("block").remove();for(t in e.components)e.components[t]=null;for(t in e.cached)e.cached[t]=null;e.router.destroy(),e.router=null,e.fire("afterdestroy"),Graph.registry.link.unregister(e),Graph.topic.publish("link:afterdestroy")}},isSelected:function(){return this.props.selected},isConnected:function(){return this.props.connected},toString:function(){return"Graph.link.Link"},toJson:function(){var t=this.router.source(),e=this.router.target(),n=Graph.registry.shape.get(t),r=Graph.registry.shape.get(e),i={metadata:{},props:{id:this.props.id,guid:this.guid(),type:this.toString(),routerType:this.router.type(),command:this.router.command(),label:this.props.label,labelDistance:this.props.labelDistance,source:n?n.guid():t.guid(),sourceType:n?"shape":"vector",target:r?r.guid():e.guid(),targetType:r?"shape":"vector",
convex:!0,smooth:!0,smoothness:this.props.smoothness},params:[{key:"Data source",value:"db.example"}]};return i},onRouterRoute:function(t){var e=t.command;this.reload(e)},onRouterReroute:function(t){var e=t.source,n=t.target;this.bindResource("source",e),this.bindResource("target",n),this.sendToFront()},onLabelRender:function(t){this.props.label&&this.label(this.props.label)},onLabelAfterDrag:function(t){var e=this.component("label"),n=e.matrix(),r=e.attrs.x,i=e.attrs.y,o={x:n.x(r,i),y:n.y(r,i)};e.attr({x:o.x,y:o.y}),e.arrange();var s=this.router.path(),a=s.nearest(o);this.props.labelDistance=a.distance/s.length(),e.reset(),n=s=null},onLabelDoubletap:function(t){var e=this.component("coat");e.editable().startEdit(t)},onCoatBeforeEdit:function(t){this.component("label").hide(),this.component().addClass("editing")},onCoatEdit:function(t){this.component().removeClass("editing"),this.component("label").show(),this.label(t.text,t.left,t.top)},onCoatClick:function(t){var e=this.component("coat").paper();
"linking"==e.state()&&e.tool().activate("panzoom")},onCoatSelect:function(t){var e=(this.component("coat"),!1);t.initial&&(e=!0),this.props.selected=!0,this.component().addClass("selected"),e&&(this.resumeControl(),Graph.topic.publish("link:select",{link:this}))},onCoatDeselect:function(t){this.props.removed||(this.props.selected=!1,this.component().removeClass("selected"),this.suspendControl(),t.initial&&Graph.topic.publish("link:deselect",{link:this}))},onCoatBeforeDrag:function(t){this.suspendControl()},onCoatAfterDrag:function(t){this.relocate(t.dx,t.dy)},onCoatAfterDestroy:function(t){this.remove()},onSourceRotate:function(){},onSourceSelect:function(t){var e=this.router.target();this.isSelected()?e.isSelected()||this.deselect():e.isSelected()&&this.select()},onSourceBeforeDrag:function(t,e){var n=this.router.target();e.isSelected()&&n.isSelected()||this.deselect(),this.cached.convex=null},onSourceDrag:function(t){console.warn("Not yet implemented")},onSourceAfterDrag:function(t){var e=this.router.source(),n=this.router.target();
e.isSelected()?n.isSelected()||this.relocateTail(t.dx,t.dy):this.relocateTail(t.dx,t.dy)},onSourceAfterResize:function(t){this.relocateTail(t.translate.dx,t.translate.dy)},onSourceBeforeDestroy:function(){this.props.removed||this.component("coat").remove()},onTargetRotate:function(){},onTargetSelect:function(t){var e=this.router.source();this.isSelected()?e.isSelected()||this.deselect():e.isSelected()&&this.select()},onTargetBeforeDrag:function(t,e){var n=this.router.source();n.isSelected()&&e.isSelected()||this.deselect(),this.cached.convex=null},onTargetDrag:function(t){console.warn("Not yet implemented")},onTargetAfterDrag:function(t){var e=this.router.target(),n=this.router.source();e.isSelected()?n.isSelected()||this.relocateHead(t.dx,t.dy):this.relocateHead(t.dx,t.dy)},onTargetAfterResize:function(t){this.relocateHead(t.translate.dx,t.translate.dy)},onTargetBeforeDestroy:function(){this.props.removed||this.component("coat").remove()},onTrashToolClick:function(t){this.component("coat").remove();
},onConfigToolClick:function(t){},onFrontToolClick:function(t){this.sendToFront()},onBackToolClick:function(t){},destroy:function(){}});e.guid=0}(),function(){var t=Graph.link.Link;Graph.link.Directed=Graph.extend(t,{renderControl:function(){var t=this,e=t.component("editor");t.cached.controls&&(_.forEach(t.cached.controls,function(t){t=Graph.registry.vector.get(t),t.remove()}),t.cached.controls=null);var n=this.cached.bendpoints,r=n.length-1,i=t.guid(),o=[],s=Graph.config.base+"img/"+Graph.config.resizer.image,a=Graph.config.resizer.size;_.forEach(n,function(n,p){var h=new Graph.svg.Image(s,n.x-a/2,n.y-a/2,a,a);h.selectable(!1),h.removeClass(Graph.styles.VECTOR),0===p?(h.addClass(Graph.styles.LINK_TAIL),h.elem.data("pole","tail")):p===r&&(h.addClass(Graph.styles.LINK_HEAD),h.elem.data("pole","head")),h.elem.group("graph-link"),h.elem.data(Graph.string.ID_LINK,i);var c={trans:0===p||p===r?"CONNECT":"BENDING",index:n.index,space:n.space,point:{x:n.x,y:n.y},event:{x:n.x,y:n.y},range:{start:n.range[0],
end:n.range[1]},delta:{x:0,y:0},snap:{hor:[],ver:[]}};h.draggable({ghost:!1}),h.cursor("default"),h.on("beforedrag",_.bind(t.onControlStart,t,_,c,h)),h.on("drag",_.bind(t.onControlMove,t,_,c,h)),h.on("afterdrag",_.bind(t.onControlEnd,t,_,c,h)),h.render(e),o.push(h.guid())}),t.cached.controls=o,o=null},onControlStart:function(t,e,n){if(this.router.initTrans(e),"CONNECT"==e.trans){var r=this.component().paper();r&&r.addClass("linking")}var i=e.snap.hor,o=e.snap.ver;n.draggable().snap([function(t,e){var n=Graph.util.snapValue(t,o),r=Graph.util.snapValue(e,i);return{x:n,y:r,range:10}}]),_.forEach(this.cached.controls,function(t){var e=Graph.registry.vector.get(t);e&&e!==n&&e.hide()}),n.show()},onControlMove:function(t,e,n){var r=this;e.delta.x+=t.dx,e.delta.y+=t.dy;var i,o,s,a;i=e.event.x,o=e.event.y,"BENDING"==e.trans?r.router.bending(e,function(t){r.reload(t.command,!0)}):r.router.connecting(e,function(t){r.reload(t.command,!0)}),s=e.event.x,a=e.event.y,t.originalData.dx=s-i,t.originalData.dy=a-o;
},onControlEnd:function(t,e,n){if(this.router.stopTrans(e),"CONNECT"==e.trans){var r=this.component().paper();r&&r.removeClass("linking")}this.reload(this.router.command()),this.invalidate(),this.resumeControl()}})}(),function(){Graph.link.Orthogonal=Graph.extend(Graph.link.Link,{reload:function(t,e){var n,r,i,o,s,a;if(e=_.defaultTo(e,!1),n=this.cached.convex,r=this.props.smooth,n){var p=this.router.waypoints();if(!p)return;o=p.slice(),s=o.length-1,a=[],_.forEach(o,function(t,e){var r,i=t,s=o[e+1];r=0===e?["M",t.x,t.y]:["L",t.x,t.y],a.push(r),n[e]&&_.forEach(n[e],function(t){var e=Graph.util.convexSegment(t,i,s);e&&a.push(e[0],e[1])})}),t=Graph.util.segments2path(a)}if(r){i=this.props.smoothness||6,a=a||Graph.util.path2segments(t).slice();var h,c,l,u,d,f;for(d=0;d<a.length;d++)if(h=a[d],l=a[d+1],f=!("L"!=h[0]||!l||"Q"==l[0]),f&&(u={x:h[h.length-2],y:h[h.length-1]},c=a[d-1],c&&l)){var g=Graph.util.smoothSegment(u,{x:c[c.length-2],y:c[c.length-1]},{x:l[l.length-2],y:l[l.length-1]},i);g&&(a.splice(d,1,g[0],g[1]),
d++)}t=Graph.util.segments2path(a)}t=t||"",this.component("coat").attr("d",t).dirty(!0),this.component("path").attr("d",t),this.invalidate(),e||(this.refresh(),this.fire("change"),Graph.topic.publish("link:change"))},renderControl:function(){var t=this,e=t.component("editor");t.cached.controls&&(_.forEach(t.cached.controls,function(t){t=Graph.registry.vector.get(t),t.remove()}),t.cached.controls=null);var n=this.cached.bendpoints,r=t.guid(),i=n.length-1,o=[],s=Graph.config.base+"img/"+Graph.config.resizer.image,a=Graph.config.resizer.size;_.forEach(n,function(n,p){var h,c,l,u,d;h=new Graph.svg.Image(s,n.x-a/2,n.y-a/2,a,a),h.selectable(!1),h.removeClass(Graph.styles.VECTOR),h.elem.group("graph-link"),h.elem.data(Graph.string.ID_LINK,r),d={ghost:!1},u=null,c="default",0===p?(h.addClass(Graph.styles.LINK_TAIL),h.elem.data("pole","tail")):p===i?(h.addClass(Graph.styles.LINK_HEAD),h.elem.data("pole","head")):(l=Graph.util.pointAlign(n.start,n.end),u="v"==l?"y":"x",c="x"==u?"ew-resize":"ns-resize",
d={ghost:!1,axis:u});var f={trans:0===p||p===i?"CONNECT":"BENDING",index:n.index,axis:u,cursor:c,point:{x:n.x,y:n.y},ranges:{start:n.range[0],end:n.range[1]},event:{x:n.x,y:n.y},snap:{hor:[],ver:[]},delta:{x:0,y:0}};h.draggable(d),h.cursor(c),h.on("beforedrag",_.bind(t.onControlStart,t,_,f,h)),h.on("drag",_.bind(t.onControlMove,t,_,f)),h.on("afterdrag",_.bind(t.onControlEnd,t,_,f,h)),h.render(e),o.push(h.guid())}),t.cached.controls=o,o=null},onControlStart:function(t,e,n){if(this.component("coat").cursor(e.cursor),this.router.initTrans(e),"CONNECT"==e.trans){var r=this.component().paper();r&&r.addClass("linking")}var i=e.snap.hor,o=e.snap.ver;n.draggable().snap([function(t,e){var n=Graph.util.snapValue(t,o),r=Graph.util.snapValue(e,i);return{x:n,y:r,range:10}}]),_.forEach(this.cached.controls,function(t){var e=Graph.registry.vector.get(t);e&&e!==n&&e.hide()}),n.show(),this.removeConvex()},onControlMove:function(t,e){var n=this;e.delta.x+=t.dx,e.delta.y+=t.dy;var r,i,o,s,a,p;r=e.event.x,
i=e.event.y,"BENDING"==e.trans?n.router.bending(e,function(t){n.reload(t.command,!0)}):n.router.connecting(e,function(t){n.reload(t.command,!0)}),o=e.event.x,s=e.event.y,a=o-r,p=s-i,t.originalData.dx=a,t.originalData.dy=p},onControlEnd:function(t,e,n){if(this.component("coat").cursor("pointer"),this.router.stopTrans(e),"CONNECT"==e.trans){var r=this.component().paper();r&&r.removeClass("linking")}this.reload(this.router.command()),this.invalidate(),this.resumeControl()},toString:function(){return"Graph.link.Orthogonal"}})}(),function(){function t(t){var e=function(t){return t},n=_.bisector(function(t){return e(t)}).left;return t.insert=function(n){var r=t.findIndex(n),i=e(n);if(!t[r]||i!=e(t[r]))return t.splice(r,0,n),r},t.remove=function(e){var n=t.findIndex(e);return t.splice(n,1),n},t.findIndex=function(r){return n(t,e(r))},t.key=function(n){return e=n,t},t.swap=function(){},t.order=function(){return t.sort(_.ascendingKey(e)),t},t}var e=1e-9,n=.1,r=Graph.util.Sweeplink=function(t){var e=this;
e.points=[],e.queue=[],e.lines=[],e.found=[],e.process=[],_.forEach(t,function(t){var n=e.extract(t);Array.prototype.push.apply(e.points,n)}),_.forEach(e.points,function(t,n){n%2&&e.lines.push(_.sortBy([t,e.points[n-1]],"y"))}),_.forEach(e.lines,function(t,e){t[0].x==t[1].x&&(t[0].x+=n,t[1].x-=n),t[0].y==t[1].y&&(t[0].y-=n,t[1].y+=n),t[0].line=t,t[1].line=t})};r.prototype.constructor=r,r.prototype.extract=function(t){var e=t.router.path().curve().segments,n=[];return _.forEach(e,function(r,i){var o=0===i?{x:r[1],y:r[2]}:{x:r[5],y:r[6]},s=e[i+1];s&&(s={x:s[5],y:s[6]},Graph.util.movepoint(o,s,-20),Graph.util.movepoint(s,o,-20),o.x=Math.round(o.x,3),o.y=Math.round(o.y,3),s.x=Math.round(s.x,3),s.y=Math.round(s.y,3),o.link=t,s.link=t,o.range=i,s.range=i+1,n.push(o,s))}),n},r.prototype.findConvex=function(){var n=this;n.queue=t(n.points.slice()).key(function(t){return t.y+e*t.x}).order(),n.found=[],n.process=t([]);for(var r=0;r<n.queue.length&&r<1e3;r++){var i,o,s,a,p=n.queue[r];p.line&&p.line[0]==p?(p.type="insert",
i=n.process.key(function(t){return n.intercept(t,p.y-e/1e3)}).insert(p.line),n.validate(p.line,n.process[i+1]),n.validate(p.line,n.process[i-1])):p.line?(p.type="removal",i=n.process.findIndex(p.line),n.process.remove(p.line),n.validate(n.process[i-1],n.process[i])):p.lineA&&p.lineB&&(n.process.key(function(t){return n.intercept(t,p.y-e/1e3)}),o=n.process.findIndex(p.lineA),s=n.process.findIndex(p.lineB),o==s&&(o+=1),n.process[o]=p.lineB,n.process[s]=p.lineA,a=o<s?o:s,n.validate(n.process[a-1],n.process[a]),n.validate(n.process[a+1],n.process[a+2]))}var h={};return _.forEach(this.found,function(e){var n,r,i,o,s,a,p,c,l,u,d;p=Graph.util.pointAlign(e.lineA[0],e.lineA[1],10),c=Graph.util.pointAlign(e.lineB[0],e.lineB[1],10),p!=c&&(o="v"==p?p:c,l="v"==p?e.lineA:e.lineB,u=l[0].link,d=u.guid(),n=u.router.waypoints(),r=Math.min(l[0].range,l[1].range),i=Math.max(l[0].range,l[1].range),s=n[r],a=n[i],h[d]||(h[d]={}),h[d][r]||(h[d][r]=t([]).key(function(t){return"v"==t.segmentAlign?t.segmentStart.x<t.segmentEnd.x?t.x+t.segmentStart.x:t.segmentStart.x-t.x:t.segmentStart.y<t.segmentEnd.y?t.y+t.segmentStart.y:t.segmentStart.y-t.y;
})),h[d][r].insert({x:e.x,y:e.y,link:u.guid(),rangeStart:r,rangeEnd:i,segmentAlign:o,segmentStart:s,segmentEnd:a}))}),h},r.prototype.intersect=function(t,e,n,r){var i=(t.x-e.x)*(n.y-r.y)-(t.y-e.y)*(n.x-r.x),o=t.x*e.y-t.y*e.x,s=n.x*r.y-n.y*r.x,a=(o*(n.x-r.x)-s*(t.x-e.x))/i,p=(o*(n.y-r.y)-s*(t.y-e.y))/i,h={x:a,y:p};return h.isOverlap=a==t.x&&p==t.y||a==e.x&&p==e.y,h.isIntersection=!(t.x<a^a<e.x)&&!(n.x<a^a<r.x)&&!h.isOverlap&&i,h},r.prototype.validate=function(t,e){if(t&&e){var n=this.intersect(t[0],t[1],e[0],e[1]);n.lineA=t,n.lineB=e,n.isIntersection&&this.found.push(n)&&this.queue.insert(n)}},r.prototype.intercept=function(t,e){var n=t[0],r=t[1],i=(n.y-r.y)/(n.x-r.x);return(e-n.y+i*n.x)/i},r.prototype.destroy=function(){this.points=null,this.lines=null,this.found=null,this.queue=null,this.process=null}}(),function(){Graph.plugin.Plugin=Graph.extend({props:{vector:null,activator:"tool"},cached:{},options:function(t){},vector:function(){return Graph.registry.vector.get(this.props.vector)},
invalidate:function(){},enable:function(t){},disable:function(){},destroy:function(){}})}(),function(){var t=Graph.plugin.Manager=function(){this.installed={}};t.prototype.get=function(t){var e=this.installed[t];return{plugin:function(){if(e){var t=Graph.registry.vector.get(e.target);return t[e.handler]()}return null},component:function(){return e?Graph.registry.vector.get(e.target):null}}},t.prototype.install=function(t,e,n){var r=this.getPluginHandler(t);r&&(n=n||{},e[r](n),this.installed[t]={handler:r,target:e.guid()})},t.prototype.uninstall=function(t){var e=this.installed[t];if(e){var n=Graph.registry.vector.get(e.target);n[handler]({destroy:!0}),delete this.installed[t]}},t.prototype.getPluginHandler=function(t){var e={network:"connectable",resizer:"resizable",snapper:"snappable",dragger:"draggable",editor:"editable"};return e[t]}}(),function(){Graph.plugin.Definer=Graph.extend(Graph.plugin.Plugin,{props:{vector:null},definitions:{},components:{holder:null},constructor:function(t){
this.props.vector=t.guid(),this.components.holder=Graph.$("<defs/>"),this.components.holder.prependTo(t.elem),t.isPaper()&&(this.defineArrowMarker("marker-link-end"),this.defineCircleMarker("marker-link-start-circle"))},defineArrowMarker:function(t){if(this.definitions[t])return this.definitions[t];var e=Graph.$(_.format('<marker id="{0}" refX="{1}" refY="{2}" viewBox="{3}" markerWidth="{4}" markerHeight="{5}" orient="{6}"><path d="{7}" fill="{8}" stroke-width="{9}" stroke-linecap="{10}" stroke-dasharray="{11}"></path></marker>',t,"11","10","0 0 20 20","10","10","auto","M 1 5 L 11 10 L 1 15 Z","#000000","1","round","10000, 1"));return this.definitions[t]=e,this.components.holder.append(e),e},defineCircleMarker:function(t){if(this.definitions[t])return this.definitions[t];var e=Graph.$(_.format('<marker id="{0}" refX="{1}" refY="{2}" viewBox="{3}" markerWidth="{4}" markerHeight="{5}" orient="{6}"><circle cx="6" cy="6" r="4" fill="none" stroke="#000000" stroke-width="1" /></marker>',t,"6","6","0 0 20 20","10","10","auto"));
return this.definitions[t]=e,this.components.holder.append(e),e},toString:function(){return"Graph.plugin.Definer"}})}(),function(){var t={},e=Graph.plugin.Reactor=function(e,n){var r=this,i=e.node(),o=e.guid();r.props={vector:o},r.navigationKeys=[Graph.event.ENTER,Graph.event.DELETE,Graph.event.SHIFT,Graph.event.CTRL,Graph.event.ESC],r.listeners=n||{};var s=t[o]=interact(i);if(s.on("down",function(t){t.target===i&&(t.originalType="pointerdown",Graph.topic.publish("vector:pointerdown",{vector:e}),e.fire(t))},!0),e.elem.on({contextmenu:function(t){t.currentTarget===i&&e.fire(t)}}),e.isPaper()){var a=Graph.$(document);a.on("keydown",function(t){r.isNavigation(t)&&Graph.cached.paper==o&&(t.originalType="keynavdown",e.fire(t))}),a.on("keyup",function(t){r.isNavigation(t)&&Graph.cached.paper==o&&(t.originalType="keynavup",e.fire(t))}),a=null}s=null};e.prototype.constructor=e,e.prototype.fire=function(t){var e;switch(t){case"down":e={type:"mousedown"}}},e.prototype.isNavigation=function(t){var e=t.keyCode;
return _.indexOf(this.navigationKeys,e)>-1},e.prototype.vendor=function(){return t[this.props.vector]},e.prototype.draggable=function(t){return this.vendor().draggable(t)},e.prototype.dropzone=function(t){return this.vendor().dropzone(t)},e.prototype.gesturable=function(t){return this.vendor().gesturable(t)},e.prototype.destroy=function(){var e=this.props.vector,n=t[e];n&&n.unset(),delete t[e]},e.prototype.toString=function(){return"Graph.plugin.Reactor"}}(),function(){Graph.plugin.Transformer=Graph.extend(Graph.plugin.Plugin,{props:{scale:1,rotate:0},constructor:function(t){this.actions=[],this.props.vector=t.guid()},transform:function(t){var e=this,n=Graph.util.transform2segments(t);return _.forEach(n,function(t){var n=t.shift();e[n]&&_.isFunction(e[n])&&!function(){e[n].apply(e,t)}(n,t)}),this},queue:function(){var t=_.toArray(arguments);return this.actions.push({name:t.shift(),args:t,sort:this.actions.length}),this},translate:function(t,e){return t=_.defaultTo(t,0),e=_.defaultTo(e,0),
this.queue("translate",t,e),this},rotate:function(t,e,n){return _.isUndefined(e)||_.isUndefined(n)?this.queue("rotate",t):this.queue("rotate",t,e,n),this},scale:function(t,e,n,r){return e=_.defaultTo(e,t),_.isUndefined(n)||_.isUndefined(r)?this.queue("scale",t,e):this.queue("scale",t,e,n,r),this},matrix:function(t,e,n,r,i,o){return this.queue("matrix",t,e,n,r,i,o),this},commit:function(t,e){var n=this,r=n.actions,i=n.vector(),o={translate:!1,rotate:!1,scale:!1};if(r.length){t=_.defaultTo(t,!1),e=_.defaultTo(e,!1);var s=0,a=1,p=1,h=i.matrix().clone();if(_.forEach(r,function(e){var n=e.args,r=e.name,c=n.length,l=!1;t&&(l=h.invert(!0));var u,d,f,g,y;"translate"==r&&2===c?(t?(u=l.x(0,0),d=l.y(0,0),f=l.x(n[0],n[1]),g=l.y(n[0],n[1]),h.translate(f-u,g-d)):h.translate(n[0],n[1]),o.translate=!0):"rotate"==r?(1==c?(y=y||i.bboxPristine().toJson(),h.rotate(n[0],y.x+y.width/2,y.y+y.height/2),s+=n[0]):3==c&&(t?(f=l.x(n[1],n[2]),g=l.y(n[1],n[2]),h.rotate(n[0],f,g)):h.rotate(n[0],n[1],n[2]),s+=n[0]),o.rotate=!0):"scale"==r?(1===c||2===c?(y=y||i.bboxPristine().toJson(),
h.scale(n[0],n[c-1],y.x+y.width/2,y.y+y.height/2),a*=n[0],p*=n[c-1]):4===c&&(t?(f=l.x(n[2],n[3]),g=l.y(n[2],n[3]),h.scale(n[0],n[1],f,g)):h.scale(n[0],n[1],n[2],n[3]),a*=n[0],p*=n[1]),o.scale=!0):"matrix"==r&&h.multiply(n[0],n[1],n[2],n[3],n[4],n[5])}),e)return this.actions=[],h;i.graph.matrix=h,i.attr("transform",h.toValue()),o.translate&&(o.translate={dx:h.e,dy:h.f},this.fire("translate",o.translate)),o.rotate&&(o.rotate={deg:s},this.fire("rotate",o.rotate)),o.scale&&(o.scale={sx:a,sy:p},this.fire("scale",o.scale)),this.actions=[]}},toString:function(){return"Graph.plugin.Transformer"}})}(),function(){function t(t,n){n=_.toString(n).replace(/\.{3}|\u2026/g,t),t=Graph.util.transform2segments(t)||[],n=Graph.util.transform2segments(n)||[];for(var r,i,o,s,a=Math.max(t.length,n.length),p=[],h=[],c=0;c<a;c++){if(o=t[c]||e(n[c]),s=n[c]||e(o),o[0]!=s[0]||"rotate"==o[0].toLowerCase()&&(o[2]!=s[2]||o[3]!=s[3])||"scale"==o[0].toLowerCase()&&(o[3]!=s[3]||o[4]!=s[4]))return{equal:!1,from:o,to:s};for(p[c]=[],
h[c]=[],r=0,i=Math.max(o.length,s.length);r<i;r++)r in o&&(p[c][r]=o[r]),r in s&&(h[c][r]=s[r])}return{equal:!0,from:p,to:h}}function e(t){var e=t[0];switch(e.toLowerCase()){case"translate":return[e,0,0];case"matrix":return[e,1,0,0,1,0,0];case"rotate":return 4==t.length?[e,0,t[2],t[3]]:[e,0];case"scale":return 5==t.length?[e,1,1,t[3],t[4]]:3==t.length?[e,1,1]:[e,1]}}var n=this,r=Graph.plugin.Animator=Graph.extend(Graph.plugin.Plugin,{props:{vector:null,duration:1e3,easing:"linier"},stacks:[],constructor:function(t){this.props.vector=t.guid()},create:function(t,e,n,r){return new i(t,e,n,r)},animate:function(t,e,n,r){var o,s,a=this.vector(),p=_.extend({},a.attrs);return t instanceof i?s=t:(e=_.defaultTo(e,this.props.duration),_.isFunction(n)&&(r=n,n=this.props.easing),n||(n=this.props.easing),o={100:t},s=new i(o,e,n,r)),s.count()?(p.transform=a.attrs.transform,p.matrix=a.matrix().clone(),this.start(s,s.frame(0),p,null),s=null,this):void(s=null)},resume:function(){},pause:function(){},stop:function(){},
start:function(e,n,o,s){var a=e.count();if(!a)return void(e=null);var p,h,c,l,u,d,f,g,y=this.vector(),v=this.stacks.length,m={},x={},b={};if(s){for(g=0;g<v;g++)if(f=this.stacks[g],f.animation==e){f.frame!=n?(this.stacks.splice(g,1),d=1):u=f,y.attr(f.reset);break}}else s=+b;for(h={animation:e,vector:y},l=e.duration(),c=e.at(a-1).frame,g=0;g<a;g++){if(p=e.at(g),p.frame==n||p.frame>s*c){h.prev=e.at(g-1),h.prev=h.prev?h.prev.frame:0,h.frame=p.frame,h.duration=l/c*(h.frame-h.prev),h.next=e.at(g+1),h.next=h.next?h.next.frame:void 0,h.last=c;break}s&&y.attr(p.params)}if(u)u.initstatus=s,u.start=new Date-u.duration*s;else{l=h.duration,_.forOwn(p.params,function(e,n){var r,o,s,a,p,h,c,u,d=i.animable[n];if(d)switch(x[n]=y.attrs[n],x[n]=_.defaultTo(x[n],d.defaults),b[n]=e,d.type){case"number":m[n]=(b[n]-x[n])/l;break;case"transform":var f=t(y.attrs[n],e);if(f.equal)for(x[n]=f.from,b[n]=f.to,m[n]=[],m[n].semantic=!0,p=0,c=x[n].length;p<c;p++)for(m[n][p]=[x[n][p][0]],h=1,u=x[n][p].length;h<u;h++)m[n][p][h]=(b[n][p][h]-x[n][p][h])/l;else r=y.plugins.transformer,
a=Graph.util.transform2segments(b[n]),o=y.matrix(),x[n]=o.clone(),s=o.invert(!0),y.graph.matrix=o.multiply(s),_.forEach(a,function(t){var e=t[0],n=t.slice(1);r[e].apply(r,n)}),o=r.commit(!1,!0),b[n]=o.clone(),m[n]={a:(b[n].props.a-x[n].props.a)/l,b:(b[n].props.b-x[n].props.b)/l,c:(b[n].props.c-x[n].props.c)/l,d:(b[n].props.d-x[n].props.d)/l,e:(b[n].props.e-x[n].props.e)/l,f:(b[n].props.f-x[n].props.f)/l},a=null,r=null,o=null}});var G=+new Date;if(_.extend(h,{scene:p,timestamp:G,start:G+e.delay(),reset:o,from:x,to:b,delta:m,status:0,initstatus:s||0,stop:!1}),this.stacks.push(h),s&&!u&&!d&&(h.stop=!0,h.start=new Date-p.duration*s,1===this.stacks.length))return this.player();d&&(h.start=new Date-p.duration*s),1===this.stacks.length&&r.play(_.bind(this.player,this))}this.fire("animstart")},player:function(){for(var t,e,n,o,s,a,p,h,c,l,u,d,u,f,g,c,y,v,m,x,b,G=+new Date,w=0;w<this.stacks.length;w++)if(e=this.stacks[w],!(e.paused||(o=G-e.start,a=e.duration,t=e.vector,l=e.scene,n=e.from,y=e.to,
delta=e.delta,s=e.animation,e.initstatus?(o=(e.initstatus*e.last-e.prev)/(e.frame-e.prev)*a,e.status=e.initstatus,delete e.initstatus,e.stop&&this.stacks.splice(w--,1)):e.status=(e.prev+(e.frame-e.prev)*(o/a))/e.last,o<0)))if(o<a){ease=l.easing(o/a);for(c in n)switch(p=i.animable[c],p.type){case"number":h=+n[c]+ease*a*delta[c],t.attr(name,h);break;case"transform":if(delta[c].semantic){for(d=t.plugins.transformer,x=0,v=n[c].length;x<v;x++){for(f=n[c][x][0],g=[],b=1,m=n[c][x].length;b<m;b++)g.push(n[c][x][b]+ease*a*delta[c][x][b]);d[f].apply(d,g)}u=d.commit(!1,!0),t.attr("transform",u.toValue()),u=null,d=null}else u=Graph.matrix(n[c].props.a+ease*a*delta[c].a,n[c].props.b+ease*a*delta[c].b,n[c].props.c+ease*a*delta[c].c,n[c].props.d+ease*a*delta[c].d,n[c].props.e+ease*a*delta[c].e,n[c].props.f+ease*a*delta[c].f),t.attr("transform",u.toValue()),u=null}}else{for(c in y)switch(p=i.animable[c],p.type){case"transform":delta[c].semantic?(d=t.plugins.transformer,_.forEach(y[c],function(t){var e=t[0],n=t.slice(1);
d[e].apply(d,n)}),u=d.commit(!1,!0),t.graph.matrix=u,t.attr("transform",u.toValue()),u=null,d=null):(u=y[c].clone(),t.graph.matrix=u,t.attr("transform",u.toValue()),u=null);break;default:t.attr(c,y[c])}l.played++,this.stacks.splice(w--,1);var k=s.repeat(),C=l.played;k>1&&C<k&&!e.next&&(_.forOwn(s.scenes,function(n,r){for(var i in n.params)"transform"==i?(t.graph.matrix=e.reset.matrix,t.attr("transform",e.reset.transform)):t.attr(r,e.reset[r])}),this.start(s,s.frame(0),e.reset,null)),e.next&&!e.stop&&this.start(s,e.next,e.reset,null),C>=k&&(e=null)}this.stacks.length&&r.play(_.bind(this.player,this))},toString:function(){return"Graph.plugin.Animator"}});r.play=function(t){var e=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(t){setTimeout(t,16)};return _.bind(e,t)}(n);var i=Graph.extend({props:{easing:"linier",duration:1e3,repeat:1,delay:0},scenes:{},frames:[],constructor:function(t,e,n,r){if(this.props.guid="graph-anim-"+ ++i.guid,
this.props.duration=e=_.defaultTo(e,1e3),_.isFunction(n)&&(r?this.props.easing="function":(r=n,n=this.props.easing)),n||(n=this.props.easing),t){var n=_.isString(n)?i.easing[n]:n,o=(this.props.repeat,this.scenes),s=this.frames;_.forOwn(t,function(t,e){var a,p,h={};a=_.toNumber(e),h=_.pickBy(t,function(t,e){return!!i.animable[e]}),p={frame:a,params:h,easing:n,callback:r,played:0},s.push(a),o[a]=p}),s.sort(function(t,e){return t-e})}},guid:function(){return this.props.guid},duration:function(){return this.props.duration},easing:function(){return this.props.easing},delay:function(t){if(void 0===t)return this.props.delay;var e=new i;return e.frames=this.frames,e.scenes=_.cloneDeep(this.scenes),e.props=_.cloneDeep(this.props),e.props.delay=t||0,e},repeat:function(t){if(void 0===t)return this.props.repeat;var e=new i;return e.frames=this.frames.slice(),e.scenes=_.cloneDeep(this.scenes),e.props=_.cloneDeep(this.props),e.props.repeat=Math.floor(Math.max(t,0))||1,_.forOwn(e.scenes,function(t,e){
t.played=0}),e},count:function(){return this.frames.length},at:function(t){var e=this.frame(t);return this.scene(e)},frame:function(t){return this.frames[t]},scene:function(t){return this.scenes[t]},destroy:function(){this.scenes=null,this.frames=null}});_.extend(i,{guid:0,animable:{x:{type:"number",defaults:0},y:{type:"number",defaults:0},cx:{type:"number",defaults:0},cy:{type:"number",defaults:0},transform:{type:"transform",defaults:""}},easing:{linier:function(t){return t},easeIn:function(t){return Math.pow(t,1.7)},easeOut:function(t){return Math.pow(t,.48)},easeInOut:function(t){var e=.48-t/1.04,n=Math.sqrt(.1734+e*e),r=n-e,i=Math.pow(Math.abs(r),1/3)*(r<0?-1:1),o=-n-e,s=Math.pow(Math.abs(o),1/3)*(o<0?-1:1),a=i+s+.5;return 3*(1-a)*a*a+a*a*a},backIn:function(t){var e=1.70158;return t*t*((e+1)*t-e)},backOut:function(t){t-=1;var e=1.70158;return t*t*((e+1)*t+e)+1},elastic:function(t){return t==!!t?t:pow(2,-10*t)*math.sin((t-.075)*(2*PI)/.3)+1},bounce:function(t){var e,n=7.5625,r=2.75;return t<1/r?e=n*t*t:t<2/r?(t-=1.5/r,
e=n*t*t+.75):t<2.5/r?(t-=2.25/r,e=n*t*t+.9375):(t-=2.625/r,e=n*t*t+.984375),e}}})}(),function(){function t(t,e){var n={x:e.x,y:e.y};switch(t.props.dir){case"n":n.x=(e.x+e.x2)/2,n.y=e.y2;break;case"e":n.x=e.x,n.y=(e.y+e.y2)/2;break;case"s":n.x=(e.x+e.x2)/2,n.y=e.y;break;case"w":n.x=e.x2,n.y=(e.y+e.y2)/2;break;case"ne":n.x=e.x,n.y=e.y2;break;case"se":n.x=e.x,n.y=e.y;break;case"sw":n.x=e.x2,n.y=e.y;break;case"nw":n.x=e.x2,n.y=e.y2}return n}Graph.plugin.Resizer=Graph.extend(Graph.plugin.Plugin,{props:{vector:null,enabled:!0,suspended:!0,restriction:null,handleImage:null,handleSize:null,rendered:!1},components:{holder:null,helper:null,handle:null},trans:{ox:0,oy:0,ow:0,oh:0,cw:0,ch:0,dx:0,dy:0},constructor:function(t,e){var n=this,r=t.guid();e=e||{},_.assign(n.props,e),t.addClass("graph-resizable"),n.props.handleImage=Graph.config.base+"img/"+Graph.config.resizer.image,n.props.handleSize=Graph.config.resizer.size,n.props.vector=r,n.cached.snapping=null,n.cached.vertices=null,n.initComponent();
},holder:function(){return Graph.registry.vector.get(this.components.holder)},helper:function(){return Graph.registry.vector.get(this.components.helper)},handle:function(t){return Graph.registry.vector.get(this.components.handle[t])},initComponent:function(){var t,e,n=this,r=n.components;t=(new Graph.svg.Group).addClass("graph-resizer").removeClass("graph-elem graph-elem-group"),t.elem.group("graph-resizer"),t.on({render:_.bind(n.onHolderRender,n)}),e=new Graph.svg.Rect(0,0,0,0,0).addClass("graph-resizer-helper").removeClass("graph-elem graph-elem-rect").selectable(!1).clickable(!1).render(t),e.elem.group("graph-resizer"),r.handle={};var i={ne:{ghost:!1,cursor:"nesw-resize"},se:{ghost:!1,cursor:"nwse-resize"},sw:{ghost:!1,cursor:"nesw-resize"},nw:{ghost:!1,cursor:"nwse-resize"},n:{ghost:!1,cursor:"ns-resize",axis:"y"},e:{ghost:!1,cursor:"ew-resize",axis:"x"},s:{ghost:!1,cursor:"ns-resize",axis:"y"},w:{ghost:!1,cursor:"ew-resize",axis:"x"}};_.forOwn(i,function(e,i){!function(i){var o=new Graph.svg.Image(n.props.handleImage,0,0,n.props.handleSize,n.props.handleSize).selectable(!1).removeClass("graph-elem graph-elem-image").addClass("graph-resizer-handle handle-"+i);
o.elem.group("graph-resizer"),o.props.dir=i,o.draggable(e),o.on("beforedrag",_.bind(n.onHandleBeforeDrag,n)),o.on("drag",_.bind(n.onHandleDrag,n)),o.on("afterdrag",_.bind(n.onHandleAfterDrag,n)),o.render(t),r.handle[i]=o.guid(),o=null}(i)}),r.holder=t.guid(),r.helper=e.guid(),t=null,e=null,i=null},invalidate:function(){this.superclass.prototype.invalidate.call(this),this.cached.vertices=null},disable:function(){this.props.enabled=!1},enable:function(){this.props.enabled=!0},render:function(){var t=this;return t.props.rendered?void t.redraw():(t.holder().render(t.vector().parent()),t.props.rendered=!0,void t.redraw())},snap:function(t){this.cached.snapping=t},vertices:function(){var t=this,e=t.vector(),n=t.cached.vertices;if(!n){var r,i,o,s,a,p,h,c,l=e.shape(),u=l.bbox().toJson(),d=e.matrixCurrent().rotate();if(r=d.deg,i=0,o=0,s=u.x,a=u.y,p=t.props.handleSize/2,r){var f=Graph.matrix(),l=e.shapeRelative();i=u.x+u.width/2,o=u.y+u.height/2,f.rotate(-r,i,o),l=l.transform(f),u=l.bbox().toJson();
}h=u.width/2,c=u.height/2,n={ne:{x:u.x+u.width-p,y:u.y-p},se:{x:u.x+u.width-p,y:u.y+u.height-p},sw:{x:u.x-p,y:u.y+u.height-p},nw:{x:u.x-p,y:u.y-p},n:{x:u.x+h-p,y:u.y-p},e:{x:u.x+u.width-p,y:u.y+c-p},s:{x:u.x+h-p,y:u.y+u.height-p},w:{x:u.x-p,y:u.y+c-p},rotate:{deg:r,cx:i,cy:o},box:{x:u.x,y:u.y,width:u.width,height:u.height},offset:{x:s,y:a}},this.cached.vertices=n}return n},redraw:function(){var t,e=this,n=e.helper(),r=e.holder();r&&(t=this.vertices(),t&&(n.reset(),n.attr({x:t.box.x,y:t.box.y,width:t.box.width,height:t.box.height}),n.rotate(t.rotate.deg,t.rotate.cx,t.rotate.cy).commit(),_.forOwn(e.components.handle,function(n,r){!function(n,r){var i=e.handle(r);i.show(),i.reset(),i.attr(t[r]),i.rotate(t.rotate.deg,t.rotate.cx,t.rotate.cy).commit()}(n,r)}),e.trans.ox=t.offset.x,e.trans.oy=t.offset.y,e.trans.ow=this.trans.cw=t.box.width,e.trans.oh=this.trans.ch=t.box.height,e.trans.dx=0,e.trans.dy=0))},suspend:function(){this.props.suspended=!0,this.holder().elem.detach()},resume:function(){
this.props.enabled&&this.props.suspended&&(this.props.suspended=!1,this.props.rendered?(this.vector().parent().elem.append(this.holder().elem),this.redraw()):this.render())},restrict:function(t){_.assign(this.props,{restriction:t})},setupRestriction:function(e){var n,r=this,i=this.props.restriction||{},o=r.vector(),s=o.paper(),a=(s.layout(),e.props.dir),p=+i.width||0,h=+i.height||0,c=Number.MAX_SAFE_INTEGER,l={top:-c,left:-c,right:c,bottom:c};if(void 0===i.origin){var u=o.bboxView().toJson();n=t(e,u)}else n=_.extend({x:0,y:0},i.origin);switch(a){case"n":l.bottom=n.y-h;break;case"e":l.left=n.x+p;break;case"s":l.top=n.y+h;break;case"w":l.right=n.x-p;break;case"ne":l.left=n.x+p,l.bottom=n.y-h;break;case"se":l.top=n.y+h,l.left=n.x+p;break;case"sw":l.right=n.x-p,l.top=n.y+h;break;case"nw":l.right=n.x-p,l.bottom=n.y-h}e.draggable().restrict(l)},onHolderRender:function(t){},onHandleBeforeDrag:function(t){var e=this,n=t.publisher;e.fire("beforeresize",{resizer:this,direction:n.props.dir}),_.forOwn(e.components.handle,function(t,r){
var i=e.handle(r);i!==n&&i.hide()});var r=this.cached.snapping;r&&n.draggable().snap()!==r&&n.draggable().snap(r),this.props.restriction&&this.setupRestriction(n),n.show(),n.removeClass("dragging")},onHandleDrag:function(t){var e=this,n=e.helper(),r=t.publisher,i=this.trans,o=t.dx,s=t.dy;switch(r.props.dir){case"ne":i.cw+=o,i.ch-=s,e.trans.dy+=s,n.translate(0,s).commit();break;case"se":i.cw+=o,i.ch+=s;break;case"sw":i.cw-=o,i.ch+=s,e.trans.dx+=o,n.translate(o,0).commit();break;case"nw":i.cw-=o,i.ch-=s,e.trans.dx+=o,e.trans.dy+=s,n.translate(o,s).commit();break;case"n":i.cw+=0,i.ch-=s,e.trans.dy+=s,n.translate(0,s).commit();break;case"e":i.cw+=o,i.ch+=0;break;case"s":i.cw+=0,i.ch+=s;break;case"w":i.cw-=o,i.ch+=0,e.trans.dx+=o,n.translate(o,0).commit()}n.attr({width:i.cw,height:i.ch})},onHandleAfterDrag:function(t){var e,n,r,i,o,s,a=this,p=this.trans,h=t.publisher;switch(e=p.ow>0?p.cw/p.ow:1,n=p.oh>0?p.ch/p.oh:1,o=p.dx,s=p.dy,h.props.dir){case"ne":r=p.ox,i=p.oy+p.oh;break;case"se":r=p.ox,
i=p.oy;break;case"sw":r=p.ox+p.ow,i=p.oy;break;case"nw":r=p.ox+p.ow,i=p.oy+p.oh;break;case"n":r=p.ox+p.ow/2,i=p.oy+p.oh;break;case"e":r=p.ox,i=p.oy+p.oh/2;break;case"s":r=p.ox+p.ow/2,i=p.oy;break;case"w":r=p.ox+p.ow,i=p.oy+p.oh/2}var c=a.vector(),l=c.bbox().center().toJson(),u=c.resize(e,n,r,i,o,s),d=c.bbox().center().toJson(),f=d.x-l.x,g=d.y-l.y;u.translate.dx=f,u.translate.dy=g,a.redraw(),a.fire("afterresize",u)},toString:function(){return"Graph.plugin.Resizer"},destroy:function(){var t=this;_.forOwn(t.components.handle,function(e,n){var r=t.handle(n);r.remove()}),t.components.handle=null,t.helper().remove(),t.components.helper=null,t.holder().remove(),t.components.holder=null,t.listeners=null}})}(),function(){Graph.plugin.Collector=Graph.extend(Graph.plugin.Plugin,{props:{enabled:!1,suspended:!0,rendered:!1,activator:"tool",ready:!1},paper:null,collection:[],components:{rubber:null},collecting:{enabled:!1},constructor:function(t){var e=this;if(!t.isPaper())throw Graph.error("Collector tool only available for paper !");
e.paper=t,e.components.rubber=Graph.$('<div class="graph-rubberband">'),e.collection=new Graph.collection.Vector,t.on("keynavdown",_.bind(e.onKeynavDown,e)),t.on("keynavup",_.bind(e.onKeynavUp,e)),e.paper.props.rendered?e.setup():e.paper.on("render",function(){e.setup()})},enable:function(t){this.props.enabled=!0,this.props.activator=t,this.paper.cursor("crosshair"),this.paper.state("collecting")},disable:function(){this.props.enabled=!1,this.paper.cursor("default")},setup:function(){var t=this;if(!t.props.ready){t.props.ready=!0;var e=t.collecting,n=t.paper,r=n.layout(),i=r.position(),o=t.components.rubber,s=n.interactable().vendor();s.styleCursor(!1),s.draggable({manualStart:!0,onstart:function(t){_.assign(e,{enabled:!0,start:{x:t.clientX,y:t.clientY},end:{x:t.clientX,y:t.clientY},bounds:{}}),o.query.css({width:0,height:0,transform:"translate("+(e.start.x-i.left)+"px, "+(e.start.y-i.top)+"px)"})},onmove:function(t){var n,r=e.start,s={x:t.clientX,y:t.clientY};n=r.x<=s.x&&r.y<s.y||r.x<s.x&&r.y<=s.y?{
x:r.x,y:r.y,width:s.x-r.x,height:s.y-r.y}:r.x>=s.x&&r.y<s.y||r.x>s.x&&r.y<=s.y?{x:s.x,y:r.y,width:r.x-s.x,height:s.y-r.y}:r.x<=s.x&&r.y>s.y||r.x<s.x&&r.y>=s.y?{x:r.x,y:s.y,width:s.x-r.x,height:r.y-s.y}:r.x>=s.x&&r.y>s.y||r.x>s.x&&r.y>=s.y?{x:s.x,y:s.y,width:r.x-s.x,height:r.y-s.y}:{x:s.x,y:s.y,width:0,height:0},e.bounds=n,o.query.css({width:n.width,height:n.height,transform:"translate("+(n.x-i.left)+"px,"+(n.y-i.top)+"px)"})},onend:function(){if(e.enabled){e.enabled=!1;var i=n.guid(),o=Graph.registry.vector.collect(i),s=e.bounds,a=(r.scale(),r.pointerLocation({clientX:s.x,clientY:s.y})),p=r.pointerLocation({clientX:s.x+s.width,clientY:s.y+s.height}),h=new Graph.lang.BBox({x:a.x,y:a.y,x2:p.x,y2:p.y,width:p.x-a.x,height:p.y-a.y});h.transform(n.viewport().matrix()),_.forEach(o,function(e){e.guid()!=i&&e.isSelectable()&&!e.isGroup()&&h.contains(e)&&t.collect(e,!0)}),"tool"==t.props.activator&&n.tool().activate("panzoom"),h=null,t.suspend()}}}).on("down",function(e){var n=!(e.ctrlKey||e.shiftKey),r=Graph.registry.vector.get(e.target);
r&&(r.isSelectable()||r.elem.belong("graph-resizer")||r.elem.belong("graph-link")||n&&t.clearCollection())}).on("tap",function(e){var n=Graph.registry.vector.get(e.target),r=!(e.ctrlKey||e.shiftKey);if(n&&n.isSelectable()){if("linking"==n.paper().state())return void t.clearCollection();r&&t.clearCollection(),t.collect(n)}},!0).on("move",function(e){var r=e.interaction;if(t.props.enabled&&r.pointerIsDown&&!r.interacting()){var i={name:"drag"};r.prepared.name=i.name,r.setEventXY(r.startCoords,r.pointers),e.currentTarget===n.node()&&(t.props.suspended&&t.resume(),r.start(i,e.interactable,o.node()))}})}},render:function(){var t=this;t.props.rendered||(t.paper.container().append(t.components.rubber),t.props.rendered=!0)},size:function(){return this.collection.size()},index:function(t){return this.collection.index(t)},add:function(t){var e=this.index(t);t._collector=this,e===-1&&this.collection.push(t)},remove:function(t){delete t._collector,this.collection.pull(t)},collect:function(t){t.select(),
Graph.cached.paper=this.paper.guid()},decollect:function(t){t.deselect()},clearCollection:function(){var t=this,e=t.collection.toArray().slice();_.forEach(e,function(e){t.decollect(e)}),e=null},suspend:function(){this.props.suspended=!0,this.components.rubber.detach()},resume:function(){this.props.suspended&&(this.props.suspended=!1,this.props.rendered?this.paper.container().append(this.components.rubber):this.render())},syncBeforeDrag:function(t,e){var n=this;n.collection.each(function(n){n.plugins.dragger&&n.plugins.dragger.props.enabled&&n!==t&&!function(){var t=n.graph.matrix.data(),r=t.sin,i=t.cos;n.plugins.resizer&&!n.plugins.resizer.suspended&&n.plugins.resizer.suspend(),n.plugins.dragger.props.ghost&&n.plugins.dragger.resume(),n.syncdrag={sin:r,cos:i,tdx:0,tdy:0},n.addClass("dragging"),n.fire("beforedrag",{dx:e.dx*i+e.dy*r,dy:e.dx*-r+e.dy*i,master:!1})}()}),n.fire("beforedrag")},syncDrag:function(t,e){var n=this;n.collection.each(function(n){n.plugins.dragger&&n.plugins.dragger.props.enabled&&n!==t&&!function(t,e){
var n=e.ox*t.syncdrag.cos+e.oy*t.syncdrag.sin,r=e.ox*-t.syncdrag.sin+e.oy*t.syncdrag.cos;t.plugins.dragger.props.ghost?t.plugins.dragger.helper().translate(e.ox,e.oy).commit():t.translate(n,r).commit(),t.syncdrag.tdx+=n,t.syncdrag.tdy+=r,t.fire("drag",{dx:n,dy:r,master:!1})}(n,e)})},syncAfterDrag:function(t,e){var n=this;n.collection.each(function(n){n.plugins.dragger&&n.plugins.dragger.props.enabled&&n!==t&&!function(t,e){var n=t.plugins.dragger.props.batchSync,r=t.plugins.dragger.props.ghost;r&&(n&&t.translate(t.syncdrag.tdx,t.syncdrag.tdy).commit(),t.plugins.dragger.suspend()),n||t.dirty(!0),t.fire("afterdrag",{dx:t.syncdrag.tdx,dy:t.syncdrag.tdy,batch:!0,master:!1}),t.removeClass("dragging"),delete t.syncdrag}(n,e)}),e.type="afterdrag",n.fire(e)},toString:function(){return"Graph.plugin.Collector"},onKeynavDown:function(t){if(t.keyCode==Graph.event.SHIFT&&"key"!=this.props.activator){var e=this.paper.tool(),n=e.current();"collector"!=n&&e.activate("collector","key")}},onKeynavUp:function(t){
if(t.keyCode==Graph.event.SHIFT){var e=this.paper.tool(),n=e.current();"collector"==n&&(this.props.activator="tool",e.activate("panzoom"))}}})}(),function(){Graph.plugin.Dragger=Graph.extend(Graph.plugin.Plugin,{props:{ready:!1,manual:!1,ghost:!0,vector:null,enabled:!0,rendered:!1,suspended:!0,inertia:!1,bound:!1,grid:null,axis:!1,cursor:"move",cls:"",batchSync:!0,restriction:!1},rotation:{deg:0,rad:0,sin:0,cos:1},scaling:{x:1,y:1},dragging:{enabled:!1,vector:null,paper:null,helper:null,dx:0,dy:0,coord:null},components:{holder:null,helper:null},constructor:function(t,e){var n=this;t.addClass("graph-draggable"),n.props.vector=t.guid(),e=_.extend({inertia:!1},e||{}),_.forEach(["axis","grid","bbox","ghost"],function(t){void 0!==e[t]&&(n.props[t]=e[t])}),_.assign(n.props,e),n.cached.snapping=null,n.cached.origin=null,n.initComponent(),t.on("render.dragger",_.bind(n.onVectorRender,n)),t.props.rendered&&n.setup()},holder:function(){return Graph.registry.vector.get(this.components.holder)},helper:function(){
return Graph.registry.vector.get(this.components.helper)},initComponent:function(){var t,e,n=this,r=n.components;n.props.ghost?(t=(new Graph.svg.Group).addClass("graph-dragger").removeClass("graph-elem graph-elem-group").traversable(!1).selectable(!1),e=new Graph.svg.Rect(0,0,0,0,0).addClass("graph-dragger-helper"+((this.props.cls?" ":"")+this.props.cls)).removeClass("graph-elem graph-elem-rect").traversable(!1).selectable(!1).clickable(!1).render(t),e.elem.data(Graph.string.ID_VECTOR,this.vector().guid()),r.holder=t.guid(),r.helper=e.guid(),t=null,e=null):this.props.cls&&this.vector().addClass(this.props.cls)},setup:function(){var t,e,n,r,i;if(!this.props.ready){t=this,e=t.vector(),r=e.paper(),i={},_.extend(i,{manualStart:!0,onstart:_.bind(t.onDragStart,t),onmove:_.bind(t.onDragMove,t),onend:_.bind(t.onDragEnd,t)}),n=e.interactable().vendor(),n.draggable(i),n.styleCursor(!1),t.cached.origin=n.origin(),t.cached.snapping=[],n.on("down",_.bind(t.onPointerDown,t));var o=e.matrixCurrent(),s=o.rotate(),a=o.scale();
t.rotate(s.deg),t.scale(a.x,a.y),t.props.grid&&t.snap({mode:"grid",x:t.props.grid[0],y:t.props.grid[1]}),t.props.ready=!0}},enable:function(){this.props.enabled=!0},disable:function(){this.props.enabled=!1},ghost:function(t){return void 0===t?this.props.ghost:(this.props.ghost=t,this)},render:function(){this.props.ghost&&(this.props.rendered||(this.props.rendered=!0,this.holder().render(this.vector().parent()),this.redraw()))},suspend:function(){this.props.ghost&&(this.props.suspended=!0,this.holder().elem.detach())},resume:function(){this.props.ghost&&(this.props.suspended=!1,this.props.rendered?(this.vector().parent().elem.append(this.holder().elem),this.redraw()):this.render())},redraw:function(){if(this.props.ghost){var t=this.vector(),e=this.helper(),n=t.bbox().toJson(),r=e.bbox().toJson(),i=n.x-r.x,o=n.y-r.y;e.translate(i,o).commit(),e.attr({width:n.width,height:n.height})}},rotate:function(t){var e=Graph.util.rad(t);this.rotation.deg=t,this.rotation.rad=e,this.rotation.sin=Math.sin(e),
this.rotation.cos=Math.cos(e)},scale:function(t,e){e=_.defaultTo(e,t),this.scaling.x=t,this.scaling.y=e},origin:function(t){if(void 0===t)return this.cached.origin;this.cached.origin=t;var e=this.vector().interactable().vendor();e&&e.origin(t)},snap:function(t,e){function n(t){return _.isFunction(t)?t:(t.mode=_.defaultTo(t.mode,"anchor"),"grid"==t.mode?("x"==r.props.axis?t.y=0:"y"==r.props.axis&&(t.x=0),t=interact.createSnapGrid({x:t.x,y:t.y})):t.range=_.defaultTo(t.range,20),t)}if(void 0===t)return this.cached.snapping;void 0===e&&(e=!1);var r=this,i=[];this.cached.snapping=t,_.isArray(t)?_.forEach(t,function(t){i.push(n(t))}):i.push(n(t));var o=this.vector().interactable().vendor();o&&o.setOptions("snap",{targets:i,endOnly:e})},resetSnap:function(){this.snaps=[],this.snap({mode:"grid",x:this.props.grid[0],y:this.props.grid[1]})},restrict:function(t){this.props.restriction=t},start:function(){var t=this,e=t.vector(),n=e.interactable().vendor();t.props.manual||t.dragging.enabled||(t.dragging.enabled=!0,
t.dragging.moveHandler=_.bind(t.onPointerMove,t,_,e),n.on("move",t.dragging.moveHandler))},onVectorRender:function(){this.setup()},onPointerDown:function(t){t.preventDefault(),this.start()},onPointerMove:function(t,e){var n=t.interaction;if(this.props.enabled&&n.pointerIsDown&&!n.interacting()){var r=e.paper(),i=e.node(),o={name:"drag"};if(n.prepared.name=o.name,n.setEventXY(n.startCoords,n.pointers),t.currentTarget===i){if(r){var s=r.state();if("collecting"==s){if(!e.elem.belong("graph-resizer"))return;r.tool().activate("panzoom")}else if("linking"==s)return}this.props.ghost?(this.props.suspended&&this.resume(),n.start(o,t.interactable,this.helper().node())):n.start(o,t.interactable,i)}}t.preventDefault()},onDragStart:function(t){var e=this.vector(),n=e.paper(),r=n.layout(),i=this.helper();e.addClass("dragging"),n.cursor(this.props.cursor),this.dragging.vector=e,this.dragging.paper=n,this.dragging.helper=i,this.dragging.dx=0,this.dragging.dy=0,this.dragging.hx=0,this.dragging.hy=0;var o={
x:t.clientX,y:t.clientY,dx:0,dy:0,ghost:this.props.ghost};this.fire("beforedrag",o);var s=r.pointerLocation(t);this.dragging.coord=s},onDragMove:function(t){var e=this.dragging,n=(e.paper,e.vector),r=e.helper,i=this.props.ghost,o=this.props.axis,s=(this.rotation.deg,this.rotation.sin),a=this.rotation.cos,p=this.scaling.x,h=this.scaling.y,c=n.matrixCurrent().scale();c.x===p&&c.y===h||(this.scale(c.x,c.y),p=c.x,h=c.y);var l,u,d,f,g,y,v=_.defaultTo(t.dx,0),m=_.defaultTo(t.dy,0);l=u=d=f=g=y=0,v/=p,m/=h,"x"==o?(l=d=v,u=f=0,g=v*a+0*s,y=v*-s+0*a):"y"==o?(l=d=0,u=f=m,g=0*a+m*s,y=0*-s+m*a):(d=v,f=m,l=g=v*a+m*s,u=y=v*-s+m*a);var x=this.props.restriction;if(x){var b=this.dragging.coord;r?(b.x+=d,b.y+=f):(b.x+=l,b.y+=u),(b.x<x.left||b.x>x.right)&&(d=l=g=v=0),(b.y<x.top||b.y>x.bottom)&&(f=u=y=m=0)}this.dragging.dx+=g,this.dragging.dy+=y,this.dragging.hx+=d,this.dragging.hy+=f;var G=_.defaultTo(t.pageX,t.x0),G=_.defaultTo(t.pageY,t.y0);G/=p,G/=h;var w={pageX:G,pageY:G,ex:v,ey:m,dx:l,dy:u,hx:d,hy:f,ox:d,
oy:f,ghost:this.props.ghost};this.fire("drag",w),i?r.translate(w.hx,w.hy).commit():n.translate(w.dx,w.dy).commit()},onDragEnd:function(t){var e=this.dragging,n=e.paper,r=e.vector,i=(e.helper,this.props.ghost),o=e.dx,s=e.dy;e.hx,e.hy;i&&(r.translate(o,s).commit(),this.redraw(),this.suspend()),r.removeClass("dragging"),n.cursor("default");var a={dx:o,dy:s,ghost:this.props.ghost},p=r.interactable().vendor();p.off("move",this.dragging.moveHandler),this.dragging.moveHandler=null,this.dragging.enabled=!1,this.fire("afterdrag",a),this.dragging.vector=null,this.dragging.paper=null,this.dragging.helper=null,this.dragging.dx=0,this.dragging.dy=0,this.dragging.hx=0,this.dragging.hy=0,this.dragging.coord=null},destroy:function(){var t=this;t.components.helper&&t.helper().remove(),t.components.helper=null,t.components.holder&&t.holder().remove(),t.components.holder=null,t.listeners={}},toString:function(){return"Graph.plugin.Dragger"}})}(),function(){Graph.plugin.Dropper=Graph.extend(Graph.plugin.Plugin,{
props:{overlap:"center",accept:".graph-draggable"},constructor:function(t,e){var n=this;_.assign(n.props,e||{}),t.addClass("graph-dropzone").removeClass("graph-draggable"),n.props.vector=t.guid(),t.on({render:_.bind(n.onVectorRender,n)}),t.props.rendered&&n.setup()},setup:function(){var t=this;if(!t.plugin){var e=_.extend({},t.props,{checker:_.bind(t.onDropValidate,t),ondropactivate:_.bind(t.onDropActivate,t),ondropdeactivate:_.bind(t.onDropDeactivate,t),ondragenter:_.bind(t.onDragEnter,t),ondragleave:_.bind(t.onDragLeave,t),ondrop:_.bind(t.onDrop,t)});t.plugin=t.vector.interactable().dropzone(e)}},onDropValidate:function(t,e,n,r,i,o,s){return n},onVectorRender:function(){this.setup()},onDropActivate:function(t){this.vector().addClass("drop-activate")},onDropDeactivate:function(t){this.vector().removeClass("drop-activate")},onDragEnter:function(t){this.vector().removeClass("drop-activate").addClass("drop-enter"),t.type="dropenter",this.fire(t)},onDragLeave:function(t){this.vector().removeClass("drop-enter").addClass("drop-activate"),
t.type="dropleave",this.fire(t)},onDrop:function(t){this.vector().removeClass("drop-activate drop-enter")}})}(),function(){var t="connect-valid",e="connect-invalid",n="connect-valid connect-invalid",r="connect-valid connect-invalid connect-hover",i="connect-hover",o="outgoing",s="incoming";Graph.plugin.Network=Graph.extend(Graph.plugin.Plugin,{props:{vector:null,wiring:"h:h",tuning:!0,limitIncoming:0,limitOutgoing:0},linking:{valid:!1,router:null,source:null,target:null,link:null,pole:null},constructor:function(o,s){var a=this,p=o.guid();s=s||{},_.assign(a.props,s),a.props.vector=p,a.cached.cables={},a.cached.pairs={},o.addClass("graph-connectable");var h=o.interactable().vendor();h.dropzone({accept:_.format(".{0}, .{1}",Graph.styles.LINK_HEAD,Graph.styles.LINK_TAIL),overlap:.2}).on("dropdeactivate",function(t){var e=Graph.registry.vector.get(t.target);e&&e.removeClass(r),a.invalidateTrans()}).on("dropactivate",function(t){var e=Graph.registry.vector.get(t.target);e&&e.addClass(i),a.invalidateTrans();
}).on("dragenter",function(n){var r=Graph.registry.link.get(n.relatedTarget);if(r){var i,s,p,h=Graph.$(n.relatedTarget).data("pole");"head"==h?(s=r.router.source(),p=o):(s=o,p=r.router.target()),i=s.connectable().canConnect(p.connectable(),r),i?(o.removeClass(e),o.addClass(t)):(o.removeClass(t),o.addClass(e)),_.assign(a.linking,{valid:i,router:r.router,source:s,target:p,pole:h}),r.router.updateTrans("CONNECT",{valid:i,source:s,target:p})}}).on("dragleave",function(t){var e=Graph.registry.vector.get(t.target);e&&e.removeClass(n),a.linking.valid=!1,"head"==a.linking.pole?a.linking.router.updateTrans("CONNECT",{valid:!1,target:null}):a.linking.router.updateTrans("CONNECT",{valid:!1,source:null})}).on("drop",function(t){var e=Graph.registry.link.get(t.relatedTarget);if(a.linking.valid)if("head"==a.linking.pole){var n=a.linking.router.target();n&&n.guid()!=o.guid()&&n.connectable().removeLink(e),a.linking.router.updateTrans("CONNECT",{target:o})}else{var r=a.linking.router.source();r&&r.guid()!=o.guid()&&r.connectable().removeLink(e),
a.linking.router.updateTrans("CONNECT",{source:o})}})},invalidateTrans:function(){for(var t in this.linking)this.linking[t]=null},wiring:function(){return this.props.wiring},treshold:function(){var t=this.props.wiring;switch(t){case"h:h":case"v:v":return 20;case"h:v":case"v:h":return-10}return 0},direction:function(t){if(!this.props.tuning)return this.props.wiring;var e=this.orientation(t);switch(e){case"intersect":return null;case"top":case"bottom":return"v:v";case"left":case"right":return"h:h";default:return this.props.wiring}},orientation:function(t){var e=this.vector().bboxView().toJson(),n=t.vector().bboxView().toJson(),r=Graph.util.boxOrientation(e,n,this.treshold());return e=n=null,r},isSource:function(t){return t.source().guid()==this.vector().guid()},isTarget:function(t){return t.target().guid()==this.vector().guid()},connect:function(t,e,n,r){if(this.canConnect(t)){e&&!n?(r=e,e=null,n=null):(e instanceof Graph.lang.Point&&(e=e.toJson()),n instanceof Graph.lang.Point&&(n=n.toJson())),
r=r||{};var i=this,a=i.vector(),p=t.vector(),h=a.paper(),c=h.layout(),l=c.createRouter(a,p),u=c.createLink(l,r);return void 0!==r.command?u.connectByCommand(r.command):u.connect(e,n),u.render(h),u.cached.beforeDestroyHandler=_.bind(this.onLinkBeforeDestroy,this),u.on("beforedestroy",u.cached.beforeDestroyHandler),i.addLink(u,o,p),t.addLink(u,s,a),a.fire("connect",{link:u}),u}return!1},connectByLinker:function(t,e,n,r){var i=this.vector().paper().layout().routerType();"orthogonal"==i?this.connect(t,null,null,r):this.connect(t,e,n,r)},disconnect:function(t,e){var n=this.connections(t),r=n.length,i=0,o=[];return void 0!==e&&(o=_.isArray(e)?_.map(e,function(t){return t&&t.guid()}):e?[e.guid()]:[]),_.forEach(n,function(t){o.length?_.indexOf(o,t.guid)>-1&&(t.link.disconnect(),i++,r--):(t.link.disconnect(),r--)}),o.length?i===o.length:0===r},addLink:function(t,e,n){var r=t.guid(),i=this.cached.cables,o=this.cached.pairs;n=n.guid(),o=o||{},o[n]=o[n]||[],_.indexOf(o[n],r)===-1&&o[n].push(r),i[r]={
type:e,pair:n}},removeLink:function(t){var e;e=_.isString(t)?t:t.guid();var n=this.cached.cables[e];if(n&&this.cached.pairs[n.pair]){var r=_.indexOf(this.cached.pairs[n.pair],e);r>-1&&this.cached.pairs[n.pair].splice(r,1),this.cached.pairs[n.pair].length||delete this.cached.pairs[n.pair]}delete this.cached.cables[e],n=null},repairLinks:function(){console.log("called")},hasConnection:function(t){var e=this.connections(t);return!!e.length&&e},connections:function(t){var e=this,n=Graph.registry.link,r=this.props.vector,i=[];if(void 0!==t){var o=t.vector().guid();return this.cached.pairs[o]&&_.forEach(e.cached.pairs[o],function(t){var s=n.get(t),a=e.cached.cables[t];s&&a&&i.push({guid:t,link:s,type:a.type,source:"outgoing"==a.type?r:o,target:"outgoing"==a.type?o:r})}),i}var s=e.cached.cables;return _.forOwn(s,function(t,e){var o=n.get(e);o&&i.push({guid:e,link:o,type:t.type,source:"outgoing"==t.type?r:t.pair,target:"outgoing"==t.type?t.pair:r})}),i},canConnect:function(t){if(t instanceof Graph.plugin.Network){
var e,n,r,i=this.vector().guid(),o=t.vector().guid();if(this.props.limitOutgoing>0&&(e=this.connections(),n=_.filter(e,function(t){return"outgoing"==t.type}),n.length+1>this.props.limitOutgoing))return!1;if(t.props.limitIncoming>0&&(e=t.connections(),r=_.filter(e,function(t){return"incoming"==t.type}),r.length+1>t.props.limitIncoming))return!1;if(i!=o)return!0}return!1},destroy:function(){this.cached.cables=null,this.cached.pairs=null},toString:function(){return"Graph.plugin.Network"},onLinkBeforeDestroy:function(t){var e,n=t.link;(e=n.router.source())&&e.connectable().removeLink(n),(e=n.router.target())&&e.connectable().removeLink(n),n.off("beforedestroy",n.cached.beforeDestroyHandler),n.cached.beforeDestroyHandler=null}})}(),function(){Graph.plugin.History=Graph.extend(Graph.plugin.Plugin,{props:{limit:1,index:0},items:{},constructor:function(t){this.props.vector=t.guid()},save:function(t,e){var n,r=this.props.limit;n>r&&_.drop(this.items,n-r),this.items[t]=this.items[t]||[],(n=this.items[t].length)>r-1&&this.items[t].splice(0,n-r),
this.items[t].push(e)},last:function(t){},go:function(){},back:function(){},next:function(){},clear:function(){}})}(),function(){function t(t,e){return Math.max(t.min,Math.min(t.max,e))}Graph.plugin.Panzoom=Graph.extend(Graph.plugin.Plugin,{props:{panEnabled:!1,zoomEnabled:!0,showToolbox:!0,vector:null},caching:{offset:{x:0,y:0}},scrolling:{steps:10},zooming:{scale:1,zoom:1,origin:null,range:{min:.2,max:4}},components:{toolbox:null},panning:{start:{x:0,y:0},moveHandler:null,stopHandler:null},constructor:function(t){var e,n,r,i=this;if(!t.isPaper())throw Graph.error("Panzoom only available for paper !");n=t.viewport(),r=Math.round(n.matrix().scale().x,1e3),e=t.interactable().vendor(),_.assign(i.props,{vector:t.guid()}),_.assign(i.zooming,{scale:r,zoom:r}),i.initComponent(t),e.on("wheel",_.bind(i.onMouseWheel,i,_,t,n)),e.on("down",_.bind(i.onPointerDown,i,_,t,n)),t.props.rendered?(i.revalidate(t),i.props.showToolbox&&i.components.toolbox.appendTo(t.container())):t.on("render",function(){i.revalidate(t),
i.props.showToolbox&&i.components.toolbox.appendTo(t.container())}),e=null,t=null},initComponent:function(t){var e,n,r=this;r.props.showToolbox&&(e=t.container(),n=r.components.toolbox=Graph.$('<div class="graph-zoom-toolbox">'),n.html('<div><a data-tool="zoom-reset" href="javascript:void(0)" title="'+Graph._("Reset zoom")+'"><i class="'+Graph.icons.ZOOM_RESET+'"></i></a><div class="splitter"></div><a data-tool="zoom-in" href="javascript:void(0)" title="'+Graph._("Zoom in")+'"><i class="'+Graph.icons.ZOOM_IN+'"></i></a><div class="splitter"></div><a data-tool="zoom-out" href="javascript:void(0)" title="'+Graph._("Zoom out")+'"><i class="'+Graph.icons.ZOOM_OUT+'"></i></a></div>'),n.on("click","[data-tool]",function(t){t.preventDefault();var e=Graph.$(this).data("tool");switch(e){case"zoom-reset":r.zoomReset();break;case"zoom-in":r.zoomIn();break;case"zoom-out":r.zoomOut()}}))},revalidate:function(t){var e=t.node().getBoundingClientRect();this.caching.offset={x:e.left,y:e.top}},enable:function(){
var t=this.vector();this.props.panEnabled=!0,this.props.zoomEnabled=!0,t.cursor("default"),t.state("panning")},disable:function(){this.props.panEnabled=!1},zoomReset:function(){var t,e=this.vector().viewport();this.zooming.zoom=1,this.zooming.scale=1,e.reset(),t=Graph.matrix(),e.attr("transform",t.toValue()),e.graph.matrix=t},zoomIn:function(){var t=this.vector().paper(),e=t.viewport(),n=t.layout().center(),r=.1875;this.zoom(t,e,r,n)},zoomOut:function(){var t=this.vector().paper(),e=t.viewport(),n=t.layout().center(),r=-.1875;this.zoom(t,e,r,n)},zoom:function(e,n,r,i){var o=this.zooming.range,s=this.zooming.zoom,a=r>0?"in":"out",p=Math.pow(1+Math.abs(r),"in"==a?1:-1),h=t(o,s*p),c=n.matrix(),l=c.props.a,u=1/l*h,d=c.clone();this.onBeforeZoom(e),d.scale(u,u,i.x,i.y),n.attr("transform",d.toValue()),n.graph.matrix=d,this.zooming.zoom=h,this.zooming.scale=d.props.a,"panning"==e.state()&&e.cursor("in"==a?"zoom-in":"zoom-out"),this.onZoom(e)},scroll:function(t,e,n,r){var i=e.matrix().clone(),o=this.zooming.scale;
this.onBeforeScroll(t),n/=o,r/=o,i.translate(n,r),e.attr("transform",i.toValue()),e.graph.matrix=i,this.zooming.origin&&(this.zooming.origin.x+=n,this.zooming.origin.y+=r),this.onScroll()},onMouseWheel:function(t,e,n){t=Graph.event.fix(t),t.preventDefault();var r,i,o,s,a=Graph.event.hasPrimaryModifier(t),p=Graph.event.hasSecondaryModifier(t),h=Graph.event.original(t);a||p?(r=Graph.isMac()?0===h.deltaMode?1.25:50:0===h.deltaMode?1:20,i={},p?(i.dx=r*(h.deltaX||h.deltaY),i.dy=0):(i.dx=0,i.dy=r*h.deltaY),this.scroll(e,n,i.dx,i.dy)):(r=0===h.deltaMode?.025:.5,s=this.caching.offset,o={x:h.clientX-s.x,y:h.clientY-s.y},this.zooming.origin=o,this.zoom(e,n,h.deltaY*r/-8,o))},onPointerDown:function(t,e,n,r){var i,o=Graph.$(t.target),s=Graph.registry.vector.get(o),r=e.interactable().vendor(),a=e.tool().current();if(this.panning.moveHandler&&(r.off("move",this.panning.moveHandler),this.panning.moveHandler=null),this.panning.stopHandler&&(r.off("up",this.panning.stopHandler),this.panning.stopHandler=null),
!(" collector pencil ".indexOf(a)>-1)&&s){if(s.isDraggable())return;if(t.button||t.ctrlKey||t.shiftKey||t.altKey)return;this.revalidate(e),i=this.caching.offset,this.panning.start={x:t.clientX-i.x,y:t.clientY-i.y},this.panning.moveHandler=_.bind(this.onPointerMove,this,_,e,n),this.panning.stopHandler=_.bind(this.onPointerStop,this,_,e,n),r.on("move",this.panning.moveHandler),r.on("up",this.panning.stopHandler)}},onPointerMove:function(t,e,n){var r=this.caching.offset,i=this.panning.start,o={x:t.clientX-r.x,y:t.clientY-r.y},s=o.x-i.x,a=o.y-i.y;Graph.util.hypo(s,a);this.scroll(e,n,s,a),this.panning.start={x:t.clientX-r.x,y:t.clientY-r.y},e.cursor("move"),t.preventDefault()},onPointerStop:function(t,e){var n,r=this,i=e.interactable().vendor();n=_.delay(function(){clearTimeout(n),n=null,i.off("move",r.panning.moveHandler),i.off("up",r.panning.stopHandler),r.panning.moveHandler=null,r.panning.stopHandler=null},0),e.cursor("default")},onBeforeZoom:_.debounce(function(t){Graph.topic.publish("paper:beforezoom",null,t);
},300,{leading:!0,trailing:!1}),onZoom:_.debounce(function(t){var e=t.state();"panning"==e&&t.cursor("default")},300),onBeforeScroll:_.debounce(function(t){Graph.topic.publish("paper:beforescroll",null,t)},300,{leading:!0,trailing:!1}),onScroll:_.debounce(function(){},300),toString:function(){return"Graph.plugin.Panzoom"}})}(),function(){var t="connect-valid",e="connect-invalid",n="connect-valid connect-invalid";Graph.plugin.Linker=Graph.extend(Graph.plugin.Plugin,{props:{vector:null,enabled:!1,suspended:!0,rendered:!1},components:{block:null,pointer:null,path:null},linking:{treshold:10,enabled:!1,moveHandler:null,stopHandler:null,source:null,start:null,target:null,end:null,visits:[]},constructor:function(t){var e,n=this;if(!t.isPaper())throw Graph.error("Linker plugin is only available for paper !");e=t.interactable().vendor(),e.on("down",_.bind(n.onPointerDown,n,_,t)),t.on("keynavdown",function(e){e.keyCode===Graph.event.ESC&&(n.invalidate(),t.tool().activate("panzoom"))}),n.props.vector=t.guid(),
n.initComponent()},initComponent:function(){var t,e,n,r=this,i=r.components;t=(new Graph.svg.Group).addClass("graph-linker-path").selectable(!1),e=(new Graph.svg.Circle).addClass("graph-linker-pointer").removeClass(Graph.styles.VECTOR).selectable(!1).render(t),n=(new Graph.svg.Path).addClass("graph-linker-path").removeClass(Graph.styles.VECTOR).selectable(!1).render(t).attr("marker-end","url(#marker-link-end)"),i.block=t.guid(),i.pointer=e.guid(),i.path=n.guid()},component:function(t){return void 0===t?Graph.registry.vector.get(this.components.block):Graph.registry.vector.get(this.components[t])},render:function(){var t;this.props.rendered||(t=this.vector(),this.component().render(t),this.props.rendered=!0)},invalidate:function(){var t,e;this.linking.enabled&&(t=this.vector(),e=t.interactable().vendor(),this.linking.moveHandler&&(e.off("move",this.linking.moveHandler),this.linking.moveHandler=null),this.linking.source&&this.linking.source.removeClass("disallowed"),this.linking.target&&this.linking.target.removeClass("allowed"),
_.assign(this.linking,{enabled:!1,moveHandler:null,stopHandler:null,source:null,start:null,target:null,end:null}),this.linking.visits&&_.forEach(this.linking.visits,function(t){t.removeClass("connect-valid connect-invalid")}),this.linking.visits=null)},enable:function(){var t=this.vector();this.props.enabled=!0,t.state("linking"),t.addClass("linking")},disable:function(){var t=this.vector();this.props.enabled=!1,this.invalidate(),this.suspend(),t.removeClass("linking")},suspend:function(){this.props.suspended=!0,this.component().elem.detach()},resume:function(){var t;this.props.suspended&&(t=this.vector(),this.props.suspended=!1,this.props.rendered?this.component().elem.appendTo(t.viewport().elem):this.render())},start:function(t,e){var n=this.vector(),r=n.layout();r.position();if("linker"==n.tool().current()){if(this.linking.enabled)return void(this.linking.source&&this.linking.target?this.build():(this.invalidate(),this.suspend()));this.linking.visits=[];var i,o,s;if(t.isConnectable()){
this.props.suspended&&this.resume();var a=this.component("path");this.linking.moveHandler=_.bind(this.onPointerMove,this,_,n,a),i=n.interactable().vendor(),i.on("move",this.linking.moveHandler),this.linking.visits.push(t),t.isConnectable()&&(this.linking.source||(o=t.bboxView(),s=o.center(!0),this.linking.source=t,this.linking.start=s,e?a.moveTo(s.x,s.y).lineTo(e.x,e.y,!1):a.moveTo(s.x,s.y).lineTo(s.x,s.y,!1),o=s=null)),this.linking.enabled=!0}}},cropping:function(t,e){var n,r,i,o,s=this.linking.source,a=this.linking.target,p=new Graph.lang.Path([["M",t.x,t.y],["L",e.x,e.y]]);return s&&(n=s.shapeView(),r=n.intersection(p,!0)),a&&(i=a.shapeView(),o=i.intersection(p,!0)),p=n=i=null,{start:r?r[0]:null,end:o?o[0]:null}},build:function(){var t=this.component("path"),e=t.tail(),n=t.head();if(e&&n){var r=this.linking.source.connectable(),i=this.linking.target.connectable();r.connectByLinker(i,e,n)}this.invalidate(),this.suspend()},onPointerDown:function(t,e){var n=e.layout(),r=n.grabVector(t);r&&this.start(r),
n=r=null},onPointerMove:function(r,i,o){if(this.linking.enabled){var s=i.layout(),a=s.grabVector(r);if(!a)return;var p=this.linking.source,h=!1;if(p){this.linking.visits.indexOf(a.guid())===-1&&this.linking.visits.push(a);var c=this.linking.start,l=s.pointerLocation(r),u=l.x,d=l.y,f=Graph.util.rad(Graph.util.theta(c,{x:u,y:d})),g=Math.sin(f),y=Math.cos(f),v=this.linking.treshold*-y,m=this.linking.treshold*g;if(u+=v,d+=m,a.isConnectable()){var x,b,G;p.connectable().canConnect(a.connectable())?(h=!0,a.removeClass(e),a.addClass(t),b=a.bboxView(),G=b.center(!0),this.linking.target=a,this.linking.end=G,x=this.cropping(c,G),x.start&&o.moveTo(x.start.x,x.start.y),x.end?o.lineTo(x.end.x,x.end.y,!1):o.lineTo(u,d,!1),b=G=null):(a.removeClass(t),a.addClass(e))}else a.addClass(e);h||(this.linking.target&&this.linking.target.removeClass(n),this.linking.target=null,this.linking.end=null,x=this.cropping(c,{x:u,y:d}),x.start&&o.moveTo(x.start.x,x.start.y),x.end?o.lineTo(x.end.x,x.end.y,!1):o.lineTo(u,d,!1));
}}r.preventDefault()},toString:function(){return"Graph.plugin.Linker"}})}(),function(){Graph.plugin.ToolManager=Graph.extend(Graph.plugin.Plugin,{props:{vector:null,current:null},tools:{},constructor:function(t){var e=this;e.props.vector=t.guid()},has:function(t){return!!this.tools[t]},get:function(t){var e=this.tools[t],n=this.vector();if(e)switch(e.type){case"plugin":return n.plugins[t];case"util":return n.utils[t]}return null},current:function(){return this.props.current},register:function(t,e){e=_.defaultTo(e,"plugin"),this.tools[t]={name:t,type:e,enabled:!1}},unregister:function(t){this.tools[t]&&delete this.tools[t]},activate:function(t,e){if(this.props.current!=t){var n,r=this.get(t);r&&(this.deactivateAll(t),this.props.current=t,n=this.tools[t],n.enabled=!0,e=_.defaultTo(e,"tool"),r.enable(e),this.fire("activate",{name:n.name,enabled:n.enabled}))}},deactivate:function(t){var e,n=this.get(t);n&&(e=this.tools[t],e.enabled=!1,this.props.current=null,n.disable(),this.fire("deactivate",{
name:e.name,enabled:e.enabled}))},deactivateAll:function(t){this.vector();for(var e in this.tools)e!=t&&this.deactivate(e)},toggle:function(t){var e=this.tools[t];e&&(e.enabled?this.deactivate(t):this.activate(t))},toString:function(){return"Graph.plugin.ToolManager"}})}(),function(){Graph.plugin.Pencil=Graph.extend(Graph.plugin.Plugin,{writing:{startHandler:null},constructor:function(t){this.props.vector=t.guid()},enable:function(t){this.props.enabled=!0,this.props.activator=t;var e=this.vector(),n=e.interactable().vendor();e.cursor("text"),e.state("writing"),this.writing.startHandler=_.bind(this.onPointerDown,this),n.on("down",this.writing.startHandler)},disable:function(){this.props.enabled=!1;var t=this.vector().interactable().vendor();t.off("down",this.writing.startHandler),this.writing.startHandler=null},toString:function(){return"Graph.plugin.Pencil"},onPointerDown:function(t){var e=this.vector();if(e.isPaper()){var n,r,i;if(n=e.layout().pointerLocation(t),r={left:n.x,top:n.y},e.diagram().current()||e.diagram().create(),
i=e.diagram().current().drawShape("Graph.shape.common.Label",r),i.shape)var o=_.delay(function(t){clearTimeout(o),o=null,e.tool().activate("panzoom"),i.shape.editable().plugin().startEdit()},10)}}})}(),function(){var t=150,e=50;Graph.plugin.Editor=Graph.extend(Graph.plugin.Plugin,{props:{vector:null,rendered:!1,suspended:!0,width:"auto",height:"auto",offset:"auto",align:"center"},editing:{commitHandler:null},components:{editor:null},constructor:function(t,e){var n;_.assign(this.props,e||{}),this.props.vector=t.guid(),_.assign(this.cached,{left:0,top:0,width:0,height:0}),n=t.interactable().vendor(),n.on("doubletap",_.bind(this.onDoubleTap,this)),this.initComponent()},initComponent:function(){var t=this,e=this.components;e.editor=Graph.$('<div class="graph-editor" contenteditable="true"></div>'),e.editor.css("text-align",this.props.align),e.editor.on("keydown",function(e){switch(e.keyCode){case Graph.event.ENTER:t.commit();break;case Graph.event.DELETE:case Graph.event.SHIFT:e.stopPropagation();
}})},commit:function(){var t=this.components.editor.text();this.suspend(),this.vector().props.text=t,this.fire("edit",{text:t,left:this.cached.left,top:this.cached.top})},render:function(){return this.props.rendered?void this.redraw():(this.vector().paper().container().append(this.components.editor),this.props.rendered=!0,void this.redraw())},suspend:function(){this.props.suspended=!0,this.components.editor.detach(),this.editing.commitHandler&&(Graph.topic.unsubscribe("paper:beforezoom",this.editing.commitHandler),Graph.topic.unsubscribe("paper:beforescroll",this.editing.commitHandler),Graph.topic.unsubscribe("vector:pointerdown",this.editing.commitHandler),this.editing.commitHandler=null)},resume:function(){var t;this.props.rendered?(this.props.suspended&&(this.props.suspended=!1,t=this.vector().paper().container(),t.append(this.components.editor)),this.redraw()):this.render()},redraw:function(){var n,r,i,o,s=this.components.editor,a=this.vector(),p=a.matrixCurrent(),h=p.scale(),c=a.bbox().clone().transform(p).toJson();
i=c.width,o=c.height,n=c.x,r=c.y,"auto"!=this.props.width?(i=Math.max(this.props.width,t),i=Math.max(i*h.x,i),n=c.x):(i-=8*h.x,n+=4*h.x),"auto"!=this.props.height?(o=Math.max(this.props.height,e),o=Math.max(o*h.y,o),r=c.y):(o-=8*h.y,r+=4*h.y),s.css({left:n,top:r,width:i,height:o}),_.assign(this.cached,{left:n,top:r,width:i,height:o}),s.text(a.props.text||""),s.focus(),c=null},startEdit:function(t){var e=this,n=e.vector();if(n.deselect(),n.paper()&&"linker"==n.paper().tool().current()&&n.paper().tool().activate("panzoom"),e.fire("beforeedit"),e.resume(),t&&"pointer"==this.props.offset){var r,i,o,s=e.components.editor,a=n.paper(),p=a.layout();p.scale();a&&(r=a.position(),i=p.pointerLocation(t),"center"==this.props.align?(o={x:t.clientX-r.left,y:t.clientY-r.top},s.css({left:o.x-s.width()/2,top:o.y-s.height()/2})):(o=n.bboxView().toJson(),o=p.screenLocation({x:o.x,y:o.y}),s.css({left:o.x-r.left,top:o.y-r.top})),s.focus(!0),e.cached.left=i.x,e.cached.top=i.y)}e.editing.commitHandler||(e.editing.commitHandler=function(){
e.commit()},Graph.topic.subscribe("paper:beforezoom",e.editing.commitHandler),Graph.topic.subscribe("paper:beforescroll",e.editing.commitHandler),Graph.topic.subscribe("vector:pointerdown",e.editing.commitHandler))},onDoubleTap:function(t){this.startEdit(t),t.preventDefault()},destroy:function(){this.editing.commitHandler&&(Graph.topic.unsubscribe("paper:beforezoom",this.editing.commitHandler),Graph.topic.unsubscribe("paper:beforescroll",this.editing.commitHandler),Graph.topic.unsubscribe("vector:pointerdown",this.editing.commitHandler),this.editing.commitHandler=null)},toString:function(){return"Graph.plugin.Editor"}})}(),function(){function t(t,e,n){n=_.defaultTo(n,10);for(var r,i=e.length;i--;)if(r=Math.abs(e[i]-t),r<=n)return{snapped:!0,value:e[i]};return{snapped:!1,value:t}}Graph.plugin.Snapper=Graph.extend(Graph.plugin.Plugin,{props:{enabled:!0,suspended:!0,rendered:!1,vector:null},clients:{},components:{block:null,stubx:null,stuby:null},snapping:{coords:null,vector:null,offset:null,
stubx:null,stuby:null},constructor:function(t,e){if(e=e||{},!t.isPaper())throw Graph.error("Snapper plugin only available for paper");_.assign(this.props,e),this.props.vector=t.guid(),this.initComponent(t),this.snapping.coords={}},invalidate:function(){for(var t in this.snapping)this.snapping[t]=null;this.snapping.coords={},this.clients={}},initComponent:function(t){var e,n,r;e=(new Graph.svg.Group).selectable(!1).clickable(!1).addClass("graph-snapper"),n=new Graph.svg.Path("M 0 0 L 0 0").removeClass(Graph.styles.VECTOR).selectable(!1).clickable(!1).render(e),r=new Graph.svg.Path("M 0 0 L 0 0").removeClass(Graph.styles.VECTOR).clickable(!1).selectable(!1).render(e),this.components.block=e.guid(),this.components.stuby=r.guid(),this.components.stubx=n.guid()},component:function(t){return void 0===t?Graph.registry.vector.get(this.components.block):Graph.registry.vector.get(this.components[t])},render:function(){this.props.rendered||(this.component().render(this.vector()),this.props.rendered=!0);
},enable:function(){this.props.enabled=!0},disable:function(){this.props.enabled=!1},suspend:function(){this.props.suspended=!0,this.component().elem.detach()},resume:function(){if(this.props.suspended)if(this.props.suspended=!1,this.props.rendered){var t=this.component(),e=this.vector().viewport();t.elem.appendTo(e.elem)}else this.render()},refresh:function(t){if(this.props.enabled){var e,n,r,i;if(void 0!==t){var o=this.clients[t];o&&(this.snapping.coords[o.coords]&&delete this.snapping.coords[o.coords],n=Graph.registry.vector.get(t),n&&(r=this.getClientCenter(n),i=r.x+"_"+r.y,this.snapping.coords[i]=r,this.clients[t].coords=i))}else{this.snapping.coords={};for(e in this.clients)n=Graph.registry.vector.get(e),n&&(r=this.getClientCenter(n),i=r.x+"_"+r.y,this.snapping.coords[i]=r,this.clients[e].coords=i)}}},setup:function(t,e){if(this.props.enabled){var n,r=this,i=t.guid();if(r.clients[i]&&(t.off("beforedrag",r.clients[i].beforeDragHandler),t.off("afterdrag",r.clients[i].afterDragHandler),
t.off("afterdestroy",r.clients[i].afterDestroyHandler),r.clients[i].coords&&delete r.snapping.coords[r.clients[i].coords],delete r.clients[i]),e.enabled){var o=t.draggable();r.clients[i]={coords:null,osnaps:o.snap(),beforeDragHandler:_.bind(r.onClientBeforeDrag,r,_,t),afterDragHandler:_.bind(r.onClientAfterDrag,r,_,t),afterDestroyHandler:_.bind(r.onClientAfterDestroy,r,_,t)},t.on("beforedrag",r.clients[i].beforeDragHandler),t.on("afterdrag",r.clients[i].afterDragHandler),t.on("afterdestroy",r.clients[i].afterDestroyHandler);var s=r.getClientCenter(t),a=this.snapping.coords;n=s.x+"_"+s.y,a[n]||(a[n]=s,r.clients[i].coords=n),n=null}}},repairClient:function(t){console.log(t)},getClientCenter:function(t){var e=t.bboxView(),n=e.center(!0);return n},showStub:function(t,e){var n,r=this.snapping;"x"==t&&(n="M "+e+" -100000 L "+e+" 100000",r.stubx.attr("d",n),r.stubx.addClass("visible")),"y"==t&&(n="M -100000 "+e+" L 100000 "+e,r.stuby.attr("d",n),r.stuby.addClass("visible")),n=null},hideStub:function(t){
var e="x"==t?"stubx":"stuby";this.snapping[e].removeClass("visible")},onClientBeforeDrag:function(e,n){if(this.props.enabled){var r=this,i=r.vector(),o=i.viewport(),s=i.layout(),a=s.position(),p=r.getClientCenter(n),h=this.snapping,c=h.coords;h.stubx=this.component("stubx"),h.stuby=this.component("stuby");var l=a.left,u=a.top,d=o.matrix(),f=s.pointerLocation({clientX:e.x,clientY:e.y}),g=p.x-f.x,y=p.y-f.y,v=[],m=[];_.forOwn(c,function(t){var e,n,r,i;e=d.x(t.x-g,t.y-y),n=d.y(t.x-g,t.y-y),r=e+l,_.indexOf(v,r)===-1&&v.push(r),i=n+u,_.indexOf(m,i)===-1&&m.push(i)}),n.draggable().snap([function(e,n){var i,o,a,p,h;return i=t(e,v),o=t(n,m),a=i.value,p=o.value,h=s.pointerLocation({clientX:a,clientY:p}),i.snapped?r.showStub("x",h.x+g):r.hideStub("x"),o.snapped?r.showStub("y",h.y+y):r.hideStub("y"),{x:a,y:p}}]),r.resume()}},onClientAfterDrag:function(t,e){if(this.props.enabled){var n=this.snapping,r=this.clients[e.guid()];if(r){var i=e.draggable();r.osnaps&&i.snap(r.osnaps);var o,s;r.coords&&delete n.coords[r.coords],
s=this.getClientCenter(e),o=s.x+"_"+s.y,n.coords[o]||(n.coords[o]=s,r.coords=o),o=null,s=null}this.suspend(),_.assign(this.snapping,{stubx:null,stuby:null})}},onClientAfterDestroy:function(t,e){var n=e.guid(),r=this.clients[n],i=this.snapping;r&&(r.coords&&i.coords[r.coords]&&delete i.coords[r.coords],delete this.clients[n])},toString:function(){return"Graph.plugin.Snapper"}})}(),function(){Graph.plugin.Toolpad=Graph.extend(Graph.plugin.Plugin,{props:{vector:null,rendered:!1,suspended:!0},components:{pad:null},constructor:function(t){this.props.vector=t.guid(),this.initComponent(t),this.cached.tools=null,this.cached.shape=null,this.cached.link=null,Graph.topic.subscribe("shape:select",_.bind(this.onShapeSelect,this)),Graph.topic.subscribe("shape:deselect",_.bind(this.onShapeDeselect,this)),Graph.topic.subscribe("link:select",_.bind(this.onLinkSelect,this)),Graph.topic.subscribe("link:deselect",_.bind(this.onLinkDeselect,this))},initComponent:function(t){var e='<div class="graph-toolpad"><div class="pad-header"></div><div class="pad-splitter"></div><div class="pad-body">x</div></div>';
e=Graph.$(e),e.on("click","[data-shape-tool]",_.bind(this.onShapeToolClick,this)),e.on("click","[data-link-tool]",_.bind(this.onLinkToolClick,this)),this.components.pad=e},render:function(){this.props.rendered||(this.components.pad.appendTo(this.vector().container()),this.props.rendered=!0)},suspend:function(){this.props.suspended=!0,this.components.pad.detach()},resume:function(){this.props.suspended&&(this.props.suspended=!1,this.props.rendered?this.components.pad.appendTo(this.vector().container()):this.render())},onShapeSelect:function(t){var e=t.shape,n=e.metadata,r=this.components.pad,i="";r.find(".pad-header").html('<a href="javascript:void(0);"><i class="ion-navicon-round"></i></a>'),_.forEach(n.tools,function(t,e){t.enabled&&(i+='<div class="splitter"></div>',i+='<a data-shape-tool="'+t.name+'" href="javascript:void(0)" title="'+t.title+'"><i class="'+t.icon+'"></i></a>')}),r.find(".pad-body").html(i),this.cached.tools=n.tools,this.cached.shape=e,this.resume()},onShapeDeselect:function(t){
this.suspend()},onLinkSelect:function(t){var e=t.link,n=e.metadata,r=this.components.pad;r.find(".pad-header").html('<a><i class="ion-navicon-round"></i></a>');var i="";_.forEach(n.tools,function(t,e){t.enabled&&(i+='<div class="splitter"></div>',i+='<a data-link-tool="'+t.name+'" href="#" title="'+t.title+'"><i class="'+t.icon+'"></i></a>')}),r.find(".pad-body").html(i),this.cached.tools=n.tools,this.cached.link=e,this.resume()},onLinkDeselect:function(t){this.suspend()},onShapeToolClick:function(t){var e=Graph.$(t.currentTarget),n=e.data("shapeTool"),r=_.find(this.cached.tools,function(t){return t.name==n});if(r)if("config"==r.name){var i=this.vector();i.fire("shapetoolclick",{shape:this.cached.shape})}else r.handler&&r.handler(t);t.preventDefault()},onLinkToolClick:function(t){var e=Graph.$(t.currentTarget),n=e.data("linkTool"),r=_.find(this.cached.tools,function(t){return t.name==n});if(r)if("config"==r.name){var i=this.vector();i.fire("linktoolclick",{link:this.cached.link})}else r.handler&&r.handler(t);
t.preventDefault()},toString:function(){return"Graph.plugin.Toolpad"}})}(),function(){function t(e,n){var r,i=e.children().toArray();r=n.call(e,e),r=_.defaultTo(r,!0),r&&i.length&&_.forEach(i,function(e){t(e,n)})}var e=Graph.shape.Shape=Graph.extend({props:{id:null,guid:null,mode:null,width:0,height:0,label:"",alias:"",fill:"rgb(255, 255, 255)",stroke:"rgb(0, 0, 0)",strokeWidth:2},components:{shape:null,block:null,label:null,child:null},layout:{suspended:!1},tree:{paper:null,parent:null,children:null},metadata:{type:null,icon:Graph.icons.SHAPE,style:"graph-shape",tools:null},cached:{},plugins:{manager:null},constructor:function(t){var n;if(this.data(t||{}),n="graph-shape-"+ ++e.guid,this.props.guid=n,this.tree.children=new Graph.collection.Shape,this.plugins.manager=new Graph.plugin.Manager,this.initComponent(),this.initMetadata(),this.components.shape){var r=Graph.styles.SHAPE,i=this.component();this.metadata.style&&(r+=" "+this.metadata.style),i.addClass(r),i.attr("data-shape",n),r=null;
}Graph.registry.shape.register(this),n=null},data:function(t,e){if(void 0===t&&void 0===e)return this.props;var n,r,i={type:!0,client_id:!0,client_parent:!0,client_pool:!0,diagram_id:!0,parent_id:!0,params:!0},o={stroke_width:"strokeWidth"};if(_.isPlainObject(t)){for(r in t)i[r]||(n=o[r]||r,this.props[n]=t[r]);return this}return void 0===e?this.props[t]:(i[t]||(n=o[t]||t,this.props[n]=e),this)},update:function(t){t=t||{},t.props&&this.data(t.props)},redraw:function(t){var e;t=t||{},this.suspendLayout();for(e in t)void 0!==this[e]&&_.isFunction(this[e])&&this[e](t[e]);this.resumeLayout(),this.refresh()},is:function(t){return this.metadata.type==t},initMetadata:function(){this.metadata.tools=[{name:"config",icon:Graph.icons.CONFIG,title:Graph._("Click to config shape"),enabled:!0,handler:_.bind(this.onConfigToolClick,this)},{name:"link",icon:Graph.icons.LINK,title:Graph._("Click to start shape linking"),enabled:!0,handler:_.bind(this.onLinkToolClick,this)},{name:"sendtofront",icon:Graph.icons.SEND_TO_FRONT,
title:Graph._("Send to front"),enabled:!0,handler:_.bind(this.onFrontToolClick,this)},{name:"sendtoback",icon:Graph.icons.SEND_TO_BACK,title:Graph._("Send to back"),enabled:!0,handler:_.bind(this.onBackToolClick,this)},{name:"trash",icon:Graph.icons.TRASH,title:Graph._("Click to remove shape"),enabled:!0,handler:_.bind(this.onTrashToolClick,this)}]},initComponent:function(){var t=new Graph.svg.Group;this.components.shape=t.guid(),t=null},component:function(t){var e=Graph.registry.vector;return void 0===t?e.get(this.components.shape):e.get(this.components[t])},invalidate:function(){for(var t in this.cached)this.cached[t]=null},connectable:function(){return this.plugins.manager.get("network")},resizable:function(){return this.plugins.manager.get("resizer")},draggable:function(){return this.plugins.manager.get("dragger")},snappable:function(){return this.plugins.manager.get("snapper")},editable:function(){return this.plugins.manager.get("editor")},paper:function(){return Graph.registry.vector.get(this.tree.paper);
},parent:function(){return Graph.registry.shape.get(this.tree.parent)},children:function(){return this.tree.children},hasChild:function(t){return this.children().has(t)},addChild:function(t,e){var n=this.children(),r=this.component("child"),i=this.guid(),o=this;e=_.defaultTo(e,!0),_.isArray(t)||(t=[t]);_.bind(this.onChildBeforeDestroy,this);_.forEach(t,function(t){var s=t.parent();if(s&&s.guid()!=i&&s.removeChild(t),!n.has(t)){var a=t.component();e?a.relocate(r):r.append(a),t.cached.beforeDestroyHandler=_.bind(o.onChildBeforeDestroy,o),t.cached.afterDragHandler=_.bind(o.onChildAfterDrag,o),t.cached.connectHandler=_.bind(o.onChildConnect,o),t.on("beforedestroy",t.cached.beforeDestroyHandler),t.on("afterdrag",t.cached.afterDragHandler),t.on("connect",t.cached.connectHandler),n.push(t),t.tree.parent=i;var p=a.matrix();t.data({left:p.props.e,top:p.props.f})}}),e&&this.autoResize()},removeChild:function(t){var e=this.children();e.has(t)&&(e.pull(t),t.tree.parent=null)},guid:function(){return this.props.guid;
},matrix:function(){return this.component().matrix()},bbox:function(){return Graph.bbox({x:this.props.left,y:this.props.top,x2:this.props.left+this.props.width,y2:this.props.top+this.props.height,width:this.props.width,height:this.props.height})},render:function(t){var e=this.guid(),n=t.guid(),r=this.component();r&&r.render(t),this.tree.paper=n,Graph.registry.shape.setContext(e,n)},select:function(t){var e=this.component("block"),n=this.paper();t=_.defaultTo(t,!1),t&&n&&n.collector().clearCollection(),e&&e.select()},deselect:function(){var t=this.component("block");t&&t.deselect()},remove:function(){this.component("block").remove()},refresh:_.debounce(function(){if(!this.layout.suspended){var t=this.component("label"),e=this.component("block"),n=e.bbox().toJson();t.attr({x:n.x+n.width/2,y:n.x+n.height/2}),t.wrap(n.width-10)}},1),autoResize:function(){},center:function(){var t=this.component().bboxView().toJson();return{x:(t.x+t.x2)/2,y:(t.y+t.y2)/2}},translate:function(t,e){var n=this.component();
n.translate(t,e).commit();var r=n.matrix(),i=r.props.e,o=r.props.f;this.data({left:i,top:o});var s=this.component("child");s&&s.dirty(!0)},cascade:function(e){t(this,e)},sendToBack:function(){this.paper()},sendToFront:function(){var t=this.paper();t.viewport().elem.append(this.component().elem)},suspendLayout:function(){this.layout.suspended=!0},resumeLayout:function(){this.layout.suspended=!1},attr:function(t,e){var n=this;return _.isPlainObject(t)?(_.forOwn(t,function(t,e){n.props[e]=t}),this):void 0===e?this.props[t]:(this.props[t]=e,this)},height:function(t){if(void 0===t)return this.props.height;var e=this.component("block"),n=e.bbox().toJson(),r=1,i=t/this.props.height,o=(n.x+n.x2)/2,s=n.y,a=0,p=0,h=e.resize(r,i,o,s,a,p);return e.fire("afterresize",h),this.props.height=t,this},width:function(t){if(void 0===t)return this.props.width;var e=this.component("block"),n=e.bbox().toJson(),r=t/this.props.width,i=1,o=n.x,s=(n.y+n.y2)/2,a=0,p=0,h=e.resize(r,i,o,s,a,p);return e.fire("afterresize",h),
this.props.width=t,this},left:function(t){if(void 0===t)return this.props.left;var e=this.component(),n=e.matrix(),r=t-n.props.e,i=0;return e.translate(r,i).commit(),this.props.left=t,this},top:function(t){if(void 0===t)return this.props.top;var e=this.component(),n=e.matrix(),r=0,i=t-n.props.f;return e.translate(r,i).commit(),this.props.top=t,this},label:function(t){if(void 0===t)return this.props.label;var e=this.component("block"),n=this.component("label");n.props.text=t,e.data("text",t),this.props.label=t,this.refresh()},fill:function(t){return void 0===t?this.props.fill:(this.props.fill=t,void this.component("block").elem.css("fill",t))},stroke:function(t){return void 0===t?this.props.stroke:(this.props.stroke=t,void this.component("block").elem.css("stroke",t))},strokeWidth:function(t){return void 0===t?this.props.strokeWidth:(this.props.strokeWidth=t,void this.component("block").elem.css("stroke-width",t))},connect:function(t,e,n,r){var i=this.connectable().plugin(),o=t.connectable().plugin();
return!(!i||!o)&&i.connect(o,e,n,r)},disconnect:function(t,e){var n=this.connectable().plugin(),r=t.connectable().plugin();return!(!n||!r)&&n.disconnect(r,e)},toJson:function(){var t=(this.component("block"),this.paper(),{metadata:{},props:{id:this.props.id,type:this.toString(),mode:this.props.mode,guid:this.props.guid,pool:null,parent:this.tree.parent,label:this.props.label,left:this.props.left,top:this.props.top,width:this.props.width,height:this.props.height,fill:this.props.fill,strokeWidth:this.props.strokeWidth,stroke:this.props.stroke},params:[{key:"Source",value:"db.employee"}],links:[]}),e=this.connectable().plugin();if(e){var n=e.connections();_.forEach(n,function(e){var n=e.link.toJson();t.links.push({guid:e.guid,mode:e.type,pair:"outgoing"==e.type?n.props.target:n.props.source})})}return t},onLabelEdit:function(t){this.label(t.text)},onBeforeDrag:function(t){this.fire(t),this.paper().diagram().capture()},onAfterDrag:function(t){var e,n=this.component("block"),r=this.component("shape"),i=this.component("child"),o=n.matrix();
n.reset(),r.matrix().multiply(o),r.attr("transform",r.matrix().toValue()),r.dirty(!0),i&&i.dirty(!0),e=r.matrix(),this.data({left:e.props.e,top:e.props.f}),this.fire(t)},onSelect:function(t){this.component("shape").addClass("shape-selected"),t.initial&&Graph.topic.publish("shape:select",{shape:this})},onDeselect:function(t){this.component("shape").removeClass("shape-selected"),t.initial&&Graph.topic.publish("shape:deselect",{shape:this})},onConnect:function(t){var e=t.link,n=e.router.source(),r=e.router.target();if(n&&r){var i=Graph.registry.shape.get(n),o=Graph.registry.shape.get(r);i&&o&&this.fire("connect",{link:e,source:i,target:o})}},onAfterResize:function(){this.refresh()},onBeforeDestroy:function(){this.fire("beforedestroy",{shape:this})},onAfterDestroy:function(){this.component("label").remove(),this.component("shape").remove();for(var t in this.components)this.components[t]=null;this.fire("afterdestroy",{shape:this}),Graph.registry.shape.unregister(this)},onChildConnect:function(t){},
onChildAfterDrag:function(t){var e;t.batch?t.master&&(e=this.component("child"),e&&e.dirty(!0)):(e=this.component("child"),e&&e.dirty(!0))},onChildBeforeDestroy:function(t){var e=t.shape;this.children().pull(e),e.off("beforedestroy",e.cached.beforeDestroyHandler),e.off("afterdrag",e.cached.afterDragHandler),e.off("connect",e.cached.connectHandler),e.cached.beforeDestroyHandler=null,e.cached.afterDragHandler=null,e.cached.connectHandler=null;var n=e.component("child");n&&n.dirty(!0)},onConfigToolClick:function(t){},onTrashToolClick:function(t){this.paper().diagram().capture(),this.remove()},onLinkToolClick:function(t){var e=this.paper();if(e){var n=e.layout(),r=e.plugins.linker,i=n.pointerLocation(t);e.tool().activate("linker"),r.start(this.connectable().component(),i)}},onFrontToolClick:function(t){this.sendToFront()},onBackToolClick:function(t){this.sendToBack()}});e.guid=0,Graph.isShape=function(t){return t instanceof Graph.shape.Shape}}(),function(){Graph.ns("Graph.shape.activity"),Graph.shape.activity.Start=Graph.extend(Graph.shape.Shape,{
props:{label:"Start",width:60,height:60,left:0,top:0},metadata:{type:"activity.start",style:"graph-shape-activity-start"},initComponent:function(){var t,e,n,r=this.components,i=this.plugins.manager;t=new Graph.svg.Group(this.props.left,this.props.top).selectable(!1);var o=this.props.width/2,s=this.props.height/2;e=new Graph.svg.Ellipse(o,s,o,s).addClass(Graph.styles.SHAPE_BLOCK).style({fill:this.props.fill,stroke:this.props.stroke,strokeWidth:this.props.strokeWidth}).data("text",this.props.label).render(t),e.elem.data(Graph.string.ID_SHAPE,this.guid()),i.install("dragger",e,{ghost:!0,cls:Graph.styles.SHAPE_DRAG}),i.install("network",e,{wiring:"h:v"}),i.install("resizer",e),i.install("editor",e),i.install("snapper",e),e.on("edit.shape",_.bind(this.onLabelEdit,this)),e.on("beforedrag.shape",_.bind(this.onBeforeDrag,this)),e.on("afterdrag.shape",_.bind(this.onAfterDrag,this)),e.on("afterresize.shape",_.bind(this.onAfterResize,this)),e.on("beforedestroy.shape",_.bind(this.onBeforeDestroy,this)),
e.on("afterdestroy.shape",_.bind(this.onAfterDestroy,this)),e.on("select.shape",_.bind(this.onSelect,this)),e.on("deselect.shape",_.bind(this.onDeselect,this)),e.on("connect.shape",_.bind(this.onConnect,this)),n=new Graph.svg.Text(o,s,this.props.label).addClass(Graph.styles.SHAPE_LABEL).selectable(!1).clickable(!1).render(t),r.shape=t.guid(),r.block=e.guid(),r.label=n.guid(),t=e=n=null},refresh:function(){if(!this.layout.suspended){var t,e,n,r,i=this.component("block"),o=this.component("shape"),s=this.component("label");e=i.bbox().toJson(),t=Graph.matrix().translate(e.x,e.y),o.matrix().multiply(t),o.attr("transform",o.matrix().toValue()),n=e.width/2,r=e.height/2,i.attr({cx:n,cy:r}),i.dirty(!0),i.resizable().redraw(),s.attr({x:n,y:r}),s.wrap(e.width-10),t=o.matrix(),this.data({left:t.props.e,top:t.props.f,width:e.width,height:e.height}),e=null,t=null}},toString:function(){return"Graph.shape.activity.Start"}})}(),function(){Graph.shape.activity.Final=Graph.extend(Graph.shape.Shape,{props:{
label:"End",width:60,height:60,left:0,top:0,fill:"#FF4081"},metadata:{type:"activity.final",style:"graph-shape-activity-final"},initComponent:function(){var t,e,n,r,i=this.components,o=this.plugins.manager;t=new Graph.svg.Group(this.props.left,this.props.top).selectable(!1);var s=this.props.width/2,a=this.props.height/2;e=new Graph.svg.Ellipse(s,a,s,a).addClass(Graph.styles.SHAPE_BLOCK).style({stroke:this.props.stroke,strokeWidth:this.props.strokeWidth}).data("text",this.props.label).render(t),e.elem.data(Graph.string.ID_SHAPE,this.guid()),o.install("dragger",e,{ghost:!0,cls:Graph.styles.SHAPE_DRAG}),o.install("network",e,{wiring:"h:v"}),o.install("resizer",e),o.install("editor",e),o.install("snapper",e),e.on("edit.shape",_.bind(this.onLabelEdit,this)),e.on("beforedrag.shape",_.bind(this.onBeforeDrag,this)),e.on("afterdrag.shape",_.bind(this.onAfterDrag,this)),e.on("afterresize.shape",_.bind(this.onAfterResize,this)),e.on("beforedestroy.shape",_.bind(this.onBeforeDestroy,this)),e.on("afterdestroy.shape",_.bind(this.onAfterDestroy,this)),
e.on("select.shape",_.bind(this.onSelect,this)),e.on("deselect.shape",_.bind(this.onDeselect,this)),e.on("connect.shape",_.bind(this.onConnect,this)),n=new Graph.svg.Ellipse(s,a,s-6,a-6).addClass("comp-inner").style({fill:this.props.fill}).clickable(!1).selectable(!1).render(t),r=new Graph.svg.Text(s,a,this.props.label).addClass(Graph.styles.SHAPE_LABEL).addClass("comp-label").selectable(!1).clickable(!1).render(t),i.shape=t.guid(),i.block=e.guid(),i.label=r.guid(),i.inner=n.guid(),t=e=r=n=null},fill:function(t){return void 0===t?this.props.value:(this.component("inner").elem.css("fill",t),this.props.fill=t,this)},refresh:function(){if(!this.layout.suspended){var t,e,n,r,i=this.component("block"),o=this.component("shape"),s=this.component("inner"),a=this.component("label");e=i.bbox().toJson(),t=Graph.matrix().translate(e.x,e.y),o.matrix().multiply(t),o.attr("transform",o.matrix().toValue()),n=e.width/2,r=e.height/2,i.attr({cx:n,cy:r}),i.dirty(!0),i.resizable().redraw(),a.attr({x:n,y:r}),
a.wrap(e.width-10),s.attr({cx:n,cy:r,rx:n-6,ry:r-6}),t=o.matrix(),this.data({left:t.props.e,top:t.props.f,width:e.width,height:e.height}),e=null,t=null}},toString:function(){return"Graph.shape.activity.Final"},onAfterDestroy:function(){this.component("label").remove(),this.component("inner").remove(),this.component("shape").remove();for(var t in this.components)this.components[t]=null;Graph.registry.shape.unregister(this),this.fire("afterdestroy")}})}(),function(){Graph.shape.activity.Action=Graph.extend(Graph.shape.Shape,{props:{label:"Action",width:140,height:60,left:0,top:0},metadata:{type:"activity.action",icon:Graph.icons.SHAPE_ACTION,style:"graph-shape-activity-action"},initComponent:function(){var t,e,n,r=this.components,i=this.plugins.manager,o=this.props.width/2,s=this.props.height/2;t=new Graph.svg.Group(this.props.left,this.props.top).selectable(!1),e=new Graph.svg.Rect(0,0,this.props.width,this.props.height).addClass(Graph.styles.SHAPE_BLOCK).style({fill:this.props.fill,stroke:this.props.stroke,
strokeWidth:this.props.strokeWidth}).data("text",this.props.label).render(t),e.elem.data(Graph.string.ID_SHAPE,this.guid()),i.install("dragger",e,{ghost:!0,cls:Graph.styles.SHAPE_DRAG}),i.install("resizer",e),i.install("editor",e),i.install("network",e,{wiring:"h:v"}),i.install("snapper",e),e.on("edit.shape",_.bind(this.onLabelEdit,this)),e.on("beforedrag.shape",_.bind(this.onBeforeDrag,this)),e.on("afterdrag.shape",_.bind(this.onAfterDrag,this)),e.on("afterresize.shape",_.bind(this.onAfterResize,this)),e.on("beforedestroy.shape",_.bind(this.onBeforeDestroy,this)),e.on("afterdestroy.shape",_.bind(this.onAfterDestroy,this)),e.on("select.shape",_.bind(this.onSelect,this)),e.on("deselect.shape",_.bind(this.onDeselect,this)),e.on("connect.shape",_.bind(this.onConnect,this)),n=new Graph.svg.Text(o,s,this.props.label).addClass(Graph.styles.SHAPE_LABEL).clickable(!1).selectable(!1).render(t),r.shape=t.guid(),r.block=e.guid(),r.label=n.guid(),t=e=n=null},refresh:function(){if(!this.layout.suspended){
var t,e,n=this.component("block"),r=this.component("shape"),i=this.component("label");t=n.bbox().toJson(),e=Graph.matrix().translate(t.x,t.y),r.matrix().multiply(e),r.attr("transform",r.matrix().toValue()),n.attr({x:0,y:0}),n.dirty(!0),n.resizable().redraw(),i.attr({x:t.width/2,y:t.height/2}),i.wrap(t.width-10),e=r.matrix(),this.data({left:e.props.e,top:e.props.f,width:t.width,height:t.height}),t=null,e=null}},onAfterResize:function(){this.refresh()},toString:function(){return"Graph.shape.activity.Action"}})}(),function(){Graph.shape.activity.Router=Graph.extend(Graph.shape.Shape,{props:{label:"Route",mode:"xor",width:100,height:100,left:0,top:0},metadata:{type:"activity.router",icon:Graph.icons.ROUTER_NONE,style:"graph-shape-activity-router"},constructor:function(){"none"!=this.props.mode&&(this.props.width=this.props.height=50),this.superclass.prototype.constructor.apply(this,arguments)},initMetadata:function(){this.metadata.tools=[{name:"mode-none",icon:Graph.icons.ROUTER_NONE,title:Graph._("Change to default mode"),
enabled:!0,handler:_.bind(this.onModeClick,this,_,"none")},{name:"mode-or",icon:Graph.icons.ROUTER_OR,title:Graph._("Change to OR mode"),enabled:!0,handler:_.bind(this.onModeClick,this,_,"or")},{name:"mode-xor",icon:Graph.icons.ROUTER_XOR,title:Graph._("Change to XOR mode"),enabled:!0,handler:_.bind(this.onModeClick,this,_,"xor")},{name:"mode-parallel",icon:Graph.icons.ROUTER_PARALLEL,title:Graph._("Change to parallel mode"),enabled:!0,handler:_.bind(this.onModeClick,this,_,"parallel")},{name:"config",icon:Graph.icons.CONFIG,title:Graph._("Click to config shape"),enabled:!0},{name:"link",icon:Graph.icons.LINK,title:Graph._("Click to start shape linking"),enabled:!0,handler:_.bind(this.onLinkToolClick,this)},{name:"sendtofront",icon:Graph.icons.SEND_TO_FRONT,title:Graph._("Send to front"),enabled:!0,handler:_.bind(this.onFrontToolClick,this)},{name:"sendtoback",icon:Graph.icons.SEND_TO_BACK,title:Graph._("Send to back"),enabled:!0,handler:_.bind(this.onBackToolClick,this)},{name:"trash",
icon:Graph.icons.TRASH,title:Graph._("Click to remove shape"),enabled:!0,handler:_.bind(this.onTrashToolClick,this)}]},initComponent:function(){var t,e,n,r=this.components,i=this.plugins.manager,o=[this.props.width/2,0,this.props.width,this.props.height/2,this.props.width/2,this.props.height,0,this.props.height/2],s=o[0],a=o[3];t=new Graph.svg.Group(this.props.left,this.props.top).selectable(!1),e=new Graph.svg.Polygon(o).addClass(Graph.styles.SHAPE_BLOCK).data("text",this.props.label).render(t),e.elem.data(Graph.string.ID_SHAPE,this.guid()),i.install("dragger",e,{ghost:!0,cls:Graph.styles.SHAPE_DRAG}),i.install("resizer",e),i.install("editor",e),i.install("network",e,{wiring:"v:v"}),i.install("snapper",e),e.on("edit.shape",_.bind(this.onLabelEdit,this)),e.on("beforedrag.shape",_.bind(this.onBeforeDrag,this)),e.on("afterdrag.shape",_.bind(this.onAfterDrag,this)),e.on("afterresize.shape",_.bind(this.onAfterResize,this)),e.on("beforedestroy.shape",_.bind(this.onBeforeDestroy,this)),e.on("afterdestroy.shape",_.bind(this.onAfterDestroy,this)),
e.on("select.shape",_.bind(this.onSelect,this)),e.on("deselect.shape",_.bind(this.onDeselect,this)),e.on("connect.shape",_.bind(this.onConnect,this)),n=new Graph.svg.Text(s,a,this.props.label).addClass(Graph.styles.SHAPE_LABEL).clickable(!1).selectable(!1).render(t),r.shape=t.guid(),r.block=e.guid(),r.label=n.guid(),t=e=n=null,this.mode(this.props.mode)},mode:function(t){if(void 0===t)return this.props.mode;this.props.mode=t;var e;if("none"!=this.props.mode){this.component("label").hide(),this.component("block").resizable().disable(),this.components.inner&&this.component("inner").remove();var n=this.component();switch(t){case"parallel":e=new Graph.svg.Path("M 10 25 L 25 25 L 25 40 L 25 25 L 40 25 L 25 25 L 25 10");break;case"or":e=new Graph.svg.Circle(25,25,10);break;case"xor":e=new Graph.svg.Path("M 15 15 L 25 25 L 15 35 L 25 25 L 35 35 L 25 25 L 35 15")}e&&(e.addClass("comp-inner"),e.selectable(!1),e.clickable(!1),e.render(n),this.components.inner=e.guid())}else this.component("label").show(),
this.component("block").resizable().enable(),e=this.component("inner"),e&&(e.remove(),this.components.inner=null);return this},width:function(t){if(void 0===t)return this.props.width;var e=this.component("block").bbox().toJson(),n=t/this.props.width,r=1,i=e.x,o=(e.y+e.y2)/2,s=0,a=0;return this.component("block").resize(n,r,i,o,s,a),this.component().dirty(!0),this.props.width=t,this},height:function(t){if(void 0===t)return this.props.height;var e=this.component("block"),n=e.bbox().toJson(),r=1,i=t/this.props.height,o=(n.x+n.x2)/2,s=n.y,a=0,p=0,h=e.resize(r,i,o,s,a,p);return e.fire("afterresize",h),this.props.height=t,this},refresh:function(){if(!this.layout.suspended){var t,e,n=this.component("block"),r=this.component("shape"),i=this.component("label");t=n.bbox().toJson(),e=Graph.matrix().translate(t.x,t.y),r.matrix().multiply(e),r.attr("transform",r.matrix().toValue());var o=[t.width/2,0,t.width,t.height/2,t.width/2,t.height,0,t.height/2];n.attr({points:_.join(o,",")}),n.dirty(!0),n.resizable().redraw(),
i.attr({x:t.width/2,y:t.height/2}),i.wrap(t.width-10),e=r.matrix(),this.data({left:e.props.e,top:e.props.f,width:t.width,height:t.height}),e=null,t=null}},toString:function(){return"Graph.shape.activity.Router"},onModeClick:function(t,e){this.mode(e)}})}(),function(){Graph.shape.activity.Fork=Graph.extend(Graph.shape.Shape,{props:{width:300,height:15,left:0,top:0},metadata:{type:"activity.fork",style:"graph-shape-activity-fork"},initComponent:function(){var t,e,n,r=this.components,i=this.plugins.manager;t=new Graph.svg.Group(this.props.left,this.props.top).selectable(!1),e=new Graph.svg.Rect(0,0,this.props.width,this.props.height,0).addClass(Graph.styles.SHAPE_BLOCK).render(t),e.elem.data(Graph.string.ID_SHAPE,this.guid()),i.install("dragger",e,{ghost:!0,cls:Graph.styles.SHAPE_DRAG}),i.install("resizer",e),i.install("snapper",e),i.install("network",e,{wiring:"v:v",tuning:!1,limitIncoming:1,limitOutgoing:0}),e.on("beforedrag.shape",_.bind(this.onBeforeDrag,this)),e.on("afterdrag.shape",_.bind(this.onAfterDrag,this)),
e.on("afterresize.shape",_.bind(this.onAfterResize,this)),e.on("beforedestroy.shape",_.bind(this.onBeforeDestroy,this)),e.on("afterdestroy.shape",_.bind(this.onAfterDestroy,this)),e.on("select.shape",_.bind(this.onSelect,this)),e.on("deselect.shape",_.bind(this.onDeselect,this)),e.on("connect.shape",_.bind(this.onConnect,this)),n=new Graph.svg.Text(0,0,this.props.label).addClass(Graph.styles.SHAPE_LABEL).clickable(!1).selectable(!1).render(t),r.shape=t.guid(),r.block=e.guid(),r.label=n.guid()},refresh:function(){if(!this.layout.suspended){var t,e,n=this.component("block"),r=this.component("shape");t=n.bbox().toJson(),e=Graph.matrix().translate(t.x,t.y),r.matrix().multiply(e),r.attr("transform",r.matrix().toValue()),n.attr({x:0,y:0}),n.dirty(!0),n.resizable().redraw(),e=r.matrix(),this.data({left:e.props.e,top:e.props.f,width:t.width,height:t.height}),t=null,e=null}},toString:function(){return"Graph.shape.activity.Join"}})}(),function(){Graph.shape.activity.Join=Graph.extend(Graph.shape.Shape,{
props:{width:300,height:15,left:0,top:0},metadata:{type:"activity.join",style:"graph-shape-activity-join"},initComponent:function(){var t,e,n,r=this.components,i=this.plugins.manager;t=new Graph.svg.Group(this.props.left,this.props.top).selectable(!1),e=new Graph.svg.Rect(0,0,this.props.width,this.props.height,0).addClass(Graph.styles.SHAPE_BLOCK).render(t),e.elem.data(Graph.string.ID_SHAPE,this.guid()),i.install("dragger",e,{ghost:!0,cls:Graph.styles.SHAPE_DRAG}),i.install("resizer",e),i.install("snapper",e),i.install("network",e,{wiring:"v:v",tuning:!1,limitIncoming:0,limitOutgoing:1}),e.on("beforedrag.shape",_.bind(this.onBeforeDrag,this)),e.on("afterdrag.shape",_.bind(this.onAfterDrag,this)),e.on("afterresize.shape",_.bind(this.onAfterResize,this)),e.on("beforedestroy.shape",_.bind(this.onBeforeDestroy,this)),e.on("afterdestroy.shape",_.bind(this.onAfterDestroy,this)),e.on("select.shape",_.bind(this.onSelect,this)),e.on("deselect.shape",_.bind(this.onDeselect,this)),e.on("connect.shape",_.bind(this.onConnect,this)),
n=new Graph.svg.Text(0,0,this.props.label).addClass(Graph.styles.SHAPE_LABEL).clickable(!1).selectable(!1).render(t),r.shape=t.guid(),r.block=e.guid(),r.label=n.guid()},refresh:function(){if(!this.layout.suspended){var t,e,n=this.component("block"),r=this.component("shape");t=n.bbox().toJson(),e=Graph.matrix().translate(t.x,t.y),r.matrix().multiply(e),r.attr("transform",r.matrix().toValue()),n.attr({x:0,y:0}),n.dirty(!0),n.resizable().redraw(),e=r.matrix(),this.data({left:e.props.e,top:e.props.f,width:t.width,height:t.height}),t=null,e=null}},toString:function(){return"Graph.shape.activity.Join"}})}(),function(){Graph.shape.activity.Lane=Graph.extend(Graph.shape.Shape,{props:{label:"Participant Role",width:1e3,height:200,left:0,top:0},components:{header:null},tree:{pool:null},transfer:null,resizing:null,metadata:{type:"activity.lane",icon:Graph.icons.SHAPE_LANE,style:"graph-shape-activity-lane"},constructor:function(t){this.superclass.prototype.constructor.call(this,t),this.initDropzone();
},initMetadata:function(){this.metadata.tools=[{name:"config",icon:Graph.icons.CONFIG,title:Graph._("Click to config shape"),enabled:!0},{name:"above",icon:Graph.icons.LANE_ABOVE,title:Graph._("Add shape above"),enabled:!0,handler:_.bind(this.onAboveToolClick,this)},{name:"below",icon:Graph.icons.LANE_BELOW,title:Graph._("Add shape below"),enabled:!0,handler:_.bind(this.onBelowToolClick,this)},{name:"moveup",icon:Graph.icons.MOVE_UP,title:Graph._("Move up"),enabled:!0,handler:_.bind(this.onUpToolClick,this)},{name:"movedown",icon:Graph.icons.MOVE_DOWN,title:Graph._("Move down"),enabled:!0,handler:_.bind(this.onDownToolClick,this)},{name:"sendtofront",icon:Graph.icons.SEND_TO_FRONT,title:Graph._("Send to front"),enabled:!0,handler:_.bind(this.onFrontToolClick,this)},{name:"sendtoback",icon:Graph.icons.SEND_TO_BACK,title:Graph._("Send to back"),enabled:!0,handler:_.bind(this.onBackToolClick,this)},{name:"trash",icon:Graph.icons.TRASH,title:Graph._("Click to remove shape"),enabled:!0,handler:_.bind(this.onTrashToolClick,this)
}]},initComponent:function(){var t,e,n,r,i,o=this.components,s=this.plugins.manager;t=new Graph.svg.Group(this.props.left,this.props.top).selectable(!1),e=new Graph.svg.Rect(0,0,this.props.width,this.props.height,0).addClass(Graph.styles.SHAPE_BLOCK).render(t),e.elem.data(Graph.string.ID_SHAPE,this.guid()),s.install("resizer",e,{restriction:{width:200,height:100}}),s.install("dragger",e,{ghost:!0,batchSync:!1,cls:Graph.styles.SHAPE_DRAG}),e.on("beforedrag.shape",_.bind(this.onBeforeDrag,this)),e.on("afterdrag.shape",_.bind(this.onAfterDrag,this)),e.on("beforeresize.shape",_.bind(this.onBeforeResize,this)),e.on("afterresize.shape",_.bind(this.onAfterResize,this)),e.on("beforedestroy.shape",_.bind(this.onBeforeDestroy,this)),e.on("afterdestroy.shape",_.bind(this.onAfterDestroy,this)),e.on("select.shape",_.bind(this.onSelect,this)),e.on("deselect.shape",_.bind(this.onDeselect,this)),n=new Graph.svg.Rect(0,0,30,this.props.height,0).addClass(Graph.styles.SHAPE_HEADER).selectable(!1).render(t),
n.data("text",this.props.label),s.install("editor",n,{width:200,height:100,offset:"pointer"}),n.on("edit.shape",_.bind(this.onLabelEdit,this));var a=15,p=this.props.height/2;r=new Graph.svg.Text(a,p,this.props.label).addClass(Graph.styles.SHAPE_LABEL).selectable(!1).clickable(!1).render(t),r.rotate(270,a,p).commit(),i=(new Graph.svg.Group).addClass(Graph.styles.SHAPE_CHILD).selectable(!1).render(t),i.translate(50,0).commit(),o.shape=t.guid(),o.block=e.guid(),o.header=n.guid(),o.label=r.guid(),o.child=i.guid(),this.tree.pool=new Graph.shape.activity.Pool,this.tree.pool.insert(this),t=e=n=r=null},initDropzone:function(){function t(){var n;n=_.delay(function(){clearTimeout(n),n=null,e.transfer.shape.off("afterdrag",t),e.transfer=null},0)}var e=this,n=e.component(),r=e.component("block");e.children();r.interactable().dropzone({accept:".shape-draggable",overlap:.2}).on("dragenter",function(r){var i,o,s,a=e.pool().guid,p=e.guid();if(!e.transfer&&(i=Graph.registry.vector.get(r.relatedTarget),i&&(o=Graph.registry.shape.get(i)))){
if(o.guid()==p||o.is("activity.lane")&&o.pool().guid==a)return;e.transfer={shape:o,batch:[]},e.transfer.shape.on("afterdrag",t),e.transfer.batch=[o];var h=i.collector();h&&(s=h.collection.toArray().slice(),_.forEach(s,function(t){var n=Graph.registry.shape.get(t);n&&n.guid()!=o.guid()&&e.transfer.batch.push(n)}),s=null)}e.transfer&&n.addClass("receiving")}).on("dragleave",function(t){n.removeClass("receiving")}).on("drop",function(t){if(e.transfer){var r;r=_.delay(function(){clearTimeout(r),r=null;var t=[],n=[],i=e.pool().guid,o=e.guid();_.forEach(e.transfer.batch,function(e){e.is("activity.lane")?e.guid()!=o&&e.pool().guid!=i&&n.push(e):t.push(e)}),t.length&&e.addChild(t),n.length&&e.addSiblingBellow(n)},0)}n.removeClass("receiving")}),r=null},pool:function(){return this.tree.pool},render:function(t,e,n){var r=this.component();e=_.defaultTo(e,"prepend"),r.render(t,e,n),this.tree.paper=t.guid(),Graph.registry.shape.setContext(this.guid(),t.guid())},sendToBack:function(){this.paper()},sendToFront:function(){
this.pool().bringToFront(this)},refresh:function(){if(!this.layout.suspended){var t,e,n=this.component("block"),r=this.component("shape"),i=this.component("child"),o=this.component("header"),s=this.component("label");e=n.bbox().toJson(),t=Graph.matrix().translate(e.x,e.y),r.matrix().multiply(t),r.attr("transform",r.matrix().toValue()),r.dirty(!0),i.dirty(!0),n.attr({x:0,y:0}),n.dirty(!0),n.resizable().redraw(),o.attr({x:0,y:0,height:e.height}),o.dirty(!0);var a=15,p=e.height/2;s.graph.matrix=Graph.matrix(),s.attr("transform",""),s.attr({x:a,y:p}),s.wrap(e.height-10),s.rotate(270,a,p).commit(),t=r.matrix(),this.data({left:t.props.e,top:t.props.f,width:e.width,height:e.height}),e=null,t=null}},attr:function(t,e){var n,r,i,o=this.superclass.prototype.attr.call(this,t,e),s={width:"width",height:"height",left:"x",top:"y"};if(_.isPlainObject(t)){n=this.component("block");for(r in t)s[r]&&(i=t[r],n.attr(s[r],i));this.refresh()}else void 0!==e&&(n=this.component("block"),s[t]&&n.attr(s[t],e),this.refresh());
return o},height:function(t){if(void 0!==t){var e=this.component("child").bbox().toJson();t=Math.max(t,e.y+e.height+20)}return this.superclass.prototype.height.call(this,t)},width:function(t){if(void 0!==t){var e=this.component("child").bbox().toJson();t=Math.max(t,e.x+e.width+20)}return this.superclass.prototype.width.call(this,t)},stroke:function(t){var e=this.superclass.prototype.stroke.call(this,t);return void 0!==t&&this.component("header").elem.css("stroke",this.props.stroke),e},addChild:function(t,e){this.superclass.prototype.addChild.call(this,t,e),this.pool().invalidate()},removeChild:function(t){this.superclass.prototype.removeChild.call(this,t),this.pool().invalidate()},addSiblingBellow:function(t){_.isArray(t)||(t=[t]);var e=this.pool(),n=_.reduce(_.map(t,function(t){return t.height()}),function(t,e){return t+e},0),r=this.width(),i=this.left(),o=this.top()+this.height();e.createSpaceBellow(this,n),_.forEach(t,function(t){var s,a,p,h=t.component().bboxView().clone().toJson();t.component().reset(),
t.attr({width:r,left:i,top:o}),n=t.height(),o+=n,t.tree.pool=e,e.insert(t),t.children().each(function(t){var e=t.connectable().component();e&&e.dirty(!0)}),s=t.component().bboxView().toJson(),a=s.x-h.x,p=s.y-h.y,e.relocateLinks(a,p,t)}),e.invalidate(),this.refreshSnapper()},createSiblingAbove:function(t){var e=new Graph.shape.activity.Lane(t),n=this.paper(),r=this.pool();r.createSpaceAbove(this,e.height());var i=this.top()-e.height();e.attr({width:this.props.width,left:this.props.left,top:i}),e.tree.pool=r;var o=r.insert(e);return void 0!==o&&(e.render(n,"before",this.component()),r.invalidate(),this.refreshSnapper()),e},createSiblingBellow:function(t){var e=new Graph.shape.activity.Lane(t),n=this.paper(),r=this.pool();r.createSpaceBellow(this,e.height());var i=this.top()+this.height();e.attr({width:this.props.width,left:this.props.left,top:i}),e.tree.pool=r;var o=r.insert(e);return void 0!==o&&(e.render(n,"after",this.component()),r.invalidate(),this.refreshSnapper()),e},refreshSnapper:function(){
this.paper().snapper().refresh()},autoResize:function(){var t=this.component(),e=this.component("block");e.isSelected()&&e.deselect();var n=this.bbox().toJson(),r=t.bbox().toJson(),e=this.component("block"),i={top:20,bottom:20,left:40,right:20},o=_.extend({},n);r.y+i.top-n.y<i.top&&(o.y=r.y-i.top),r.x+i.left-n.x<i.left&&(o.x=r.x-i.left),n.x2-r.x2+i.right<i.right&&(o.x2=r.x2+i.right),n.y2-r.y2+i.bottom<i.bottom&&(o.y2=r.y2+i.bottom);var s=o.x-n.x,a=o.y-n.y,p=o.x2-o.x,h=o.y2-o.y,c=this.pool(),l=(this.guid(),c.populateChildren()),u={};l.each(function(t){var e=t.component("child").bboxView().toJson();u[t.guid()]={x:e.x,y:e.y}}),this.translate(s,a),this.attr({width:p,height:h}),c.resizeBy(this),l.each(function(t){var e=t.component("child"),n=e.bboxView().toJson(),r=u[t.guid()];if(r){var i=r.x-n.x,o=r.y-n.y;e.translate(i,o).commit()}})},toString:function(){return"Graph.shape.activity.Lane"},toJson:function(){var t=this.superclass.prototype.toJson.call(this);return t.props.pool=this.pool().guid,
t},onAfterDestroy:function(){var t=this,e=this.guid();t.cascade(function(t){t.guid()!=e&&t.remove()}),this.pool().remove(this),this.component("child").remove(),this.component("label").remove(),this.component("header").remove(),this.component("shape").remove();for(var n in this.components)this.components[n]=null;Graph.registry.shape.unregister(this),this.fire("afterdestroy")},onChildConnect:function(t){var e=t.source.parent(),n=t.target.parent();if(e&&n){var r=e.pool(),i=n.pool();r.guid!=i.guid&&t.link.type("message")}},onChildBeforeDestroy:function(t){this.superclass.prototype.onChildBeforeDestroy.call(this,t),this.pool().invalidate()},onSelect:function(t){var e=this,n=e.guid(),r=_.delay(function(){clearTimeout(r),r=null,e.cascade(function(t){if(t.guid()!=n){var e,r;if(e=t.draggable().component(),e&&e.deselect(),r=t.connectable().plugin()){var i=r.connections();_.forEach(i,function(t){t.link.deselect()})}}}),e.component("shape").addClass("shape-selected"),Graph.topic.publish("shape:select",{
shape:e})},0)},onBeforeDrag:function(t){if(t.master){this.fire(t),this.paper().diagram().capture();var e,n,r=this.pool().populateLinks();for(n in r.isolated)e=r.isolated[n].link,e.deselect();for(n in r.separated)e=r.separated[n].link,e.deselect()}},onAfterDrag:function(t){if(t.master){var e,n=this.component("block"),r=this.component("shape"),i=this.component("child"),o=n.matrix(),s=this.pool();n.reset(),r.matrix().multiply(o),r.attr("transform",r.matrix().toValue()),r.dirty(!0),i.dirty(!0),e=r.matrix(),this.data({left:e.props.e,top:e.props.f}),this.fire(t),s.relocateSiblings(this,t.dx,t.dy),s.refreshContents(),s.relocateLinks(t.dx,t.dy),s.refreshChildren(),this.refreshSnapper()}},onBeforeResize:function(t){this.resizing={childOffsets:{}};var e=this.component("child").bboxView().toJson(),n=this.pool().populateChildren(),r=this.resizing;n.each(function(t){var n=t.component("child"),i=n.bboxView().toJson();r.childOffsets[t.guid()]={x:i.x,y:i.y},i.x<e.x&&(e.x=i.x),e.x2<i.x2&&(e.x2=i.x2)});var i=t.resizer,o=t.direction,s={
x:e.x,y:e.y},a={top:10,left:40,right:10,bottom:10};switch(o){case"n":s.x=(e.x+e.x2)/2,s.y=e.y2-a.bottom;break;case"e":s.x=e.x+a.right,s.y=(e.y+e.y2)/2;break;case"s":s.x=(e.x+e.x2)/2,s.y=e.y+a.top;break;case"w":s.x=e.x2-a.left,s.y=(e.y+e.y2)/2;break;case"ne":s.x=e.x+a.right,s.y=e.y2-a.bottom;break;case"se":s.x=e.x+a.right,s.y=e.y+a.top;break;case"sw":s.x=e.x2-a.left,s.y=e.y+a.top;break;case"nw":s.x=e.x2-a.left,s.y=e.y2-a.bottom}var p=e.x2-e.x,h=e.y2-e.y;p<=0&&(p=200),h<=0&&(h=100),i.restrict({width:p,height:h,origin:s})},onAfterResize:function(t){this.superclass.prototype.onAfterResize.call(this,t);var e=this.pool();if(e.resizeBy(this),this.resizing){var n=e.populateChildren(),r=this.resizing;n.each(function(t){var e=t.component("child"),n=e.bboxView().toJson(),i=r.childOffsets[t.guid()];if(i){var o=i.x-n.x,s=i.y-n.y;e.translate(o,s).commit()}}),this.resizing=r=null}},onAboveToolClick:function(t){this.createSiblingAbove()},onBelowToolClick:function(t){this.createSiblingBellow()},onUpToolClick:function(t){
this.pool().moveUp(this),this.refreshSnapper()},onDownToolClick:function(t){this.pool().moveDown(this),this.refreshSnapper()}})}(),function(){var t=Graph.shape.activity.Pool=function(){this.guid="pool-"+ ++t.guid,this.lanes=new Graph.collection.Tree([]).keygen(function(t){return t.bbox.y}),this.cached={nodes:{},contents:null}};t.prototype.invalidate=function(){this.cached.contents=null},t.prototype.populateChildren=function(){var t=[];return _.forEach(this.lanes.toArray(),function(e){var n=Graph.registry.shape.get(e.lane);t.push(n)}),new Graph.collection.Shape(t)},t.prototype.bbox=function(){for(var t,e=this.lanes.toArray(),n=[],r=[],i=[],o=[],s=e.length-1;s>=0;s--)t=e[s].bbox,n.push(t.x),r.push(t.y),i.push(t.x+t.width),o.push(t.y+t.height);return n=_.min(n),r=_.min(r),i=_.max(i),o=_.max(o),e=null,Graph.bbox({x:n,y:r,x2:i,y2:o,width:i-n,height:o-r})},t.prototype.get=function(t){var e=this.lanes.get(t);return e?Graph.registry.shape.get(e.lane):null},t.prototype.prev=function(t){var e=this.index(t),n=this.lanes.get(e-1);
return n?Graph.registry.shape.get(n.lane):null},t.prototype.last=function(){var t=this.size()-1,e=this.lanes.get(t);return e?Graph.registry.shape.get(e.lane):null},t.prototype.createSpaceAbove=function(t,e){var n=this.index(t),r=this.lanes.get(n-1),i=this;r&&(this.lanes.bubble(r,function(t){var n=Graph.registry.shape.get(t.lane);n&&(n.translate(0,-e),t.bbox=n.bbox().toJson(),n.children().each(function(t){var e=t.connectable().component();e&&e.dirty(!0)}),i.relocateLinks(0,-e,n))}),this.lanes.order())},t.prototype.createSpaceBellow=function(t,e){var n=this.index(t),r=this.lanes.get(n+1),i=this;r&&(this.lanes.cascade(r,function(t){var n=Graph.registry.shape.get(t.lane);n&&(n.translate(0,e),t.bbox=n.bbox().toJson(),n.children().each(function(t){var e=t.connectable().component();e&&e.dirty(!0)}),i.relocateLinks(0,e,n))}),this.lanes.order())},t.prototype.relocateSiblings=function(t,e,n){var r=this.lanes.root(),i=t.guid();r&&this.lanes.cascade(r,function(r){if(r.lane==i)r.bbox=t.bbox().toJson();else{
var o=Graph.registry.shape.get(r.lane);o&&(o.translate(e,n),r.bbox=o.bbox().toJson())}})},t.prototype.resizeBy=function(t){var e=t.guid(),n=t.bbox().toJson(),r=this.lanes.root(),i=this.index(t);if(r){var o,s,a,p,h,c;o=this.lanes.get(i-1),s=this.lanes.get(i+1),a=0,h=0,p=0,c=0,o&&(a=n.x-o.bbox.x,h=n.y-(o.bbox.y+o.bbox.height)),s&&(p=n.x-s.bbox.x,c=n.y+n.height-s.bbox.y),this.lanes.cascade(r,function(t,r){if(t.lane==e)t.bbox=n;else{var o=Graph.registry.shape.get(t.lane);if(o){var s=(o.component(),o.component("block"));i>r?o.translate(a,h):i<r&&o.translate(p,c),s.attr({width:n.width}),s.dirty(!0),o.refresh(),t.bbox=o.bbox().toJson()}}})}n=null},t.prototype.bringToFront=function(t){var e=Graph.$('[data-pool="'+this.guid+'"]'),n=e.last();n.length()&&n.node()!=t.component().node()&&n.after(t.component().elem)},t.prototype.moveUp=function(t){var e=this.index(t),n=this.get(e-1),r=this.lanes.get(e),i=this.lanes.get(e-1);if(n){var o=t.bbox().toJson(),s=n.bbox().toJson(),a=0,p=s.y-o.y,h=0,c=o.height;
r.bbox.y+=p,r.bbox.y2+=p,i.bbox.y+=c,i.bbox.y2+=c,t.translate(a,p),n.translate(h,c),this.lanes.order(),t.children().each(function(t){var e=t.connectable().component();e&&e.dirty(!0)}),n.children().each(function(t){var e=t.connectable().component();e&&e.dirty(!0)}),this.relocateLinks(a,p,t),this.relocateLinks(h,c,n)}},t.prototype.moveDown=function(t){var e=this.index(t),n=this.get(e+1),r=this.lanes.get(e),i=this.lanes.get(e+1);if(n){var o=t.bbox().toJson(),s=n.bbox().toJson(),a=0,p=s.height,h=0,c=o.y-s.y;r.bbox.y+=p,r.bbox.y2+=p,i.bbox.y+=c,i.bbox.y2+=c,t.translate(a,p),n.translate(h,c),this.lanes.order(),t.children().each(function(t){var e=t.connectable().component();e&&e.dirty(!0)}),n.children().each(function(t){var e=t.connectable().component();e&&e.dirty(!0)}),this.relocateLinks(a,p,t),this.relocateLinks(h,c,n)}},t.prototype.refreshChildren=function(){var t=this.populateChildren();t.each(function(t){t.component("child").dirty(!0)})},t.prototype.populateContents=function(t){var e;return void 0!==t?e=new Graph.collection.Shape(t.children().toArray()):(e=this.cached.contents,
e||(e=[],_.forEach(this.lanes.toArray(),function(t){var n=Graph.registry.shape.get(t.lane);n&&(e=_.concat(e,n.children().toArray()))}),e=new Graph.collection.Shape(e),this.cached.contents=e)),e},t.prototype.refreshContents=function(){var t=this.populateContents();t.each(function(t){var e=t.connectable().component();e&&e.dirty(!0)})},t.prototype.populateLinks=function(t){var e=this,n=e.populateContents(t),r=n.keys(),i={isolated:{},separated:{}};return n.each(function(t){var e,n,o=t.connectable().plugin(),s=o&&o.connections()||[];_.forEach(s,function(t){e=Graph.registry.vector.get("incoming"==t.type?t.source:t.target),e&&(n=Graph.registry.shape.get(e),n&&(_.indexOf(r,n.guid())>-1?i.isolated[t.guid]||(i.isolated[t.guid]=t):i.separated[t.guid]||(i.separated[t.guid]=t)))})}),i},t.prototype.relocateLinks=function(t,e,n){var r,i,o=this.populateLinks(n);for(r in o.isolated)i=o.isolated[r],i.link.invalidate("convex"),i.link.relocate(t,e);for(r in o.separated)i=o.separated[r],i.link.invalidate("convex"),
"incoming"==i.type?i.link.relocateHead(t,e):(i.link.invalidate("convex"),i.link.relocateTail(t,e));o=null},t.prototype.size=function(){return this.lanes.size()},t.prototype.insert=function(t){var e,n,r=t.guid();return e={lane:r,bbox:t.bbox().toJson()},n=this.lanes.insert(e),void 0!==n&&(this.cached.nodes[r]=e,t.component().elem.attr("data-pool",this.guid)),e=null,n},t.prototype.remove=function(t){var e=t.guid(),n=this.cached.nodes[e],r=this.lanes.remove(n);if(void 0!==r){var i=(this.lanes.get(r-1),this.lanes.get(r)),o=this;if(i){var s=0,a=-n.bbox.height;this.lanes.cascade(i,function(t){var e=Graph.registry.shape.get(t.lane);e&&(e.translate(s,a),t.bbox=e.bbox().toJson(),e.children().each(function(t){var e=t.connectable().component();e&&e.dirty(!0)}),o.relocateLinks(s,a,e))}),this.lanes.order()}delete this.cached.nodes[e]}return n=null,r},t.prototype.index=function(t){var e=t.guid(),n=this.cached.nodes[e],r=this.lanes.index(n);return n=null,r},t.guid=0}(),function(){Graph.shape.common.Label=Graph.extend(Graph.shape.Shape,{
props:{label:"untitled",align:"left",fontSize:16,lineHeight:1.1},metadata:{type:"common.label",icon:"ion-android-create"},initComponent:function(){var t,e,n,r=this.plugins.manager;t=new Graph.svg.Group(this.props.left,this.props.top).selectable(!1),e=new Graph.svg.Rect(0,0,0,0,0).data("text",this.props.label).render(t),e.style({fill:"rgba(255,255,255,0)","stroke-width":0}),e.elem.data(Graph.string.ID_SHAPE,this.guid()),r.install("dragger",e,{cls:Graph.styles.SHAPE_DRAG}),r.install("editor",e,{width:300,height:75,align:"left",offset:"pointer"}),e.on("edit.shape",_.bind(this.onLabelEdit,this)),e.on("afterdrag.shape",_.bind(this.onAfterDrag,this)),e.on("select.shape",_.bind(this.onSelect,this)),e.on("deselect.shape",_.bind(this.onDeselect,this)),e.on("beforedestroy.shape",_.bind(this.onBeforeDestroy,this)),e.on("afterdestroy.shape",_.bind(this.onAfterDestroy,this)),n=new Graph.svg.Text(0,this.props.lineHeight*this.props.fontSize,this.props.label).attr("font-size",this.props.fontSize).attr("text-anchor",this.props.align).clickable(!1).selectable(!1).render(t),
n.on("render.shape",_.bind(this.onLabelRender,this)),_.assign(this.components,{shape:t.guid(),block:e.guid(),label:n.guid()})},initMetadata:function(){this.metadata.tools=[{name:"sendtofront",icon:Graph.icons.SEND_TO_FRONT,title:Graph._("Send to front"),enabled:!0,handler:_.bind(this.onFrontToolClick,this)},{name:"sendtoback",icon:Graph.icons.SEND_TO_BACK,title:Graph._("Send to back"),enabled:!0,handler:_.bind(this.onBackToolClick,this)},{name:"trash",icon:Graph.icons.TRASH,title:Graph._("Click to remove shape"),enabled:!0,handler:_.bind(this.onTrashToolClick,this)}]},refresh:_.debounce(function(){if(!this.layout.suspended){var t=this.component("label"),e=this.component("block");t.write(this.props.label),t.dirty(!0);var n=t.bbox().toJson();e.attr({width:n.width}),e.dirty(!0)}},1),toString:function(){return"Graph.shape.common.Label"},onLabelRender:function(){var t=this.component("label"),e=this.component("block"),n=t.bbox().toJson();e.attr({width:n.width,height:n.height})},onLabelEdit:function(t){
var e=t.text;e?(this.component("label").props.text=e,this.props.label=e,this.refresh()):this.remove()},onAfterDrag:function(t){var e,n=this.component("block"),r=this.component("shape"),i=n.matrix();n.reset(),r.matrix().multiply(i),r.attr("transform",r.matrix().toValue()),r.dirty(!0),e=r.matrix(),this.data({left:e.props.e,top:e.props.f}),this.fire(t)},onSelect:function(t){this.component().addClass("label-selected"),t.initial&&Graph.topic.publish("shape:select",{shape:this})},onDeselect:function(t){this.component().removeClass("label-selected"),t.initial&&Graph.topic.publish("shape:deselect",{shape:this})}})}(),function(){function t(t){var e=encodeURIComponent(t);return e=e.replace(/%([0-9A-F]{2})/g,function(t,e){var n=String.fromCharCode("0x"+e);return"%"===n?"%25":n}),decodeURIComponent(e)}function e(t,e){if(navigator.msSaveOrOpenBlob){var r=n(e);navigator.msSaveOrOpenBlob(r,t),r=null}else{var i=Graph.dom("<a/>");"download"in i?(i.download=t,i.href=e,i.style.display="none",document.body.appendChild(i),
i.click(),document.body.removeChild(i)):window.open(e,"_download","menubar=no,toolbar=no,status=no"),i=null}}function n(t){for(var e=window.atob(t.split(",")[1]),n=t.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(e.length),i=new Uint8Array(r),o=0,s=e.length;o<s;o++)i[o]=e.charCodeAt(o);return new Blob([r],{type:n})}function r(t,e,n){var r=o(t,e),i=new Image;i.onload=function(){var t,r,o;t=document.createElement("canvas"),t.width=i.width,t.height=i.height,r=t.getContext("2d"),e.background&&(r.fillStyle=e.background,r.fillRect(0,0,t.width,t.height)),r.drawImage(i,0,0);try{o=t.toDataURL(e.encoder,e.compression)}catch(t){o=!1}t=r=null,n(o)},i.onerror=function(){n(!1)},i.src=r}function i(t,e){var n,r,i,o,p=Graph.dom("<div/>"),h=t.cloneNode(!0);"svg"==h.tagName?(h.setAttribute("width",e.width),h.setAttribute("height",e.height)):(i=Graph.dom("<svg/>"),i.setAttribute("xmlns",Graph.config.xmlns.svg),i.setAttribute("xmlns:xlink",Graph.config.xmlns.xlink),i.setAttribute("version",Graph.config.svg.version),
i.setAttribute("width",e.width),i.setAttribute("height",e.height),i.appendChild(h),h=i),p.appendChild(h),n=s(t),r=Graph.dom("<style/>"),r.setAttribute("type","text/css"),r.innerHTML="<![CDATA[\n"+n+"\n]]>";var c=h.childNodes[0];return c?h.insertBefore(r,c):h.appendChild(r),o=a+p.innerHTML,p=h=null,o}function o(e,n){var r=i(e,n),o="data:image/svg+xml;base64,"+window.btoa(t(r));return o}function s(t){for(var e,n,r,i=document.styleSheets,o="",s=0,a=i.length;s<a;s++)if(e=i[s].cssRules,null!=e)for(var p=0,h=e.length;p<h;p++,r=null)if(n=e[p],void 0!==n.style&&n.selectorText)try{r=t.querySelector(n.selectorText),r?o+=n.selectorText+" { "+n.style.cssText+" }\n":n.cssText.match(/^@font-face/)&&(o+=n.cssText+"\n")}catch(t){continue}return o}var a='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd" [<!ENTITY nbsp "&#160;">]>',p=Graph.data.Exporter=function(t,e){this.options=_.extend({},p.defaults,e||{}),this.element=t.node();
var n,r,i,o;t.isPaper()?(n=t.viewport().bbox().toJson(),i=Math.max(n.y+n.height+100,t.elem.height()),r=Math.max(n.x+n.width,t.elem.width()),o=t.layout().scale()):(n=t.bbox().toJson(),r=n.width,i=n.height,o=t.matrixCurrent().scale()),_.assign(this.options,{width:r,height:i,scaleX:o.x,scaleY:o.y})};p.defaults={width:0,height:0,scaleX:1,scaleY:1},p.prototype.exportDataURI=function(){},p.prototype.exportSVG=function(t,e){var n=_.extend({},this.options);n.encoder="application/svg+xml",n.compression=1,n.background="#ffffff";var r,i=o(this.element,n),s=document.createElement("a");s.setAttribute("download",t),s.setAttribute("href",i),document.createEvent?(r=document.createEvent("MouseEvents"),r.initEvent("click",!0,!1),s.dispatchEvent(r)):document.createEventObject&&s.fireEvent("onclick"),s=r=null},p.prototype.exportJPEG=function(t,n){var i=_.extend({},this.options);i.encoder="image/jpeg",i.compression=n||1,i.background="#ffffff",t=_.defaultTo(t,"download.jpg"),r(this.element,i,function(n){n&&e(t,n);
})},p.prototype.exportPNG=function(t,n){var i=_.extend({},this.options);t=_.defaultTo(t,"download.png"),i.encoder="image/png",i.compression=n||.8,r(this.element,i,function(n){n&&e(t,n)})},p.prototype.exportFile=function(t){var e=_.extend({},this.options);e.encoder="image/jpeg",e.compression=1,e.background="#ffffff",r(this.element,e,function(e){if(e){var r=n(e);t&&t(r)}else t&&t(!1)})},p.prototype.exportBlob=function(t){var e=_.extend({},this.options);e.encoder="image/jpeg",e.compression=1,e.background="#ffffff",r(this.element,e,function(e){if(e){var r=n(e);t&&t(r)}else t&&t(!1)})}}(),function(){Graph.diagram.Manager=Graph.extend({props:{paper:null,defaultType:"activity"},pallets:[],diagram:null,snapshoot:[],constructor:function(t){this.props.paper=t.guid(),t.on("keynavdown",_.bind(this.onKeynavDown,this))},paper:function(){return Graph.registry.vector.get(this.props.paper)},deselectAll:function(){this.paper().collector().clearCollection()},removeSelection:function(){var t=this.paper().collector().collection.toArray().slice();
this.capture(),_.forEach(t,function(t){t.remove()})},capture:function(){this.diagram},undo:function(){this.snapshoot.length&&this.diagram.render(this.snapshoot[0])},redo:function(){},addPallet:function(t){var e=this,n=e.paper(),r=n.layout(),i=r.scale(),o=null;e.pallets.push(t),t.on({pick:function(s){n.tool().activate("panzoom"),e.diagram||e.create(e.props.defaultType);var a=r.pointerLocation({clientX:s.origin.x,clientY:s.origin.y}),p={left:a.x,top:a.y},h=e.diagram.drawShape(s.shape,p);h.movable?(o=h.shape,i=n.layout().scale(),o.component("block").dirty(!0),o.component().dirty(!0)):(o=null,t.stopPicking())},drag:function(t){if(o){var e=t.dx,n=t.dy;e/=i.x,n/=i.y,i.x<1&&(e+=i.x),o.translate(e,n)}},drop:function(t){o&&(o=null)}})},current:function(){return this.diagram},remove:function(){this.diagram&&(this.diagram.remove(),this.diagram=null,this.paper().fire("diagram.destroy"))},create:function(t,e,n){t=_.defaultTo(this.props.defaultType);var r=Graph.diagram.type[_.capitalize(t)],i=this.paper();
return this.diagram=Graph.factory(r,[i,e]),n=_.defaultTo(n,!1),n||i.fire("diagram.create",{diagram:this.diagram}),this.diagram},saveAsImage:function(t,e){var n=new Graph.data.Exporter(this.paper());switch(t){case"svg":n.exportSVG(e);break;case"png":n.exportPNG(e);break;case"jpg":case"jpeg":n.exportJPEG(e)}n=null},saveAsFile:function(t){var e=new Graph.data.Exporter(this.paper());e.exportFile(t),e=null},saveAsBlob:function(t){var e=new Graph.data.Exporter(this.paper());return e.exportBlob(t)},onKeynavDown:function(t){switch(t.keyCode){case Graph.event.DELETE:this.removeSelection(),t.preventDefault()}}})}(),function(){function t(e,n,r){var i,o;for(i in e)o=e[i],r(n[o.index],o.index,o.total),void 0!==o.children&&t(o.children,n,r)}var e=Graph.diagram.Parser=function(t){t=t||{},this._props=t.props||{},this._shapes=t.shapes||[],this._links=t.links||[],this._tree={},this.parse()};e.prototype.constructor=e,e.prototype.parse=function(){var t=this._shapes,e={},n={},r=t.length;_.forEach(t,function(t,e){
n[t.props.id]={id:t.props.id,parent_id:t.props.parent_id,index:e,total:r}});var i,o;for(i in n)o=n[i],o.parent_id?(void 0===n[o.parent_id].children&&(n[o.parent_id].children={}),n[o.parent_id].children[o.id]=o):e[i]=o;this._tree=e},e.prototype.shapes=function(){var e=this._shapes,n=this._tree;return{total:e.length,each:function(r){t(n,e,r)}}},e.prototype.links=function(){var t=this._links;return{total:t.length,each:function(e){_.forEach(t,e)}}},e.prototype.props=function(){var t=this._props;return{each:function(e){_.forOwn(t,e)}}},e.prototype.destroy=function(){this._shapes=null,this._links=null,this._tree=null,this._props=null}}(),function(){var t=Graph.diagram.pallet.Activity=Graph.extend({props:{guid:null,rendered:!1},components:{pallet:null},cached:{},picking:{enabled:!1,target:null,matrix:null,shape:null,begin:!1,start:null},constructor:function(e){_.assign(this.props,e||{}),this.props.guid="pallet-"+ ++t,this.initComponent(),Graph.registry.pallet.register(this)},guid:function(){return this.props.guid;
},initComponent:function(){var t,e;t=_.format('<svg class="graph-pallet" xmlns="{0}" xmlns:xlink="{1}" version="{2}" style="width: 100%; height: 100%"><defs><marker id="marker-arrow-pallet" refX="11" refY="10" viewBox="0 0 20 20" markerWidth="10" markerHeight="10" orient="auto"><path d="M 1 5 L 11 10 L 1 15 Z" fill="#30D0C6" stroke-linecap="round" stroke-dasharray="10000, 1"/></marker></defs><g class="graph-pallet-item" data-shape="Graph.shape.activity.Start" transform="matrix(1,0,0,1,40,0)"><circle cx="32" cy="32" r="30"/><text x="32" y="36">Start</text></g><g class="graph-pallet-item" data-shape="Graph.shape.activity.Final" transform="matrix(1,0,0,1,40,80)"><circle cx="32" cy="32" r="30"/><circle cx="32" cy="32" r="24" class="full"/><text x="32" y="36">End</text></g><g class="graph-pallet-item" data-shape="Graph.shape.activity.Action" transform="matrix(1,0,0,1,40,160)"><rect x="2" y="2" width="60" height="60" rx="7" ry="7"/><text x="32" y="34">Action</text></g><g class="graph-pallet-item" data-shape="Graph.shape.activity.Router" transform="matrix(1,0,0,1,40,250)"><rect x="4" y="4" width="54" height="54" transform="rotate(45,32,32)"/><text x="30" y="34">Route</text></g><g class="graph-pallet-item" data-shape="Graph.shape.activity.Join" transform="matrix(1,0,0,1,40,340)"><rect x="2" width="60" height="58" rx="0" ry="0" style="fill: rgba(255,255,255,0); stroke-width: 0" /><rect x="2" y="28" width="60" height="6" rx="0" ry="0" pointer-events="none" class="full"/><path d="M 10  0 L 10 28" pointer-events="none" ></path><path d="M 54  0 L 54 28" pointer-events="none" ></path><path d="M 32 34 L 32 60" marker-end="url(#marker-arrow-pallet)" pointer-events="none" ></path><text x="32" y="20">Join</text></g><g class="graph-pallet-item" data-shape="Graph.shape.activity.Fork" transform="matrix(1,0,0,1,40,420)"><rect x="2" width="60" height="58" rx="0" ry="0" pointer-events="none" style="fill: rgba(255,255,255,0); stroke-width: 0" /><rect x="2" y="28" width="60" height="6" rx="0" ry="0" class="full"/><path d="M 10 34 L 10 60" marker-end="url(#marker-arrow-pallet)" pointer-events="none" ></path><path d="M 54 34 L 54 60" marker-end="url(#marker-arrow-pallet)" pointer-events="none" ></path><path d="M 32  0 L 32 28" pointer-events="none" ></path><text x="32" y="50">Fork</text></g><g class="graph-pallet-item" data-shape="Graph.shape.activity.Lane" transform="matrix(1,0,0,1,40,500)"><rect x="2" y="2" width="60" height="60" rx="0" ry="0"/><rect x="2" y="2" width="10" height="60" rx="0" ry="0"/><text x="32" y="34">Role</text></g></svg>',Graph.config.xmlns.svg,Graph.config.xmlns.xlink,Graph.config.svg.version),
e=Graph.$(t),this.components.pallet=e},stopPicking:function(){this.picking.enabled&&(this.picking.target.remove(),_.assign(this.picking,{target:null,matrix:null,offset:null,enabled:!1,shape:null,start:!1}))},render:function(t){function e(t){var e=Graph.$(t.currentTarget);if(i.picking.enabled&&r(t),void 0!==e.data("shape")){var n=Graph.util.transform2segments(e.attr("transform"));n=n[0].slice(1),i.picking.enabled=!0,i.picking.matrix=Graph.factory(Graph.lang.Matrix,n),i.picking.target=Graph.$(t.currentTarget.cloneNode(!0)),i.picking.target.addClass("grabbing"),i.picking.shape=e.data("shape"),o.append(i.picking.target),i.fire("pick",{shape:i.picking.shape,origin:{x:t.clientX,y:t.clientY}}),n=null}}function n(t){var e=t.interaction;if(e.pointerIsDown&&i.picking.target){t.preventDefault();var n={x:t.clientX,y:t.clientY};i.picking.offset||(i.picking.offset=n);var r=n.x-i.picking.offset.x,o=n.y-i.picking.offset.y;i.picking.matrix.translate(r,o),i.picking.target.attr("transform",i.picking.matrix.toValue()),
i.fire("drag",{dx:r,dy:o}),i.picking.offset=n}}function r(t){i.picking.enabled&&i.fire("drop",{clientX:t.clientX,clientY:t.clientY}),i.stopPicking()}if(!this.props.rendered){var i=this,o=this.components.pallet;this.props.rendered=!0,t=Graph.$(t),t.prepend(o),t=null,interact(".graph-pallet-item").on("down",function(t){e(t)}).on("move",function(t){n(t)}).on("up",function(t){r(t)}),o.on("mouseleave",function(t){r(t)})}},toString:function(){return"Graph.diagram.pallet.Activity"}});t.guid=0}(),function(){Graph.diagram.type.Diagram=Graph.extend({props:{id:null,paper:null,dirty:!1},drawing:{enabled:!1},metadata:{type:"diagram.diagram"},constructor:function(t,e){e=e||{},_.assign(this.props,e),this.props.paper=t.guid(),this.empty()},update:function(t){var e=this,n=new Graph.diagram.Parser(t);e.paper();n.props().each(function(t,n){"type"!=n&&(e.props[n]=t)}),n.shapes().each(function(t){var n;n=t.props.id?e.getShapeBy(function(e){return e.props.id==t.props.id}):e.getShapeBy(function(e){return e.props.guid==t.props.client_id;
}),n&&n.update(t)}),n.links().each(function(t){var n;n=t.props.id?e.getLinkBy(function(e){return e.props.id==t.props.id}):e.getLinkBy(function(e){return e.props.guid==t.props.client_id})}),n.destroy(),n=null},commit:function(){return this.props.dirty=!1,this},render:function(t){},paper:function(){return Graph.registry.vector.get(this.props.paper)},empty:function(){var t=this.getShapes();return this.paper().snapper().invalidate(),t.each(function(t){t.tree.parent||t.remove()}),t=null,this},getShapes:function(){var t=this.paper().guid(),e=Graph.registry.shape.collect(t);return new Graph.collection.Shape(e)},getLinks:function(){var t,e,n,r,i,o,s=this.getShapes().toArray(),a={},p=[];for(n=0,r=s.length;n<r;n++)if(t=s[n].connectable().plugin())for(e=t.connections(),i=0,o=e.length;i<o;i++)void 0===a[e[i].guid]&&(p.push(e[i].link),a[e[i].guid]=!0);return a=null,new Graph.collection.Link(p)},drawShape:function(t,e){},findShapeBy:function(t){var e=this.getShapes().toArray();return _.filter(e,t)},getShapeBy:function(t){
var e=this.getShapes().toArray();return _.find(e,t)},getLinkBy:function(t){},remove:function(){this.empty(),this.fire("afterdestroy")},toJson:function(){var t={};return t}})}(),function(){Graph.diagram.type.Activity=Graph.extend(Graph.diagram.type.Diagram,{props:{name:"Activity Diagram",description:"No diagram description",cover:null},rendering:{active:!1},metadata:{type:"diagram.activity"},drawShape:function(t,e){var n=this.paper();this.drawing.dragging&&(this.drawing.dragging=!1,this.drawing.shape.off("beforedrag",this.drawing.beforeDrag),this.drawing.shape.off("aferdrag",this.drawing.afterDrag),this.drawing.beforeDrag=null,this.drawing.afterDrag=null,this.drawing.shape.remove(),this.drawing.shape=null);var r,i,o;if(e=e||{},o=!0,"Graph.shape.activity.Lane"==t){var s=this.getShapes();if(s.size()&&!this.hasLane()){var a=s.bbox().toJson();e.left=a.x-40,e.top=a.y-20,o=!1,a=null}s=null}else"Graph.shape.common.Label"==t&&(o=!1);r=Graph.ns(t),i=Graph.factory(r,[e]),o&&(o=!!i.draggable().plugin());
var p=this;if(this.drawing.beforeDrag=function(t){i.component().addClass("picking")},this.drawing.afterDrag=function(){var t;t=_.delay(function(e){var n=!1;if(clearTimeout(t),t=null,e.is("activity.lane"))n=!0;else if(p.hasLane()){var r=e.parent();n=r&&r.is("activity.lane")}else n=!0;n||(Graph.message("Can't drop shape outside lane or pool","warning"),e.remove(),e=null)},0,p.drawing.shape),i.component().removeClass("picking"),p.drawing.beforeDrag=null,p.drawing.afterDrag=null,p.drawing.dragging=!1,p.drawing.shape=null},o){this.drawing.dragging=!0,this.drawing.shape=i,i.render(n);var h=i.draggable().plugin(),c=i.snappable().component();if(h.start(),void 0!==e.left&&void 0!==e.top){var l=i.center(),u=e.left-l.x,d=e.top-l.y;i.translate(u,d),c&&c.dirty(!0)}i.one("beforedrag",this.drawing.beforeDrag),i.one("afterdrag",this.drawing.afterDrag)}else if(p.drawing.dragging=!1,p.drawing.shape=null,p.drawing.beforeDrag=null,p.drawing.afterDrag=null,i.is("activity.lane")){var f=p.getShapes().toArray();
i.render(n),i.addChild(f),f=null}else if(i.is("common.label")){p.findShapeBy(function(t){return t.is("activity.lane")}),{x:i.props.left,y:i.props.top};i.render(n)}return{movable:o,shape:i}},hasLane:function(){return 0!==this.findShapeBy(function(t){return t.is("activity.lane")}).length},render:function(t){function e(t){var e=Graph.defer(),n={},i={},o=0,s=0;return t.shapes().each(function(t,a,p){var h,c,l=t.props,u=Graph.ns(l.type);c=_.delay(function(t,s){if(clearTimeout(c),c=null,h=Graph.factory(t,[s]),h.render(r),s.client_pool&&(void 0===i[s.client_pool]&&(i[s.client_pool]=[]),i[s.client_pool].push(h)),void 0!==n[s.parent_id]){n[s.parent_id].addChild(h,!1);var a=h.connectable().component();a&&a.dirty(!0)}if(n[s.id]=h,o++,o===p){var l,u,d;for(u in i)l=i[u],d=null,l.length>1&&_.forEach(l,function(t,e){d?(t.tree.pool=d,d.insert(t)):d=t.pool()}),d&&d.invalidate();e.resolve(n)}},100*s,u,l),s++}),e.promise()}var n=this,r=this.paper(),i=new Graph.diagram.Parser(t);this.rendering.active||(this.rendering.active=!0,
this.empty(),i.props().each(function(t,e){n.props[e]=t}),e(i).then(function(t){i.links().each(function(e){var n=e.props,r=t[n.source_id],i=t[n.target_id];if(r&&i){var o=r.connectable().plugin(),s=i.connectable().plugin();o&&s&&o.connect(s,null,null,e.props)}}),n.rendering.active=!1,i.destroy(),i=null,n.paper().snapper().refresh()}))},toString:function(){return"Graph.diagram.type.Activity"},toJson:function(){var t={props:{id:this.props.id,name:this.props.name,type:this.toString(),description:this.props.description,cover:this.props.cover},shapes:[],links:[]},e=this.getShapes(),n=this.getLinks();return e.each(function(e){var n=e.toJson();t.shapes.push({props:n.props,params:n.params})}),n.each(function(e){var n=e.toJson();t.links.push({props:n.props,params:n.params})}),e=n=null,t}})}(),function(){Graph.popup.Dialog=Graph.extend({props:{opened:!1},components:{element:null,backdrop:null},handlers:{backdrop_click:null},constructor:function(t,e){var n=this,r=n.components,i=n.handlers;r.element=Graph.$(t),
e.buttons&&_.forEach(e.buttons,function(t,e){var o=Graph.$(t.element,r.element);if(o.length()){var s="button"+e,a=s+"_click";r[s]=o,_.isFunction(t.onclick)&&(i[a]=_.bind(function(e){t.onclick.call(n,e)},n),o.on("click",i[a])),s=a=null}o=null})},element:function(){return this.components.element},open:function(){this.props.opened||(this.element().addClass("open"),this.props.opened=!0,this.center(),this.backdrop())},close:function(){var t=this.components,e=this.handlers,n=t.backdrop;if(this.element().removeClass("open"),this.props.opened=!1,e.backdrop_click){n.off("click",e.backdrop_click),e.backdrop_click=null;var r=+n.data("user");r--,r<=0&&(r=0,n.detach()),n.data("user",r)}_.forOwn(e,function(n,r){var i=_.split(r,"_"),o=i[0],s=i[1];n&&t[o]&&s&&(t[o].off(s,n),e[r]=null),i=o=s=null}),this.fire("close")},center:_.debounce(function(){var t=this.element(),e=t.width(),n=t.height();t.css({top:"50%",left:"50%","margin-top":-n/2,"margin-left":-e/2})},0),backdrop:function(){var t=this,e=Graph.$(".graph-dialog-backdrop");
e.length()||(e=Graph.$('<div class="graph-dialog-backdrop"/>'),e.data("user",0),e.on("click",function(t){t.stopPropagation()})),t.handlers.backdrop_click=function(){t.close()},e.on("click",t.handlers.backdrop_click);var n=+e.data("user");n++,e.data("user",n),t.components.element.before(e),t.components.backdrop=e},toString:function(){return"Graph.popup.Dialog"},destroy:function(){this.components.element=null}}),Graph.dialog=function(t,e){return new Graph.popup.Dialog(t,e)}}();
//# sourceMappingURL=graph.min.js.map
