!function(){_.float=parseFloat,_.gcd=function(t){if(2===t.length){for(var e,n=t[0],r=t[1];r>0;)e=r,r=n%r,n=e;return n}var i,o=t[0],s=t.length;for(i=1;i<s;i++)o=_.gcd([o,t[i]]);return o},_.lcm=function(t){if(2===t.length){var e=t[0],n=t[1];return e*(n/_.gcd([e,n]))}var r,i=t[0],o=t.length;for(r=1;r<o;r++)i=_.lcm([i,t[r]]);return i},_.format=function(){var t=_.toArray(arguments),e=t.shift();return e.replace(/{(\d+)}/g,function(e,n){return"undefined"!=typeof t[n]?t[n]:e})},_.insert=function(t,e,n){return Array.prototype.splice.apply(t,[e,0].concat(n)),t},_.move=function(t,e,n){for(var r=t.length;e<0;)e+=r;for(;n<0;)n+=r;if(n>=r)for(var i=n-r;i--+1;)t.push(void 0);return t.splice(n,0,t.splice(e,1)[0]),t},_.permute=function(t,e){return _.isFunction(e)?_.reduce(t,function(t,n,r){return t[e(r,n)]=n,t},[]):_.isArray(e)?_.reduce(e,function(n,r,i){return n[i]=t[e[i]],n},[]):t},_.bisector=function(t){return{left:function(e,n,r,i){for(arguments.length<3&&(r=0),arguments.length<4&&(i=e.length);r<i;){
var o=r+i>>>1;t.call(e,e[o],o)<n?r=o+1:i=o}return r},right:function(e,n,r,i){for(arguments.length<3&&(r=0),arguments.length<4&&(i=e.length);r<i;){var o=r+i>>>1;n<t.call(e,e[o],o)?i=o:r=o+1}return r}}},_.ascendingKey=function(t){return"function"==typeof t?function(e,n){return t(e)<t(n)?-1:t(e)>t(n)?1:t(e)>=t(n)?0:NaN}:function(e,n){return e[t]<n[t]?-1:e[t]>n[t]?1:e[t]>=n[t]?0:NaN}},_.isIE=function(){var t=global.navigator,e=(t&&t.userAgent||"").toLowerCase(),n=e.indexOf("MSIE ");return!!(n>0||e.match(/Trident.*rv\:11\./))&&parseInt(e.substring(n+5,e.indexOf(".",n)))}}(),function(){var t="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")(),e=(document,100),n=1e3,r=[];t.Graph=function(t){r.push(t)},Graph.VERSION="1.0.0",Graph.AUTHOR="Kreasindo Cipta Teknologi",Graph.cached={},Graph.config={base:"./",svg:{version:"1.1"},xmlns:{svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",html:"http://www.w3.org/1999/xhtml"
},font:{family:"Segoe UI",size:"12px",line:1}},Graph.setup=function(t,e){_.isPlainObject(t)?_.extend(Graph.config,t):Graph.config[t]=e},Graph.string={ID_VECTOR:"graph-vector-id",ID_LINK:"graph-link-id",ID_PORT:"graph-port-id",CLS_VECTOR_SVG:"graph-paper",CLS_VECTOR_RECT:"graph-elem graph-elem-rect",CLS_VECTOR_PATH:"graph-elem graph-elem-path",CLS_VECTOR_TEXT:"graph-elem graph-elem-text",CLS_VECTOR_LINE:"graph-elem graph-elem-line",CLS_VECTOR_GROUP:"graph-elem graph-elem-group",CLS_VECTOR_IMAGE:"graph-elem graph-elem-image",CLS_VECTOR_CIRCLE:"graph-elem graph-elem-circle",CLS_VECTOR_ELLIPSE:"graph-elem graph-elem-ellipse",CLS_VECTOR_POLYGON:"graph-elem graph-elem-polygon",CLS_VECTOR_POLYLINE:"graph-elem graph-elem-polyline",CLS_VECTOR_VIEWPORT:"graph-viewport",CLS_LINK_HEAD:"graph-link-head",CLS_LINK_TAIL:"graph-link-tail"},Graph.isHTML=function(t){return t instanceof HTMLElement},Graph.isSVG=function(t){return t instanceof SVGElement},Graph.isElement=function(t){return t instanceof Graph.dom.Element;
},Graph.isMac=function(){return/mac/i.test(navigator.platform)},Graph.ns=function(e){var n=Graph.lookup("Graph","ns",e);if(n.clazz)return n.clazz;var r,i,o=_.split(e,"."),s=t,a=o.length;for(i=0;i<a;i++)r=o[i],s[r]=s[r]||{},s=s[r];return _.isFunction(s)&&(n.clazz=s),s},Graph.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,n="x"==t?e:3&e|8;return n.toString(16)})},Graph.hash=function(t){var e,n,r,i=0;if(!t.length)return i;for(r=0,n=t.length;r<n;r++)e=t.charCodeAt(r),i=(i<<5)-i+e,i|=0;return i},Graph.create=function(t,e){},Graph.factory=function(t,e){return e=[t].concat(e),new(Function.prototype.bind.apply(t,e))},Graph.expand=function(t,e,n){var r=t.constructor.prototype,i=e.constructor.prototype;n=_.defaultTo(e),_.forOwn(i,function(t,e){_.isFunction(t)&&_.isUndefined(r[e])&&!function(t,e){r[t]=_.bind(e,n)}(e,t)})},Graph.extend=function(t,e){return _.isPlainObject(t)&&(e=t,t=Graph.lang.Class),t.extend(e)},Graph.mixin=function(t,e){
this.extend(t,e,t)},Graph.lookup=function(t,n){var r,i,o=_.toArray(arguments);return t=o.shift(),n=_.join(o,"|"),r=Graph.cached[t]=Graph.cached[t]||{},i="Regex.event"==t?null:e,r[n]?r[n].credit=i:r[n]={credit:i,remove:function(t,e){return function(){delete Graph.cached[t][e]}}(t,n)},_.debounce(function(t){_.forOwn(r,function(e,n){n!=t&&null!==r[n].credit&&(r[n].credit--,r[n].credit<=0&&delete r[n])})})(n),r[n]},Graph.memoize=function(t){return function e(){var r=_.toArray(arguments),i=_.join(r,"␀"),o=e.cache=e.cache||{},s=e.saved=e.saved||[];if(!_.isUndefined(o[i])){for(var a=0,p=s.length;a<p;a++)if(s[a]==i){s.push(s.splice(a,1)[0]);break}return o[i]}return s.length>=n&&delete o[s.shift()],s.push(i),o[i]=t.apply(this,r),o[i]}},Graph.defer=function(){return $.Deferred()},Graph.when=$.when,Graph.ns("Graph.lang"),Graph.ns("Graph.collection"),Graph.ns("Graph.registry"),Graph.ns("Graph.data"),Graph.ns("Graph.diagram"),Graph.ns("Graph.popup"),Graph.paper=function(t,e,n){return Graph.factory(Graph.svg.Paper,[t,e,n]);
},Graph.svg=function(t){var e,n=_.toArray(arguments);return t=n.shift(),e=Graph.factory(Graph.svg[_.capitalize(t)],n),n=null,e},Graph.shape=function(t,e){var n,r,i;return i=t.lastIndexOf("."),t=t.substr(0,i)+"."+_.capitalize(t.substr(i+1)),n=Graph.ns("Graph.shape."+t),r=Graph.factory(n,e),i=t=n=null,r},Graph.ns("Graph.shape.activity"),Graph.layout=function(t){},Graph.router=function(t){},Graph.link=function(t){},Graph.plugin=function(t){},Graph.topic={subscribers:{},topics:{},publish:function(t,e,n){var r=Graph.topic.subscribers,i=r[t]||[];_.forEach(i,function(t){!function(){t.call(null,e,n)}(t)})},subscribe:function(t,e){if(_.isPlainObject(t)){var n=[];return _.forOwn(t,function(t,e){!function(t,e){var r=Graph.topic.subscribe(t,e);n.push({topic:t,sub:r})}(e,t)}),{unsubscribe:function(t){return function(e){if(e){var n=_.find(t,function(t){return t.topic==e});n&&n.sub.unsubscribe()}else _.forEach(t,function(t){t.sub.unsubscribe()})}}(n)}}var r=Graph.topic.subscribers;return r[t]=r[t]||[],
r[t].push(e),{unsubscribe:function(t,e){return function(){Graph.topic.unsubscribe(t,e)}}(t,e)}},unsubscribe:function(t,e){for(var n=Graph.topic.subscribers,r=n[t]||[],i=r.length-1;i>=0;i--)r[i]===e&&r.splice(i,1)}},function(t,e){var n,i=function(){t.removeEventListener(e,i,!1),t.readyState="complete"},o=function(){_.forEach(r,function(t){t()})},s=function(){"complete"!=t.readyState?n=_.delay(function(){clearTimeout(n),n=null,s()},10):o()};null==t.readyState&&t.addEventListener&&(t.addEventListener(e,i,!1),t.readyState="loading"),s()}(document,"DOMContentLoaded")}(),function(){var t=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,e=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/gi,n=/,?([achlmqrstvxz]),?/gi,r=/(\-?[0-9.]+)\s*,\s*(\-?[0-9.]+)/g,i=/((matrix|translate|rotate|scale|skewX|skewY)*\((\-?\d+\.?\d*e?\-?\d*[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+\))+/g,o=/[\w\.\-]+/g,r=/(\-?[0-9.]+)\s*,\s*(\-?[0-9.]+)/g,s=10,a=6,p=12,h=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],c=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472];
Graph.util={deg:function(t){return Math.round(180*t/Math.PI%360*1e3)/1e3},rad:function(t){return t%360*Math.PI/180},angle:function(t,e){var n=t.x-e.x,r=t.y-e.y;return n||r?(180+180*Math.atan2(-r,-n)/Math.PI+360)%360:0},theta:function(t,e){var n,r,i=-(e.y-t.y),o=e.x-t.x;return n=0==i.toFixed(10)&&0==o.toFixed(10)?0:Math.atan2(i,o),n<0&&(n=2*Math.PI+n),r=180*n/Math.PI,r=r%360+(r<0?360:0)},taxicab:function(t,e){var n=t.x-e.x,r=t.y-e.y;return n*n+r*r},hypo:function(t,e){return Math.sqrt(t*t+e*e)},sign:function(t){return t<0?-1:1},quadrant:function(t,e){return t>=0&&e>=0?1:t>=0&&e<0?4:t<0&&e<0?3:2},gradient:function(t,e){return e.x==t.x?e.y>t.y?1/0:-(1/0):e.y==t.y?e.x>t.x?0:-0:(e.y-t.y)/(e.x-t.x)},snapValue:function(t,e,n){if(n=_.defaultTo(n,10),_.isArray(e)){for(var r=e.length;r--;)if(Math.abs(e[r]-t)<=n)return e[r]}else{e=+e;var i=t%e;if(i<n)return t-i;if(i>t-n)return t-i+e}return t},pointbox:function(t,e,n){_.isPlainObject(t)&&(n=e,e=t.y,t=t.x),n=n||0;var r=t-n,i=e-n,o=t+n,s=e+n,a=o-r,p=s-i;
return{x:r,y:i,x2:o,y2:s,width:a,height:p}},pointAlign:function(t,e,n){return!(!t||!e)&&(n=n||2,Math.abs(t.x-e.x)<=n?"h":Math.abs(t.y-e.y)<=n&&"v")},pointDistance:function(t,e){return t&&e?Graph.util.hypo(t.x-e.x,t.y-e.y):-1},isPointEquals:function(t,e){return t.x==e.x&&t.y==e.y},isPointOnLine:function(t,e,n){if(!t||!e||!n)return!1;var r=(e.x-t.x)*(n.y-t.y)-(e.y-t.y)*(n.x-t.x),i=Graph.util.pointDistance(t,e);return Math.abs(r/i)<2},polar2point:function(t,e,n){var r,i,o;return _.isUndefined(n)&&(n=Graph.point(0,0)),r=Math.abs(t*Math.cos(e)),i=Math.abs(t*Math.sin(e)),o=Graph.util.deg(e),o<90?i=-i:o<180?(r=-r,i=-i):o<270&&(r=-r),Graph.point(n.props.x+r,n.props.y+i)},isBoxContainsPoint:function(t,e){return e.x>=t.x&&e.x<=t.x2&&e.y>=t.y&&e.y<=t.y2},isBoxIntersect:function(t,e){var n=Graph.util.isBoxContainsPoint;return n(e,{x:t.x,y:t.y})||n(e,{x:t.x2,y:t.y})||n(e,{x:t.x,y:t.y2})||n(e,{x:t.x2,y:t.y2})||n(t,{x:e.x,y:e.y})||n(t,{x:e.x2,y:e.y})||n(t,{x:e.x,y:e.y2})||n(t,{x:e.x2,y:e.y2})||(t.x<e.x2&&t.x>e.x||e.x<t.x2&&e.x>t.x)&&(t.y<e.y2&&t.y>e.y||e.y<t.y2&&e.y>t.y);
},boxOrientation:function(t,e,n,r){n=_.defaultTo(n,0),r=_.defaultTo(r,n);var i=t.y2+r<=e.y,o=t.x-n>=e.x2,s=t.y-r>=e.y2,a=t.x2+n<=e.x,p=i?"top":s?"bottom":null,h=a?"left":o?"right":null;return h&&p?p+"-"+h:h||p||"intersect"},midpoint:function(t,e){return{x:(t.x+e.x)/2,y:(t.y+e.y)/2}},movepoint:function(t,e,n){var r=Graph.util.rad(Graph.util.theta(e,t)),i=Math.cos(r)*n,o=-Math.sin(r)*n;return t.x+=i,t.y+=o,t},lineBendpoints:function(t,e,n){var r,i,o=[],s=t.x,a=t.y,p=e.x,h=e.y;return n=n||"h:h","h:v"==n?o=[{x:p,y:a}]:"v:h"==n?o=[{x:s,y:h}]:"h:h"==n?(r=Math.round((p-s)/2+s),o=[{x:r,y:a},{x:r,y:h}]):"v:v"==n?(i=Math.round((h-a)/2+a),o=[{x:s,y:i},{x:p,y:i}]):o=[],o},lineIntersection:function(t,e,n,r,i,o,s,a){if(Math.max(t,n)<Math.min(i,s)||Math.min(t,n)>Math.max(i,s)||Math.max(e,r)<Math.min(o,a)||Math.min(e,r)>Math.max(o,a))return null;var p=(t*r-e*n)*(i-s)-(t-n)*(i*a-o*s),h=(t*r-e*n)*(o-a)-(e-r)*(i*a-o*s),c=(t-n)*(o-a)-(e-r)*(i-s);if(!c)return null;var l=p/c,u=h/c,d=+l.toFixed(2),f=+u.toFixed(2);
return d<+Math.min(t,n).toFixed(2)||d>+Math.max(t,n).toFixed(2)||d<+Math.min(i,s).toFixed(2)||d>+Math.max(i,s).toFixed(2)||f<+Math.min(e,r).toFixed(2)||f>+Math.max(e,r).toFixed(2)||f<+Math.min(o,a).toFixed(2)||f>+Math.max(o,a).toFixed(2)?null:{x:l,y:u}},perpendicular:function(t,e,n){var r,i,o,s;r=Graph.util.gradient(t,e),i=0===r?0:-1/r,o=Math.atan(i);var s=n*Math.cos(o),a=(t.x+e.x)/2,p=(t.y+e.y)/2,h=p-a*i,c=a+s,l=i*c+h;return{from:{x:a,y:p},to:{x:c,y:l}}},points2path:function(t){var e=_.map(t,function(t,e){var n=0===e?"M":"L";return[n,t.x,t.y]});return Graph.util.segments2path(e)},path2points:function(t){var e=Graph.util.path2segments(t);return _.map(e,function(t,e){return"M"==t[0]||"L"==t[0]?{x:t[1],y:t[2]}:{x:t[5],y:t[6]}})},segments2path:function(t){return _.join(t||[],",").replace(n,"$1")},path2segments:function(n){if(!n)return[];var r=Graph.lookup("Graph.util","path2segments",n),i={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},o=[];return r.segments?_.cloneDeep(r.segments):(n.replace(t,function(t,n,r){
var s=[],a=n.toLowerCase();if(r.replace(e,function(t,e){e&&s.push(+e)}),"m"==a&&s.length>2&&(o.push(_.concat([n],s.splice(0,2))),a="l",n="m"==n?"l":"L"),"r"==a)o.push(_.concat([n],s));else for(;s.length>=i[a]&&(o.push(_.concat([n],s.splice(0,i[a]))),i[a]););}),r.segments=_.cloneDeep(o),o)},polygon2dots:function(t){var e=[];return t.replace(r,function(t,n,r){e.push([_.float(n),_.float(r)])}),e},polygon2path:function(t){var e=Graph.util.polygon2dots(t);if(!e.length)return"M0,0";for(var t="M"+e[0][0]+","+e[0][1],n=1,r=e.length;n<r;n++)t+="L"+e[n][0]+","+e[n][1]+",";return t=t.substring(0,t.length-1),t+="Z"},transform2segments:Graph.memoize(function(t){var e={matrix:!0,translate:!0,rotate:!0,scale:!0,skewX:!0,skewY:!0};t+="";var n=[],r=t.match(i);return r&&_.forEach(r,function(t){var r=t.match(o),i=r.shift();e[i]&&(r=_.map(r,function(t){return+t}),n.push([i].concat(r)))}),n}),curvebox:Graph.memoize(function(t,e,n,r,i,o,s,a){var p=_.join(arguments,"_"),h=Graph.lookup("Graph.util","curvebox",p);
if(p=null,h.curvebox)return h.curvebox;for(var c,l,u,d,f,g,v,m,x=[],y=[[],[]],b=0;b<2;++b)if(0==b?(l=6*t-12*n+6*i,c=-3*t+9*n-9*i+3*s,u=3*n-3*t):(l=6*e-12*r+6*o,c=-3*e+9*r-9*o+3*a,u=3*r-3*e),Math.abs(c)<1e-12){if(Math.abs(l)<1e-12)continue;d=-u/l,0<d&&d<1&&x.push(d)}else v=l*l-4*u*c,m=Math.sqrt(v),v<0||(f=(-l+m)/(2*c),0<f&&f<1&&x.push(f),g=(-l-m)/(2*c),0<g&&g<1&&x.push(g));for(var G,w=x.length,C=w;w--;)d=x[w],G=1-d,y[0][w]=G*G*G*t+3*G*G*d*n+3*G*d*d*i+d*d*d*s,y[1][w]=G*G*G*e+3*G*G*d*r+3*G*d*d*o+d*d*d*a;return y[0][C]=t,y[1][C]=e,y[0][C+1]=s,y[1][C+1]=a,y[0].length=y[1].length=C+2,h.curvebox={min:{x:Math.min.apply(0,y[0]),y:Math.min.apply(0,y[1])},max:{x:Math.max.apply(0,y[0]),y:Math.max.apply(0,y[1])}},h.curvebox}),curveLength:function(t,e,n,r,i,o,s,a,l){l=_.defaultTo(l,1),l=l>1?1:l<0?0:l;for(var u=l/2,d=0,f=0;f<p;f++){var g=u*h[f]+u,v=Graph.util.curvePolynom(g,t,n,i,s),m=Graph.util.curvePolynom(g,e,r,o,a),x=v*v+m*m;d+=c[f]*Math.sqrt(x)}return u*d},curvePolynom:function(t,e,n,r,i){var o=-3*e+9*n-9*r+3*i,s=t*o+6*e-12*n+6*r;
return t*s-3*e+3*n},curveInterval:function(t,e,n,r,i,o,s,a,p){if(!(p<0||Graph.util.curveLength(t,e,n,r,i,o,s,a)<p)){var h,c=1,l=c/2,u=c-l,d=.01;for(h=Graph.util.curveLength(t,e,n,r,i,o,s,a,u);Math.abs(h-p)>d;)l/=2,u+=(h<p?1:-1)*l,h=Graph.util.curveLength(t,e,n,r,i,o,s,a,u);return u}},pointAtInterval:function(t,e,n,r,i,o,s,a,p){var h=1-p,c=Math.pow(h,3),l=Math.pow(h,2),u=p*p,d=u*p,f=c*t+3*l*p*n+3*h*p*p*i+d*s,g=c*e+3*l*p*r+3*h*p*p*o+d*a,v=t+2*p*(n-t)+u*(i-2*n+t),m=e+2*p*(r-e)+u*(o-2*r+e),x=n+2*p*(i-n)+u*(s-2*i+n),y=r+2*p*(o-r)+u*(a-2*o+r),b=h*t+p*n,G=h*e+p*r,_=h*i+p*s,w=h*o+p*a,C=90-180*Math.atan2(v-x,m-y)/Math.PI;return C=90-180*Math.atan2(x-v,y-m)/Math.PI,{x:f,y:g,m:{x:v,y:m},n:{x:x,y:y},start:{x:b,y:G},end:{x:_,y:w},alpha:C}},curveIntersection:function(t,e,n){var r=Graph.util.curvebox.apply(null,t),i=Graph.util.curvebox.apply(null,e),o=0,s=[],a={x:r.min.x,y:r.min.y,x2:r.max.x,y2:r.max.y},p={x:i.min.x,y:i.min.y,x2:i.max.x,y2:i.max.y};if(!Graph.util.isBoxIntersect(a,p))return n?0:[];var h,c,l,u,d=Graph.util.curveLength.apply(null,t),f=Graph.util.curveLength.apply(null,e),g=~~(d/10),v=~~(f/10),m=[],x=[],y={};
for(h=0;h<g+1;h++)l=h/g,u=Graph.util.pointAtInterval.apply(null,t.concat([l])),m.push({x:u.x,y:u.y,t:l});for(h=0;h<v+1;h++)l=h/v,u=Graph.util.pointAtInterval.apply(null,e.concat([l])),x.push({x:u.x,y:u.y,t:l});for(h=0;h<g;h++)for(c=0;c<v;c++){var b=m[h],G=m[h+1],_=x[c],w=x[c+1],C=Math.abs(G.x-b.x)<.001?"y":"x",k=Math.abs(w.x-_.x)<.001?"y":"x",S=Graph.util.lineIntersection(b.x,b.y,G.x,G.y,_.x,_.y,w.x,w.y);if(S){if(y[S.x.toFixed(4)]==S.y.toFixed(4))continue;y[S.x.toFixed(4)]=S.y.toFixed(4);var M=b.t+Math.abs((S[C]-b[C])/(G[C]-b[C]))*(G.t-b.t),T=_.t+Math.abs((S[k]-_[k])/(w[k]-_[k]))*(w.t-_.t);M>=0&&M<=1.001&&T>=0&&T<=1.001&&(o++,s.push({x:S.x,y:S.y,t1:M,t2:T}))}}return n?o:s},convexSegment:function(t,e,n,r){if(!e||!n||!t)return null;var i=Graph.util.pointDistance(t,e),o=Graph.util.pointDistance(t,n);if(r=r||s,i>r&&o>r){var a,p=Graph.util.movepoint({x:t.x,y:t.y},e,-r/2),h=Graph.util.movepoint({x:t.x,y:t.y},n,-r/2),c=Graph.util.pointAlign(e,n,r/2);return"h"==c?a={x:t.x-r,y:t.y}:(p.y=e.y,h.y=n.y,
a={x:t.x,y:t.y-r}),[["L",p.x,p.y],["Q",a.x,a.y,h.x,h.y]]}return null},smoothSegment:function(t,e,n,r){if(!e||!n||!t)return null;var i=Graph.util.pointDistance(t,e),o=Graph.util.pointDistance(t,n);if(r=r||a,i>r&&o>r){var s=Graph.util.movepoint({x:t.x,y:t.y},e,-r),p=Graph.util.movepoint({x:t.x,y:t.y},n,-r);return[["L",s.x,s.y],["Q",t.x,t.y,p.x,p.y]]}return null}}}(),function(){var t=Graph.lang.Error=function(t){this.message=t;var e=new Error;this.stack=e.stack,e=null};Object.setPrototypeOf(t,Error),t.prototype=Object.create(Error.prototype),t.prototype.name="Graph.lang.Error",t.prototype.message="",t.prototype.constructor=t,Graph.error=function(t){return new Graph.lang.Error(t)}}(),function(t,e){var n=Graph.lang.Event=function(t,e){this.type=t,this.init(e)};n.toString=function(){return"function(type, data)"},t.extend(n.prototype,{cancelBubble:!1,defaultPrevented:!1,propagationStopped:!1,immediatePropagationStopped:!1,originalData:null,init:function(e){e&&(this.originalData=e,t.assign(this,e||{}));
},stopPropagation:function(){this.cancelBubble=this.propagationStopped=!0},stopImmediatePropagation:function(){this.immediatePropagationStopped=this.propagationStopped=!0},preventDefault:function(){this.defaultPrevented=!0},toString:function(){return"Graph.lang.Event"}}),Graph.event=function(t,e){return new Graph.lang.Event(t,e)},t.extend(Graph.event,{ESC:27,ENTER:13,DELETE:46,SHIFT:16,fix:function(t){return e.event.fix(t)},original:function(t){return t.originalEvent||t},position:function(t){return{x:t.clientX,y:t.clientY}},relative:function(t,e){var n=Graph.event.position(t),r=e.matrix().clone().invert(),i={x:r.x(n.x,n.y),y:r.y(n.x,n.y)};return r=null,i},isPrimaryButton:function(t){var e=Graph.event.original(t);return!e.button},hasPrimaryModifier:function(t){if(!Graph.event.isPrimaryButton(t))return!1;var e=Graph.event.original(t);return Graph.isMac()?e.metaKey:e.ctrlKey},hasSecondaryModifier:function(t){var e=Graph.event.original(t);return Graph.event.isPrimaryButton(t)&&e.shiftKey}});
}(_,jQuery),function(){var t=!1,e=Graph.lang.Class=function(){};e.extend=function(n){var r,i,o,a,p;r=this.prototype,p={},t=!0,i=Object.create(r),t=!1;var o;for(o in n)a=n[o],_.isFunction(a)?i[o]=a:(i[o]=a,p[o]=a);var h,c;return _.isUndefined(i.constructor)||(c=i.constructor,delete i.constructor),h=function(){var e,n,r=this;r.listeners={};var i=r.constructor.defaults,o=r.superclass.defaults,s={};if(o)for(e in o)r[e]=_.cloneDeep(o[e]),s[e]=!0;if(i)for(e in i)n=_.cloneDeep(i[e]),s[e]?(_.isPlainObject(n)||_.isArray(n))&&_.assign(r[e],n):r[e]=n;s=o=i=null,t||c&&c.apply(r,arguments)},h.init=c,h.extend=e.extend,h.defaults=p,h.prototype=i,h.prototype.constructor=h,h.prototype.superclass=r.constructor,h.prototype.$super=function(){var t,n,r,i=h.prototype.$super,o=this.constructor;if(t=i&&i.caller?i.caller:arguments.callee.caller){if(n=t.$super,!n&&(r=e.closest(t,o))){var s=r.proto,a=r.key;n=s.superclass.prototype[a],t.$super=n}return n?n.apply(this,arguments):void 0}},h.prototype.on=function(t,e,n){
var r,i=this;if(_.isPlainObject(t))return _.forOwn(t,function(t,e){if(_.isPlainObject(t)){var n=t;t=n.handler,s=n.once,i.on(e,t,s)}else i.on(e,t,!1)}),i;var o=_.split(t,"."),a=o.shift();return i.listeners[a]=i.listeners[a]||[],n=_.defaultTo(n,!1),r={type:t,once:n,orig:e,func:_.bind(e,this)},i.listeners[a].push(r),this},h.prototype.one=function(t,e){var n=this;return _.isPlainObject(t)?(_.forOwn(t,function(t,e){n.on(e,t,!0)}),n):n.on(t,e,!0)},h.prototype.off=function(t,e){var n,r,i,o;n=_.split(t,"."),r=n.shift(),i=r?(this.listeners[r]||[]).slice():[];var s=Graph.lookup("Regex.event",t);if(s.rgex?o=s.rgex:(o=new RegExp(_.escapeRegExp(t),"i"),s.rgex=o),i.length)for(var a=i.length-1;a>=0;a--)e?o.test(i[a].type)&&i[a].orig===e&&this.listeners[r].splice(a,1):o.test(i[a].type)&&this.listeners[r].splice(a,1);else{var p=this;for(r in p.listeners)!function(t){for(var n=t.length-1;n>=0;n--)e?o.test(t[n].type)&&t[n].orig===e&&t.splice(n,1):o.test(t[n].type)&&t.splice(n,1)}(p.listeners[r])}return o=null,
i=null,this},h.prototype.fire=function(t,e){var n,r,i,o,s,a=(h.prototype.fire,[]);_.isString(t)?n=new Graph.lang.Event(t,e):(n=t,n.originalData=n.originalData||{},t=n.originalType||n.type),n.publisher=this,a.push(n),r=_.split(t,"."),i=r.shift(),o=this.listeners[i]||[];var p=Graph.lookup("Regex.event",t);p.rgex?s=p.rgex:(s=new RegExp(_.escapeRegExp(t),"i"),p.rgex=s);var c=[];if(o.length)for(var l=0,u=o.length;l<u;l++)i!=t?s.test(o[l].type)&&(o[l].once&&c.push(o[l]),o[l].func.apply(o[l].func,a)):(o[l].once&&c.push(o[l]),o[l].func.apply(o[l].func,a));if(c.length){var d=this;_.forEach(c,function(t){d.off(t.type,t.orig)})}return s=null,n},h},e.closest=function(t,n){var r,i=n.prototype;if(t===n.init){if(r=!!i.superclass&&t===i.superclass.init,!r)return{proto:i,key:"constructor"}}else for(var o in i)if(i[o]===t&&(r=!!i.superclass&&i[o]===i.superclass.prototype[o],!r))return{proto:i,key:o};return i.superclass?e.closest(t,i.superclass):null}}(),function(){function t(t,e){return e*Math.round(t/e);
}var e=Graph.lang.Point=Graph.extend({props:{x:0,y:0},constructor:function(t,e){var n;_.isPlainObject(t)?(n=t,t=n.x,e=n.y):_.isString(t)&&(n=_.split(_.trim(t),","),t=_.toNumber(n[0]),e=_.toNumber(n[1])),this.props.x=t,this.props.y=e},x:function(t){return _.isUndefined(t)?this.props.x:(this.props.x=t,this)},y:function(t){return _.isUndefined(t)?this.props.y:(this.props.y=t,this)},distance:function(t){var e=this.props.x-t.props.x,n=this.props.y-t.props.y;return Math.sqrt(Math.pow(n,2)+Math.pow(e,2))},manhattan:function(t){return Math.abs(t.props.x-this.props.x)+Math.abs(t.props.y-this.props.y)},angle:function(t){return Graph.util.angle(a.toJson(),t.toJson())},triangle:function(t,e){return this.angle(e)-t.angle(e)},theta:function(t){return Graph.util.theta(this.toJson(),t.toJson())},difference:function(t){return new Graph.lang.Point(this.props.x-t.props.x,this.props.y-t.props.y)},alignment:function(t){return Graph.util.pointAlign(this.toJson(),t.toJson())},bbox:function(){var t=this.props.x,e=this.props.y;
return Graph.bbox({x:t,y:e,x2:t,y2:e,width:0,height:0})},bearing:function(t){var e=new Graph.lang.Line(this,t),n=e.bearing();return e=null,n},snap:function(e,n){return n=_.defaultTo(n,e),this.props.x=t(this.props.x,e),this.props.y=t(this.props.y,n),this},move:function(t,e){var n=Graph.util.rad(t.theta(this));return this.expand(Math.cos(n)*e,-Math.sin(n)*e),this},expand:function(t,e){return this.props.x+=t,this.props.y+=e,this},round:function(t){return this.props.x=t?this.props.x.toFixed(t):Math.round(this.props.x),this.props.y=t?this.props.y.toFixed(t):Math.round(this.props.y),this},equals:function(t){return this.props.x==t.props.x&&this.props.y==t.props.y},rotate:function(t,e){var n=Graph.util.rad(t),r=this.props.x-(e?e.props.x:0),i=this.props.y-(e?e.props.y:0),o=Math.sin(n),s=Math.cos(n),a=r*s+i*o,p=r*-o+i*s;return this.props.x=this.props.x+a,this.props.y=this.props.y+p,this},transform:function(t){var e=this.props.x,n=this.props.y;return this.props.x=t.x(e,n),this.props.y=t.y(e,n),this;
},comply:function(t){},polar:function(){},adhereToBox:function(t){return t.contains(this)?this:(this.props.x=Math.min(Math.max(this.props.x,t.props.x),t.props.x+t.props.width),this.props.y=Math.min(Math.max(this.props.y,t.props.y),t.props.y+t.props.height),this)},stringify:function(t){return t=_.defaultTo(t,","),this.props.x+t+this.props.y},toString:function(){return this.stringify()},toJson:function(){return{x:this.props.x,y:this.props.y}},clone:function(){return new e(this.props.x,this.props.y)}});Graph.lang.Point.toString=function(){return"function(x, y)"},Graph.isPoint=function(t){return t instanceof Graph.lang.Point},Graph.point=function(t,e){return new Graph.lang.Point(t,e)}}(),function(){Graph.lang.Line=Graph.extend({props:{start:{x:0,y:0},end:{x:0,y:0}},constructor:function(){var t,e,n=_.toArray(arguments);4===n.length?(_.assign(this.props.start,{x:n[0],y:n[1]}),_.assign(this.props.end,{x:n[2],y:n[3]}),t=Graph.point(n[0],n[1]),e=Graph.point(n[2],n[3])):(this.props.start=n[0].toJson(),
this.props.end=n[1].toJson(),t=n[0],e=n[1])},start:function(){return Graph.point(this.props.start.x,this.props.start.y)},end:function(){return Graph.point(this.props.end.x,this.props.end.y)},bearing:function(){var t=["NE","E","SE","S","SW","W","NW","N"],e=this.props.start.x,n=this.props.start.y,r=this.props.end.x,i=this.props.end.y,o=Graph.util.rad(n),s=Graph.util.rad(i),a=e,p=r,h=Graph.util.rad(p-a),c=Math.sin(h)*Math.cos(s),l=Math.cos(o)*Math.sin(s)-Math.sin(o)*Math.cos(s)*Math.cos(h);return index=Graph.util.deg(Math.atan2(c,l))-22.5,index<0&&(index+=360),index=parseInt(index/45),t[index]},intersect:function(t){return null!==this.intersection(t)},intersection:function(t,e){var n=this.props.start.x,r=this.props.start.y,i=this.props.end.x,o=this.props.end.y,s=t.props.start.x,a=t.props.start.y,p=t.props.end.x,h=t.props.end.y,c=Graph.util.lineIntersection(n,r,i,o,s,a,p,h);return c?e?c:Graph.point(c.x,c.y):c},toString:function(){return"Graph.lang.Line"}}),Graph.lang.Line.toString=function(){
return"function(from, to)"},Graph.line=function(t){var e=_.toArray(arguments);return Graph.factory(Graph.lang.Line,e)}}(),function(){Graph.lang.Curve=Graph.extend({segments:[],constructor:function(t){if(this.segments=_.isString(t)?Graph.util.path2segments(t):_.cloneDeep(t),"M"!=this.segments[0][0]&&this.segments.unshift(["M",this.segments[0][1],this.segments[0][2]]),1===this.segments.length&&"M"===this.segments[0][0]){var e=this.segments[0][1],n=this.segments[0][2];this.segments.push(["C",e,n,e,n,e,n])}},x:function(){return this.segments[1][5]},y:function(){return this.segments[1][6]},length:function(t){var e=this.segments[0].slice(1).concat(this.segments[1].slice(1)).concat([t]);return Graph.util.curveLength.apply(null,e)},t:function(t){var e=this.segments[0].slice(1).concat(this.segments[1].slice(1)).concat([t]);return Graph.util.curveInterval.apply(null,e)},pointAt:function(t,e){var n=this.segments[0].slice(1).concat(this.segments[1].slice(1)).concat([t]),r=Graph.util.pointAtInterval.apply(null,n);
if(e)return r;var i=Graph.point(r.x,r.y);return r.x=r.y=void 0,_.extend(i,r)},intersection:function(t,e){var n=this.segments[0].slice(1).concat(this.segments[1].slice(1)),r=t.segments[0].slice(1).concat(t.segments[1].slice(1)),i=Graph.util.curveIntersection(n,r);if(e)return i;var o=_.map(i,function(t){return Graph.point(t.x,t.y)});return o},intersectnum:function(t){var e=this.segments[0].slice(1).concat(this.segments[1].slice(1)),n=t.segments[0].slice(1).concat(t.segments[1].slice(1));return Graph.util.curveIntersection(e,n,!0)},bbox:function(){var t=[this.segments[0][1],this.segments[0][2]].concat(this.segments[1].slice(1)),e=Graph.util.curvebox.apply(null,t);return Graph.bbox({x:e.min.x,y:e.min.y,x2:e.max.x,y2:e.max.y,width:e.max.x-e.min.x,height:e.max.y-e.min.y})},clone:function(){var t=_.cloneDeep(this.segments);return new Graph.lang.Curve(t)},toString:function(){return Graph.util.segments2path(this.segments)}}),Graph.lang.Curve.toString=function(){return"function(command)"},Graph.curve=function(t){
return new Graph.lang.Curve(t)}}(),function(){var t=Graph.lang.BBox=Graph.extend({props:{x:0,y:0,x2:0,y2:0,width:0,height:0},constructor:function(t){this.props=_.cloneDeep(t)},data:function(t,e){return void 0===t&&void 0===e?this.props:void 0===e?this.props[t]:null},pathinfo:function(){var t=this.props;return new Graph.lang.Path([["M",t.x,t.y],["l",t.width,0],["l",0,t.height],["l",-t.width,0],["z"]])},origin:function(){var t=this.props.x,e=this.props.y;return Graph.point(t,e)},center:function(t){var e=this.props.x+this.props.width/2,n=this.props.y+this.props.height/2;return t?{x:e,y:n}:Graph.point(e,n)},corner:function(){var t=this.props.x+this.props.width,e=this.props.y+this.props.height;return Graph.point(t,e)},width:function(){return this.props.width},height:function(){return this.props.height},clone:function(){var e=_.extend({},this.props);return new t(e)},contains:function(t){var e,n=!0,r=this.props,i=[];if(Graph.isPoint(t))i=[[t.props.x,t.props.y]];else if(Graph.isVector(t))i=t.dots(!0);else if(Graph.isBBox(t))i=[[t.props.x,t.props.y],[t.props.x2,t.props.y2]];else{
var o=_.toArray(arguments);2===o.length&&(i=[o])}if(i.length)for(var s=i.length;s--&&(e=i[s],n=e[0]>=r.x&&e[0]<=r.x2&&e[1]>=r.y&&e[1]<=r.y2););return n},expand:function(t,e,n,r){var i,o;return _.isUndefined(e)?(i=Math.abs(t),t=-i,e=-i,n=2*i,r=2*i):(i=Math.abs(t),o=Math.abs(e),t=-i,e=-o,n=2*i,r=2*o),this.props.x+=t,this.props.y+=e,this.props.width+=n,this.props.height+=r,this},transform:function(t){var e=this.props.x,n=this.props.y;this.props.x=t.x(e,n),this.props.y=t.y(e,n),e=this.props.x2,n=this.props.y2,this.props.x2=t.x(e,n),this.props.y2=t.y(e,n);var r=t.scale();return this.props.width*=r.x,this.props.height*=r.y,this},intersect:function(t){var e=this,n=e.props,r=t.toJson();return t.contains(n.x,n.y)||t.contains(n.x2,n.y)||t.contains(n.x,n.y2)||t.contains(n.x2,n.y2)||e.contains(r.x,r.y)||e.contains(r.x2,r.y)||e.contains(r.x,r.y2)||e.contains(r.x2,r.y2)||(n.x<r.x2&&n.x>r.x||r.x<n.x2&&r.x>n.x)&&(n.y<r.y2&&n.y>r.y||r.y<n.y2&&r.y>n.y)},sideNearestPoint:function(t){var e=t.props.x,n=t.props.y,r=this.props.x,i=this.props.y,o=this.props.width,s=this.props.height,a=e-r,p=r+o-e,h=n-i,c=i+s-n,l=a,u="left";
return p<l&&(l=p,u="right"),h<l&&(l=h,u="top"),c<l&&(l=c,u="bottom"),u},pointNearestPoint:function(t){if(this.contains(t)){var e=this.sideNearestPoint(t);switch(e){case"right":return Graph.point(this.props.x+this.props.width,t.props.y);case"left":return Graph.point(this.props.x,t.props.y);case"bottom":return Graph.point(t.props.x,this.props.y+this.props.height);case"top":return Graph.point(t.props.x,this.props.y)}}return t.clone().adhereToBox(this)},toJson:function(){return this.props}});Graph.lang.BBox.toString=function(){return"function(bounds)"},Graph.isBBox=function(t){return t instanceof Graph.lang.BBox},Graph.bbox=function(t){return new Graph.lang.BBox(t)}}(),function(){function t(t,e,o){var s,a,p={T:1,Q:1};if(!t)return["C",e.x,e.y,e.x,e.y,e.x,e.y];switch(!(t[0]in p)&&(e.qx=e.qy=null),t[0]){case"M":e.X=t[1],e.Y=t[2];break;case"A":t=["C"].concat(i.apply(0,[e.x,e.y].concat(t.slice(1))));break;case"S":"C"==o||"S"==o?(s=2*e.x-e.bx,a=2*e.y-e.by):(s=e.x,a=e.y),t=["C",s,a].concat(t.slice(1));
break;case"T":"Q"==o||"T"==o?(e.qx=2*e.x-e.qx,e.qy=2*e.y-e.qy):(e.qx=e.x,e.qy=e.y),t=["C"].concat(r(e.x,e.y,e.qx,e.qy,t[1],t[2]));break;case"Q":e.qx=t[1],e.qy=t[2],t=["C"].concat(r(e.x,e.y,t[1],t[2],t[3],t[4]));break;case"L":t=["C"].concat(n(e.x,e.y,t[1],t[2]));break;case"H":t=["C"].concat(n(e.x,e.y,t[1],e.y));break;case"V":t=["C"].concat(n(e.x,e.y,e.x,t[1]));break;case"Z":t=["C"].concat(n(e.x,e.y,e.X,e.Y))}return t}function e(t,e){for(var n=[],r=_.defaultTo,i=0,o=t.length;o-2*!e>i;i+=2){var s=[{x:r(t[i-2],0),y:r(t[i-1],0)},{x:r(t[i],0),y:r(t[i+1],0)},{x:r(t[i+2],0),y:r(t[i+3],0)},{x:r(t[i+4],0),y:r(t[i+5],0)}];e?i?o-4==i?s[3]={x:r(t[0],0),y:r(t[1],0)}:o-2==i&&(s[2]={x:r(t[0],0),y:r(t[1],0)},s[3]={x:r(t[2],0),y:r(t[3],0)}):s[0]={x:r(t[o-2],0),y:r(t[o-1],0)}:o-4==i?s[3]=s[2]:i||(s[0]={x:r(t[i],0),y:r(t[i+1],0)}),n=[(-s[0].x+6*s[1].x+s[2].x)/6,(-s[0].y+6*s[1].y+s[2].y)/6,(s[1].x+6*s[2].x-s[3].x)/6,(s[1].y+6*s[2].y-s[3].y)/6,s[2].x,s[2].y]}return n}function n(t,e,n,r){return[t,e,n,r,n,r]}function r(t,e,n,r,i,o){
var s=1/3,a=2/3;return[s*t+a*n,s*e+a*r,s*i+a*n,s*o+a*r,i,o]}function i(t,e,n,r,o,s,a,p,h,c){var l,u=120*Math.PI/180,d=Math.PI/180*(+o||0),f=[],g=Graph.memoize(function(t,e,n){var r=t*Math.cos(n)-e*Math.sin(n),i=t*Math.sin(n)+e*Math.cos(n);return{x:r,y:i}});if(c)C=c[0],k=c[1],_=c[2],w=c[3];else{l=g(t,e,-d),t=l.x,e=l.y,l=g(p,h,-d),p=l.x,h=l.y;var v=(Math.cos(Math.PI/180*o),Math.sin(Math.PI/180*o),(t-p)/2),m=(e-h)/2,x=v*v/(n*n)+m*m/(r*r);x>1&&(x=Math.sqrt(x),n=x*n,r=x*r);var y=n*n,b=r*r,G=(s==a?-1:1)*Math.sqrt(Math.abs((y*b-y*m*m-b*v*v)/(y*m*m+b*v*v))),_=G*n*m/r+(t+p)/2,w=G*-r*v/n+(e+h)/2,C=Math.asin(((e-w)/r).toFixed(9)),k=Math.asin(((h-w)/r).toFixed(9));C=t<_?Math.PI-C:C,k=p<_?Math.PI-k:k,C<0&&(C=2*Math.PI+C),k<0&&(k=2*Math.PI+k),a&&C>k&&(C-=2*Math.PI),!a&&k>C&&(k-=2*Math.PI)}var S=k-C;if(Math.abs(S)>u){var M=k,T=p,E=h;k=C+u*(a&&k>C?1:-1),p=_+n*Math.cos(k),h=w+r*Math.sin(k),f=i(p,h,n,r,o,0,a,T,E,[k,M,_,w])}S=k-C;var z=Math.cos(C),P=Math.sin(C),D=Math.cos(k),L=Math.sin(k),R=Math.tan(S/4),A=4/3*n*R,I=4/3*r*R,O=[t,e],q=[t+A*P,e-I*z],N=[p+A*L,h-I*D],V=[p,h];
if(q[0]=2*O[0]-q[0],q[1]=2*O[1]-q[1],c)return[q,N,V].concat(f);f=[q,N,V].concat(f).join().split(",");for(var H=[],B=0,$=f.length;B<$;B++)H[B]=B%2?g(f[B-1],f[B],d).y:g(f[B],f[B+1],d).x;return H}function o(t,e,n){var r,i,o,s,a,p,h,c,l,u,d,f,g,v,m,x,y,b=t.curve().segments,G=b.length,_=e.curve().segments,w=_.length,C=n?0:[];for(m=0;m<G;m++)if(g=b[m],"M"==g[0])r=a=g[1],i=p=g[2];else for("C"==g[0]?(l=[["M",r,i],g],d=[r,i].concat(g.slice(1)),r=g[5],i=g[6]):(l=[["M",r,i],["C",r,i,a,p,a,a]],d=[r,i,r,i,a,p,a,p],r=a,i=p),x=0;x<w;x++)if(v=_[x],"M"==v[0])o=h=v[1],s=c=v[2];else if("C"==v[0]?(u=[["M",o,s],v],f=[o,s].concat(v.slice(1)),o=v[5],s=v[6]):(u=[["M",o,s],["C",o,s,h,c,h,c]],f=[o,s,o,s,h,c,h,c],o=h,s=c),n)C+=Graph.util.curveIntersection(d,f,!0);else{y=Graph.util.curveIntersection(d,f);for(var k=0,S=y.length;k<S;k++)y[k].segment1=m,y[k].segment2=x,y[k].bezier1=l,y[k].bezier2=u;C=C.concat(y)}return C}var s=Graph.lang.Path=Graph.extend({__CLASS__:"Graph.lang.Path",segments:[],constructor:function(t){
var e=[];e=Graph.isPath(t)?_.cloneDeep(t.segments):_.isArray(t)?_.cloneDeep(t):_.cloneDeep(Graph.util.path2segments(t)),this.segments=e},command:function(){return Graph.util.segments2path(this.segments)},absolute:function(){if(!this.segments.length)return new s([["M",0,0]]);var t=Graph.lookup(this.__CLASS__,"absolute",this.toString()),n=this.segments;if(t.absolute)return t.absolute;var r=[],i=0,o=0,a=0,p=0,h=0;"M"==n[0][0]&&(i=+n[0][1],o=+n[0][2],a=i,p=o,h++,r[0]=["M",i,o]);for(var c,l,u,d=3==n.length&&"M"==n[0][0]&&"R"==n[1][0].toUpperCase()&&"Z"==n[2][0].toUpperCase(),f=h,g=n.length;f<g;f++){if(r.push(l=[]),u=n[f],u[0]!=_.toUpper(u[0]))switch(l[0]=_.toUpper(u[0]),l[0]){case"A":l[1]=u[1],l[2]=u[2],l[3]=u[3],l[4]=u[4],l[5]=u[5],l[6]=+(u[6]+i),l[7]=+(u[7]+o);break;case"V":l[1]=+u[1]+o;break;case"H":l[1]=+u[1]+i;break;case"R":c=_.concat([i,o],u.slice(1));for(var v=2,m=c.length;v<m;v++)c[v]=+c[v]+i,c[++v]=+c[v]+o;r.pop(),r=_.concat(r,[["C"].concat(e(c,d))]);break;case"M":a=+u[1]+i,p=+u[2]+o;
default:for(var x=1,y=u.length;x<y;x++)l[x]=+u[x]+(x%2?i:o)}else if("R"==u[0])c=_.concat([i,o],u.slice(1)),r.pop(),r=_.concat(r,[["C"].concat(e(c,d))]),l=_.concat(["R"],u.slice(-2));else for(var b=0,G=u.length;b<G;b++)l[b]=u[b];switch(l[0]){case"Z":i=a,o=p;break;case"H":i=l[1];break;case"V":o=l[1];break;case"M":a=l[l.length-2],p=l[l.length-1];default:i=l[l.length-2],o=l[l.length-1]}}return t.absolute=r=new s(r),r},start:function(){return this.pointAt(0)},end:function(){return this.pointAt(this.length())},head:function(){},tail:function(){},relative:function(){var t=Graph.lookup(this.__CLASS__,"relative",this.toString()),e=this.segments;if(t.relative)return t.relative;var n=[],r=0,i=0,o=0,a=0,p=0;"M"==e[0][0]&&(r=e[0][1],i=e[0][2],o=r,a=i,p++,n.push(["M",r,i]));for(var h=p,c=e.length;h<c;h++){var l=n[h]=[],u=e[h];if(u[0]!=_.toLower(u[0]))switch(l[0]=_.toLower(u[0]),l[0]){case"a":l[1]=u[1],l[2]=u[2],l[3]=u[3],l[4]=u[4],l[5]=u[5],l[6]=+(u[6]-r).toFixed(3),l[7]=+(u[7]-i).toFixed(3);break;case"v":
l[1]=+(u[1]-i).toFixed(3);break;case"m":o=u[1],a=u[2];default:for(var d=1,f=u.length;d<f;d++)l[d]=+(u[d]-(d%2?r:i)).toFixed(3)}else{l=res[h]=[],"m"==u[0]&&(o=u[1]+r,a=u[2]+i);for(var g=0,v=u.length;g<v;g++)res[h][g]=u[g]}var m=n[h].length;switch(n[h][0]){case"z":r=o,i=a;break;case"h":r+=+n[h][m-1];break;case"v":i+=+n[h][m-1];break;default:r+=+n[h][m-2],i+=+n[h][m-1]}}return t.relative=n=new s(n),n},curve:function(){function e(t,e){if(t[e].length>7){t[e].shift();for(var n=t[e];n.length;)o[e]="A",t.splice(e++,0,["C"].concat(n.splice(0,6)));t.splice(e,1),c=r.length}}var n=Graph.lookup(this.__CLASS__,"curve",this.toString());if(n.curve)return n.curve;for(var r=_.cloneDeep(this.absolute().segments),i={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},o=[],a="",p="",h=0,c=r.length;h<c;h++){r[h]&&(a=r[h][0]),"C"!=a&&(o[h]=a,h&&(p=o[h-1])),r[h]=t(r[h],i,p),"A"!=o[h]&&"C"==a&&(o[h]="C"),e(r,h);var l=r[h],u=l.length;i.x=l[u-2],i.y=l[u-1],i.bx=_.float(l[u-4])||i.x,i.by=_.float(l[u-3])||i.y}return n.curve=new s(r),
n.curve},curve2curve:function(e){function n(t,e){if(t[e].length>7){t[e].shift();for(var n=t[e];n.length;)h[e]="A",c[e]="A",t.splice(e++,0,["C"].concat(n.splice(0,6)));t.splice(e,1),f=_.max([i.length,o.length])}}function r(t,e,n,r,s){t&&e&&"M"==t[s][0]&&"M"!=e[s][0]&&(e.splice(s,0,["M",r.x,r.y]),n.bx=0,n.by=0,n.x=t[s][1],n.y=t[s][2],f=_.max([i.length,o&&o.length||0]))}for(var i=_.cloneDeep(this.absolute().segments),o=_.cloneDeep(new s(e).absolute().segments),a={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},p={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},h=[],c=[],l="",u="",d=0,f=_.max([i.length,o.length]);d<f;d++){i[d]&&(l=i[d][0]),"C"!=l&&(h[d]=l,d&&(u=h[d-1])),i[d]=t(i[d],a,u),"A"!=h[d]&&"C"==l&&(h[d]="C"),n(i,d),o[d]&&(l=o[d][0]),"C"!=l&&(c[d]=l,d&&(u=c[d-1])),o[d]=t(o[d],attrs2,pcom),"A"!=c[d]&&"C"==l&&(c[d]="C"),fixArc2(o,d),r(i,o,a,p,d),r(o,i,p,a,d);var g=i[d],v=o[d],m=g.length,x=v.length;a.x=g[m-2],a.y=g[m-1],a.bx=_.float(g[m-4])||a.x,a.by=_.float(g[m-3])||a.y,p.bx=_.float(v[x-4])||p.x,
p.by=_.float(v[x-3])||p.y,p.x=v[x-2],p.y=v[x-1]}return[new s(i),new s(o)]},bbox:function(){if(!this.segments.length)return Graph.bbox({x:0,y:0,width:0,height:0,x2:0,y2:0});var t=Graph.lookup(this.__CLASS__,"bbox",this.toString());if(t.bbox)return t.bbox;for(var e,n=this.curve().segments,r=0,i=0,o=[],s=[],a=0,p=n.length;a<p;a++)if(e=n[a],"M"==e[0])r=e[1],i=e[2],o.push(r),s.push(i);else{var h=Graph.util.curvebox(r,i,e[1],e[2],e[3],e[4],e[5],e[6]);o=o.concat(h.min.x,h.max.x),s=s.concat(h.min.y,h.max.y),r=e[5],i=e[6]}var c=_.min(o),l=_.min(s),u=_.max(o),d=_.max(s),f=u-c,g=d-l,v={x:c,y:l,x2:u,y2:d,width:f,height:g,cx:c+f/2,cy:l+g/2};return t.bbox=Graph.bbox(v),t.bbox},transform:function(t){if(t){var e=Graph.lookup(this.__CLASS__,"transform",this.toString(),t.toString());if(e.transform)return e.transform;var n,r,i,o,a,p,h,c=_.cloneDeep(this.curve().segments);for(i=0,o=c.length;i<o;i++)for(h=c[i],a=1,p=h.length;a<p;a+=2)n=t.x(h[a],h[a+1]),r=t.y(h[a],h[a+1]),h[a]=n,h[a+1]=r;return e.transform=new s(c),
e.transform}},lengthAt:function(t){},pointAt:function(t,e){var n,r,i,o,s,a,p,h=this.curve().segments;e=_.defaultTo(e,!1),s=0;for(var c=0,l=h.length;c<l;c++)if(r=h[c],"M"==r[0])i=r[1],o=r[2];else{if(a=Graph.curve([["M",i,o],r]),p=a.length(),s+p>t)return n=a.pointAt(a.t(t-s),e),a=null,n;s+=p,i=r[5],o=r[6],a=null}return a=Graph.curve([["M",i,o],r]),n=a.pointAt(1,e),a=null,n},segmentAt:function(t){var e,n,r,i,o=this.curve().segments,s=-1,a=0;return _.forEach(o,function(o,p){if("M"==o[0])e=o[1],n=o[2];else{if(i=Graph.curve([["M",e,n],o]),e=i.x(),n=i.y(),r=i.length(),r+a>t)return s=p,!1;a+=r,i=null}}),s},length:function(){var t,e,n,r,i,o=this.curve().segments;r=0;for(var s=0,a=o.length;s<a;s++)t=o[s],"M"==t[0]?(e=t[1],n=t[2]):(i=Graph.curve([["M",e,n],t]),r+=i.length(),e=t[5],n=t[6],i=null);return r},slice:function(t,e){var n,r,i,o,s,a,p,h,c=this.curve().segments,l={};a=0,r="";for(var u=0,d=c.length;u<d;u++)i=c[u],"M"==i[0]?(o=i[1],s=i[2]):(p=Graph.curve([["M",o,s],i]),h=p.length(),a+h>length&&(n=p.pointAt(p.t(length-a)),
r+=["C"+n.start.x,n.start.y,n.m.x,n.m.y,n.props.x,n.props.y],l.start=Graph.path(r),r=["M"+n.props.x,n.props.y+"C"+n.n.x,n.n.y,n.end.x,n.end.y,i[5],i[6]].join()),a+=h,o=i[5],s=i[6],p=null),r+=i.shift()+i;return l.end=Graph.path(r),l},vertices:function(){var t=Graph.lookup(this.__CLASS__,"vertices",this.toString());if(t.vertices)return t.vertices;var e=this.segments,n=[];return _.forEach(e,function(t){var e,r,i=t.length;"Z"!=t[0]&&("M"==t[0]?(e=t[1],r=t[2]):(e=t[i-2],r=t[i-1]),n.push(Graph.point(e,r)))}),t.vertices=n,t.vertices},addVertext:function(t){var e,n,r,i,o=this.isSimple(),s=o?_.cloneDeep(this.segments):this.curve().segments,a=-1,p=t.props.x,h=t.props.y,c=0,l=0;return _.forEach(s,function(t,o){if("Z"!=t[0])if("M"==t[0])e=t[1],n=t[2];else if("L"==t[0]?(r=Graph.curve([["M",e,n],["C",e,n,e,n,t[1],t[2]]]),e=t[1],n=t[2]):(r=Graph.curve([["M",e,n],t]),e=r.x(),n=r.y()),i=r.clone(),i.segments[1][5]=p,i.segments[1][6]=h,c+=r.length(),l+=i.length(),l<=c)return a=o,!1}),a>-1&&(o?s.splice(a,0,["L",p,h]):s.splice(a,0,["C",p,h,p,h,p,h]),
this.segments=s),this},intersect:function(t){return o(this,t,!0)>0},intersection:function(t,e){var n=o(this,t);return e?n:_.map(n,function(t){var e=Graph.point(t.x,t.y);return e.segment1=t.segment1,e.segment2=t.segment2,e.bezier1=t.bezier1,e.bezier2=t.bezier2,e})},intersectnum:function(t){return o(this,t,!0)},alpha:function(t){},contains:function(t){var e,n,r,i,o;return i=t.props.x,o=t.props.y,e=this.bbox(),r=e.toJson(),n=new s([["M",i,o],["H",r.x2+10]]),e.contains(t)&&this.intersectnum(n)%2==1},nearest:function(t){var e,n,r,i,o,s=this.length(),a=20,p=1/0,h=Graph.util.taxicab;for(Graph.isPoint(t)&&(t=t.toJson()),o=0;o<s;o+=a)r=this.pointAt(o,!0),i=h(r,t),i<p&&(p=i,e=r,n=o);a/=2;for(var c,l,u,d,f,g;a>.5;)(u=n-a)>=0&&(f=h(c=this.pointAt(u,!0),t))<p?(e=c,n=u,p=f):(d=n+a)<=s&&(g=h(l=this.pointAt(d,!0),t))<p?(e=l,n=d,p=g):a/=2;return e.distance=n,e},isSimple:function(){var t=!0;return _.forEach(this.segments,function(e){if(!/[MLZ]/i.test(e[0]))return t=!1,!1}),t},moveTo:function(t,e){var n=this.segments;
return n.length?(n[0][0]="M",n[0][1]=t,n[0][2]=e):n=[["M",t,e]],this},lineTo:function(t,e,n){var r=this.segments;if(n=_.defaultTo(n,!0),r){var i=r.length-1;"M"==r[i][0]||n?r.push(["L",t,e]):(r[i][1]=t,r[i][2]=e)}return this},toString:function(){return Graph.util.segments2path(this.segments)},toArray:function(){return this.segments},clone:function(){var t=_.cloneDeep(this.segments);return new s(t)}});Graph.lang.Path.toString=function(){return"function(command)"},Graph.isPath=function(t){return t instanceof Graph.lang.Path},Graph.path=function(t){return new Graph.lang.Path(t)}}(),function(){var t=Graph.lang.Matrix=Graph.extend({props:{a:1,b:0,c:0,d:1,e:0,f:0},constructor:function(t,e,n,r,i,o){this.props.a=_.defaultTo(t,1),this.props.b=_.defaultTo(e,0),this.props.c=_.defaultTo(n,0),this.props.d=_.defaultTo(r,1),this.props.e=_.defaultTo(i,0),this.props.f=_.defaultTo(o,0)},x:function(t,e){return t*this.props.a+e*this.props.c+this.props.e},y:function(t,e){return t*this.props.b+e*this.props.d+this.props.f;
},get:function(t){return+this.props[t].toFixed(4)},multiply:function(t,e,n,r,i,o){var s,a,p,h,c=[[],[],[]],l=[[this.props.a,this.props.c,this.props.e],[this.props.b,this.props.d,this.props.f],[0,0,1]],u=[[t,n,i],[e,r,o],[0,0,1]];for(Graph.isMatrix(t)&&(u=[[t.props.a,t.props.c,t.props.e],[t.props.b,t.props.d,t.props.f],[0,0,1]]),s=0;s<3;s++)for(a=0;a<3;a++){for(h=0,p=0;p<3;p++)h+=l[s][p]*u[p][a];c[s][a]=h}return this.props.a=c[0][0],this.props.b=c[1][0],this.props.c=c[0][1],this.props.d=c[1][1],this.props.e=c[0][2],this.props.f=c[1][2],this},invert:function(t){var e,n,r,i,o,s,a=this.props.a*this.props.d-this.props.b*this.props.c;return t=_.defaultTo(t,!1),e=this.props.d/a,n=-this.props.b/a,r=-this.props.c/a,i=this.props.a/a,o=(this.props.c*this.props.f-this.props.d*this.props.e)/a,s=(this.props.b*this.props.e-this.props.a*this.props.f)/a,t?new Graph.matrix(e,n,r,i,o,s):(this.props.a=e,this.props.b=n,this.props.c=r,this.props.d=i,this.props.e=o,this.props.f=s,this)},translate:function(t,e){
return t=_.defaultTo(t,0),e=_.defaultTo(e,0),this.multiply(1,0,0,1,t,e),this},rotate:function(t,e,n){if(void 0===t){var r=this.delta(0,1),i=(this.delta(1,0),180/Math.PI*Math.atan2(r.y,r.x)-90),o=Graph.util.rad(i);return{deg:i,rad:o}}t=Graph.util.rad(t),e=_.defaultTo(e,0),n=_.defaultTo(n,0);var s=+Math.cos(t).toFixed(9),a=+Math.sin(t).toFixed(9);return this.multiply(s,a,-a,s,e,n),this.multiply(1,0,0,1,-e,-n),this},scale:function(t,e,n,r){if(void 0===t){var i=this.props,t=Graph.util.hypo(i.a,i.b),e=Graph.util.hypo(i.c,i.d);return this.determinant()<0&&(t=-t),{x:t,y:e}}return e=_.defaultTo(e,t),(n||r)&&(n=_.defaultTo(n,0),r=_.defaultTo(r,0)),(n||r)&&this.multiply(1,0,0,1,n,r),this.multiply(t,0,0,e,0,0),(n||r)&&this.multiply(1,0,0,1,-n,-r),this},determinant:function(){return this.props.a*this.props.d-this.props.b*this.props.c},delta:function(t,e){return{x:t*this.props.a+e*this.props.c+0,y:t*this.props.b+e*this.props.d+0}},data:function(){var t=this.delta(0,1),e=this.delta(1,0),n=180/Math.PI*Math.atan2(t.y,t.x)-90,r=Graph.util.rad(n),i=Math.cos(r),o=Math.sin(r),s=Graph.util.hypo(this.props.a,this.props.b),a=Graph.util.hypo(this.props.c,this.props.d),p=Graph.util.rad(n);
return this.determinant()<0&&(s=-s),{x:this.props.e,y:this.props.f,dx:(this.props.e*i+this.props.f*o)/s,dy:(this.props.f*i+this.props.e*-o)/a,skewX:-n,skewY:180/Math.PI*Math.atan2(e.y,e.x),scaleX:s,scaleY:a,rotate:n,rad:p,sin:Math.sin(p),cos:Math.cos(p),a:this.props.a,b:this.props.b,c:this.props.c,d:this.props.d,e:this.props.e,f:this.props.f}},toString:function(){var t=[this.get("a"),this.get("b"),this.get("c"),this.get("d"),this.get("e"),this.get("f")];return"matrix("+_.join(t,",")+")"},toFilter:function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get("a")+", M12="+this.get("c")+", M21="+this.get("b")+", M22="+this.get("d")+", Dx="+this.get("e")+", Dy="+this.get("f")+", sizingmethod='auto expand')"},toArray:function(){return[[this.get("a"),this.get("c"),this.get("e")],[this.get("b"),this.get("d"),this.get("f")],[0,0,1]]},clone:function(){return new t(this.props.a,this.props.b,this.props.c,this.props.d,this.props.e,this.props.f)}});Graph.lang.Matrix.toString=function(){
return"function(a, b, c, d, e, f)"},Graph.isMatrix=function(t){return t instanceof Graph.lang.Matrix},Graph.matrix=function(t,e,n,r,i,o){return new Graph.lang.Matrix(t,e,n,r,i,o)}}(),function(){var t=Graph.collection.Point=function(t){this.items=t||[]};t.prototype.constructor=t,t.prototype.items=[],t.prototype.nth=function(t){return _.nth(this.items,t)},t.prototype.push=function(t){return this.items.push(t),t},t.prototype.pop=function(){var t=this.items.pop();return t},t.prototype.shift=function(){var t=this.items.shift();return t},t.prototype.first=function(){return _.head(this.items)},t.prototype.last=function(){return _.last(this.items)},t.prototype.clear=function(){return this.items=[],this},t.prototype.modify=function(t,e,n){var r=this.items[t];return r.props.x=e,r.props.y=n,r},t.prototype.each=function(t){_.forEach(this.items,t)},t.prototype.toArray=function(){return this.items},t.prototype.toJson=function(){return _.map(this.items,function(t){return t.toJson()})}}(),function(){var t=Graph.collection.Vector=Graph.extend({
items:[],constructor:function(t){this.items=_.map(t,function(t){return t.guid()})},has:function(t){var e=t.guid();return _.indexOf(this.items,e)>-1},not:function(e){var n=e.guid(),r=_.filter(this.items,function(t){return t!=n});return new t(r)},count:function(){return this.items.length},index:function(t){var e=t.guid();return _.indexOf(this.items,e)},push:function(t){var e=t.guid();return this.items.push(e),this.fire("push",{vector:t}),this},pop:function(){this.items.pop()},shift:function(){this.items.shift()},unshift:function(t){var e=t.guid();return this.items.unshift(e),this.fire("unshift",{vector:t}),this},pull:function(t){var e=t.guid();return _.pull(this.items,e),this.fire("pull",{vector:t}),this},clear:function(){this.items=[]},each:function(t){_.forEach(this.items,function(e){var n=Graph.registry.vector.get(e);t.call(n,n)})},bbox:function(){for(var t,e,n=[],r=[],i=[],o=[],s=this.items.length-1;s>=0;s--)t=Graph.registry.vector.get(this.items[s]),e=t.bbox().toJson(),n.push(e.x),r.push(e.y),
i.push(e.x+e.width),o.push(e.y+e.height);return n=_.min(n),r=_.min(r),i=_.max(i),o=_.max(o),Graph.bbox({x:n,y:r,x2:i,y2:o,width:i-n,height:o-r})},toArray:function(){return _.map(this.items,function(t){return Graph.registry.vector.get(t)})},toString:function(){return"Graph.collection.Vector"}});Graph.collection.Vector.toString=function(){return"function(vectors)"};var e=["attr","remove"];_.forEach(e,function(e){!function(e){t.prototype[e]=function(){var t=_.toArray(arguments);return this.each(function(n){n[e].apply(n,t)}),this}}(e)})}(),function(t,e){var n,r=/^<(svg|g|rect|text|path|line|tspan|circle|polygon|defs|marker)/i;Graph.dom=function(i,o,s){var a,p;if(void 0===n)try{n=new DOMParser}catch(t){n=null}return s=t.defaultTo(s,!1),t.isString(i)?r.test(i)?n&&(a='<g xmlns="'+Graph.config.xmlns.svg+'">'+i+"</g>",p=n.parseFromString(a,"text/xml").documentElement.childNodes[0],a=null,p=s?e(p):p):p=s?e(i,o):e(i,o)[0]:p=Graph.isHTML(i)||Graph.isSVG(i)?s?e(i):i:Graph.isElement(i)?s?i.query:i.query[0]:s?e(i):i,
p},Graph.dom.clone=function(t,e){return t.cloneNode(e)};var i=Graph.dom.Element=function(t){this.query=e(t)};i.prototype.node=function(){return this.query[0]},i.prototype.length=function(){return this.query.length},i.prototype.group=function(t){return void 0===t?this.query.data("component-group"):(this.query.data("component-group",t),this)},i.prototype.belong=function(t){return this.group()==t},i.prototype.attr=function(e,n){var r=this,i=this.query[0];if(Graph.isHTML(i))this.query.attr(e,n);else if(Graph.isSVG(i)){if(t.isPlainObject(e))return t.forOwn(e,function(t,e){r.attr(e,t)}),this;"xlink:"==e.substring(0,6)?i.setAttributeNS(Graph.config.xmlns.xlink,e.substring(6),t.toString(n)):i.setAttribute(e,t.toString(n))}return this},i.prototype.width=function(t){return void 0===t?this.query.width():(this.query.width(t),this)},i.prototype.outerHeight=function(t){return this.query.outerHeight(t)},i.prototype.height=function(t){return void 0===t?this.query.height():(this.query.height(t),this)},i.prototype.show=function(){
return this.query.show(),this},i.prototype.hide=function(){return this.query.hide(),this},i.prototype.offset=function(){return this.query.offset()},i.prototype.position=function(){return this.query.position()},i.prototype.css=function(t,e){return void 0===e?this.query.css(t):(this.query.css(t,e),this)},i.prototype.addClass=function(e){var n=this.query[0];if(Graph.isHTML(n))this.query.addClass(e);else if(Graph.isSVG(n)){var r=t.split(n.className.baseVal||""," ");e=t.split(e," "),e=t.concat(r,e),e=t.uniq(e),e=t.join(e," "),n.className.baseVal=t.trim(e)}return this},i.prototype.removeClass=function(t){var e=this.query[0];return Graph.isHTML(e)&&this.query.removeClass(t),this},i.prototype.hasClass=function(e){var n=this.query[0];if(Graph.isHTML(n))return this.query.hasClass(e);if(Graph.isSVG(n)){var r=t.split(n.className.baseVal," ");return r.indexOf(e)>-1}return!1},i.prototype.find=function(t){return new Graph.dom.Element(this.query.find(t))},i.prototype.parent=function(){return new Graph.dom.Element(this.query.parent());
},i.prototype.closest=function(t){return new Graph.dom.Element(this.query.closest(t))},i.prototype.append=function(t){return this.query.append(t.query),this},i.prototype.prepend=function(t){return this.query.prepend(t.query),this},i.prototype.appendTo=function(t){return this.query.appendTo(t.query),this},i.prototype.prependTo=function(t){return this.query.prependTo(t.query),this},i.prototype.before=function(t){return this.query.before(t.query),this},i.prototype.remove=function(){return this.query.remove(),this.query=null,this},i.prototype.detach=function(){return this.query=this.query.detach(),this},i.prototype.on=function(t,e,n,r,i){return this.query.on.call(this.query,t,e,n,r,i),this},i.prototype.off=function(t,e,n){return this.query.off.call(this.query,t,e,n),this},i.prototype.trigger=function(t,e){return this.query.trigger(t,e),this},i.prototype.text=function(t){return void 0===t?this.query.text():(this.query.text(t),this)},i.prototype.html=function(t){return void 0===t?this.query.html():(this.query.html(t),
this)},i.prototype.focus=function(){return this.query.focus(),this},i.prototype.contextmenu=function(e){e=t.defaultTo(e,!0),e||this.query.on("contextmenu",function(t){return!1})},i.prototype.each=function(t){return this.query.each(t),this},i.prototype.empty=function(){return this.query.empty(),this},i.prototype.data=function(t,e){return void 0===e?this.query.data(t):(this.query.data(t,e),this)},i.prototype.prop=function(t,e){return void 0===e?this.query.data(t):(this.query.prop(t,e),this)},i.prototype.scrollTop=function(t){return void 0===t?this.query.scrollTop():(this.query.scrollTop(t),this)},i.prototype.scrollLeft=function(t){return void 0===t?this.query.scrollLeft():(this.query.scrollLeft(t),this)},i.prototype.toString=function(){return"Graph.dom.Element"},Graph.$=function(t,e){var n=Graph.dom(t,e,!0);return new Graph.dom.Element(n)}}(_,jQuery),function(){function t(e,n){var r=e.children().toArray();n.call(e,e),r.length&&_.forEach(r,function(e){t(e,n)})}function e(t,n){var r,i=t.parent();
if(r=n.call(t,t),r=_.defaultTo(r,!0),r&&i)return e(i,n)}function n(t){return t.parentNode?"svg"==t.parentNode.nodeName?t.parentNode.getBoundingClientRect():n(t.parentNode):{top:0,left:0}}var r=Graph.svg.Vector=Graph.extend({tree:{container:null,paper:null,parent:null,children:null,next:null,prev:null},props:{id:null,guid:null,type:null,text:null,rotate:0,scaleX:1,scaleY:1,traversable:!0,selectable:!0,focusable:!1,snappable:!1,selected:!1,rendered:!1,state:null},attrs:{style:"",class:""},plugins:{transformer:null,collector:null,animator:null,resizer:null,reactor:null,dragger:null,dropper:null,network:null,history:null,sorter:null,panzoom:null,toolmgr:null,editor:null},utils:{collector:null,spotlight:null,definer:null,toolpad:null},graph:{matrix:null,layout:null},cached:{bbox:null,originalBBox:null,position:null,offset:null},elem:null,constructor:function(t,e){var n=this;n.graph.matrix=Graph.matrix(),n.tree.children=new Graph.collection.Vector,n.tree.children.on({push:_.bind(n.onAppendChild,n),
pull:_.bind(n.onRemoveChild,n),unshift:_.bind(n.onPrependChild,n)}),e=_.extend({id:"graph-vector-"+ ++r.guid},n.attrs,e||{}),n.elem=Graph.$(document.createElementNS(Graph.config.xmlns.svg,t)),n.attr(e),n.props.guid=n.props.id=n.attrs.id,n.props.type=t,n.elem.data(Graph.string.ID_VECTOR,n.props.guid),n.plugins.transformer=new Graph.plugin.Transformer(n).on("translate",_.bind(n.onTransformTranslate,n)).on("rotate",_.bind(n.onTransformRotate,n)).on("scale",_.bind(n.onTransformScale,n)),n.isPaper()&&(n.plugins.toolmgr=new Graph.plugin.ToolManager(n).on("activate",_.bind(n.onActivateTool,n)).on("deactivate",_.bind(n.onDeactivateTool,n))),Graph.registry.vector.register(this)},matrix:function(t){var e,n;return t=_.defaultTo(t,!1),t?(n=this.node().getCTM(),e=n?Graph.matrix(n.a,n.b,n.c,n.d,n.e,n.f):this.graph.matrix):e=this.graph.matrix,e},layout:function(t){if(void 0===t)return this.graph.layout;var e,n;return t="default"==t?"layout":t,_.isString(t)?(e=Graph.layout[_.capitalize(t)],n=Graph.factory(e,[this])):_.isPlainObject(t)&&t.name&&(e=Graph.layout[_.capitalize(t.name)],
delete t.name,n=Graph.factory(e,[this,t])),n.refresh(),this.graph.layout=n,this},reset:function(){this.graph.matrix=Graph.matrix(),this.removeAttr("transform"),this.props.rotate=0,this.props.scale=0,this.dirty(!0),this.fire("reset",this.props),this.dragger&&this.dragger.rotate(0)},invalidate:function(t){this.cached[t]=null},state:function(t){return void 0===t?this.props.state:(this.props.state=t,this)},dirty:function(t){var e=this;if(void 0===t)return null===e.cached.bbox;if(t){for(var n in this.cached)e.cached[n]=null;var r=["resizer","network"];_.forEach(r,function(t){e.plugins[t]&&e.plugins[t].invalidate()})}return this},interactable:function(t){return this.plugins.reactor||(this.plugins.reactor=new Graph.plugin.Reactor(this,t)),this.plugins.reactor},animable:function(){var t=this;return t.plugins.animator||(t.plugins.animator=new Graph.plugin.Animator(t),t.plugins.animator.on({animstart:function(e){t.fire(e)},animating:function(e){t.fire(e)},animend:function(e){t.fire(e)}})),t.plugins.animator;
},resizable:function(t){return this.plugins.resizer||(this.plugins.resizer=new Graph.plugin.Resizer(this,t),this.plugins.resizer.on({resize:_.bind(this.onResizerResize,this)})),this.plugins.resizer},draggable:function(t){return this.plugins.dragger||(this.plugins.dragger=new Graph.plugin.Dragger(this,t),this.plugins.dragger.on({dragstart:_.bind(this.onDraggerStart,this),dragmove:_.bind(this.onDraggerMove,this),dragend:_.bind(this.onDraggerEnd,this)})),this.plugins.dragger},zoomable:function(){return this.plugins.panzoom||(this.plugins.panzoom=new Graph.plugin.Panzoom(this),this.plugins.toolmgr.register("panzoom")),this.plugins.panzoom},droppable:function(){return this.plugins.dropper||(this.plugins.dropper=new Graph.plugin.Dropper(this),this.plugins.dropper.on({dropenter:_.bind(this.onDropperEnter,this),dropleave:_.bind(this.onDropperLeave,this)})),this.plugins.dropper},sortable:function(t){return this.plugins.sorter||(this.plugins.sorter=new Graph.plugin.Sorter(this,t)),this.plugins.sorter;
},connectable:function(t){return this.plugins.network||(this.plugins.network=new Graph.plugin.Network(this,t)),this.plugins.network},traversable:function(t){return t=_.defaultTo(t,!0),this.props.traversable=t,this},selectable:function(t){return t=_.defaultTo(t,!0),this.props.selectable=t,this},clickable:function(t){var e=this;return void 0===t?e.attrs["pointer-events"]||"visiblePainted":(t?this.attr("pointer-events",""):this.attr("pointer-events","none"),this)},editable:function(t){var e=this;return this.plugins.editor||(this.plugins.editor=new Graph.plugin.Editor(this,t),this.plugins.editor.on({beforeedit:function(t){e.fire(t)},edit:function(t){e.fire(t)}})),this.plugins.editor},snappable:function(t){var e=this;return t=_.isBoolean(t)?{vector:e,shield:e,enabled:t}:_.extend({vector:e,shield:e,enabled:!0},t||{}),e.props.snappable=t.enabled,e.props.rendered?e.paper().snapping(t):e.on("render",function(){e.paper().snapping(t)}),e},id:function(){return this.props.id},guid:function(){return this.props.guid;
},node:function(){return this.elem.node()},data:function(t,e){var n=this;return _.isPlainObject(t)?(_.forOwn(t,function(t,e){n.props[e]=t}),this):void 0===t&&void 0===e?n.props:void 0===e?n.props[t]:(n.props[t]=e,this)},attr:function(t,e){var n=this,r=n.node();return _.isPlainObject(t)?(_.forOwn(t,function(t,e){!function(t,e){n.attr(e,t)}(t,e)}),n):void 0===t?n.attrs:void 0===e?n.attrs[t]||"":(n.attrs[t]=e,null!==e&&("xlink:"==t.substring(0,6)?r.setAttributeNS(Graph.config.xmlns.xlink,t.substring(6),_.toString(e)):"class"==t?r.className.baseVal=_.toString(e):r.setAttribute(t,_.toString(e))),n)},removeAttr:function(t){return this.node().removeAttribute(t),this.attrs[t]&&delete this.attrs[t],this},style:function(t,e){var n=this;return _.isPlainObject(t)?(_.forOwn(t,function(t,e){n.style(e,t)}),this):(this.elem.css(t,e),this)},cursor:function(t){this.elem.css("cursor",t)},hasClass:function(t){return _.indexOf(_.split(this.attrs.class," "),t)>-1},addClass:function(t){var e=_.chain(this.attrs.class).split(" ").concat(_.split(t," ")).uniq().join(" ").trim().value();
return this.attr("class",e),this},removeClass:function(t){var e=_.split(this.attrs.class," "),n=_.isArray(t)?t:_.split(t," ");return _.pullAll(e,n),this.attr("class",_.join(e," ")),this},hide:function(){this.elem.hide()},show:function(){this.elem.show()},pathinfo:function(){return new Graph.lang.Path([])},vertices:function(){return[]},dots:function(t){var e,n,r,i;return t=_.defaultTo(t,!1),e=this.matrix(t),n=this.pathinfo().transform(e),r=n.segments,i=[],_.forEach(r,function(t){var e,n;"Z"!=t[0]&&(e=t[t.length-2],n=t[t.length-1],i.push([e,n]))}),i},dotval:function(t,e){var n=this.graph.matrix;return{x:n.x(t,e),y:n.y(t,e)}},dimension:function(){var t={},e=this.node();try{t=e.getBBox()}catch(n){t={x:e.clientLeft,y:e.clientTop,width:e.clientWidth,height:e.clientHeight}}finally{t=t||{}}return t},offset:function(){var t=this.node(),e=t.getBoundingClientRect(),n={top:e.top,left:e.left,bottom:e.bottom,right:e.right,width:e.width,height:e.height};return n},position:function(){if(!this.cached.position){
var t=this.node(),e=t.getBoundingClientRect(),r=n(t);this.cached.position={top:e.top-r.top,left:e.left-r.left,bottom:e.bottom-r.top,right:e.right-r.left,width:e.width,height:e.height}}return this.cached.position},bbox:function(t){var e,n;return t=_.defaultTo(t,!1),t?(n=this.cached.originalBBox,n||(e=this.pathinfo(),n=e.bbox(),this.cached.originalBBox=n)):(n=this.cached.bbox,n||(e=this.pathinfo().transform(this.matrix()),n=e.bbox(),this.cached.bbox=n)),e=null,n},find:function(t){var e=this.elem.find(t),n=[];return e.each(function(t,e){n.push(Graph.registry.vector.get(e))}),new Graph.collection.Vector(n)},holder:function(){return this.isPaper()?Graph.$(this.node().parentNode):Graph.$(this.paper().node().parentNode)},append:function(t){var e=this;if(_.isArray(t))return _.forEach(t,function(t){e.append(t)}),e;if(_.isString(t)){var n=Graph.svg[_.capitalize(t)];t=Graph.factory(n,[])}return t.render(this,"append"),e},prepend:function(t){return t.render(this,"prepend"),t},render:function(t,e){var n=this,r=n.guid(),i=n.props.traversable;
if(n.props.rendered)return n;if(t=_.defaultTo(t,n.paper()),e=_.defaultTo(e,"append"),t){switch(t.isPaper()&&(t=t.viewport()),n.tree.paper=t.tree.paper,i&&(n.tree.parent=t.guid()),e){case"append":t.elem.append(n.elem),i&&t.children().push(n);break;case"prepend":t.elem.prepend(n.elem),i&&t.children().unshift(n)}if(t.props.rendered){n.props.rendered=!0,n.fire("render");var o=t.isViewport()?t.paper():null;o&&Graph.registry.vector.setContext(r,n.tree.paper),n.cascade(function(t){t===n||t.props.rendered||(t.props.rendered=!0,t.tree.paper=n.tree.paper,t.fire("render"),o&&Graph.registry.vector.setContext(t.props.guid,n.tree.paper))})}}return n},children:function(){return this.tree.children},ancestors:function(){for(var t,e=this,n=[];(t=e.parent())&&!t.isPaper();)n.push(t),t=t.parent();return new Graph.collection.Vector(n)},descendants:function(){var t=this,e=[];return t.cascade(function(n){n!==t&&e.push(n)}),new Graph.collection.Vector(e)},paper:function(){return this.isPaper()?this:Graph.registry.vector.get(this.tree.paper);
},parent:function(){return Graph.registry.vector.get(this.tree.parent)},prev:function(){return Graph.registry.vector.get(this.tree.prev)},next:function(){return Graph.registry.vector.get(this.tree.next)},cascade:function(e){t(this,e)},bubble:function(t){return e(this,t)},remove:function(){var t=this.parent();this.$collector&&this.$collector.decollect(this);for(var e in this.plugins)this.plugins[e]&&(this.plugins[e].destroy(),this.plugins[e]=null);t&&t.children().pull(this),this.elem&&(this.elem.remove(),this.elem=null),Graph.registry.vector.unregister(this),this.fire("remove")},empty:function(){var t=this;return t.cascade(function(e){e!==t&&Graph.registry.vector.unregister(e)}),this.children().clear(),this.elem.empty(),this},select:function(){return this.addClass("graph-selected"),this.props.selected=!0,this.fire("select"),this.plugins.resizer&&this.plugins.resizer.resume(),Graph.topic.publish("vector/select",{vector:this}),this},deselect:function(){return this.removeClass("graph-selected"),
this.props.selected=!1,this.fire("deselect"),this.plugins.resizer&&(this.plugins.resizer.props.suspended||this.plugins.resizer.suspend()),this.$collector||Graph.topic.publish("vector/deselect",{vector:this}),this},transform:function(t){return this.plugins.transformer.transform(t)},translate:function(t,e){return this.plugins.transformer.translate(t,e)},scale:function(t,e,n,r){return void 0===t?this.matrix(!0).scale():this.plugins.transformer.scale(t,e,n,r)},rotate:function(t,e,n){return this.plugins.transformer.rotate(t,e,n)},animate:function(t,e,n,r){return this.plugins.animator?(this.plugins.animator.animate(t,e,n,r),this.plugins.animator):null},label:function(t){return this.elem.text(t),this},deltaMatrix:function(){},backward:function(){var t=this.parent();t&&t.elem.prepend(this.elem)},forward:function(){var t=this.parent();t&&t.elem.append(this.elem)},front:function(){return this.tree.paper?(this.paper().elem.append(this.elem),this):this},back:function(){return this.tree.paper?(this.paper().elem.prepend(this.elem),
this):this},focus:function(t){var e,n=this.paper();n&&n.utils.spotlight&&(t=_.defaultTo(t,!0),e=_.delay(function(t,r){clearTimeout(e),n.utils.spotlight.focus(t,r)},0,this,t))},resize:function(t,e,n,r,i,o){return this},isGroup:function(){return"g"==this.props.type},isPaper:function(){return"svg"==this.props.type},isViewport:function(){return this.props.viewport===!0},isTraversable:function(){return this.props.traversable},isSelectable:function(){return this.props.selectable},isDraggable:function(){return null!==this.plugins.dragger},isResizable:function(){return null!==this.plugins.resizer},isConnectable:function(){return!!this.plugins.network},isSnappable:function(){return this.props.snappable},isRendered:function(){return this.props.rendered},tool:function(){return this.plugins.toolmgr},toString:function(){return"Graph.svg.Vector"},onResizerResize:function(t){this.dirty(!0),this.fire(t),Graph.topic.publish("vector/resize",t)},onDraggerStart:function(t){this.fire(t),this.$collector&&this.$collector.syncDragStart(this,t),
this.plugins.resizer&&this.plugins.resizer.suspend(),this.plugins.editor&&this.plugins.editor.suspend()},onDraggerMove:function(t){this.fire(t),this.$collector&&this.$collector.syncDragMove(this,t)},onDraggerEnd:function(t){this.dirty(!0),this.fire(t),Graph.topic.publish("vector/dragend",t),this.$collector&&this.$collector.syncDragEnd(this,t),this.plugins.resizer&&(this.plugins.resizer.resume(),this.props.selected||this.plugins.resizer.suspend())},onDropperEnter:function(t){this.fire(t)},onDropperLeave:function(t){this.fire(t)},onTransformRotate:function(t){if(this.dirty(!0),this.props.rotate=t.deg,this.fire("rotate",{deg:t.deg}),this.plugins.dragger){var e=this.matrix(!0).rotate();this.plugins.dragger.rotate(e.deg)}},onTransformTranslate:function(t){this.dirty(!0),this.fire("translate",{dx:t.dx,dy:t.dy})},onTransformScale:function(t){if(this.dirty(!0),this.props.scaleX=t.sx,this.props.scaleY=t.sy,this.fire("scale",{sx:t.sx,sy:t.sy}),this.plugins.dragger){var e=this.matrix(!0).scale();this.plugins.dragger.scale(e.x,e.y);
}},onActivateTool:function(t){var e=t.originalData;this.fire("activatetool",e)},onDeactivateTool:function(t){var e=t.originalData;this.fire("deactivatetool",e)},onAppendChild:function(t){this.fire("appendchild",{child:t.vector})},onRemoveChild:function(t){this.fire("removechild",{child:t.vector})},onPrependChild:function(t){this.fire("prependchild",{child:t.vector})}});r.toString=function(){return"function(tag)"},r.guid=0,Graph.isVector=function(t){return t instanceof Graph.svg.Vector}}(),function(){Graph.svg.Ellipse=Graph.extend(Graph.svg.Vector,{attrs:{class:Graph.string.CLS_VECTOR_ELLIPSE},constructor:function(t,e,n,r){this.superclass.prototype.constructor.call(this,"ellipse",{cx:t,cy:e,rx:n,ry:r})},pathinfo:function(){var t=this.attrs;return Graph.path([["M",t.cx,t.cy],["m",0,-t.ry],["a",t.rx,t.ry,0,1,1,0,2*t.ry],["a",t.rx,t.ry,0,1,1,0,-2*t.ry],["z"]])},resize:function(t,e,n,r,i,o){var s,a,p=this.graph.matrix.clone().scale(t,e,n,r),h=this.props.rotate,c=p.x(this.attrs.cx,this.attrs.cy),l=p.y(this.attrs.cx,this.attrs.cy),u=this.attrs.rx*t,d=this.attrs.ry*e;
this.reset(),this.attr({cx:c,cy:l,rx:u,ry:d}),h&&this.rotate(h,c,l).commit();var f=this.bbox().toJson();return s=c-u-i,a=l-d-o,s=f.x,a=f.y,{matrix:p,translate:{dx:i,dy:o},scale:{sx:t,sy:e,cx:n,cy:r},rotate:{deg:h,cx:c,cy:l},magnify:{cx:s,cy:a}}},toString:function(){return"Graph.svg.Ellipse"}}),Graph.svg.Ellipse.toString=function(){return"function(cx, cy, rx, ry)"}}(),function(){Graph.svg.Circle=Graph.extend(Graph.svg.Vector,{attrs:{style:"",class:Graph.string.CLS_VECTOR_CIRCLE},constructor:function(t,e,n){var r=this;Graph.isPoint(t)&&(n=e,e=t.props.y,t=t.props.x),r.superclass.prototype.constructor.call(r,"circle",{cx:t,cy:e,r:n})},pathinfo:function(){var t=this.attrs;return Graph.path([["M",t.cx,t.cy],["m",0,-t.r],["a",t.r,t.r,0,1,1,0,2*t.r],["a",t.r,t.r,0,1,1,0,-2*t.r],["z"]])},resize:function(t,e,n,r,i,o){var s,a,p,h=this.graph.matrix.clone(),c=this.props.rotate,l=this.attrs.cx,u=this.attrs.cy,d=this.attrs.r;return 1===e?(p=d*t,e=t):1===t?(p=d*e,t=e):t<e?(p=d*e,t=e):t>e&&(p=d*t,e=t),h.scale(t,e,n,r),
s=h.x(l,u),a=h.y(l,u),this.reset(),this.attr({cx:s,cy:a,r:p}),c&&this.rotate(c,s,a).commit(),{matrix:h,translate:{dx:i,dy:o},scale:{sx:t,sy:e,cx:n,cy:r},rotate:{deg:c,cx:s,cy:a}}},toString:function(){return"Graph.svg.Circle"}}),Graph.svg.Circle.toString=function(){return"function(cx, cy, r)"}}(),function(){Graph.svg.Rect=Graph.extend(Graph.svg.Vector,{attrs:{style:"",class:Graph.string.CLS_VECTOR_RECT},constructor:function(t,e,n,r,i){var o=this;i=_.defaultTo(i,6),o.superclass.prototype.constructor.call(o,"rect",{x:_.defaultTo(t,0),y:_.defaultTo(e,0),rx:i,ry:i,width:_.defaultTo(n,0),height:_.defaultTo(r,0)}),o.origpath=o.pathinfo()},attr:function(t,e){var n=this.superclass.prototype.attr.apply(this,[t,e]);return"rx"==t&&void 0!==e&&(this.attrs.r=this.attrs.rx),n},pathinfo:function(){var t,e=this.attrs;return t=e.r?Graph.path([["M",e.x+e.r,e.y],["l",e.width-2*e.r,0],["a",e.r,e.r,0,0,1,e.r,e.r],["l",0,e.height-2*e.r],["a",e.r,e.r,0,0,1,-e.r,e.r],["l",2*e.r-e.width,0],["a",e.r,e.r,0,0,1,-e.r,-e.r],["l",0,2*e.r-e.height],["a",e.r,e.r,0,0,1,e.r,-e.r],["z"]]):Graph.path([["M",e.x,e.y],["l",e.width,0],["l",0,e.height],["l",-e.width,0],["z"]]);
},resize:function(t,e,n,r,i,o){var s,a,p,h,c=this.matrix().clone(),l=c.rotate().deg;return c.scale(t,e,n,r),this.reset(),s=c.x(this.attrs.x,this.attrs.y),a=c.y(this.attrs.x,this.attrs.y),p=this.attrs.width*t,h=this.attrs.height*e,this.attr({x:s,y:a,width:p,height:h}),l&&this.rotate(l,s,a).commit(),{matrix:c,translate:{dx:i,dy:o},scale:{sx:t,sy:e,cx:n,cy:r},rotate:{deg:l,cx:s,cy:a}}},toString:function(){return"Graph.svg.Rect"}}),Graph.svg.Rect.toString=function(){return"function(x, y, width, height, r)"}}(),function(){Graph.svg.Path=Graph.extend(Graph.svg.Vector,{attrs:{style:"",class:Graph.string.CLS_VECTOR_PATH},constructor:function(t){t||(t=[["M",0,0]]),t=_.isArray(t)?Graph.path(Graph.util.segments2path(t)).absolute().toString():t instanceof Graph.lang.Path?t.toString():Graph.path(t).absolute().toString(),this.superclass.prototype.constructor.call(this,"path",{d:t})},pathinfo:function(){return Graph.path(this.attrs.d)},segments:function(){return this.pathinfo().segments},intersection:function(t,e){
return this.pathinfo().intersection(t.pathinfo(),e)},intersectnum:function(t){return this.pathinfo().intersectnum(t.pathinfo())},angle:function(){var t=_.clone(this.segments()),e=t.length-1;"Z"==t[e][0]&&(e--,t.pop()),1===t.length&&(e++,t.push(["L",t[0][1],t[0][2]]));var n=t[e][1]-t[e-1][1],r=t[e][2]-t[e-1][2];return(180+180*Math.atan2(-r,-n)/Math.PI+360)%360},slice:function(t,e){return this.pathinfo().slice(t,e)},pointAt:function(t){return this.pathinfo().pointAt(t)},length:function(){return this.pathinfo().length()},addVertext:function(t){var e=this.pathinfo();return e.addVertext(t),this.attr("d",e.command()),this},resize:function(t,e,n,r,i,o){var s=this.matrix().clone(),a=matrix.rotate(),p=a.deg,h=a.rad,c=(Math.sin(h),Math.cos(h),this.pathinfo()),l=c.segments,u=l[0][1],d=l[0][2];return p&&s.rotate(-p,u,d),u=s.x(l[0][1],l[0][2]),d=s.y(l[0][1],l[0][2]),s.scale(t,e,n,r),_.forEach(l,function(t){var e,n,r,i;"Z"!=t[0]&&(e=t[t.length-2],n=t[t.length-1],r=s.x(e,n),i=s.y(e,n),t[t.length-2]=r,
t[t.length-1]=i)}),this.reset(),this.attr("d",c.command()),p&&this.rotate(p,u,d).commit(!0),{matrix:s,x:u,y:d}},moveTo:function(t,e){var n=this.pathinfo();return n.moveTo(t,e),this.attr("d",n.command()),this},lineTo:function(t,e,n){var r=this.pathinfo();return r.lineTo(t,e,n),this.attr("d",r.command()),this},tail:function(){var t=this.segments();return t.length?Graph.point(t[0][1],t[0][2]):null},head:function(){var t,e=this.segments();return e.length?(t=e.length-1,Graph.point(e[t][1],e[t][2])):null},toString:function(){return"Graph.svg.Path"}}),Graph.svg.Path.toString=function(){return"function(d)"}}(),function(){Graph.svg.Polyline=Graph.extend(Graph.svg.Vector,{attrs:{style:"",class:Graph.string.CLS_VECTOR_POLYLINE},constructor:function(t){t=_.defaultTo(t,""),_.isArray(t)&&(t.length?(_.isPlainObject(t[0])&&(t=_.map(t,function(t){return t.x+","+t.y})),t=_.join(t,",")):t=""),this.superclass.prototype.constructor.call(this,"polyline",{points:t})},pathinfo:function(){var t=Graph.util.polygon2path(this.attrs.points);
return t=t.replace(/Z/i,""),Graph.path(t)},attr:function(t,e){return"points"==t&&_.isArray(e)&&(e=_.join(_.map(e,function(t){return t[0]+","+t[1]})," ")),this.superclass.prototype.attr.call(this,t,e)},toString:function(){return"Graph.svg.Polyline"}}),Graph.svg.Polyline.toString=function(){return"function(points)"}}(),function(){Graph.svg.Polygon=Graph.extend(Graph.svg.Vector,{attrs:{style:"",class:Graph.string.CLS_VECTOR_POLYGON},constructor:function(t){t=_.defaultTo(t,""),_.isArray(t)&&(t.length?(_.isPlainObject(t[0])&&(t=_.map(t,function(t){return t.x+","+t.y})),t=_.join(t,",")):t=""),this.superclass.prototype.constructor.call(this,"polygon",{points:t})},attr:function(t,e){return"points"==t&&_.isArray(e)&&(e=_.join(e,",")),this.superclass.prototype.attr.call(this,t,e)},pathinfo:function(){var t=Graph.util.polygon2path(this.attrs.points);return Graph.path(t)},resize:function(t,e,n,r,i,o){var s=this.graph.matrix.clone(),a=this.graph.matrix.clone(),p=this.props.rotate,h=this.pathinfo().segments,c=[],l=h[0][1],u=h[0][2];
return p&&(a.rotate(-p,h[0][1],h[0][2]),l=a.x(h[0][1],h[0][2]),u=a.y(h[0][1],h[0][2])),a.scale(t,e,n,r),s.scale(t,e,n,r),_.forEach(h,function(t){var e,n,r,i;"Z"!=t[0]&&(e=t[t.length-2],n=t[t.length-1],r=a.x(e,n),i=a.y(e,n),c.push(r+","+i))}),c=_.join(c," "),this.reset(),this.attr("points",c),p&&this.rotate(p,l,u).commit(),{matrix:s,translate:{dx:i,dy:o},scale:{sx:t,sy:e,cx:n,cy:r},rotate:{deg:p,cx:l,cy:u}}},toString:function(){return"Graph.svg.Polygon"}}),Graph.svg.Polygon.toString=function(){return"function(points)"}}(),function(){Graph.svg.Group=Graph.extend(Graph.svg.Vector,{attrs:{stroke:null,"stroke-width":null,class:null,fill:null,style:null},constructor:function(t,e){this.superclass.prototype.constructor.call(this,"g"),void 0!==t&&void 0!==e&&(this.graph.matrix.translate(t,e),this.attr("transform",this.graph.matrix.toString()))},pathinfo:function(){var t=this.dimension();return new Graph.lang.Path([["M",t.x,t.y],["l",t.width,0],["l",0,t.height],["l",-t.width,0],["z"]])},toString:function(){
return"Graph.svg.Group"}}),Graph.svg.Group.toString=function(){return"function(x, y)"}}(),function(){Graph.svg.Text=Graph.extend(Graph.svg.Vector,{attrs:{"text-anchor":"middle",class:Graph.string.CLS_VECTOR_TEXT},props:{id:"",guid:"",text:"",type:"text",rotate:0,lineHeight:1,fontSize:12,traversable:!0,focusable:!1,selectable:!0,selected:!1,rendered:!1},rows:[],constructor:function(t,e,n){this.superclass.prototype.constructor.call(this,"text",{x:_.defaultTo(t,0),y:_.defaultTo(e,0)}),this.attr({"font-size":Graph.config.font.size,"font-family":Graph.config.font.family}),n&&this.write(n),this.on("render",_.bind(this.onTextRender,this))},attr:function(t,e){var n=this.superclass.prototype.attr.apply(this,[t,e]);return"font-size"==t&&void 0!==e&&(this.props.fontSize=_.parseInt(e)||12),n},write:function(t){var e,n=this;return void 0===t?n.props.text:(e=(t||"").split("\n"),n.empty(),n.rows=[],_.forEach(e,function(t,e){n.addSpan(t)}),n.props.text=t,void(n.cached.bbox=null))},addSpan:function(t){var e,n=this;
return t=_.defaultTo(t,""),e=Graph.$("<tspan/>"),e.text(t),n.elem.append(e),n.rows.push(e),e},arrange:function(){var t=this.rows,e=this.props.fontSize,n=this.props.lineHeight;this.bbox().toJson();if(t.length){for(var r=0,i=t.length;r<i;r++)r&&(t[r].attr("x",this.attrs.x),t[r].attr("dy",e*n));t[0].attr("dy",0)}},wrap:function(t){var e,n,r=this.props.text,i=r.split(/\s+/).reverse(),o=[],s=0,a=this.props.lineHeight,p=this.attrs.x,h=this.attrs.y,c=0;for(this.empty(),n=this.addSpan(),n.attr({x:p,y:h,dy:c+"em"});e=i.pop();)o.push(e),n.text(o.join(" ")),n.node().getComputedTextLength()>t&&(o.pop(),n.text(o.join(" ")),o=[e],n=this.addSpan(e),n.attr({x:p,y:h,dy:++s*a+"em"}))},center:function(t){if(t){var e,n,r,i,o,s=t.bbox().toJson(),a=this.graph.matrix.data();this.reset(),e=this.bbox().toJson(),n=s.width/2,r=s.height/2,i=e.x+e.width/2,o=e.y+e.height/2,a.rotate?this.translate(n,r).rotate(a.rotate).commit():this.translate(n,r).commit()}},pathinfo:function(){var t=this.dimension();return new Graph.lang.Path([["M",t.x,t.y],["l",t.width,0],["l",0,t.height],["l",-t.width,0],["z"]]);
},toString:function(){return"Graph.svg.Text"},onTextRender:function(){var t=this;t.arrange()}}),Graph.svg.Text.toString=function(){return"function(x, y, text)"}}(),function(){Graph.svg.Image=Graph.extend(Graph.svg.Vector,{attrs:{preserveAspectRatio:"none",class:Graph.string.CLS_VECTOR_IMAGE},constructor:function(t,e,n,r,i){var o=this;o.superclass.prototype.constructor.call(o,"image",{"xlink:href":t,x:_.defaultTo(e,0),y:_.defaultTo(n,0),width:_.defaultTo(r,0),height:_.defaultTo(i,0)})},align:function(t,e){if("none"==t)return this.attr("preserveAspectRatio","none"),this;var n=this.attrs.preserveAspectRatio,r="";switch(n=/(meet|slice)/.test(n)?n.replace(/(.*)\s*(meet|slice)/i,"$2"):"",e=_.defaultTo(e,n),t=t.replace(/s+/," ").toLowerCase()){case"top left":case"left top":r="xMinYMin";break;case"top center":case"center top":r="xMidYMin";break;case"top right":case"right top":r="xMaxYMin";break;case"left":r="xMinYMid";break;case"center":r="xMidYMid";break;case"right":r="xMaxYMid";break;case"bottom left":
case"left bottom":r="xMinYMax";break;case"bottom center":case"center bottom":r="xMidYMax";break;case"bottom right":case"right bottom":r="xMaxYMax"}return n=r+(e?" "+e:""),this.attr("preserveAspectRatio",n),this},pathinfo:function(){var t=this.attrs;return new Graph.lang.Path([["M",t.x,t.y],["l",t.width,0],["l",0,t.height],["l",-t.width,0],["z"]])},resize:function(t,e,n,r,i,o){var s=this.graph.matrix.clone().scale(t,e,n,r),a=this.graph.matrix.data().rotate;this.reset();var p=s.x(this.attrs.x,this.attrs.y),h=s.y(this.attrs.x,this.attrs.y),c=+this.attrs.width*t,l=+this.attrs.height*e;return this.attr({x:p,y:h,width:c,height:l}),this.rotate(a,p,h).commit(),{matrix:s,x:p,y:h}},toString:function(){return"Graph.svg.Image"}}),Graph.svg.Image.toString=function(){return"function(src, x, y, width, height)"}}(),function(){Graph.svg.Line=Graph.extend(Graph.svg.Vector,{attrs:{class:Graph.string.CLS_VECTOR_LINE},constructor:function(t,e,n,r){var i=_.toArray(arguments);if(1===i.length){var o=i[0].start().toJson(),s=i[0].end().toJson();
t=o.x,e=o.y,n=s.x,r=s.y}else 2===i.length&&(Graph.isPoint(i[0])?(t=i[0].props.x,e=i[0].props.y,n=i[1].props.x,r=i[1].props.y):(t=i[0].x,e=i[0].y,n=i[1].x,r=i[1].y));this.superclass.prototype.constructor.call(this,"line",{x1:_.defaultTo(t,0),y1:_.defaultTo(e,0),x2:_.defaultTo(n,0),y2:_.defaultTo(r,0)})},toString:function(){return"Graph.svg.Line"}}),Graph.svg.Line.toString=function(){return"function(x1, y1, x2, y2)"}}(),function(){var t=Graph.svg.Paper=Graph.extend(Graph.svg.Vector,{attrs:{class:Graph.string.CLS_VECTOR_SVG},props:{id:null,guid:null,type:"paper",text:null,rotate:0,traversable:!1,selectable:!1,selected:!1,focusable:!1,rendered:!1,showOrigin:!0,zoomable:!0},components:{viewport:null},constructor:function(t,e,n){var r=this;r.superclass.prototype.constructor.call(r,"svg",{xmlns:Graph.config.xmlns.svg,"xmlns:link":Graph.config.xmlns.xlink,version:Graph.config.svg.version}),_.assign(r.props,n||{}),r.style({overflow:"hidden",position:"relative"}),r.interactable(),r.initLayout(),r.plugins.collector=new Graph.plugin.Collector(r),
r.plugins.toolmgr.register("collector","plugin"),r.plugins.linker=new Graph.plugin.Linker(r),r.plugins.toolmgr.register("linker","plugin"),r.plugins.pencil=new Graph.plugin.Pencil(r),r.plugins.definer=new Graph.plugin.Definer(r),r.plugins.snapper=new Graph.plugin.Snapper(r),r.utils.spotlight=new Graph.util.Spotlight(r),r.utils.toolpad=new Graph.util.Toolpad(r),r.on("pointerdown",_.bind(r.onPointerDown,r)),r.on("keynavdown",_.bind(r.onKeynavDown,r)),r.on("keynavup",_.bind(r.onKeynavUp,r)),Graph.topic.subscribe("link/update",_.bind(r.listenLinkUpdate,r)),Graph.topic.subscribe("link/remove",_.bind(r.listenLinkRemove,r)),Graph.topic.subscribe("shape/draw",_.bind(r.listenShapeDraw,r))},initLayout:function(){var t=(new Graph.svg.Group).addClass(Graph.string.CLS_VECTOR_VIEWPORT).selectable(!1);if(t.props.viewport=!0,this.components.viewport=t.guid(),this.props.showOrigin){var e=Graph.$('<g class="graph-origin"><rect class="x" rx="1" ry="1" x="-16" y="-2" height="2" width="30"></rect><rect class="y" rx="1" ry="1" x="-2" y="-16" height="30" width="2"></rect><text class="t" x="-40" y="-10">(0, 0)</text></g>');
e.appendTo(t.elem),e=null}t.tree.paper=t.tree.parent=this.guid(),t.translate(.5,.5).commit(),this.elem.append(t.elem),this.children().push(t),t.on("render",function(){t.cascade(function(e){e===t||e.props.rendered||(e.props.rendered=!0,e.tree.paper=t.tree.paper,e.fire("render"))})}),this.layout("default")},layout:function(t){var e=this.viewport();return void 0===t?e.graph.layout:(e.layout(t),this)},shape:function(t,e){var n=Graph.shape(t,e);return n.render(this),n},render:function(t){var e=this,n=e.viewport();e.guid();if(!e.props.rendered){if(t=Graph.$(t),t.append(e.elem),e.tree.container=t,e.elem.css({width:"100%",height:"100%"}),e.props.rendered=!0,e.fire("render"),n.props.rendered=!0,n.fire("render"),e.props.zoomable){e.zoomable();var r=_.debounce(function(){r.flush(),r=null,e.tool().activate("panzoom")},1e3);r()}return e}},container:function(){return this.tree.container},viewport:function(){return Graph.registry.vector.get(this.components.viewport)},scale:function(t,e,n,r){return void 0===t?this.viewport().matrix().scale():this.plugins.transformer.scale(t,e,n,r);
},snapping:function(t){Graph.isVector(t)&&(t={vector:t,shield:t,enabled:!0});var e=this.plugins.snapper;e.subscribe(t)},connect:function(t,e,n,r,i){var o,s,a;return n&&(Graph.isPoint(n)||(i=n,n=null,r=null)),t=Graph.isShape(t)?t.hub():t,e=Graph.isShape(e)?e.hub():e,o=this.layout(),s=o.createRouter(t,e,i),a=o.createLink(s),a.connect(n,r),a.render(this),a},parse:function(t){var e=this,n={};_.forEach(t.shapes,function(t){!function(t){var r=Graph.shape(t.type,t.data);r.render(e),n[t.data.id]=r}(t)}),_.forEach(t.links,function(t){!function(t){e.connect(n[t.source],n[t.target])}(t)})},save:function(){alert("save")},toString:function(){return"Graph.svg.Paper"},onPointerDown:function(t){if(t.target===this.node()){var e=this.tool().current();"collector"!=e&&this.tool().activate("panzoom")}},onKeynavDown:function(t){var e=this,n=t.keyCode;switch(n){case Graph.event.DELETE:for(var r,i=e.plugins.collector.collection,o=i.length-1;o>=0;o--)(r=i[o])&&(r.remove(),i.splice(o,1));t.preventDefault();break;
case Graph.event.SHIFT:break;case Graph.event.ESC:}},onKeynavUp:function(t){var e=t.keyCode;switch(e){case Graph.event.SHIFT:}},saveAsImage:function(t){var e=new Graph.data.Exporter(this);e.exportPNG(t),e=null},save:function(){},listenLinkUpdate:_.debounce(function(){this.layout().arrangeLinks()},300),listenLinkRemove:_.debounce(function(){this.layout().arrangeLinks()},10),listenShapeDraw:_.debounce(function(){this.layout().arrangeShapes()},1)});t.toString=function(){return"function( width, height )"};var e={ellipse:"Ellipse",circle:"Circle",rect:"Rect",path:"Path",polyline:"Polyline",polygon:"Polygon",group:"Group",text:"Text",image:"Image",line:"Line",connector:"Connector"};_.forOwn(e,function(e,n){!function(e,n){t.prototype[n]=function(){var t=[e].concat(_.toArray(arguments)),n=Graph.svg.apply(null,t);return n.tree.paper=this.guid(),n.render(this),t=null,n}}(e,n)})}(),function(){var t={},e={},n=Graph.extend({context:{},constructor:function(){this.context=e},register:function(e){var n=e.guid();
this.get(n);t[n]=e},unregister:function(n){var r=n.guid();t[r]&&delete t[r],e[r]&&delete e[r]},setContext:function(n,r){t[n]&&(e[n]=r)},count:function(){return _.keys(t).length},toArray:function(){var e=_.keys(t);return _.map(e,function(e){return t[e]})},get:function(e){return _.isUndefined(e)?this.toArray():(e instanceof SVGElement?("tspan"==e.tagName&&(e=e.parentNode),e=Graph.$(e).data(Graph.string.ID_VECTOR)):e instanceof Graph.dom.Element&&(e=e.data(Graph.string.ID_VECTOR)),t[e])},wipe:function(e){var n=e.guid();for(var r in t)t.hasOwnProperty(r)&&t[r].tree.paper==n&&delete t[r];t[n]&&delete t[n]},toString:function(){return"Graph.registry.Vector"}});Graph.registry.vector=new n}(),function(){var t={},e={},n=Graph.extend({context:{},constructor:function(){this.context=e},register:function(e){var n=e.guid();t[n]=e},unregister:function(n){var r=n.guid();t[r]&&delete t[r],e[r]&&delete e[r]},setContext:function(n,r){t[n]&&(e[n]=r)},count:function(){return _.keys(t).length},get:function(e){
return _.isUndefined(e)?this.toArray():(e instanceof SVGElement?e=Graph.$(e).data(Graph.string.ID_LINK):e instanceof Graph.dom.Element&&(e=e.data(Graph.string.ID_LINK)),t[e])},collect:function(n){var r=[];for(var i in e)e[i]==n&&t[i]&&r.push(t[i]);return r},toArray:function(){var e=_.keys(t);return _.map(e,function(e){return t[e]})},toString:function(){return"Graph.registry.Link"}});Graph.registry.link=new n}(),function(){var t={},e=Graph.extend({storage:{},constructor:function(){this.storage=t},register:function(e){var n=e.guid();t[n]=e},unregister:function(e){var n=e.guid();t[n]&&(t[n]=null,delete t[n])},count:function(){return _.keys(t).length},toArray:function(){var e=_.keys(t);return _.map(e,function(e){return t[e]})},get:function(e){return _.isUndefined(e)?this.toArray():(e instanceof SVGElement?("tspan"==e.tagName&&(e=e.parentNode),e=Graph.$(e).data(Graph.string.ID_SHAPE)):e instanceof Graph.dom.Element&&(e=e.data(Graph.string.ID_SHAPE)),t[e])},toString:function(){return"Graph.registry.Shape";
}});Graph.registry.shape=new e}(),function(){Graph.layout.Layout=Graph.extend({props:{fit:!0,view:null,width:0,height:0,router:{type:"orthogonal"},link:{smooth:!0,smootness:6}},view:null,cached:{offset:null},constructor:function(t,e){_.assign(this.props,e||{}),this.props.view=t.guid()},view:function(){return Graph.registry.vector.get(this.props.view)},offset:function(){var t,e,n=this.cached.offset;return n||(t=this.view(),e=t.isViewport()?t.parent().node():t.node(),n=e.getBoundingClientRect(),this.cached.offset=n),n},invalidate:function(){this.cached.offset=null},width:function(){},height:function(){},fit:function(){},grabVector:function(t){return Graph.registry.vector.get(t.target)},grabLocation:function(t){var e=t.clientX,n=t.clientY,r=this.offset(),i=this.view().matrix(),o=i.clone().invert(),s=i.scale(),a={x:o.x(e,n),y:o.y(e,n)};return a.x-=r.left/s.x,a.y-=r.top/s.y,i=o=null,a},currentScale:function(){return this.view().matrix().scale()},dragSnapping:function(){return{mode:"anchor",x:1,
y:1}},createRouter:function(t,e,n){var r,i;return r=Graph.router[_.capitalize(this.props.router.type)],n=_.extend({},this.props.router,n||{}),i=Graph.factory(r,[this.view(),t,e,n])},createLink:function(t,e){var n,r;return n=Graph.link[_.capitalize(this.props.router.type)],e=_.extend({},this.props.link,e||{}),r=Graph.factory(n,[t,e])},refresh:function(t){this.fire("refresh")},arrangeLinks:function(){var t=this.view().paper().guid(),e=Graph.registry.link.collect(t);if(e.length){var n=[];_.forEach(e,function(t){t.cached.convex&&n.push(t.guid())});var r,i,o,s=new Graph.util.Sweeplink(e),a=s.findConvex();for(r in a)i=Graph.registry.link.get(r),i.updateConvex(a[r]),i.refresh(!0),o=_.indexOf(n,r),o>-1&&n.splice(o,1);n.length&&_.forEach(n,function(t){var e=Graph.registry.link.get(t);e.removeConvex(),e.refresh(!0)}),s.destroy(),s=null}},arrangeShapes:function(){}})}(),function(){var t=Graph.router.Router=Graph.extend({props:{domain:null,source:null,target:null},values:{start:null,end:null,waypoints:null
},cached:{command:null,segments:null,pathinfo:null,bendpoints:null,bending:null,connect:null},constructor:function(t,e,n,r){_.assign(this.props,r||{}),this.props.domain=t.guid(),this.props.source=e.guid(),this.props.target=n.guid(),this.values.waypoints=[]},invalidate:function(){this.cached.command=null,this.cached.segments=null,this.cached.pathinfo=null,this.cached.bendpoints=null},domain:function(){return Graph.registry.vector.get(this.props.domain)},source:function(t){return void 0===t?Graph.registry.vector.get(this.props.source):(this.props.source=t.guid(),this)},target:function(t){return void 0===t?Graph.registry.vector.get(this.props.target):(this.props.target=t.guid(),this)},layout:function(){return this.domain().layout()},tail:function(){var t=_.first(this.values.waypoints);return t?_.extend({},t):null},head:function(){var t=_.last(this.values.waypoints);return t?_.extend({},t):null},center:function(){var t=this.pathinfo(),e=t.pointAt(t.length()/2,!0);return t=null,e},command:function(t){
var e,n;return void 0===t?(t=this.cached.command,t||(e=this.segments(),t=Graph.util.segments2path(e),this.cached.command=t),t):(e=Graph.util.path2segments(t),n=_.map(e,function(t){return{x:t[1],y:t[2]}}),this.values.waypoints=n,this.invalidate(),e=n=null,this)},segments:function(){var t=this.cached.segments;return t||(t=[],_.forEach(this.values.waypoints,function(e,n){var r=0===n?"M":"L";t.push([r,e.x,e.y])}),this.cached.segments=t),t},waypoints:function(){return this.values.waypoints},bendpoints:function(){var t=this.cached.bendpoints;return t||(t=(this.values.waypoints||[]).slice(),this.cached.bendpoints=t),t},pathinfo:function(){var t=this.cached.pathinfo;return t||(t=Graph.path(this.command()),this.cached.pathinfo=t),t},modify:function(t,e,n){return this.values.waypoints[t].x=e,this.values.waypoints[t].y=n,this},commit:function(){return this.invalidate(),this},route:function(){return this},repair:function(t,e){},relocate:function(t,e){return _.forEach(this.values.waypoints,function(n){
n.x+=t,n.y+=e}),this.commit(),this},initTrans:function(t){},updateTrans:function(t){},bending:function(){},connecting:function(){},stopTrans:function(t){},destroy:function(){for(var t in this.cached)this.cached[t]=null}});t.portCentering=function(t,e,n){return"x"==n&&(t.y=e.y),"y"==n&&(t.x=e.x),t},t.porting=function(e,n,r){var i,o,s=r?0:e.length-1,a=Graph.path(Graph.util.points2path(e)),p=n.intersection(a,!0);return i=e[s],p.length&&(p=t.sortIntersection(p),o=r?p[0]:p[p.length-1]),{index:s,point:i,port:o||i}},t.isRepairable=function(t){var e=t.length;return!(e<3)&&(e>4||!_.find(t,function(e,n){var r=t[n-1];return r&&Graph.util.pointDistance(e,r)<=5}))},t.getSegmentIndex=function(t,e){var n=0;return _.forEach(t,function(r,i){if(Graph.util.isPointOnLine(r,t[i+1],e))return n=i,!1}),n},t.sortIntersection=function(t){return _.sortBy(t,function(t){var e=Math.floor(100*t.t2)||1;return e=100-e,e=(e<10?"0":"")+e,t.segment2+"#"+e})},t.getClosestIntersect=function(e,n,r){var i,o=Graph.path(Graph.util.points2path(e)),s=n.intersection(o,!0),a=1/0;
return s.length&&(s=t.sortIntersection(s),_.forEach(s,function(t){var e=Graph.util.taxicab(t,r);e<=a&&(a=e,i=t)})),i},t.repairBendpoint=function(t,e,n){var r=Graph.util.pointAlign(e,t);switch(r){case"v":return{x:t.x,y:n.y};case"h":return{x:n.x,y:t.y}}return{x:t.x,y:t.y}},t.repairRoutes=function(e,n,r,i){var o=i[0],s=i.slice();return s[0]=r,s[1]=t.repairBendpoint(s[1],o,r),s},t.tidyRoutes=function(t){return _.filter(t,function(e,n){return!Graph.util.isPointOnLine(t[n-1],t[n+1],e)})}}(),function(){var t=Graph.router.Router;Graph.router.Directed=Graph.extend(t,{bendpoints:function(){var t=this.cached.bendpoints;if(!t){var e,n,r,i,o,s,a=this.pathinfo().curve().segments;t=[];for(var p=0,h=a.length;p<h;p++)e=a[p],0===p?(o=e[1],s=e[2],n=Graph.curve([["M",o,s],["C",o,s,o,s,o,s]]),i=n.pointAt(n.t(0),!0),i.index=p,i.range=[0,0],i.space=0,t.push(i)):(n=Graph.curve([["M",o,s],e]),o=e[5],s=e[6],r=n.length(),i=n.pointAt(n.t(r/2),!0),i.index=p,i.range=[p-1,p],i.space=0,t.push(i),i=n.pointAt(n.t(r),!0),
i.index=p,i.range=[p-1,p+1],i.space=1,t.push(i));this.cached.bendpoints=t}return t},route:function(t,e){var n=this.source(),r=n.connectable(),i=r.bbox(),o=i.toJson(),s=this.target(),a=s.connectable(),p=a.bbox(),h=p.toJson(),c=r.orientation(a),l=r.direction(a),u=!1,d=[];t||(t=i.center(!0)),e||(e=p.center(!0));var f,g;if(l){if("h:h"==l){switch(c){case"top-right":case"right":case"bottom-right":f={x:o.x,y:t.y},g={x:h.x+h.width,y:e.y};break;case"top-left":case"left":case"bottom-left":f={x:o.x+o.width,y:t.y},g={x:h.x,y:e.y}}u=!0}if("v:v"==l){switch(c){case"top-left":case"top":case"top-right":f={x:t.x,y:o.y+o.height},g={x:e.x,y:h.y};break;case"bottom-left":case"bottom":case"bottom-right":f={x:t.x,y:o.y},g={x:e.x,y:h.y+h.height}}u=!0}}d=u?[f,g]:[t,e];var v,m=Graph.path(Graph.util.points2path(d));return v=r.pathinfo().intersection(m,!0),v.length&&(d[0]=v[0]),v=a.pathinfo().intersection(m,!0),v.length&&(d[1]=v[v.length-1]),this.values.waypoints=d,this.commit(),this.fire("route",{command:this.command()
}),this},repair:function(e,n){var r=this.source(),i=r.connectable(),o=i.bbox(),s=this.target(),a=s.connectable(),p=a.bbox(),h=this.values.waypoints,c=h.length-1;e===r?h[0]=n:e===s&&(h[c]=n);var l;l=t.getClosestIntersect(h,i.pathinfo(),p.center(!0)),l&&(h[0]=l),l=t.getClosestIntersect(h,a.pathinfo(),o.center(!0)),l&&(h[c]=l),this.commit(),this.fire("route",{command:this.command()})},initTrans:function(t){var e=this.source(),n=this.target(),r=e.connectable(),i=n.connectable(),o=r.pathinfo(),s=i.pathinfo(),a=this.waypoints(),p=t.range.start,h=t.range.end,c=a[p],l=a[h],u=[];"BENDING"==t.trans&&(u=[a[p],a[h]]);var d=this.layout().offset();t.snap.hor=[],t.snap.ver=[],_.forEach(u,function(e){e&&(t.snap.hor.push(e.y+d.top),t.snap.ver.push(e.x+d.left))}),"BENDING"==t.trans?this.cached.bending={source:e,target:n,rangeStart:p,rangeEnd:p,segmentStart:c,segmentEnd:l,original:a.slice(),sourcePath:o,targetPath:s}:this.cached.connect={valid:!1,source:null,target:null,sourcePath:null,targetPath:null,original:a.slice()
}},updateTrans:function(t,e){if("CONNECT"==t){var n=this.cached.connect,r=n.source,i=n.target;_.assign(n,e),r&&n.source?r.guid()!=n.source.guid()&&(n.sourcePath=n.source.connectable().pathinfo()):!r&&n.source&&(n.sourcePath=n.source.connectable().pathinfo()),i&&n.target?i.guid()!=n.target.guid()&&(n.targetPath=n.target.connectable().pathinfo()):!i&&n.target&&(n.targetPath=n.target.connectable().pathinfo())}},bending:function(t,e){var n=this.cached.bending,r=n.original.slice(),i=n.rangeStart,o=(n.rangeEnd,n.segmentStart),s=n.segmentEnd,a={x:t.point.x+t.delta.x,y:t.point.y+t.delta.y},p=Graph.util.pointAlign(o,a,10),h=Graph.util.pointAlign(s,a,10);"h"==p&&"v"==h?(a.x=o.x,a.y=s.y):"v"==p&&"h"==h?(a.y=o.y,a.x=s.x):"h"==p?a.x=o.x:"v"==p?a.y=o.y:"h"==h?a.x=s.x:"v"==h&&(a.y=s.y),t.event.x=a.x,t.event.y=a.y,r.splice(i+1,t.space,a),n.routes=r,this.cropBinding(t,e)},cropBinding:_.debounce(function(e,n){var r,i=this.cached.bending,o=i.routes,s=t.porting(o,i.sourcePath,!0),a=t.porting(o,i.targetPath),p=o.slice(s.index+1,a.index);
p.unshift(s.port),p.push(a.port),i.waypoints=p,n&&(r=Graph.util.points2path(p),n({command:r}))},0),connecting:function(t,e){var n,r=this.cached.connect,i=r.original.slice();n={x:t.point.x+t.delta.x,y:t.point.y+t.delta.y},i[t.index]=n,t.event.x=n.x,t.event.y=n.y,r.routes=i,this.cropConnect(t,e)},cropConnect:_.debounce(function(t,e){var n,r,i,o,s=this.cached.connect,a=s.routes;0===t.index?s.source&&(r=s.sourcePath):s.target&&(r=s.targetPath),r&&(i=Graph.path(Graph.util.points2path(a)),o=r.intersection(i,!0),o.length&&(a[t.index]=o[0])),s.waypoints=a,e&&(n=Graph.util.points2path(a),e({command:n}))},0),stopTrans:function(e){var n,r,i,o;"CONNECT"==e.trans?(n=this.cached.connect,i=n.waypoints,this.cached.connect.valid?(o=!0,this.source(n.source),this.target(n.target),this.fire("reroute",{source:n.source,target:n.target})):(i=n.original.slice(),o=!1)):"BENDING"==e.trans&&(r=this.cached.bending,i=r.waypoints,o=!0),o?this.values.waypoints=t.tidyRoutes(i):this.values.waypoints=i,this.commit(),this.cached.connect=null,
this.cached.bending=null},toString:function(){return"Graph.router.Directed"}})}(),function(){var t=Graph.router.Router;Graph.router.Orthogonal=Graph.extend(t,{bendpoints:function(){var t=this.cached.bendpoints;if(!t){var e,n,r,i,o,s,a=this.pathinfo().curve().segments,p=a.length-1;t=[];for(var h=0,c=a.length;h<c;h++)e=a[h],0===h?(o=e[1],s=e[2],n=Graph.curve([["M",o,s],["C",o,s,o,s,o,s]]),i=n.pointAt(n.t(0),!0),i.index=h,i.range=[h,h+1],i.space=0,t.push(i)):(n=Graph.curve([["M",o,s],e]),o=e[5],s=e[6],r=n.length(),i=n.pointAt(n.t(r/2),!0),i.index=h,i.range=[h-1,h],i.space=0,t.push(i),h===p&&(i=n.pointAt(n.t(r),!0),i.index=h,i.range=[h-1,h],i.space=0,t.push(i)));this.cached.bendpoints=t}return t},route:function(e,n){var r=this.source(),i=this.target(),o=r.connectable(),s=i.connectable(),a=o.bbox(),p=a.data(),h=s.bbox(),c=h.data(),l=o.orientation(s),u=o.direction(s),d=!1;e||(e=a.center(!0)),n||(n=h.center(!0));var f,g;if(u){if("h:h"==u){switch(l){case"top-right":case"right":case"bottom-right":
f={x:p.x+1,y:e.y},g={x:c.x+c.width-1,y:n.y};break;case"top-left":case"left":case"bottom-left":f={x:p.x+p.width-1,y:e.y},g={x:c.x+1,y:n.y}}d=!0}if("v:v"==u){switch(l){case"top-left":case"top":case"top-right":f={x:e.x,y:p.y+p.height-1},g={x:n.x,y:c.y+1};break;case"bottom-left":case"bottom":case"bottom-right":f={x:e.x,y:p.y+1},g={x:n.x,y:c.y+c.height-1}}d=!0}}var v,m,x,y,b;return d?(x=o.pathinfo(),y=Graph.path(Graph.util.points2path([f,g])),b=x.intersection(y,!0),b.length&&(b=b[0],Graph.util.isPointEquals(b,f)||(f=b)),x=s.pathinfo(),b=x.intersection(y,!0),b.length&&(b=b[b.length-1],Graph.util.isPointEquals(b,g)||(g=b)),m=Graph.util.lineBendpoints(f,g,u),v=[f].concat(m).concat([g]),this.values.waypoints=t.tidyRoutes(v)):(f=e,g=n,m=Graph.util.lineBendpoints(f,g,u),y=Graph.path(Graph.util.points2path([f].concat(m).concat([g]))),x=o.pathinfo(),b=x.intersection(y,!0),b.length&&(f=b[0]),x=s.pathinfo(),b=x.intersection(y,!0),b.length&&(g=b[b.length-1]),v=[f].concat(m).concat([g]),this.values.waypoints=t.tidyRoutes(v)),
this.commit(),this.fire("route",{command:this.command()}),this},repair:function(e,n){var r=this.values.waypoints.slice();if(!t.isRepairable(r))return this.route();var i,o,s,a,p,h,c=this.target(),l=c.connectable(),u=l.bbox(),d=this.source(),f=d.connectable(),g=f.bbox();e===d?(i=g.toJson(),o=u.toJson(),s=g.center(!0),a=r):(i=u.toJson(),o=g.toJson(),s=u.center(!0),a=r.slice(),a.reverse()),p="h"==Graph.util.pointAlign(a[0],a[1])?"x":"y",t.portCentering(n,s,p),h=t.repairRoutes(i,o,n,a);var v,m,x,y;if(h){if(e===c&&h.reverse(),v=h.slice(),m=t.getClosestIntersect(h,f.pathinfo(),u.center(!0)),m&&(x=t.getSegmentIndex(h,m),v=v.slice(x+1),v.unshift(m)),m=t.getClosestIntersect(v,l.pathinfo(),g.center(!0)),m&&(y=t.getSegmentIndex(v,m),v=v.slice(0,y+1),v.push(m),2===v.length)){var b=Graph.util.pointAlign(v[0],v[1]);"h"==b?v[1].x=v[0].x:"v"==b&&(v[1].y=v[0].y)}return this.values.waypoints=v,this.commit(),this.fire("route",{command:this.command()}),this}return this.route()},initTrans:function(e){var n=this.waypoints(),r=this.source(),i=this.target(),o=e.ranges.start,s=e.ranges.end,a=r.connectable(),p=i.connectable(),h=a.bbox(),c=p.bbox(),l=n[o],u=n[s],d=[];
"BENDING"==e.trans&&(0===o&&t.portCentering(l,h.center(!0),e.axis),s===n.length-1&&t.portCentering(u,c.center(!0),e.axis),d=[n[o-1],l,u,n[s+1]],o<2&&d.unshift(h.center(!0)),s>n.length-3&&d.unshift(c.center(!0)));var f=this.layout().offset(),g=[],v=[];if(e.snap.hor=[],e.snap.ver=[],_.forEach(d,function(t){t&&("y"==e.axis&&(g.push(t.y),e.snap.hor.push(t.y+f.top)),"x"==e.axis&&(v.push(t.x),e.snap.ver.push(t.x+f.left)))}),this.cached.connect=null,this.cached.bending=null,"BENDING"==e.trans)this.cached.bending={source:r,target:i,original:n,rangeStart:o,rangeEnd:s,segmentStart:l,segmentEnd:u,sourceBound:h.toJson(),targetBound:c.toJson(),sourcePath:a.pathinfo(),targetPath:p.pathinfo(),snapH:g,snapV:v};else{var m=n.slice(),x=Graph.util.pointAlign(l,u,10);if(2===m.length){var y,b;y={x:(l.x+u.x)/2,y:(l.y+u.y)/2},b={x:y.x,y:y.y},m.splice(1,0,y,b),0!==e.index?(o+=2,s+=2,l=m[o],u=m[s],e.index+=2,e.point=_.extend({},u),e.event=_.extend({},u)):u=m[s]}this.cached.connect={valid:!1,source:null,target:null,
sourcePath:null,targetPath:null,rangeStart:o,rangeEnd:s,segmentStart:l,segmentEnd:u,segmentAlign:x,original:m}}},updateTrans:function(t,e){if("CONNECT"==t){var n=this.cached.connect,r=n.source,i=n.target;_.assign(n,e),r&&n.source?r.guid()!=n.source.guid()&&(n.sourcePath=n.source.connectable().pathinfo()):!r&&n.source&&(n.sourcePath=n.source.connectable().pathinfo()),i&&n.target?i.guid()!=n.target.guid()&&(n.targetPath=n.target.connectable().pathinfo()):!i&&n.target&&(n.targetPath=n.target.connectable().pathinfo())}},bending:function(t,e){var n,r,i=this.cached.bending,o=i.original.slice(),s=i.segmentStart,a=i.segmentEnd,p=i.rangeStart,h=i.rangeEnd;n={x:s.x+t.delta.x,y:s.y+t.delta.y},r={x:a.x+t.delta.x,y:a.y+t.delta.y},"x"==t.axis&&(t.event.x=(n.x+r.x)/2),"y"==t.axis&&(t.event.y=(n.y+r.y)/2);var c=Graph.util.snapValue(t.event.x,i.snapV),l=Graph.util.snapValue(t.event.y,i.snapH);t.event.x=c,t.event.y=l,"x"==t.axis&&(n.x=c,r.x=c),"y"==t.axis&&(n.y=l,r.y=l),o[p]=n,o[h]=r;var u,d,f=o.length,g=0;
p<2&&(u=Graph.util.boxOrientation(i.sourceBound,Graph.util.pointbox(n)),1===p?"intersect"==u&&(o.shift(),o[0]=n,g--):"intersect"!=u&&(o.unshift(s),g++)),h>f-3&&(d=Graph.util.boxOrientation(i.targetBound,Graph.util.pointbox(r)),h===f-2?"intersect"==d&&(o.pop(),o[o.length-1]=r):"intersect"!=d&&o.push(a)),i.routes=o,i.newRangeStart=p+g,this.cropBending(e)},cropBending:_.debounce(function(e){var n,r=this.cached.bending,i=r.routes,o=t.porting(i,r.sourcePath,!0),s=t.porting(i,r.targetPath),a=i.slice(o.index+1,s.index);a.unshift(o.port),a.push(s.port),r.waypoints=a,e&&(n=Graph.util.points2path(a),e({command:n}))},0),connecting:function(t,e){var n,r=this.cached.connect,i=r.original.slice(),o=r.segmentAlign,s=r.segmentStart,a=r.segmentEnd,p=r.rangeStart,h=r.rangeEnd;n={x:t.point.x+t.delta.x,y:t.point.y+t.delta.y};var c,l;0===t.index?(c={x:t.point.x+t.delta.x,y:t.point.y+t.delta.y},l="v"==o?{x:a.x,y:c.y}:{x:c.x,y:a.y}):(l={x:t.point.x+t.delta.x,y:t.point.y+t.delta.y},c="h"==o?{x:l.x,y:s.y}:{x:s.x,
y:l.y}),i[p]=c,i[h]=l,t.event.x=n.x,t.event.y=n.y,r.routes=i,this.cropConnect(t,e)},cropConnect:_.debounce(function(t,e){var n=this.cached.connect,r=n.routes;if(n.valid){var i,o,s,a;0===t.index?n.source&&(o=n.sourcePath):n.target&&(o=n.targetPath),o&&(s=Graph.path(Graph.util.points2path(r)),a=o.intersection(s,!0),a.length&&(r[t.index]=a[0]))}n.waypoints=r,e&&(i=Graph.util.points2path(r),e({command:i}))},0),stopTrans:function(e){var n,r,i,o;"CONNECT"==e.trans?(n=this.cached.connect,i=n.waypoints,this.cached.connect.valid?(o=!0,this.source(n.source),this.target(n.target),this.fire("reroute",{source:n.source,target:n.target})):(i=n.original.slice(),o=!1)):"BENDING"==e.trans&&(r=this.cached.bending,i=r.waypoints,o=!0),o?this.values.waypoints=t.tidyRoutes(i):this.values.waypoints=i,this.commit()},toString:function(){return"Graph.router.Orthogonal"}})}(),function(){function t(t,e,n){var r="on"+_.capitalize(e)+_.capitalize(n),i=t[r];return r=null,i}var e=Graph.link.Link=Graph.extend({props:{id:null,
guid:null,rendered:!1,selected:!1,label:"",labelDistance:null,labelX:null,labelY:null,source:null,target:null},components:{block:null,coat:null,path:null,label:null,editor:null},cached:{bendpoints:null,controls:null,convex:null},handlers:{source:null,target:null},router:null,constructor:function(t,n){n=_.extend({id:"graph-link-"+ ++e.guid},n||{}),_.assign(this.props,n),this.props.guid=this.props.id,this.router=t,this.initComponent(),this.bindResource("source",t.source()),this.bindResource("target",t.target()),this.router.on("route",_.bind(this.onRouterRoute,this)),this.router.on("reroute",_.bind(this.onRouterReroute,this)),Graph.registry.link.register(this)},initComponent:function(){var t,e,n,r,i,o=this.components;t=(new Graph.svg.Group).addClass("graph-link").selectable(!1),t.elem.data(Graph.string.ID_LINK,this.props.guid),e=(new Graph.svg.Path).removeClass(Graph.string.CLS_VECTOR_PATH).addClass("graph-link-coat").render(t),e.data("text",this.props.label),e.elem.data(Graph.string.ID_LINK,this.props.guid),
e.draggable({ghost:!0,single:!1,manual:!0}),e.editable({width:150,height:80,offset:"pointer"}),e.on("select.link",_.bind(this.onCoatSelect,this)),e.on("deselect.link",_.bind(this.onCoatDeselect,this)),e.on("dragstart.link",_.bind(this.onCoatDragStart,this)),e.on("dragend.link",_.bind(this.onCoatDragEnd,this)),e.on("edit.link",_.bind(this.onCoatEdit,this)),e.on("beforeedit.link",_.bind(this.onCoatBeforeEdit,this)),e.on("remove.link",_.bind(this.onCoatRemove,this)),n=(new Graph.svg.Path).removeClass(Graph.string.CLS_VECTOR_PATH).addClass("graph-link-path").selectable(!1).clickable(!1).attr("marker-end","url(#marker-arrow)").render(t),n.elem.data(Graph.string.ID_LINK,this.props.guid),i=new Graph.svg.Text(0,0,"").addClass("graph-link-label").selectable(!1).render(t),i.draggable({ghost:!0}),i.on("render.link",_.bind(this.onLabelRender,this)),i.on("dragend.link",_.bind(this.onLabelDragend,this));var s=i.interactable().vendor();s.on("doubletap",_.bind(this.onLabelDoubletap,this)),r=(new Graph.svg.Group).selectable(!1).render(t),
o.block=t.guid(),o.coat=e.guid(),o.path=n.guid(),o.label=i.guid(),o.editor=r.guid()},bindResource:function(e,n){var r=(this.router,this.props[e]),i=this.handlers[e];if(r&&i&&(r=Graph.registry.vector.get(r))){var o,s;for(o in i)s=o+".link",r.off(s,i[o]),s=null}return i={},i.resize=_.bind(t(this,e,"resize"),this),i.rotate=_.bind(t(this,e,"rotate"),this),i.dragstart=_.bind(t(this,e,"dragstart"),this,_,n),i.dragmove=_.bind(t(this,e,"dragmove"),this),i.dragend=_.bind(t(this,e,"dragend"),this),this.handlers[e]=i,this.props[e]=n.guid(),n.on("resize.link",i.resize),n.on("rotate.link",i.rotate),n.isDraggable()&&(n.on("dragstart.link",i.dragstart),n.draggable().ghost()?n.on("dragend.link",i.dragend):n.on("dragmove.link",i.dragmove)),this},bindSource:function(t){return this.bindResource("source",t)},bindTarget:function(t){return this.bindResource("target",t)},component:function(t){return void 0===t?Graph.registry.vector.get(this.components.block):Graph.registry.vector.get(this.components[t])},invalidate:function(){
this.cached.bendpoints=null},render:function(t){var e;this.component().render(t),e=t.paper(),e&&Graph.registry.link.setContext(this.guid(),e.guid())},id:function(){return this.props.id},guid:function(){return this.props.guid},connect:function(){this.router.route()},update:function(t,e){e=_.defaultTo(e,!1),this.component("coat").attr("d",t).dirty(!0),this.component("path").attr("d",t),this.invalidate(),e||(this.redraw(),this.fire("update"),Graph.topic.publish("link/update"))},refresh:function(t){var e=this.router.command();this.update(e,t)},updateConvex:function(t){this.cached.convex=t},removeConvex:function(){this.cached.convex=null},redraw:function(){if(this.props.label){var t=this.component("label"),e=t.bbox().toJson(),n=this.props.labelDistance||.5,r=this.router.layout().currentScale(),i=this.router.pathinfo(),o=i.pointAt(n*i.length(),!0),s=Graph.util.pointAlign(o.start,o.end,10);"h"==s?o.x+=(10+e.width/2)/r.x:o.y-=(10+e.height/2)/r.y,t.attr({x:o.x,y:o.y}),i=null,o=null,t.dirty(!0)}},
label:function(t,e,n){var r,i,o;return void 0===t?this.props.label:(this.props.label=t,void 0!==e&&void 0!==n?(r=this.router.pathinfo(),o=r.nearest({x:e,y:n}),i=o.distance/r.length()):_.isNull(this.props.labelDistance)&&(r=this.router.pathinfo(),i=.5,o=r.pointAt(r.length()/2,!0)),o&&(this.props.labelDistance=i,r=o=null),this.component("label").write(t),this.component("coat").data("text",t),this.redraw(),this)},select:function(){this.props.selected=!0,this.component("block").addClass("selected"),this.sendToFront(),this.resumeControl()},deselect:function(){this.props.selected=!1,this.component("block").removeClass("selected"),this.suspendControl()},renderControl:function(){},resumeControl:function(){var t=this,e=t.component("editor");t.cached.bendpoints||(t.cached.bendpoints=t.router.bendpoints(),t.renderControl()),e.elem.appendTo(this.component("block").elem)},suspendControl:function(){this.component("editor").elem.detach()},sendToFront:function(){var t=this.component().parent();this.component().elem.appendTo(t.elem);
},toString:function(){return"Graph.link.Link"},onRouterRoute:function(t){var e=t.command;this.update(e)},onRouterReroute:function(t){var e=t.source,n=t.target;this.bindResource("source",e),this.bindResource("target",n),this.sendToFront()},onLabelRender:function(t){this.props.label&&this.label(this.props.label)},onLabelDragend:function(t){var e=this.component("label"),n=e.matrix(),r=e.attrs.x,i=e.attrs.y,o={x:n.x(r,i),y:n.y(r,i)};e.attr({x:o.x,y:o.y});var s=this.router.pathinfo(),a=s.nearest(o);this.props.labelDistance=a.distance/s.length(),e.reset(),n=s=null},onLabelDoubletap:function(t){var e=this.component("coat");e.editable().startEdit(t)},onCoatBeforeEdit:function(t){this.component("label").hide(),this.component().addClass("editing")},onCoatEdit:function(t){this.component().removeClass("editing"),this.component("label").show(),this.label(t.text,t.left,t.top)},onCoatSelect:function(t){this.select()},onCoatDeselect:function(t){this.deselect()},onCoatDragStart:function(t){this.suspendControl();
},onCoatDragEnd:function(t){var e=t.dx,n=t.dy;this.router.relocate(e,n),this.update(this.router.command())},onCoatRemove:function(t){this.destroy()},onSourceRotate:function(){},onSourceDragstart:function(t,e){var n=this.component("coat").$collector;e.$collector||n&&n.decollect(this.component("coat")),this.cached.convex=null},onSourceDragmove:function(){this.router.repair("source")},onSourceDragend:function(t){var e=this.component("coat").$collector;if(!e){var n=this.router.tail();n.x+=t.dx,n.y+=t.dy,this.router.repair(this.router.source(),n)}},onSourceResize:function(t){var e=this.router.tail();e.x+=t.translate.dx,e.y+=t.translate.dy,this.router.repair(this.router.source(),e)},onTargetRotate:function(){},onTargetDragstart:function(t,e){var n=this.component("coat").$collector;e.$collector||n&&n.decollect(this.component("coat")),this.cached.convex=null},onTargetDragmove:function(){this.router.repair("target")},onTargetDragend:function(t){var e=this.component("coat").$collector;if(!e){var n=this.router.head();
n.x+=t.dx,n.y+=t.dy,this.router.repair(this.router.target(),n)}},onTargetResize:function(t){var e=this.router.head();e.x+=t.translate.dx,e.y+=t.translate.dy,this.router.repair(this.router.target(),e)},destroy:function(){var t,e=this;e.component("label").remove(),e.cached.controls&&(_.forEach(e.cached.controls,function(t){var e=Graph.registry.vector.get(t);e&&e.remove()}),e.cached.controls=null),e.component("editor").remove(),e.component("path").remove(),e.component("block").remove();for(t in e.components)e.components[t]=null;_.forEach(["source","target"],function(t){var n,r,i=e.handlers[t],o=e.router[t]();if(i&&o)for(n in i)r=n+".link",o.off(r,i[n]);i=null});for(t in e.cached)e.cached[t]=null;e.router.destroy(),e.router=null,Graph.registry.link.unregister(e),Graph.topic.publish("link/remove")}});e.guid=0}(),function(){var t=Graph.link.Link;Graph.link.Directed=Graph.extend(t,{renderControl:function(){var t=this,e=t.component("editor");t.cached.controls&&(_.forEach(t.cached.controls,function(t){
t=Graph.registry.vector.get(t),t.remove()}),t.cached.controls=null);var n=this.cached.bendpoints,r=n.length-1,i=t.guid(),o=[];_.forEach(n,function(n,s){var a=new Graph.svg.Image(Graph.config.base+"img/resize-control.png",n.x-8.5,n.y-8.5,17,17);a.selectable(!1),a.removeClass(Graph.string.CLS_VECTOR_IMAGE),0===s?(a.addClass(Graph.string.CLS_LINK_TAIL),a.elem.data("pole","tail")):s===r&&(a.addClass(Graph.string.CLS_LINK_HEAD),a.elem.data("pole","head")),a.elem.group("graph-link"),a.elem.data(Graph.string.ID_LINK,i);var p={trans:0===s||s===r?"CONNECT":"BENDING",index:n.index,space:n.space,point:{x:n.x,y:n.y},event:{x:n.x,y:n.y},range:{start:n.range[0],end:n.range[1]},delta:{x:0,y:0},snap:{hor:[],ver:[]}};a.draggable(),a.cursor("default"),a.on("dragstart",_.bind(t.onControlStart,t,_,p,a)),a.on("dragmove",_.bind(t.onControlMove,t,_,p,a)),a.on("dragend",_.bind(t.onControlEnd,t,_,p,a)),a.render(e),o.push(a.guid())}),t.cached.controls=o,o=null},onControlStart:function(t,e,n){this.router.initTrans(e);
var r=e.snap.hor,i=e.snap.ver;n.draggable().snap([function(t,e){var n=Graph.util.snapValue(t,i),o=Graph.util.snapValue(e,r);return{x:n,y:o,range:10}}]),_.forEach(this.cached.controls,function(t){var e=Graph.registry.vector.get(t);e&&e!==n&&e.hide()}),n.show()},onControlMove:function(t,e,n){var r=this;e.delta.x+=t.dx,e.delta.y+=t.dy;var i,o,s,a;i=e.event.x,o=e.event.y,"BENDING"==e.trans?r.router.bending(e,function(t){r.update(t.command,!0)}):r.router.connecting(e,function(t){r.update(t.command,!0)}),s=e.event.x,a=e.event.y,t.originalData.dx=s-i,t.originalData.dy=a-o},onControlEnd:function(t,e,n){this.router.stopTrans(e),this.update(this.router.command()),this.invalidate(),this.resumeControl()}})}(),function(){Graph.link.Orthogonal=Graph.extend(Graph.link.Link,{update:function(t,e){var n,r,i,o,s,a;if(e=_.defaultTo(e,!1),n=this.cached.convex,r=this.props.smooth,n&&(o=this.router.waypoints().slice(),s=o.length-1,a=[],_.forEach(o,function(t,e){var r,i=t,s=o[e+1];r=0===e?["M",t.x,t.y]:["L",t.x,t.y],
a.push(r),n[e]&&_.forEach(n[e],function(t){var e=Graph.util.convexSegment(t,i,s);e&&a.push(e[0],e[1])})}),t=Graph.util.segments2path(a)),r){i=this.props.smootness||6,a=a||Graph.util.path2segments(t).slice();var p,h,c,l,u,d;for(u=0;u<a.length;u++)if(p=a[u],c=a[u+1],d=!("L"!=p[0]||!c||"Q"==c[0]),d&&(l={x:p[p.length-2],y:p[p.length-1]},h=a[u-1],h&&c)){var f=Graph.util.smoothSegment(l,{x:h[h.length-2],y:h[h.length-1]},{x:c[c.length-2],y:c[c.length-1]},i);f&&(a.splice(u,1,f[0],f[1]),u++)}t=Graph.util.segments2path(a)}this.component("coat").attr("d",t).dirty(!0),this.component("path").attr("d",t),this.invalidate(),e||(this.redraw(),this.fire("update"),Graph.topic.publish("link/update"))},renderControl:function(){var t=this,e=t.component("editor");t.cached.controls&&(_.forEach(t.cached.controls,function(t){t=Graph.registry.vector.get(t),t.remove()}),t.cached.controls=null);var n=this.cached.bendpoints,r=t.guid(),i=n.length-1,o=[];_.forEach(n,function(n,s){var a,p,h,c,l;a=new Graph.svg.Image(Graph.config.base+"img/resize-control.png",n.x-8.5,n.y-8.5,17,17),
a.selectable(!1),a.removeClass(Graph.string.CLS_VECTOR_IMAGE),a.elem.group("graph-link"),a.elem.data(Graph.string.ID_LINK,r),l={},c=null,p="default",0===s?(a.addClass(Graph.string.CLS_LINK_TAIL),a.elem.data("pole","tail")):s===i?(a.addClass(Graph.string.CLS_LINK_HEAD),a.elem.data("pole","head")):(h=Graph.util.pointAlign(n.start,n.end),c="v"==h?"y":"x",p="x"==c?"ew-resize":"ns-resize",l={axis:c});var u={trans:0===s||s===i?"CONNECT":"BENDING",index:n.index,axis:c,cursor:p,point:{x:n.x,y:n.y},ranges:{start:n.range[0],end:n.range[1]},event:{x:n.x,y:n.y},snap:{hor:[],ver:[]},delta:{x:0,y:0}};a.draggable(l),a.cursor(p),a.on("dragstart",_.bind(t.onControlStart,t,_,u,a)),a.on("dragmove",_.bind(t.onControlMove,t,_,u)),a.on("dragend",_.bind(t.onControlEnd,t,_,u,a)),a.render(e),o.push(a.guid())}),t.cached.controls=o,o=null},onControlStart:function(t,e,n){this.component("coat").cursor(e.cursor),this.router.initTrans(e);var r=e.snap.hor,i=e.snap.ver;n.draggable().snap([function(t,e){var n=Graph.util.snapValue(t,i),o=Graph.util.snapValue(e,r);
return{x:n,y:o,range:10}}]),_.forEach(this.cached.controls,function(t){var e=Graph.registry.vector.get(t);e&&e!==n&&e.hide()}),n.show(),this.removeConvex()},onControlMove:function(t,e){var n=this;e.delta.x+=t.dx,e.delta.y+=t.dy;var r,i,o,s,a,p;r=e.event.x,i=e.event.y,"BENDING"==e.trans?n.router.bending(e,function(t){n.update(t.command,!0)}):n.router.connecting(e,function(t){n.update(t.command,!0)}),o=e.event.x,s=e.event.y,a=o-r,p=s-i,t.originalData.dx=a,t.originalData.dy=p},onControlEnd:function(t,e,n){this.component("coat").cursor("pointer"),this.router.stopTrans(e),this.update(this.router.command()),this.invalidate(),this.resumeControl()},toString:function(){return"Graph.link.Orthogonal"}})}(),function(){Graph.util.Spotlight=Graph.extend({props:{suspended:!0,rendered:!1},components:{G:null,N:null,E:null,S:null,W:null},paper:null,constructor:function(t){var e=this,n=e.components;e.paper=t,n.G=(new Graph.svg.Group).traversable(!1).selectable(!1).addClass("graph-util-spotlight"),_.forEach(["N","E","S","W"],function(t){
n[t]=new Graph.svg.Line(0,0,0,0).removeClass(Graph.string.CLS_VECTOR_LINE).traversable(!1).selectable(!1).render(n.G)})},component:function(){return this.components.G},render:function(){this.props.rendered||(this.components.G.render(this.paper),this.props.rendered=!0)},suspend:function(){this.props.suspended=!0,this.components.G.elem.detach()},resume:function(){this.props.suspended=!1,this.props.rendered?this.paper.viewport().elem.append(this.components.G.elem):this.render()},focus:function(t,e){if(e=_.defaultTo(e,!0),!e)return void this.suspend();var n,r,i,o,s=t.bbox().toJson(),a=(t.dots(!0),this.components),p=this.paper;n=s.x,r=s.y,i=p.elem.height()||0,o=p.elem.width()||0,this.resume(),a.W.attr({x1:n,y1:0,x2:n,y2:i}),a.E.attr({x1:n+s.width,y1:0,x2:n+s.width,y2:i}),a.N.attr({x1:0,y1:r,x2:o,y2:r}),a.S.attr({x1:0,y1:r+s.height,x2:o,y2:r+s.height})},toString:function(){return"Graph.util.Spotlight"}})}(),function(){Graph.util.Toolpad=Graph.extend({props:{vector:null,rendered:!1,suspended:!0,
tools:[]},components:{block:null},paper:null,constructor:function(t){this.paper=t,this.initComponent(),Graph.topic.subscribe("vector/select",_.bind(this.onVectorSelect,this)),Graph.topic.subscribe("vector/deselect",_.bind(this.onVectorDeselect,this))},initComponent:function(){var t=this.components;t.block=Graph.$('<div class="graph-util-toolpad">')},render:function(){return this.props.rendered?void this.redraw():(this.paper.container().append(this.components.block),this.rendered=!0,void this.redraw())},vector:function(){return Graph.registry.vector.get(this.props.vector)},resume:function(){this.props.suspended=!1,this.props.rendered?this.paper.container().append(this.components.block):this.render(),this.redraw()},redraw:function(){var t=this.vector(),e=t.bbox().toJson(),n=t.position();this.components.block.css({top:n.top,left:n.left+e.width+12})},suspend:function(){this.props.suspended=!0,this.components.block.detach()},onVectorSelect:function(t){},onVectorDeselect:function(t){}})}(),function(){
function t(t){var e=function(t){return t},n=_.bisector(function(t){return e(t)}).left;return t.insert=function(n){var r=t.findIndex(n),i=e(n);if(!t[r]||i!=e(t[r]))return t.splice(r,0,n),r},t.remove=function(e){var n=t.findIndex(e);return t.splice(n,1),n},t.findIndex=function(r){return n(t,e(r))},t.key=function(n){return e=n,t},t.swap=function(){},t.order=function(){return t.sort(_.ascendingKey(e)),t},t}var e=1e-9,n=.1,r=Graph.util.Sweeplink=function(t){var e=this;e.points=[],e.queue=[],e.lines=[],e.found=[],e.process=[],_.forEach(t,function(t){var n=e.extract(t);Array.prototype.push.apply(e.points,n)}),_.forEach(e.points,function(t,n){n%2&&e.lines.push(_.sortBy([t,e.points[n-1]],"y"))}),_.forEach(e.lines,function(t,e){t[0].x==t[1].x&&(t[0].x+=n,t[1].x-=n),t[0].y==t[1].y&&(t[0].y-=n,t[1].y+=n),t[0].line=t,t[1].line=t})};r.prototype.constructor=r,r.prototype.extract=function(t){var e=t.router.pathinfo().curve().segments,n=[];return _.forEach(e,function(r,i){var o=0===i?{x:r[1],y:r[2]}:{x:r[5],
y:r[6]},s=e[i+1];s&&(s={x:s[5],y:s[6]},Graph.util.movepoint(o,s,-20),Graph.util.movepoint(s,o,-20),o.x=Math.round(o.x,3),o.y=Math.round(o.y,3),s.x=Math.round(s.x,3),s.y=Math.round(s.y,3),o.link=t,s.link=t,o.range=i,s.range=i+1,n.push(o,s))}),n},r.prototype.findConvex=function(){var n=this;n.queue=t(n.points.slice()).key(function(t){return t.y+e*t.x}).order(),n.found=[],n.process=t([]);for(var r=0;r<n.queue.length&&r<1e3;r++){var i,o,s,a,p=n.queue[r];p.line&&p.line[0]==p?(p.type="insert",i=n.process.key(function(t){return n.intercept(t,p.y-e/1e3)}).insert(p.line),n.validate(p.line,n.process[i+1]),n.validate(p.line,n.process[i-1])):p.line?(p.type="removal",i=n.process.findIndex(p.line),n.process.remove(p.line),n.validate(n.process[i-1],n.process[i])):p.lineA&&p.lineB&&(n.process.key(function(t){return n.intercept(t,p.y-e/1e3)}),o=n.process.findIndex(p.lineA),s=n.process.findIndex(p.lineB),o==s&&(o+=1),n.process[o]=p.lineB,n.process[s]=p.lineA,a=o<s?o:s,n.validate(n.process[a-1],n.process[a]),
n.validate(n.process[a+1],n.process[a+2]))}var h={};return _.forEach(this.found,function(e){var n,r,i,o,s,a,p,c,l,u,d;p=Graph.util.pointAlign(e.lineA[0],e.lineA[1],10),c=Graph.util.pointAlign(e.lineB[0],e.lineB[1],10),p!=c&&(o="v"==p?p:c,l="v"==p?e.lineA:e.lineB,u=l[0].link,d=u.guid(),n=u.router.waypoints(),r=Math.min(l[0].range,l[1].range),i=Math.max(l[0].range,l[1].range),s=n[r],a=n[i],h[d]||(h[d]={}),h[d][r]||(h[d][r]=t([]).key(function(t){return"v"==t.segmentAlign?t.segmentStart.x<t.segmentEnd.x?t.x+t.segmentStart.x:t.segmentStart.x-t.x:t.segmentStart.y<t.segmentEnd.y?t.y+t.segmentStart.y:t.segmentStart.y-t.y})),h[d][r].insert({x:e.x,y:e.y,link:u.guid(),rangeStart:r,rangeEnd:i,segmentAlign:o,segmentStart:s,segmentEnd:a}))}),h},r.prototype.intersect=function(t,e,n,r){var i=(t.x-e.x)*(n.y-r.y)-(t.y-e.y)*(n.x-r.x),o=t.x*e.y-t.y*e.x,s=n.x*r.y-n.y*r.x,a=(o*(n.x-r.x)-s*(t.x-e.x))/i,p=(o*(n.y-r.y)-s*(t.y-e.y))/i,h={x:a,y:p};return h.isOverlap=a==t.x&&p==t.y||a==e.x&&p==e.y,h.isIntersection=!(t.x<a^a<e.x)&&!(n.x<a^a<r.x)&&!h.isOverlap&&i,
h},r.prototype.validate=function(t,e){if(t&&e){var n=this.intersect(t[0],t[1],e[0],e[1]);n.lineA=t,n.lineB=e,n.isIntersection&&this.found.push(n)&&this.queue.insert(n)}},r.prototype.intercept=function(t,e){var n=t[0],r=t[1],i=(n.y-r.y)/(n.x-r.x);return(e-n.y+i*n.x)/i},r.prototype.destroy=function(){this.points=null,this.lines=null,this.found=null,this.queue=null,this.process=null}}(),function(){Graph.plugin.Plugin=Graph.extend({props:{shield:null,vector:null,activator:"tool"},cached:{bboxMatrix:null,pathMatrix:null},vector:function(){return Graph.registry.vector.get(this.props.vector)},shield:function(){return this.props.shield==this.props.vector?this.vector():Graph.registry.vector.get(this.props.shield)},invalidate:function(){this.cached.bboxMatrix=null,this.cached.pathMatrix=null},bboxMatrix:function(){var t=this.cached.bboxMatrix;return t||(t=this.props.vector==this.props.shield?this.vector().matrix().clone():this.shield().matrix().clone(),this.cached.bboxMatrix=t),t},pathMatrix:function(){
var t=this.cached.pathMatrix;if(!t){if(t=Graph.matrix(),this.props.vector==this.props.shield)t=t.multiply(this.vector().matrix());else{var e=this.shield(),n=this.vector();n.bubble(function(n){if(t.multiply(n.matrix()),n==e)return!1})}this.cached.pathMatrix=t}return t},bbox:function(){var t=this.bboxMatrix(),e=this.vector().pathinfo().transform(t),n=e.bbox();return t=e=null,n},pathinfo:function(){var t=this.pathMatrix(),e=this.vector().pathinfo().transform(t);return t=null,e},hasShield:function(){return this.props.vector!=this.props.shield},enable:function(t){},disable:function(){},destroy:function(){}})}(),function(){Graph.plugin.Definer=Graph.extend(Graph.plugin.Plugin,{props:{vector:null},definitions:{},components:{holder:null},constructor:function(t){this.props.vector=t.guid(),this.components.holder=Graph.$("<defs/>"),this.components.holder.prependTo(t.elem),t.isPaper()&&this.defineArrowMarker("marker-arrow")},defineArrowMarker:function(t){if(this.definitions[t])return this.definitions[t];
var e=Graph.$(_.format('<marker id="{0}" refX="{1}" refY="{2}" viewBox="{3}" markerWidth="{4}" markerHeight="{5}" orient="{6}"><path d="{7}" fill="{8}" stroke-width="{9}" stroke-linecap="{10}" stroke-dasharray="{11}"></path></marker>',t,"11","10","0 0 20 20","10","10","auto","M 1 5 L 11 10 L 1 15 Z","#000000","1","round","10000, 1"));return this.definitions[t]=e,this.components.holder.append(e),e},toString:function(){return"Graph.plugin.Definer"}})}(),function(){var t=Graph.plugin.Reactor=Graph.extend(Graph.plugin.Plugin,{props:{vector:null},plugin:null,navigationKeys:[Graph.event.ENTER,Graph.event.DELETE,Graph.event.SHIFT,Graph.event.CTRL,Graph.event.ESC],constructor:function(t,e){var n=this;this.props.vector=t.guid(),this.plugin=interact(t.node()),this.listeners=e||{},this.plugin.on("down",function(e){e.originalType="pointerdown",t.fire(e)},!0),t.elem.on({mouseenter:function(e){e.type="pointerin",t.fire(e)},mouseleave:function(e){e.type="pointerout",t.fire(e)}}),t.isPaper()&&(Graph.$(document).on("keydown",function(e){
n.isNavigation(e)&&(e.originalType="keynavdown",t.fire(e))}),Graph.$(document).on("keyup",function(e){n.isNavigation(e)&&(e.originalType="keynavup",t.fire(e))}))},isNavigation:function(t){var e=t.keyCode;return _.indexOf(this.navigationKeys,e)>-1},vendor:function(){return this.plugin},draggable:function(t){return this.plugin.draggable(t)},dropzone:function(t){return this.plugin.dropzone(t)},gesturable:function(t){return this.plugin.gesturable(t)},destroy:function(){this.plugin.unset(),this.plugin=null},toString:function(){return"Graph.plugin.Reactor"}}),e=t.prototype.on,n=t.prototype.off;t.prototype.on=function(t,n){var r=this.vector();return e.apply(r,[t,n])},t.prototype.off=function(t,e){var r=this.vector();return n.apply(r,[t,e])}}(),function(){Graph.plugin.Transformer=Graph.extend(Graph.plugin.Plugin,{props:{scale:1,rotate:0},constructor:function(t){this.actions=[],this.props.vector=t.guid()},transform:function(t){var e=this,n=Graph.util.transform2segments(t);return _.forEach(n,function(t){
var n=t.shift();e[n]&&_.isFunction(e[n])&&!function(){e[n].apply(e,t)}(n,t)}),this},queue:function(){var t=_.toArray(arguments);return this.actions.push({name:t.shift(),args:t,sort:this.actions.length}),this},translate:function(t,e){return t=_.defaultTo(t,0),e=_.defaultTo(e,0),this.queue("translate",t,e),this},rotate:function(t,e,n){return _.isUndefined(e)||_.isUndefined(n)?this.queue("rotate",t):this.queue("rotate",t,e,n),this},scale:function(t,e,n,r){return e=_.defaultTo(e,t),_.isUndefined(n)||_.isUndefined(r)?this.queue("scale",t,e):this.queue("scale",t,e,n,r),this},matrix:function(t,e,n,r,i,o){return this.queue("matrix",t,e,n,r,i,o),this},commit:function(t,e){var n=this,r=n.actions,i=n.vector(),o={translate:!1,rotate:!1,scale:!1};if(r.length){t=_.defaultTo(t,!1),e=_.defaultTo(e,!1);var s=0,a=1,p=1,h=i.matrix().clone();if(_.forEach(r,function(e){var n=e.args,r=e.name,c=n.length,l=!1;t&&(l=h.invert(!0));var u,d,f,g,v;"translate"==r&&2===c?(t?(u=l.x(0,0),d=l.y(0,0),f=l.x(n[0],n[1]),g=l.y(n[0],n[1]),
h.translate(f-u,g-d)):h.translate(n[0],n[1]),o.translate=!0):"rotate"==r?(1==c?(v=v||i.bbox(!0).toJson(),h.rotate(n[0],v.x+v.width/2,v.y+v.height/2),s+=n[0]):3==c&&(t?(f=l.x(n[1],n[2]),g=l.y(n[1],n[2]),h.rotate(n[0],f,g)):h.rotate(n[0],n[1],n[2]),s+=n[0]),o.rotate=!0):"scale"==r?(1===c||2===c?(v=v||i.bbox(!0).toJson(),h.scale(n[0],n[c-1],v.x+v.width/2,v.y+v.height/2),a*=n[0],p*=n[c-1]):4===c&&(t?(f=l.x(n[2],n[3]),g=l.y(n[2],n[3]),h.scale(n[0],n[1],f,g)):h.scale(n[0],n[1],n[2],n[3]),a*=n[0],p*=n[1]),o.scale=!0):"matrix"==r&&h.multiply(n[0],n[1],n[2],n[3],n[4],n[5])}),e)return this.actions=[],h;i.graph.matrix=h,i.attr("transform",h),o.translate&&(o.translate={dx:h.e,dy:h.f},this.fire("translate",o.translate)),o.rotate&&(o.rotate={deg:s},this.fire("rotate",o.rotate)),o.scale&&(o.scale={sx:a,sy:p},this.fire("scale",o.scale)),this.actions=[]}},toString:function(){return"Graph.plugin.Transformer"}})}(),function(){function t(t,n){n=_.toString(n).replace(/\.{3}|\u2026/g,t),t=Graph.util.transform2segments(t)||[],
n=Graph.util.transform2segments(n)||[];for(var r,i,o,s,a=Math.max(t.length,n.length),p=[],h=[],c=0;c<a;c++){if(o=t[c]||e(n[c]),s=n[c]||e(o),o[0]!=s[0]||"rotate"==o[0].toLowerCase()&&(o[2]!=s[2]||o[3]!=s[3])||"scale"==o[0].toLowerCase()&&(o[3]!=s[3]||o[4]!=s[4]))return{equal:!1,from:o,to:s};for(p[c]=[],h[c]=[],r=0,i=Math.max(o.length,s.length);r<i;r++)r in o&&(p[c][r]=o[r]),r in s&&(h[c][r]=s[r])}return{equal:!0,from:p,to:h}}function e(t){var e=t[0];switch(e.toLowerCase()){case"translate":return[e,0,0];case"matrix":return[e,1,0,0,1,0,0];case"rotate":return 4==t.length?[e,0,t[2],t[3]]:[e,0];case"scale":return 5==t.length?[e,1,1,t[3],t[4]]:3==t.length?[e,1,1]:[e,1]}}var n=this,r=Graph.plugin.Animator=Graph.extend(Graph.plugin.Plugin,{props:{vector:null,duration:1e3,easing:"linier"},stacks:[],constructor:function(t){this.props.vector=t.guid()},create:function(t,e,n,r){return new i(t,e,n,r)},animate:function(t,e,n,r){var o,s,a=this.vector(),p=_.extend({},a.attrs);return t instanceof i?s=t:(e=_.defaultTo(e,this.props.duration),
_.isFunction(n)&&(r=n,n=this.props.easing),n||(n=this.props.easing),o={100:t},s=new i(o,e,n,r)),s.count()?(p.transform=a.attrs.transform,p.matrix=a.matrix().clone(),this.start(s,s.frame(0),p,null),s=null,this):void(s=null)},resume:function(){},pause:function(){},stop:function(){},start:function(e,n,o,s){var a=e.count();if(!a)return void(e=null);var p,h,c,l,u,d,f,g,v=this.vector(),m=this.stacks.length,x={},y={},b={};if(s){for(g=0;g<m;g++)if(f=this.stacks[g],f.animation==e){f.frame!=n?(this.stacks.splice(g,1),d=1):u=f,v.attr(f.reset);break}}else s=+b;for(h={animation:e,vector:v},l=e.duration(),c=e.at(a-1).frame,g=0;g<a;g++){if(p=e.at(g),p.frame==n||p.frame>s*c){h.prev=e.at(g-1),h.prev=h.prev?h.prev.frame:0,h.frame=p.frame,h.duration=l/c*(h.frame-h.prev),h.next=e.at(g+1),h.next=h.next?h.next.frame:void 0,h.last=c;break}s&&v.attr(p.params)}if(u)u.initstatus=s,u.start=new Date-u.duration*s;else{l=h.duration,_.forOwn(p.params,function(e,n){var r,o,s,a,p,h,c,u,d=i.animable[n];if(d)switch(y[n]=v.attrs[n],
y[n]=_.defaultTo(y[n],d.defaults),b[n]=e,d.type){case"number":x[n]=(b[n]-y[n])/l;break;case"transform":var f=t(v.attrs[n],e);if(f.equal)for(y[n]=f.from,b[n]=f.to,x[n]=[],x[n].semantic=!0,p=0,c=y[n].length;p<c;p++)for(x[n][p]=[y[n][p][0]],h=1,u=y[n][p].length;h<u;h++)x[n][p][h]=(b[n][p][h]-y[n][p][h])/l;else r=v.plugins.transformer,a=Graph.util.transform2segments(b[n]),o=v.matrix(),y[n]=o.clone(),s=o.invert(!0),v.graph.matrix=o.multiply(s),_.forEach(a,function(t){var e=t[0],n=t.slice(1);r[e].apply(r,n)}),o=r.commit(!1,!0),b[n]=o.clone(),x[n]={a:(b[n].props.a-y[n].props.a)/l,b:(b[n].props.b-y[n].props.b)/l,c:(b[n].props.c-y[n].props.c)/l,d:(b[n].props.d-y[n].props.d)/l,e:(b[n].props.e-y[n].props.e)/l,f:(b[n].props.f-y[n].props.f)/l},a=null,r=null,o=null}});var G=+new Date;if(_.extend(h,{scene:p,timestamp:G,start:G+e.delay(),reset:o,from:y,to:b,delta:x,status:0,initstatus:s||0,stop:!1}),this.stacks.push(h),s&&!u&&!d&&(h.stop=!0,h.start=new Date-p.duration*s,1===this.stacks.length))return this.player();
d&&(h.start=new Date-p.duration*s),1===this.stacks.length&&r.play(_.bind(this.player,this))}this.fire("animstart")},player:function(){for(var t,e,n,o,s,a,p,h,c,l,u,d,u,f,g,c,v,m,x,y,b,G=+new Date,w=0;w<this.stacks.length;w++)if(e=this.stacks[w],!(e.paused||(o=G-e.start,a=e.duration,t=e.vector,l=e.scene,n=e.from,v=e.to,delta=e.delta,s=e.animation,e.initstatus?(o=(e.initstatus*e.last-e.prev)/(e.frame-e.prev)*a,e.status=e.initstatus,delete e.initstatus,e.stop&&this.stacks.splice(w--,1)):e.status=(e.prev+(e.frame-e.prev)*(o/a))/e.last,o<0)))if(o<a){ease=l.easing(o/a);for(c in n)switch(p=i.animable[c],p.type){case"number":h=+n[c]+ease*a*delta[c],t.attr(name,h);break;case"transform":if(delta[c].semantic){for(d=t.plugins.transformer,y=0,m=n[c].length;y<m;y++){for(f=n[c][y][0],g=[],b=1,x=n[c][y].length;b<x;b++)g.push(n[c][y][b]+ease*a*delta[c][y][b]);d[f].apply(d,g)}u=d.commit(!1,!0),t.attr("transform",u.toString()),u=null,d=null}else u=Graph.matrix(n[c].props.a+ease*a*delta[c].a,n[c].props.b+ease*a*delta[c].b,n[c].props.c+ease*a*delta[c].c,n[c].props.d+ease*a*delta[c].d,n[c].props.e+ease*a*delta[c].e,n[c].props.f+ease*a*delta[c].f),
t.attr("transform",u.toString()),u=null}}else{for(c in v)switch(p=i.animable[c],p.type){case"transform":delta[c].semantic?(d=t.plugins.transformer,_.forEach(v[c],function(t){var e=t[0],n=t.slice(1);d[e].apply(d,n)}),u=d.commit(!1,!0),t.graph.matrix=u,t.attr("transform",u.toString()),u=null,d=null):(u=v[c].clone(),t.graph.matrix=u,t.attr("transform",u.toString()),u=null);break;default:t.attr(c,v[c])}l.played++,this.stacks.splice(w--,1);var C=s.repeat(),k=l.played;C>1&&k<C&&!e.next&&(_.forOwn(s.scenes,function(n,r){for(var i in n.params)"transform"==i?(t.graph.matrix=e.reset.matrix,t.attr("transform",e.reset.transform)):t.attr(r,e.reset[r])}),this.start(s,s.frame(0),e.reset,null)),e.next&&!e.stop&&this.start(s,e.next,e.reset,null),k>=C&&(e=null)}this.stacks.length&&r.play(_.bind(this.player,this))},toString:function(){return"Graph.plugin.Animator"}});r.play=function(t){var e=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(t){
setTimeout(t,16)};return _.bind(e,t)}(n);var i=Graph.extend({props:{easing:"linier",duration:1e3,repeat:1,delay:0},scenes:{},frames:[],constructor:function(t,e,n,r){if(this.props.guid="graph-anim-"+ ++i.guid,this.props.duration=e=_.defaultTo(e,1e3),_.isFunction(n)&&(r?this.props.easing="function":(r=n,n=this.props.easing)),n||(n=this.props.easing),t){var n=_.isString(n)?i.easing[n]:n,o=(this.props.repeat,this.scenes),s=this.frames;_.forOwn(t,function(t,e){var a,p,h={};a=_.toNumber(e),h=_.pickBy(t,function(t,e){return!!i.animable[e]}),p={frame:a,params:h,easing:n,callback:r,played:0},s.push(a),o[a]=p}),s.sort(function(t,e){return t-e})}},guid:function(){return this.props.guid},duration:function(){return this.props.duration},easing:function(){return this.props.easing},delay:function(t){if(void 0===t)return this.props.delay;var e=new i;return e.frames=this.frames,e.scenes=_.cloneDeep(this.scenes),e.props=_.cloneDeep(this.props),e.props.delay=t||0,e},repeat:function(t){if(void 0===t)return this.props.repeat;
var e=new i;return e.frames=this.frames.slice(),e.scenes=_.cloneDeep(this.scenes),e.props=_.cloneDeep(this.props),e.props.repeat=Math.floor(Math.max(t,0))||1,_.forOwn(e.scenes,function(t,e){t.played=0}),e},count:function(){return this.frames.length},at:function(t){var e=this.frame(t);return this.scene(e)},frame:function(t){return this.frames[t]},scene:function(t){return this.scenes[t]},destroy:function(){this.scenes=null,this.frames=null}});_.extend(i,{guid:0,animable:{x:{type:"number",defaults:0},y:{type:"number",defaults:0},cx:{type:"number",defaults:0},cy:{type:"number",defaults:0},transform:{type:"transform",defaults:""}},easing:{linier:function(t){return t},easeIn:function(t){return Math.pow(t,1.7)},easeOut:function(t){return Math.pow(t,.48)},easeInOut:function(t){var e=.48-t/1.04,n=Math.sqrt(.1734+e*e),r=n-e,i=Math.pow(Math.abs(r),1/3)*(r<0?-1:1),o=-n-e,s=Math.pow(Math.abs(o),1/3)*(o<0?-1:1),a=i+s+.5;return 3*(1-a)*a*a+a*a*a},backIn:function(t){var e=1.70158;return t*t*((e+1)*t-e);
},backOut:function(t){t-=1;var e=1.70158;return t*t*((e+1)*t+e)+1},elastic:function(t){return t==!!t?t:pow(2,-10*t)*math.sin((t-.075)*(2*PI)/.3)+1},bounce:function(t){var e,n=7.5625,r=2.75;return t<1/r?e=n*t*t:t<2/r?(t-=1.5/r,e=n*t*t+.75):t<2.5/r?(t-=2.25/r,e=n*t*t+.9375):(t-=2.625/r,e=n*t*t+.984375),e}}})}(),function(){Graph.plugin.Resizer=Graph.extend(Graph.plugin.Plugin,{props:{shield:null,vector:null,enabled:!0,suspended:!0,handleImage:Graph.config.base+"img/resize-control.png",handleSize:17,rendered:!1},components:{holder:null,helper:null,handle:null},trans:{ox:0,oy:0,ow:0,oh:0,cw:0,ch:0,dx:0,dy:0},constructor:function(t,e){var n=this,r=t.guid();e=e||{},e.shield?e.shield=e.shield.guid():e.shield=r,_.assign(n.props,e),t.addClass("graph-resizable"),n.props.handleImage=Graph.config.base+"img/resize-control.png",n.props.vector=r,n.cached.snapping=null,n.cached.vertices=null,n.initComponent()},holder:function(){return Graph.registry.vector.get(this.components.holder)},helper:function(){
return Graph.registry.vector.get(this.components.helper)},handle:function(t){return Graph.registry.vector.get(this.components.handle[t])},initComponent:function(){var t,e,n=this,r=n.components;t=(new Graph.svg.Group).addClass("graph-resizer").removeClass("graph-elem graph-elem-group"),t.elem.group("graph-resizer"),t.on({render:_.bind(n.onHolderRender,n)}),e=new Graph.svg.Rect(0,0,0,0,0).addClass("graph-resizer-helper").removeClass("graph-elem graph-elem-rect").selectable(!1).clickable(!1).render(t),e.elem.group("graph-resizer"),r.handle={};var i={ne:{cursor:"nesw-resize"},se:{cursor:"nwse-resize"},sw:{cursor:"nesw-resize"},nw:{cursor:"nwse-resize"},n:{cursor:"ns-resize",axis:"y"},e:{cursor:"ew-resize",axis:"x"},s:{cursor:"ns-resize",axis:"y"},w:{cursor:"ew-resize",axis:"x"}};_.forOwn(i,function(e,i){!function(i){var o=new Graph.svg.Image(n.props.handleImage,0,0,n.props.handleSize,n.props.handleSize).selectable(!1).removeClass("graph-elem graph-elem-image").addClass("graph-resizer-handle handle-"+i);
o.elem.group("graph-resizer"),o.props.dir=i,o.draggable(e),o.on("dragstart",_.bind(n.onHandleMoveStart,n)),o.on("dragmove",_.bind(n.onHandleMove,n)),o.on("dragend",_.bind(n.onHandleMoveEnd,n)),o.render(t),r.handle[i]=o.guid(),o=null}(i)}),r.holder=t.guid(),r.helper=e.guid(),t=null,e=null,i=null},invalidate:function(){this.superclass.prototype.invalidate.call(this),this.cached.vertices=null},render:function(){var t=this;return t.props.rendered?void t.redraw():(t.holder().render(t.vector().parent()),t.props.rendered=!0,void t.redraw())},snap:function(t){this.cached.snapping=t},vertices:function(){var t=this,e=t.vector(),n=t.cached.vertices;if(!n){var r,i,o,s,a,p,h,c,l=e.pathinfo(),u=l.bbox().toJson(),d=e.matrix(!0).rotate();if(r=d.deg,i=0,o=0,s=u.x,a=u.y,p=t.props.handleSize/2,r){var f=Graph.matrix(),l=t.pathinfo();i=u.x+u.width/2,o=u.y+u.height/2,f.rotate(-r,i,o),l=l.transform(f),u=l.bbox().toJson()}else this.hasShield()||(l=t.pathinfo(),u=l.bbox().toJson());h=u.width/2,c=u.height/2,n={ne:{
x:u.x+u.width-p,y:u.y-p},se:{x:u.x+u.width-p,y:u.y+u.height-p},sw:{x:u.x-p,y:u.y+u.height-p},nw:{x:u.x-p,y:u.y-p},n:{x:u.x+h-p,y:u.y-p},e:{x:u.x+u.width-p,y:u.y+c-p},s:{x:u.x+h-p,y:u.y+u.height-p},w:{x:u.x-p,y:u.y+c-p},rotate:{deg:r,cx:i,cy:o},box:{x:u.x,y:u.y,width:u.width,height:u.height},offset:{x:s,y:a}},this.cached.vertices=n}return n},redraw:function(){var t,e=this,n=e.helper(),r=e.holder();r&&(t=this.vertices(),t&&(n.reset(),n.attr({x:t.box.x,y:t.box.y,width:t.box.width,height:t.box.height}),n.rotate(t.rotate.deg,t.rotate.cx,t.rotate.cy).commit(),_.forOwn(e.components.handle,function(n,r){!function(n,r){var i=e.handle(r);i.show(),i.reset(),i.attr(t[r]),i.rotate(t.rotate.deg,t.rotate.cx,t.rotate.cy).commit()}(n,r)}),e.trans.ox=t.offset.x,e.trans.oy=t.offset.y,e.trans.ow=this.trans.cw=t.box.width,e.trans.oh=this.trans.ch=t.box.height,e.trans.dx=0,e.trans.dy=0))},suspend:function(){this.props.suspended=!0,this.holder().elem.detach()},resume:function(){this.props.enabled&&this.props.suspended&&(this.props.suspended=!1,
this.props.rendered?(this.vector().parent().elem.append(this.holder().elem),this.redraw()):this.render())},onHolderRender:function(t){},onHandleMoveStart:function(t){var e=this,n=t.publisher;_.forOwn(e.components.handle,function(t,r){var i=e.handle(r);i!==n&&i.hide()});var r=this.cached.snapping;r&&n.draggable().snap()!==r&&n.draggable().snap(r),n.show(),n.removeClass("dragging")},onHandleMove:function(t){var e=this,n=e.helper(),r=t.publisher,i=this.trans,o=t.dx,s=t.dy;switch(r.props.dir){case"ne":i.cw+=o,i.ch-=s,e.trans.dy+=s,n.translate(0,s).commit();break;case"se":i.cw+=o,i.ch+=s;break;case"sw":i.cw-=o,i.ch+=s,e.trans.dx+=o,n.translate(o,0).commit();break;case"nw":i.cw-=o,i.ch-=s,e.trans.dx+=o,e.trans.dy+=s,n.translate(o,s).commit();break;case"n":i.cw+=0,i.ch-=s,e.trans.dy+=s,n.translate(0,s).commit();break;case"e":i.cw+=o,i.ch+=0;break;case"s":i.cw+=0,i.ch+=s;break;case"w":i.cw-=o,i.ch+=0,e.trans.dx+=o,n.translate(o,0).commit()}n.attr({width:i.cw,height:i.ch})},onHandleMoveEnd:function(t){
var e,n,r,i,o,s,a=this,p=this.trans,h=t.publisher;switch(e=p.ow>0?p.cw/p.ow:1,n=p.oh>0?p.ch/p.oh:1,o=p.dx,s=p.dy,h.props.dir){case"ne":r=p.ox,i=p.oy+p.oh;break;case"se":r=p.ox,i=p.oy;break;case"sw":r=p.ox+p.ow,i=p.oy;break;case"nw":r=p.ox+p.ow,i=p.oy+p.oh;break;case"n":r=p.ox+p.ow/2,i=p.oy+p.oh;break;case"e":r=p.ox,i=p.oy+p.oh/2;break;case"s":r=p.ox+p.ow/2,i=p.oy;break;case"w":r=p.ox+p.ow,i=p.oy+p.oh/2}var c=a.vector(),l=c.bbox().center().toJson(),u=c.resize(e,n,r,i,o,s),d=c.bbox().center().toJson(),f=d.x-l.x,g=d.y-l.y;u.translate.dx=f,u.translate.dy=g,a.redraw(),a.fire("resize",u)},destroy:function(){var t=this;_.forOwn(t.components.handle,function(e,n){var r=t.handle(n);r.remove()}),t.components.handle=null,t.helper().remove(),t.components.helper=null,t.holder().remove(),t.components.holder=null,t.listeners=null}})}(),function(){Graph.plugin.Collector=Graph.extend(Graph.plugin.Plugin,{props:{x:0,y:0,x2:0,y2:0,dir:null,top:0,left:0,width:0,height:0,offset:[0,0],enabled:!1,suspended:!0,
rendered:!1,activator:"tool"},paper:null,collection:[],components:{rubber:null},constructor:function(t){var e=this;if(!t.isPaper())throw Graph.error("Lasso tool only available for paper !");e.paper=t,e.components.rubber=Graph.$('<div class="graph-rubberband">'),t.on("keynavdown",_.bind(e.onKeynavDown,e)),t.on("keynavup",_.bind(e.onKeynavUp,e)),e.paper.props.rendered?e.setup():e.paper.on("render",function(){e.setup()})},enable:function(t){this.props.enabled=!0,this.props.activator=t,this.paper.cursor("crosshair"),this.paper.state("collecting")},disable:function(){this.props.enabled=!1,this.paper.cursor("default")},setup:function(){var t=this,e=t.paper;t.plugin||(t.plugin=e.interactable().draggable({manualStart:!0,onstart:function(n){t.reset(),t.resize(0,0);var r=e.tree.container.offset(),i=n.pageX-r.left,o=n.pageY-r.top;t.translate(i,o),t.props.offset=[i,o]},onmove:function(e){var n=0,r=0,i=0,o=0;if(t.props.dir){switch(t.props.dir){case"nw":n=e.dx,r=e.dy,i=0,o=0;break;case"ne":n=-e.dx,r=e.dy,
i=e.dx,o=0;break;case"se":n=-e.dx,r=-e.dy,i=e.dx,o=e.dy;break;case"sw":n=e.dx,r=-e.dy,i=0,o=e.dy}t.props.width+=n,t.props.height+=r,t.props.width>=0&&t.props.height>=0?(t.translate(i,o),t.resize(t.props.width,t.props.height)):(t.props.width-=n,t.props.height-=r)}else switch(!0){case e.dx>0&&e.dy>0:t.props.dir="nw";break;case e.dx<0&&e.dy<0:t.props.dir="se";break;case e.dx<0&&e.dy>0:t.props.dir="ne";break;case e.dx>0&&e.dy<0:t.props.dir="sw"}},onend:function(){var n;t.props.x2=t.props.x+t.props.width,t.props.y2=t.props.y+t.props.height,n=t.bbox(),e.cascade(function(r){r!==e&&r.isSelectable()&&!r.isGroup()&&n.contains(r)&&t.collect(r)}),"tool"==t.props.activator&&e.tool().activate("panzoom"),t.resize(0,0),t.suspend()}}).on("down",function(e){var n=!(e.ctrlKey||e.shiftKey),r=Graph.registry.vector.get(e.target);r&&(r.isSelectable()||r.elem.belong("graph-resizer")||r.elem.belong("graph-link")||n&&t.clearCollection())}).on("tap",function(e){var n=Graph.registry.vector.get(e.target),r=!(e.ctrlKey||e.shiftKey);
if(n&&n.isSelectable()){if("linking"==n.paper().state())return void t.clearCollection();r&&t.clearCollection(),t.collect(n)}},!0).on("move",function(n){var r=n.interaction;t.props.enabled&&r.pointerIsDown&&!r.interacting()&&n.currentTarget===e.node()&&(t.props.suspended&&t.resume(),r.start({name:"drag"},n.interactable,t.components.rubber.node()))}),t.plugin.styleCursor(!1))},render:function(){var t=this;t.props.rendered||(t.paper.container().append(t.components.rubber),t.props.rendered=!0)},bbox:function(){var t=this.props;return Graph.bbox({x:t.x,y:t.y,x2:t.x2,y2:t.y2,width:t.width,height:t.height})},collect:function(t,e){var n;t.$collector=this,t.select(),e=_.defaultTo(e,!1),n=_.indexOf(this.collection,t),n===-1&&(this.collection.push(t),e||t.fire("collect"))},decollect:function(t){var e;t.$collector=null,t.deselect(),e=_.indexOf(this.collection,t),e>-1&&(this.collection.splice(e,1),t.fire("decollect"))},clearCollection:function(t){var e=this;e.paper.cascade(function(n){n!==e.paper&&n!==t&&n.props.selected&&e.decollect(n);
})},suspend:function(){this.props.suspended=!0,this.components.rubber.detach()},resume:function(){this.props.suspended=!1,this.props.rendered?this.paper.container().append(this.components.rubber):this.render()},reset:function(){var t=this.paper.container().scrollTop(),e=this.paper.container().scrollLeft();this.props.x=0,this.props.y=0,this.props.x2=this.props.x,this.props.y2=this.props.y,this.props.top=t,this.props.left=e,this.props.dir=null,this.props.width=0,this.props.height=0,this.props.offset=[0,0]},translate:function(t,e){this.props.x+=t,this.props.y+=e,this.components.rubber.css({transform:"translate("+this.props.x+"px,"+this.props.y+"px)"})},resize:function(t,e){this.components.rubber.width(t).height(e)},syncDragStart:function(t,e){var n=this;_.forEach(n.collection,function(n){n.plugins.dragger&&n.plugins.dragger.props.enabled&&n!==t&&!function(){var t=n.graph.matrix.data(),r=t.sin,i=t.cos;n.plugins.resizer&&(n.plugins.resizer.redraw(),n.plugins.resizer.suspend()),n.plugins.dragger.components.helper&&n.plugins.dragger.resume(),
n.syncdrag={sin:r,cos:i,tdx:0,tdy:0},n.addClass("dragging"),n.fire("dragstart",{dx:e.dx*i+e.dy*r,dy:e.dx*-r+e.dy*i})}()}),n.fire("beforedrag")},syncDragMove:function(t,e){var n=this;_.forEach(n.collection,function(n){n.plugins.dragger&&n.plugins.dragger.props.enabled&&n!==t&&!function(t,e){var n=e.ox*t.syncdrag.cos+e.oy*t.syncdrag.sin,r=e.ox*-t.syncdrag.sin+e.oy*t.syncdrag.cos;t.plugins.dragger.components.helper?t.plugins.dragger.helper().translate(e.ox,e.oy).commit():t.translate(n,r).commit(),t.syncdrag.tdx+=n,t.syncdrag.tdy+=r,t.fire("dragmove",{dx:n,dy:r})}(n,e)})},syncDragEnd:function(t,e){var n=this;_.forEach(n.collection,function(n){n.plugins.dragger&&n.plugins.dragger.props.enabled&&n!==t&&!function(t,e){var n=t.plugins.dragger.props.manual,r=t.plugins.dragger.components.helper;r&&(n||t.translate(t.syncdrag.tdx,t.syncdrag.tdy).commit(),t.plugins.dragger.suspend()),n||t.dirty(!0),t.plugins.resizer&&t.plugins.resizer.resume(),t.fire("dragend",{dx:t.syncdrag.tdx,dy:t.syncdrag.tdy}),
t.removeClass("dragging"),delete t.syncdrag}(n,e)}),e.origin=t,e.type="afterdrag",n.fire(e)},toString:function(){return"Graph.plugin.Collector"},onKeynavDown:function(t){if(t.keyCode==Graph.event.SHIFT&&"key"!=this.props.activator){var e=this.paper.tool(),n=e.current();"collector"!=n&&e.activate("collector","key")}},onKeynavUp:function(t){if(t.keyCode==Graph.event.SHIFT){var e=this.paper.tool(),n=e.current();"collector"==n&&(this.props.activator="tool",e.activate("panzoom"))}}})}(),function(){Graph.plugin.Dragger=Graph.extend(Graph.plugin.Plugin,{props:{manual:!1,single:!0,ghost:!1,vector:null,enabled:!0,rendered:!1,suspended:!0,inertia:!1,bound:!1,grid:null,axis:!1,cursor:"move",snappable:!1},rotation:{deg:0,rad:0,sin:0,cos:1},scaling:{x:1,y:1},trans:{vector:null,paper:null,helper:null,dx:0,dy:0},components:{holder:null,helper:null},constructor:function(t,e){var n=this;t.addClass("graph-draggable"),n.props.vector=t.guid(),e=_.extend({inertia:!1},e||{}),_.forEach(["axis","grid","bbox","ghost"],function(t){
void 0!==e[t]&&(n.props[t]=e[t])}),_.assign(n.props,e),n.cached.snapping=null,n.cached.origin=null,n.initComponent(),t.on("render.dragger",_.bind(n.onVectorRender,n)),t.props.rendered&&n.setup()},holder:function(){return Graph.registry.vector.get(this.components.holder)},helper:function(){return Graph.registry.vector.get(this.components.helper)},initComponent:function(){var t,e,n=this,r=n.components;n.props.ghost&&(t=(new Graph.svg.Group).addClass("graph-dragger").removeClass("graph-elem graph-elem-group").traversable(!1).selectable(!1),e=new Graph.svg.Rect(0,0,0,0,0).addClass("graph-dragger-helper").removeClass("graph-elem graph-elem-rect").traversable(!1).selectable(!1).clickable(!1).render(t),r.holder=t.guid(),r.helper=e.guid(),t=null,e=null)},setup:function(){var t=this,e=t.vector(),n=e.paper(),r={};if(!t.plugin){n.utils.scroller,_.extend(r,{manualStart:!0,onstart:_.bind(t.onDragStart,t),onmove:_.bind(t.onDragMove,t),onend:_.bind(t.onDragEnd,t)});var i=e.interactable().vendor();i.draggable(r),
i.styleCursor(!1),t.cached.origin=i.origin(),t.cached.snapping=[],i.on("down",function(t){t.preventDefault()}),t.props.single&&i.on("move",_.bind(t.onPointerMove,t,_,e));var o=e.matrix(!0),s=o.rotate(),a=o.scale();t.rotate(s.deg),t.scale(a.x,a.y),t.props.grid&&t.snap({mode:"grid",x:t.props.grid[0],y:t.props.grid[1]})}},enable:function(){this.props.enabled=!0},disable:function(){this.props.enabled=!1},ghost:function(t){return void 0===t?this.props.ghost:(this.props.ghost=t,this)},render:function(){var t=this,e=t.vector();t.props.rendered||(t.props.rendered=!0,t.holder().render(e.parent())),t.props.ghost&&t.redraw()},suspend:function(){this.props.suspended=!0,this.holder().elem.detach()},resume:function(){this.props.suspended=!1,this.props.rendered?(this.vector().parent().elem.append(this.holder().elem),this.redraw()):this.render()},redraw:function(){var t=this.vector(),e=this.helper();if(e){var n=t.bbox().toJson(),r=e.bbox().toJson(),i=n.x-r.x,o=n.y-r.y;e.translate(i,o).commit(),e.attr({
width:n.width,height:n.height})}},rotate:function(t){var e=Graph.util.rad(t);this.rotation.deg=t,this.rotation.rad=e,this.rotation.sin=Math.sin(e),this.rotation.cos=Math.cos(e)},scale:function(t,e){e=_.defaultTo(e,t),this.scaling.x=t,this.scaling.y=e},origin:function(t){if(void 0===t)return this.cached.origin;this.cached.origin=t;var e=this.vector().interactable().vendor();e&&e.origin(t)},snap:function(t,e){function n(t){return _.isFunction(t)?t:(t.mode=_.defaultTo(t.mode,"anchor"),"grid"==t.mode?("x"==r.props.axis?t.y=0:"y"==r.props.axis&&(t.x=0),t=interact.createSnapGrid({x:t.x,y:t.y})):t.range=_.defaultTo(t.range,20),t)}if(void 0===t)return this.cached.snapping;void 0===e&&(e=!1);var r=this,i=[];this.cached.snapping=t,_.isArray(t)?_.forEach(t,function(t){i.push(n(t))}):i.push(n(t));var o=this.vector().interactable().vendor();o&&o.setOptions("snap",{targets:i,endOnly:e})},resetSnap:function(){this.snaps=[],this.snap({mode:"grid",x:this.props.grid[0],y:this.props.grid[1]})},bound:function(t){},
onVectorRender:function(){this.setup()},onPointerMove:function(t,e){var n=t.interaction;if(this.props.enabled&&n.pointerIsDown&&!n.interacting()){var r=e.paper(),i=e.node(),o={name:"drag"};if(n.prepared.name=o.name,n.setEventXY(n.startCoords,n.pointers),t.currentTarget===i){if(r){var s=r.state();if("collecting"==s){if(!e.elem.belong("graph-resizer"))return;r.tool().activate("panzoom")}else if("linking"==s)return}this.props.ghost?(this.props.suspended&&this.resume(),n.start(o,t.interactable,this.helper().node())):n.start(o,t.interactable,i)}}t.preventDefault()},onDragStart:function(t){var e=this.vector(),n=e.paper(),r=this.helper();e.addClass("dragging"),n.cursor(this.props.cursor),this.trans.vector=e,this.trans.paper=n,this.trans.helper=r,this.trans.dx=0,this.trans.dy=0;var i={x:t.clientX,y:t.clientY,dx:0,dy:0,ghost:this.props.ghost};this.fire("dragstart",i)},onDragMove:function(t){var e=this.trans,n=(e.paper,e.vector),r=e.helper,i=this.props.axis,o=(this.rotation.deg,this.rotation.sin),s=this.rotation.cos,a=this.scaling.x,p=this.scaling.y,h=n.matrix(!0).scale();
h.x===a&&h.y===p||(this.scale(h.x,h.y),a=h.x,p=h.y);var c,l,u,d,f,g,v=_.defaultTo(t.dx,0),m=_.defaultTo(t.dy,0);c=l=u=d=f=g=0,v/=a,m/=p,"x"==i?(c=u=v,l=d=0,f=v*s+0*o,g=v*-o+0*s):"y"==i?(c=u=0,l=d=m,f=0*s+m*o,g=0*-o+m*s):(u=v,d=m,c=f=v*s+m*o,l=g=v*-o+m*s),this.trans.dx+=f,this.trans.dy+=g;var x=_.defaultTo(t.pageX,t.x0),x=_.defaultTo(t.pageY,t.y0);x/=a,x/=p;var y={pageX:x,pageY:x,ex:v,ey:m,dx:c,dy:l,hx:u,hy:d,ox:u,oy:d,ghost:this.props.ghost};this.fire("dragmove",y),r?r.translate(y.hx,y.hy).commit():n.translate(y.dx,y.dy).commit()},onDragEnd:function(t){var e=this.trans,n=e.paper,r=e.vector,i=e.helper,o=e.dx,s=e.dy;i&&(r.translate(o,s).commit(),this.redraw(),this.suspend()),r.removeClass("dragging"),n.cursor("default");var a={dx:o,dy:s,ghost:this.props.ghost};this.fire("dragend",a),this.trans.vector=null,this.trans.paper=null,this.trans.helper=null,this.trans.dx=0,this.trans.dy=0},destroy:function(){var t=this;t.components.helper&&t.helper().remove(),t.components.helper=null,t.components.holder&&t.holder().remove(),
t.components.holder=null,t.listeners={}}})}(),function(){Graph.plugin.Dropper=Graph.extend(Graph.plugin.Plugin,{props:{overlap:"center",accept:".graph-draggable"},constructor:function(t,e){var n=this;_.assign(n.props,e||{}),t.addClass("graph-dropzone").removeClass("graph-draggable"),n.props.vector=t.guid(),t.on({render:_.bind(n.onVectorRender,n)}),t.props.rendered&&n.setup()},setup:function(){var t=this;if(!t.plugin){var e=_.extend({},t.props,{checker:_.bind(t.onDropValidate,t),ondropactivate:_.bind(t.onDropActivate,t),ondropdeactivate:_.bind(t.onDropDeactivate,t),ondragenter:_.bind(t.onDragEnter,t),ondragleave:_.bind(t.onDragLeave,t),ondrop:_.bind(t.onDrop,t)});t.plugin=t.vector.interactable().dropzone(e)}},onDropValidate:function(t,e,n,r,i,o,s){return n},onVectorRender:function(){this.setup()},onDropActivate:function(t){this.vector().addClass("drop-activate")},onDropDeactivate:function(t){this.vector().removeClass("drop-activate")},onDragEnter:function(t){this.vector().removeClass("drop-activate").addClass("drop-enter"),
t.type="dropenter",this.fire(t)},onDragLeave:function(t){this.vector().removeClass("drop-enter").addClass("drop-activate"),t.type="dropleave",this.fire(t)},onDrop:function(t){this.vector().removeClass("drop-activate drop-enter")}})}(),function(){Graph.plugin.Sorter=Graph.extend(Graph.plugin.Plugin,{props:{height:0,width:0,suspended:!0,enabled:!0,offsetTop:0,offsetLeft:0},sortables:[],origins:[],guests:[],batch:[],trans:{sorting:!1,valid:!1,drag:null,drop:null},components:{helper:null},constructor:function(t){var e=this;e.vector=t,e.vector.addClass("graph-sorter"),e.components.helper=new Graph.svg.Rect(0,0,0,0),e.components.helper.addClass("graph-sorter-helper"),e.components.helper.removeClass("graph-elem graph-elem-rect"),e.components.helper.props.selectable=!1,e.components.helper.render(e.vector),e.components.helper.$sorter=e,e.sortables.push(e.components.helper),e.vector.on({render:_.bind(e.onVectorRender,e),appendchild:_.bind(e.onItemAdded,e),prependchild:_.bind(e.onItemAdded,e)}),e.vector.props.rendered&&e.setup();
},setup:function(){var t=this,e=t.vector,n=e.paper(),r=e.node();t.plugin||(t.plugin=interact(".graph-sortable",{context:r}).dropzone({accept:".graph-sortable",overlap:.1,ondropactivate:_.bind(t.onSortActivate,t),ondropdeactivate:_.bind(t.onSortDeactivate,t),ondragenter:_.bind(t.onSortEnter,t),ondragleave:_.bind(t.onSortLeave,t),ondrop:_.bind(t.onSort,t)}),t.plugin.styleCursor(!1),n.plugins.collector&&n.plugins.collector.on({afterdrag:function(e){var n=e.origin;_.indexOf(t.sortables,n)>-1&&(t.props.offsetTop+=e.dy)}}))},snapping:function(t,e,n,r,i,o,s){return n},suspend:function(){this.props.suspended=!0,this.components.helper&&(this.components.helper.focus(!1),this.components.helper.removeClass("visible"))},resume:function(){var t=this;t.props.suspended=!1,t.components.helper&&t.components.helper.addClass("visible")},redraw:function(){var t=this;t.trans.valid&&(t.props.suspended&&t.resume(),t.swap(t.components.helper,t.trans.drop),t.components.helper.focus())},commit:function(){var t=this;
_.forEach(t.guests,function(e){t.vector.elem.append(e.node())}),_.forEach(t.sortables,function(t){t.$master=!1,t.$sorter=null,t.$sorting=!1}),t.components.helper.attr("height",0),t.batch.length?t.permute():t.swap(t.trans.drag,t.components.helper),_.forEach(t.origins,function(t){t.components.helper.attr("height",0),t.reset(),t.arrange(),t.suspend()}),t.reset(),t.suspend(),t.resumeBatch(t.batch)},revert:function(){var t=this;_.forEach(t.guests,function(e){t.vector.elem.append(e.node())}),_.forEach(t.sortables,function(t){t.$sorting=!1,t.$sorter=null,t.$master=!1}),_.forEach(t.origins,function(t){t.components.helper.attr("height",0),t.reset(),t.arrange(),t.suspend()}),t.components.helper.attr("height",0),t.reset(),t.arrange(),t.suspend(),t.resumeBatch(t.batch)},permute:function(){var t=this,e=_.indexOf(t.sortables,t.components.helper),n=_.map(t.sortables,function(t,e){return e});t.batch.sort(function(t,e){var n=t.offset().top,r=e.offset().top;return n===r?0:n<r?-1:1}),orders=_.map(t.batch,function(e){
return _.indexOf(t.sortables,e)});var r=_.difference(n,orders),i=_.indexOf(r,e);_.insert(r,i,orders),t.sortables=_.permute(t.sortables,r),t.arrange()},swap:function(t,e){var n=this,r=_.indexOf(n.sortables,t),i=_.indexOf(n.sortables,e);_.move(n.sortables,r,i),n.arrange()},arrange:function(){var t=this;t.props.height=0,t.props.width=0,_.forEach(t.sortables,function(e){if(!e.$sorting){var n=e.bbox().toJson(),r=t.props.height-n.y+t.props.offsetTop;e.translate(0,r).commit(),t.props.height+=n.height,n.width>t.props.width&&(t.props.width=n.width)}})},suspendBatch:function(t,e){_.forEach(t,function(t){t.cascade(function(t){t.props.selected&&t.resizer&&t.resizer.suspend()}),e&&e.call(t,t)})},resumeBatch:function(t){var e;e=_.delay(function(){clearTimeout(e),_.forEach(t,function(t){t.cascade(function(t){t.props.selected&&t.resizer&&t.resizer.resume()})})},0)},reset:function(){this.guests=[],this.origins=[],this.trans.drag=null,this.trans.sorting=!1,this.trans.valid=!1,this.trans.drop=null},enroll:function(t){
var e,n=this;_.indexOf(n.sortables,t)===-1&&(e=t.$sorter,e.release(t),_.indexOf(n.origins,e)===-1&&n.origins.push(e),t.$sorter=n,t.$master&&(n.trans.drag=t),t.off(".sorter"),t.tree.parent=n.vector,n.vector.children().push(t),n.guests.push(t))},release:function(t){var e,n=this,r=t.$sorter||n;t.off(".sorter"),t.$sorter=null,t.tree.parent=null,t.$master&&(r.trans.drag=null),r.vector.children().pull(t),(e=_.indexOf(r.sortables,t))>-1&&r.sortables.splice(e,1),(e=_.indexOf(r.batch,t))>-1&&r.batch.splice(e,1),(e=_.indexOf(r.guests,t))>-1&&r.guests.splice(e,1)},onVectorRender:function(){this.setup()},onItemAdded:function(t){var e,n=this;_.indexOf(n.sortables,t)>-1||t.hasClass("graph-sorter-helper")||(t.$sorter=this,t.addClass("graph-sortable"),t.off(".sorter"),t.on("render.sorter",_.bind(n.onItemRender,n)),t.on("resize.sorter",_.bind(n.onItemResize,n)),t.on("dragstart.sorter",_.bind(n.onItemDragStart,n)),t.on("dragend.sorter",_.bind(n.onItemDragEnd,n)),t.on("collect.sorter",_.bind(n.onItemCollect,n)),
t.on("decollect.sorter",_.bind(n.onItemDecollect,n)),n.sortables.push(t),t.props.rendered&&!t.$sorting&&(e=_.delay(function(){clearTimeout(e),n.arrange()},0)))},onItemRender:function(t){var e,n=this;e=_.delay(function(){clearTimeout(e),n.arrange()},0)},onItemResize:function(t){function e(t,e){t.cascade(function(t){if(t.props.selected&&t.resizer){var n=e?"suspend":"resume";t.resizer[n].call(t.resizer)}})}var n,r=t.publisher,i=r.$sorter||this;e(r,!0),_.forEach(i.sortables,function(e){e!==r&&(t.type="resize.sortable",e.fire(t))}),n=_.defer(function(t){clearTimeout(n),i.arrange(),e(t,!1)},r)},onItemDragStart:function(t){var e,n=this,r=t.publisher,i=n.batch.length;n.props.enabled=!i||i+1!==n.sortables.length,n.props.enabled&&(r.$sorter=n,r.$master=!0,r.$sorting=!0,n.trans.drag=r,n.trans.sorting=!0,e=r.bbox().toJson(),width=n.props.width,height=e.height,i&&(r.$collector?(height=0,n.suspendBatch(n.batch,function(t){var e=t.bbox().toJson();height+=e.height,t.$sorter=n,t.$sorting=!0})):(n.batch.pop().$collector.clearCollection(),
n.batch=[])),n.components.helper.attr({width:width,height:height}))},onItemDragEnd:function(t){var e=this;e.props.enabled&&(e.trans.sorting?e.trans.valid||e.revert():e.revert())},onItemCollect:function(t){var e=t.publisher,n=e.$sorter||this;n.batch.push(e)},onItemDecollect:function(t,e){var n,e=t.publisher,r=e.$sorter||this;n=_.indexOf(r.batch,e),n>-1&&r.batch.splice(n,1)},onSortActivate:function(){},onSortDeactivate:function(){},onSortEnter:function(t){var e,n,r,i,o,s=this;s.props.enabled&&(e=Graph.registry.vector.get(t.relatedTarget),n=Graph.registry.vector.get(t.target),e.$collector?(o=0,i=s.props.width,_.forEach(e.$collector.collection,function(t){var e;t.$sorter&&(t.$sorter!==s&&(s.enroll(t),s.batch.push(t)),e=t.bbox().toJson(),o+=e.height,e.width>i&&(i=e.width))}),s.components.helper.attr({width:i,height:o})):e.$sorter&&e.$sorter!==s&&(s.batch.length&&s.suspendBatch(s.batch),s.enroll(e),r=e.bbox().toJson(),o=r.height,i=s.props.width,s.components.helper.attr({width:i,height:o})),s.trans.drop=n,
s.trans.valid=!0,s.redraw())},onSortLeave:function(){var t=this;t.props.enabled&&(t.trans.drop=null,t.trans.valid=!1,t.suspend())},onSort:function(){var t=this;t.props.enabled&&t.commit()}})}(),function(){var t="connect-valid",e="connect-invalid",n="connect-hover";Graph.plugin.Network=Graph.extend(Graph.plugin.Plugin,{props:{shield:null,vector:null,wiring:"h:h"},links:[],linking:{valid:!1,router:null,source:null,target:null,link:null,pole:null},constructor:function(r,i){var o=this,s=r.guid();i=i||{},i.shield?i.shield=i.shield.guid():i.shield=s,_.assign(o.props,i),o.props.vector=s,r.addClass("graph-connectable");var a=r.interactable().vendor();a.dropzone({accept:_.format(".{0}, .{1}",Graph.string.CLS_LINK_HEAD,Graph.string.CLS_LINK_TAIL),overlap:.2}).on("dropdeactivate",function(r){var i=Graph.registry.vector.get(r.target);i&&i.removeClass([t,e,n]),o.invalidateTrans()}).on("dropactivate",function(t){var e=Graph.registry.vector.get(t.target);e&&e.addClass(n),o.invalidateTrans()}).on("dragenter",function(n){
var i=Graph.registry.link.get(n.relatedTarget);if(i){var s,a,p,h=Graph.$(n.relatedTarget).data("pole");"head"==h?(a=i.router.source(),p=r):(a=r,p=i.router.target()),s=a.connectable().canConnect(p.connectable(),i),s?(r.removeClass(e),r.addClass(t)):(r.removeClass(t),r.addClass(e)),_.assign(o.linking,{valid:s,router:i.router,source:a,target:p,pole:h}),i.router.updateTrans("CONNECT",{valid:s,source:a,target:p})}}).on("dragleave",function(n){var r=Graph.registry.vector.get(n.target);r&&r.removeClass([t,e]),o.linking.valid=!1,"head"==o.linking.pole?o.linking.router.updateTrans("CONNECT",{valid:!1,target:null}):o.linking.router.updateTrans("CONNECT",{valid:!1,source:null})}).on("drop",function(t){o.linking.valid&&("head"==o.linking.pole?o.linking.router.updateTrans("CONNECT",{target:r}):o.linking.router.updateTrans("CONNECT",{source:r}))})},invalidateTrans:function(){for(var t in this.linking)this.linking[t]=null},wiring:function(){return this.props.wiring},treshold:function(){var t=this.props.wiring;
switch(t){case"h:h":case"v:v":return 20;case"h:v":case"v:h":return-10}return 0},direction:function(t){var e=this.orientation(t);switch(e){case"intersect":return null;case"top":case"bottom":return"v:v";case"left":case"right":return"h:h";default:return this.props.wiring}},orientation:function(t){var e=this.bbox().toJson(),n=t.bbox().toJson(),r=Graph.util.boxOrientation(e,n,this.treshold());return e=n=null,r},isSource:function(t){return t.source().guid()==this.vector().guid()},isTarget:function(t){return t.target().guid()==this.vector().guid()},canConnect:function(t,e){var n=this.vector().guid(),r=t.vector().guid();return n!=r}})}(),function(){Graph.plugin.History=Graph.extend(Graph.plugin.Plugin,{props:{limit:1,index:0},items:{},constructor:function(t){this.props.vector=t.guid()},save:function(t,e){var n,r=this.props.limit;n>r&&_.drop(this.items,n-r),this.items[t]=this.items[t]||[],(n=this.items[t].length)>r-1&&this.items[t].splice(0,n-r),this.items[t].push(e),console.log(this)},last:function(t){},
go:function(){},back:function(){},next:function(){},clear:function(){}})}(),function(){function t(t,e){return Math.max(t.min,Math.min(t.max,e))}Graph.plugin.Panzoom=Graph.extend(Graph.plugin.Plugin,{props:{panEnabled:!1,zoomEnabled:!0,showToolbox:!0,vector:null},caching:{offset:{x:0,y:0}},scrolling:{steps:10},zooming:{scale:1,zoom:1,origin:null,range:{min:.2,max:4}},components:{toolbox:null},panning:{start:{x:0,y:0},moveHandler:null,stopHandler:null},constructor:function(t){var e,n,r,i=this;if(!t.isPaper())throw Graph.error("Panzoom only available for paper !");n=t.viewport(),r=Math.round(n.matrix().scale().x,1e3),e=t.interactable().vendor(),_.assign(i.props,{vector:t.guid()}),_.assign(i.zooming,{scale:r,zoom:r}),i.initComponent(t),e.on("wheel",_.bind(i.onMouseWheel,i,_,t,n)),e.on("down",_.bind(i.onPointerDown,i,_,t,n)),t.props.rendered?(i.revalidate(t),i.props.showToolbox&&i.components.toolbox.appendTo(t.container())):t.on("render",function(){i.revalidate(t),i.props.showToolbox&&i.components.toolbox.appendTo(t.container());
}),e=null,t=null},initComponent:function(t){var e,n,r=this;r.props.showToolbox&&(e=t.container(),n=r.components.toolbox=Graph.$('<div class="graph-zoom-toolbox">'),n.html('<div><a data-tool="zoom-reset" href="#"><i class="ion-pinpoint"></i></a><div class="splitter"></div><a data-tool="zoom-in" href="#"><i class="ion-android-add"></i></a><div class="splitter"></div><a data-tool="zoom-out" href="#"><i class="ion-android-remove"></i></a></div>'),n.on("click","[data-tool]",function(t){t.preventDefault();var e=Graph.$(this).data("tool");switch(e){case"zoom-reset":r.zoomReset();break;case"zoom-in":r.zoomIn();break;case"zoom-out":r.zoomOut()}}))},revalidate:function(t){var e=t.node().getBoundingClientRect();this.caching.offset={x:e.left,y:e.top}},enable:function(){var t=this.vector();this.props.panEnabled=!0,this.props.zoomEnabled=!0,t.cursor("default"),t.state("panning")},disable:function(){this.props.panEnabled=!1},zoomReset:function(){var t,e=this.vector().viewport();this.zooming.zoom=1,this.zooming.scale=1,
e.reset(),t=Graph.matrix(),t.translate(.5,.5),e.attr("transform",t.toString()),e.graph.matrix=t},zoomIn:function(){var t=this.vector(),e=t.viewport(),n=.1,r=e.bbox().center(!0);this.zoom(t,e,n,r)},zoomOut:function(){var t=this.vector(),e=t.viewport(),n=-.1,r=e.bbox().center(!0);this.zoom(t,e,n,r)},zoom:function(e,n,r,i){var o=this.zooming.range,s=this.zooming.zoom,a=r>0?"in":"out",p=Math.pow(1+Math.abs(r),"in"==a?1:-1),h=t(o,s*p),c=n.matrix(),l=c.props.a,u=1/l*h,d=c.clone();this.onBeforeZoom(e),d.scale(u,u,i.x,i.y),n.attr("transform",d.toString()),n.graph.matrix=d,this.zooming.zoom=h,this.zooming.scale=d.props.a,"panning"==e.state()&&e.cursor("in"==a?"zoom-in":"zoom-out"),this.onZoom(e)},scroll:function(t,e,n,r){var i=e.matrix().clone(),o=this.zooming.scale;this.onBeforeScroll(t),n/=o,r/=o,i.translate(n,r),e.attr("transform",i.toString()),e.graph.matrix=i,this.zooming.origin&&(this.zooming.origin.x+=n,this.zooming.origin.y+=r),this.onScroll()},onMouseWheel:function(t,e,n){t=Graph.event.fix(t),
t.preventDefault();var r,i,o,s,a=Graph.event.hasPrimaryModifier(t),p=Graph.event.hasSecondaryModifier(t),h=Graph.event.original(t);a||p?(r=Graph.isMac()?0===h.deltaMode?1.25:50:0===h.deltaMode?1:20,i={},p?(i.dx=r*(h.deltaX||h.deltaY),i.dy=0):(i.dx=0,i.dy=r*h.deltaY),this.scroll(e,n,i.dx,i.dy)):(r=0===h.deltaMode?.025:.5,s=this.caching.offset,o={x:h.clientX-s.x,y:h.clientY-s.y},this.zooming.origin=o,this.zoom(e,n,h.deltaY*r/-8,o))},onPointerDown:function(t,e,n,r){var i,o=Graph.$(t.target),s=Graph.registry.vector.get(o),r=e.interactable().vendor(),a=e.tool().current();if("collector"!=a&&s){if(s.isDraggable())return;if(t.button||t.ctrlKey||t.shiftKey||t.altKey)return;this.revalidate(e),i=this.caching.offset,this.panning.start={x:t.clientX-i.x,y:t.clientY-i.y},this.panning.moveHandler=_.bind(this.onPointerMove,this,_,e,n),this.panning.stopHandler=_.bind(this.onPointerStop,this,_,e,n),r.on("move",this.panning.moveHandler),r.on("up",this.panning.stopHandler)}},onPointerMove:function(t,e,n){var r=this.caching.offset,i=this.panning.start,o={
x:t.clientX-r.x,y:t.clientY-r.y},s=o.x-i.x,a=o.y-i.y;Graph.util.hypo(s,a);e.cursor("move"),this.scroll(e,n,s,a),this.panning.start={x:t.clientX-r.x,y:t.clientY-r.y},t.preventDefault()},onPointerStop:function(t,e){var n,r=this,i=e.interactable().vendor();n=_.delay(function(){clearTimeout(n),n=null,i.off("move",r.panning.moveHandler),i.off("up",r.panning.stopHandler)},0),e.cursor("default")},onBeforeZoom:_.debounce(function(t){Graph.topic.publish("paper/beforezoom",null,t)},300,{leading:!0,trailing:!1}),onZoom:_.debounce(function(t){var e=t.state();"panning"==e&&t.cursor("default")},300),onBeforeScroll:_.debounce(function(t){Graph.topic.publish("paper/beforescroll",null,t)},300,{leading:!0,trailing:!1}),onScroll:_.debounce(function(){},300)})}(),function(){Graph.plugin.Linker=Graph.extend(Graph.plugin.Plugin,{props:{vector:null,enabled:!1,suspended:!0,rendered:!1},components:{block:null,pointer:null,path:null},linking:{treshold:10,enabled:!1,moveHandler:null,stopHandler:null,source:null,start:null,
target:null,end:null,visits:[]},constructor:function(t){var e,n=this;if(!t.isPaper())throw Graph.error("Linker plugin is only available for paper !");e=t.interactable().vendor(),e.on("down",_.bind(n.onPointerDown,n,_,t)),t.on("keynavdown",function(e){e.keyCode===Graph.event.ESC&&(n.invalidate(),t.tool().activate("panzoom"))}),n.props.vector=t.guid(),n.initComponent(t)},initComponent:function(t){var e=this,n=e.components;n.block=(new Graph.svg.Group).addClass("graph-linker-path").selectable(!1),n.pointer=(new Graph.svg.Circle).addClass("graph-linker-pointer").removeClass(Graph.string.CLS_VECTOR_CIRCLE).selectable(!1).render(n.block),n.path=(new Graph.svg.Path).addClass("graph-linker-path").removeClass(Graph.string.CLS_VECTOR_PATH).selectable(!1).render(n.block).attr("marker-end","url(#marker-arrow)")},render:function(){var t;this.props.rendered||(t=this.vector(),this.components.block.render(t),this.props.rendered=!0)},invalidate:function(){var t,e;this.linking.enabled&&(t=this.vector(),e=t.interactable().vendor(),
t.removeClass("linking"),this.linking.moveHandler&&e.off("move",this.linking.moveHandler),this.linking.stopHandler&&e.off("up",this.linking.stopHandler),this.linking.source&&this.linking.source.removeClass("disallowed"),this.linking.target&&this.linking.target.removeClass("allowed"),_.assign(this.linking,{enabled:!1,moveHandler:null,stopHandler:null,source:null,start:null,target:null,end:null}),this.linking.visits&&_.forEach(this.linking.visits,function(t){t.removeClass("connect-valid connect-invalid")}),this.linking.visits=null)},enable:function(){this.props.enabled=!0,this.vector().state("linking")},disable:function(){this.props.enabled=!1,this.invalidate(),this.suspend()},suspend:function(){this.props.suspended=!0,this.components.block.elem.detach()},resume:function(){var t;this.props.suspended&&(t=this.vector(),this.props.suspended=!1,this.props.rendered?t.viewport().elem.append(this.components.block.elem):this.render())},cropping:function(t,e){var n,r,i,o,s=this.linking.source,a=this.linking.target,p=new Graph.lang.Path([["M",t.x,t.y],["L",e.x,e.y]]);
return s&&(n=s.connectable().pathinfo(),r=n.intersection(p,!0)),a&&(i=a.connectable().pathinfo(),o=i.intersection(p,!0)),p=n=i=null,{start:r?r[0]:null,end:o?o[0]:null}},build:function(){var t=this.components.path.tail(),e=this.components.path.head();if(t&&e){var n=this.vector();n.connect(this.linking.source,this.linking.target,t,e)}this.invalidate(),this.suspend()},onPointerDown:function(t,e){var n=e.layout(),r=(n.offset(),n.grabVector(t)),i=e.interactable().vendor(),o=e.tool().current();if("linker"==o)if(this.linking.enabled)this.linking.target&&this.build();else if(this.linking.visits=[],r.isConnectable()){var s,a;this.linking.visits.push(r),this.linking.source||(s=r.connectable().bbox(),a=s.center(!0),this.linking.source=r,this.linking.start=a,this.components.path.moveTo(a.x,a.y).lineTo(a.x,a.y,!1),s=a=null),this.props.suspended&&this.resume(),this.linking.enabled=!0,this.linking.moveHandler=_.bind(this.onPointerMove,this,_,e),e.addClass("linking"),i=e.interactable().vendor(),i.on("move",this.linking.moveHandler);
}},onPointerMove:function(t,e){var n=e.layout(),r=this.linking.start,i=n.grabLocation(t),o=i.x,s=i.y,a=Graph.util.rad(Graph.util.theta(r,{x:o,y:s})),p=Math.sin(a),h=Math.cos(a),c=this.linking.treshold*-h,l=this.linking.treshold*p;o+=c,s+=l;var u,d,f,g,v=n.grabVector(t),m=!1;v&&v.isConnectable()&&(this.linking.visits.indexOf(v.guid())===-1&&this.linking.visits.push(v),this.linking.source.connectable().canConnect(v.connectable())?(m=!0,u=v,u.removeClass("connect-invalid"),u.addClass("connect-valid"),f=v.connectable().bbox(),g=f.center(!0),this.linking.target=u,this.linking.end=g,d=this.cropping(r,g),d.start&&this.components.path.moveTo(d.start.x,d.start.y),d.end?this.components.path.lineTo(d.end.x,d.end.y,!1):this.components.path.lineTo(o,s,!1),f=g=null):(v.removeClass("connect-valid"),v.addClass("connect-invalid"))),m||(this.linking.target&&this.linking.target.removeClass("connect-valid connect-invalid"),this.linking.target=null,this.linking.end=null,d=this.cropping(r,{x:o,y:s}),d.start&&this.components.path.moveTo(d.start.x,d.start.y),
d.end?this.components.path.lineTo(d.end.x,d.end.y,!1):this.components.path.lineTo(o,s,!1))}})}(),function(){Graph.plugin.ToolManager=Graph.extend(Graph.plugin.Plugin,{props:{vector:null,current:null},tools:{},constructor:function(t){var e=this;e.props.vector=t.guid()},has:function(t){return!!this.tools[t]},get:function(t){var e=this.tools[t],n=this.vector();if(e)switch(e.type){case"plugin":return n.plugins[t];case"util":return n.utils[t]}return null},current:function(){return this.props.current},register:function(t,e){e=_.defaultTo(e,"plugin"),this.tools[t]={name:t,type:e,enabled:!1}},unregister:function(t){this.tools[t]&&delete this.tools[t]},activate:function(t,e){if(this.props.current!=t){var n,r=this.get(t);r&&(this.deactivateAll(t),this.props.current=t,n=this.tools[t],n.enabled=!0,e=_.defaultTo(e,"tool"),r.enable(e),this.fire("activate",{name:n.name,enabled:n.enabled}))}},deactivate:function(t){var e,n=this.get(t);n&&(e=this.tools[t],e.enabled=!1,this.props.current=null,n.disable(),
this.fire("deactivate",{name:e.name,enabled:e.enabled}))},deactivateAll:function(t){this.vector();for(var e in this.tools)e!=t&&this.deactivate(e)},toggle:function(t){var e=this.tools[t];e&&(e.enabled?this.deactivate(t):this.activate(t))}})}(),function(){Graph.plugin.Pencil=Graph.extend(Graph.plugin.Plugin,{paper:null,drawing:{offset:{x:0,y:0},moveHandler:null,stopHandler:null},constructor:function(t){this.paper=t},draw:function(){var t,e;return this.paper.tool().activate("panzoom"),t=Graph.shape.apply(null,arguments),t&&(t.render(this.paper),t.move(-500,-500),this.refresh(t),this.paper.state("drawing"),e=this.paper.interactable().vendor(),this.drawing.offset=this.paper.layout().offset(),this.drawing.moveHandler=_.bind(this.onPointerMove,this,_,t),this.drawing.stopHandler=_.bind(this.onPointerStop,this,_,t),e.on("move",this.drawing.moveHandler),e.on("up",this.drawing.stopHandler)),t},refresh:function(t){var e=this.paper.layout().dragSnapping();t.component().cascade(function(t){t.isDraggable()&&t.draggable().snap(e),
t.isResizable()&&t.resizable().snap(e)})},onPointerMove:function(t,e){var n=this.drawing.offset,r=this.paper.viewport(),i=Graph.event.relative(t,r),o=r.scale(),s=i.x-n.left/o.x,a=i.y-n.top/o.y;e.move(s,a)},onPointerStop:function(t,e){var n,r=this.paper.interactable().vendor();n=_.delay(_.bind(function(){this.drawing.moveHandler&&(r.off("move",this.drawing.moveHandler),this.drawing.moveHandler=null),this.drawing.stopHandler&&(r.off("up",this.drawing.stopHandler),this.drawing.stopHandler=null)},this),0)}})}(),function(){var t=150,e=50,n=10;Graph.plugin.Editor=Graph.extend(Graph.plugin.Plugin,{props:{vector:null,rendered:!1,suspended:!0,width:"auto",height:"auto",offset:"auto"},editing:{commitHandler:null},components:{editor:null},constructor:function(t,e){var n;_.assign(this.props,e||{}),this.props.vector=t.guid(),_.assign(this.cached,{left:0,top:0,width:0,height:0}),n=t.interactable().vendor(),n.on("doubletap",_.bind(this.onDoubleTap,this)),this.initComponent()},initComponent:function(){
var t=this,e=this.components;e.editor=Graph.$('<div class="graph-editor" contenteditable="true"></div>'),e.editor.on("keypress",function(e){e.keyCode===Graph.event.ENTER&&t.commit()})},commit:function(){var t=this.components.editor.text();this.suspend(),this.vector().props.text=t,this.fire("edit",{text:t,left:this.cached.left,top:this.cached.top})},render:function(){return this.props.rendered?void this.redraw():(this.vector().paper().container().append(this.components.editor),this.props.rendered=!0,void this.redraw())},suspend:function(){this.props.suspended=!0,this.components.editor.detach(),this.editing.commitHandler&&(Graph.topic.unsubscribe("paper/beforezoom",this.editing.commitHandler),Graph.topic.unsubscribe("paper/beforescroll",this.editing.commitHandler),this.vector().paper().off("pointerdown",this.editing.commitHandler),this.editing.commitHandler=null)},resume:function(){var t;this.props.rendered?(this.props.suspended&&(this.props.suspended=!1,t=this.vector().paper().container(),
t.append(this.components.editor)),this.redraw()):this.render()},redraw:function(){var n,r,i,o,s=this.components.editor,a=this.vector(),p=a.matrix(!0),h=p.scale(),c=a.bbox().clone().transform(p).toJson();i=c.width,o=c.height,n=c.x,r=c.y,"auto"!=this.props.width&&(i=Math.max(Math.min(this.props.width,i),t),n=c.x+(c.width-i)/2),"auto"!=this.props.height&&(o=Math.max(Math.min(this.props.height,o),e),r=c.y+(c.height-o)/2),n+=4*h.x,r+=4*h.y,i-=8*h.x,o-=8*h.y,s.css({left:n,top:r,width:i,height:o}),_.assign(this.cached,{left:n,top:r,width:i,height:o}),s.text(a.props.text||""),s.focus(),c=null},startEdit:function(t){var e=this,r=e.vector();if(r.$collector&&r.$collector.decollect(r),"linker"==r.paper().tool().current()&&r.paper().tool().activate("panzoom"),e.fire("beforeedit"),e.resume(),t&&"pointer"==this.props.offset){var i,o,s,a,p=e.components.editor,h=r.paper(),c=h.layout().currentScale();h&&(i=h.offset(),o=h.layout().grabLocation(t),s=t.clientX-i.left+n*c.x,a=t.clientY-i.top+n*c.y,p.css({left:s,
top:a}),e.cached.left=o.x,e.cached.top=o.y)}e.editing.commitHandler=function(){e.commit()},Graph.topic.subscribe("paper/beforezoom",e.editing.commitHandler),Graph.topic.subscribe("paper/beforescroll",e.editing.commitHandler),r.paper().on("pointerdown",e.editing.commitHandler),r=null},onDoubleTap:function(t){this.startEdit(t),t.preventDefault()},destroy:function(){}})}(),function(){function t(t,e,n){n=_.defaultTo(n,10);for(var r=e.length;r--;)if(Math.abs(e[r]-t)<=n)return{snapped:!0,value:e[r]};return{snapped:!1,value:t}}Graph.plugin.Snapper=Graph.extend(Graph.plugin.Plugin,{props:{enabled:!0,suspended:!0,rendered:!1,vector:null},clients:{},components:{block:null,stubx:null,stuby:null},snapping:{coords:null,vector:null,stubx:null,stuby:null},constructor:function(t,e){if(e=e||{},!t.isPaper())throw Graph.error("Snapper plugin only available for paper");this.props.vector=t.guid(),this.initComponent(t),this.snapping.coords={x:[],y:[]}},initComponent:function(t){var e,n,r;e=(new Graph.svg.Group).selectable(!1).clickable(!1).addClass("graph-snapper"),
n=new Graph.svg.Path("M 0 0 L 0 0").removeClass(Graph.string.CLS_VECTOR_PATH).selectable(!1).clickable(!1).render(e),r=new Graph.svg.Path("M 0 0 L 0 0").removeClass(Graph.string.CLS_VECTOR_PATH).clickable(!1).selectable(!1).render(e),this.components.block=e.guid(),this.components.stuby=r.guid(),this.components.stubx=n.guid()},component:function(t){return void 0===t?Graph.registry.vector.get(this.components.block):Graph.registry.vector.get(this.components[t])},render:function(){this.props.rendered||(this.component().render(this.vector()),this.props.rendered=!0)},suspend:function(){this.props.suspended=!0,this.component().elem.detach()},resume:function(){if(this.props.suspended)if(this.props.suspended=!1,this.props.rendered){var t=this.component(),e=this.vector().viewport();t.elem.appendTo(e.elem)}else this.render()},subscribe:function(t){var e=this,n=t.vector,r=t.shield,i=n.guid();if(e.clients[i]&&(n.off("dragstart",e.clients[i].dragStartHandler),n.off("dragend",e.clients[i].dragEndHandler),
n.off("remove",e.clients[i].removeHandler),delete e.clients[i]),t.enabled){var o=n.draggable();e.clients[i]={vector:i,shield:r.guid(),osnaps:o.snap(),ostart:o.origin(),dragStartHandler:_.bind(e.onClientDragStart,e,_,n,r),dragEndHandler:_.bind(e.onClientDragEnd,e,_,n),removeHandler:_.bind(e.onClientRemove,e,_,i)},n.on("dragstart",e.clients[i].dragStartHandler),n.on("dragend",e.clients[i].dragEndHandler),n.on("remove",e.clients[i].removeHandler);var s=r.bbox().center().toJson(),a=n.paper().offset(),p=this.snapping.coords,h=s.x,c=s.y;_.indexOf(p.x,h)===-1&&p.x.push(h+a.left),_.indexOf(p.y,c)===-1&&p.y.push(c+a.top)}},showStub:function(t,e){var n,r=this.snapping;"x"==t&&(n="M "+e+" -100000 L "+e+" 100000",r.stubx.attr("d",n),r.stubx.addClass("visible")),"y"==t&&(n="M -100000 "+e+" L 100000 "+e,r.stuby.attr("d",n),r.stuby.addClass("visible")),n=null},hideStub:function(t){var e="x"==t?"stubx":"stuby";this.snapping[e].removeClass("visible")},onClientDragStart:function(e,n,r){var i=this,o=n.paper().offset(),s=r.bbox().center().toJson(),a=this.snapping,p=a.coords;
a.stubx=this.component("stubx"),a.stuby=this.component("stuby");var h=s.x+o.left-e.x,c=s.y+o.top-e.y,l=[],u=[];_.forEach(p.x,function(t){l.push(t-h)}),_.forEach(p.y,function(t){u.push(t-c)}),n.draggable().origin({x:h,y:c}),n.draggable().snap([function(e,n){var r,s;return r=t(e,l),s=t(n,u),r.snapped?i.showStub("x",r.value-o.left+h):i.hideStub("x"),s.snapped?i.showStub("y",s.value-o.top+c):i.hideStub("y"),{x:r.value,y:s.value}}]),i.resume()},onClientDragEnd:function(t,e){var n=(this.snapping,this.clients[e.guid()]);if(n){var r=e.draggable();n.osnaps&&r.snap(n.osnaps),n.ostart&&r.origin(n.ostart)}this.suspend(),_.assign(this.snapping,{stubx:null,stuby:null})},onClientRemove:function(t){}})}(),function(){var t=Graph.shape.Shape=Graph.extend({props:{id:null,guid:null,width:0,height:0,label:""},components:{shape:null,block:null,label:null},plugins:{},constructor:function(e){_.assign(this.props,e||{}),this.props.guid="graph-shape-"+ ++t.guid,this.initComponent(),Graph.registry.shape.register(this);
},guid:function(){return this.props.guid},draw:function(){},render:function(t){var e=this.component();e&&e.render(t)},initComponent:function(){var t=new Graph.svg.Group;this.components.shape=t.guid(),t=null},component:function(t){var e=Graph.registry.vector;return void 0===t?e.get(this.components.shape):e.get(this.components[t])},hub:function(){return this.component("block")},redraw:_.debounce(function(){var t=this.component("label"),e=this.component("block"),n=e.bbox().toJson();t.attr({x:n.x+n.width/2,y:n.x+n.height/2}),t.wrap(n.width-10)},1),move:function(t,e){var n=this.component(),r=n.matrix().clone().invert();t-=this.props.width/2,e-=this.props.height/2,n.matrix().multiply(r),n.translate(t,e).commit(),r=null},onLabelEdit:function(t){var e=t.text;this.component("label").props.text=e,this.redraw()},onDragEnd:function(t){var e=this.component("block"),n=this.component("shape"),r=e.matrix();e.reset(),n.matrix().multiply(r),n.attr("transform",n.matrix().toString())},onResize:function(){this.redraw();
},onRemove:function(){this.component("label").remove(),this.component("shape").remove();for(var t in this.components)this.components[t]=null;Graph.registry.shape.unregister(this)}});t.guid=0,Graph.isShape=function(t){return t instanceof Graph.shape.Shape}}(),function(){Graph.ns("Graph.shape.activity"),Graph.shape.activity.Start=Graph.extend(Graph.shape.Shape,{props:{label:"START",width:60,height:60,left:0,top:0},initComponent:function(){var t,e,n,r=this,i=r.components;t=new Graph.svg.Group(r.props.left,r.props.top).addClass("graph-shape-activity-start").selectable(!1);var o=r.props.width/2,s=r.props.height/2;e=new Graph.svg.Ellipse(o,s,o,s).data("text",r.props.label).render(t),e.draggable({ghost:!0}),e.connectable({shield:t,wiring:"h:v"}),e.resizable({shield:t}),e.editable(),e.on("edit",_.bind(r.onLabelEdit,r)),e.on("dragend",_.bind(r.onDragEnd,r)),e.on("resize",_.bind(r.onResize,r)),e.on("remove",_.bind(r.onRemove,r)),n=new Graph.svg.Text(o,s,r.props.label).selectable(!1).clickable(!1).render(t),
i.shape=t.guid(),i.block=e.guid(),i.label=n.guid(),t=e=n=null},redraw:function(){var t,e,n,r,i=this.component("block"),o=this.component("shape"),s=this.component("label");e=i.bbox().toJson(),t=Graph.matrix().translate(e.x,e.y),o.matrix().multiply(t),o.attr("transform",o.matrix().toString()),n=e.width/2,r=e.height/2,i.attr({cx:n,cy:r}),i.dirty(!0),i.resizable().redraw(),s.attr({x:n,y:r}),s.wrap(e.width-10),e=null,t=null},toString:function(){return"Graph.shape.activity.Start"}})}(),function(){Graph.shape.activity.Final=Graph.extend(Graph.shape.Shape,{props:{label:"STOP",width:60,height:60,left:0,top:0},initComponent:function(){var t,e,n,r,i=this,o=i.components;t=new Graph.svg.Group(i.props.left,i.props.top).addClass("graph-shape-activity-final").selectable(!1);var s=i.props.width/2,a=i.props.height/2;e=new Graph.svg.Ellipse(s,a,s,a).addClass("block").data("text",i.props.label).render(t),e.draggable({ghost:!0}),e.connectable({shield:t}),e.resizable({shield:t}),e.editable(),e.on("edit",_.bind(i.onLabelEdit,i)),
e.on("dragend",_.bind(i.onDragEnd,i)),e.on("resize",_.bind(i.onResize,i)),e.on("remove",_.bind(i.onRemove,i)),n=new Graph.svg.Ellipse(s,a,s-6,a-6).addClass("inner").clickable(!1).selectable(!1).render(t),r=new Graph.svg.Text(s,a,i.props.label).addClass("label").selectable(!1).clickable(!1).render(t),o.shape=t.guid(),o.block=e.guid(),o.label=r.guid(),o.inner=n.guid(),t=e=r=null},redraw:function(){var t,e,n,r,i=this.component("block"),o=this.component("shape"),s=this.component("inner"),a=this.component("label");e=i.bbox().toJson(),t=Graph.matrix().translate(e.x,e.y),o.matrix().multiply(t),o.attr("transform",o.matrix().toString()),n=e.width/2,r=e.height/2,i.attr({cx:n,cy:r}),i.dirty(!0),i.resizable().redraw(),a.attr({x:n,y:r}),a.wrap(e.width-10),s.attr({cx:n,cy:r,rx:n-6,ry:r-6}),e=null,t=null},toString:function(){return"Graph.shape.activity.Final"},onRemove:function(){this.component("label").remove(),this.component("inner").remove(),this.component("shape").remove();for(var t in this.components)this.components[t]=null;
Graph.registry.shape.unregister(this)}})}(),function(){Graph.shape.activity.Action=Graph.extend(Graph.shape.Shape,{props:{label:"Action",width:140,height:60,left:0,top:0},initComponent:function(){var t,e,n,r=this,i=this.components,o=r.props.width/2,s=r.props.height/2;t=new Graph.svg.Group(r.props.left,r.props.top).selectable(!1),e=new Graph.svg.Rect(0,0,r.props.width,r.props.height).data("text",r.props.label).render(t),e.draggable({ghost:!0}),e.resizable({shield:t}),e.editable(),e.connectable({shield:t,wiring:"h:v"}),e.snappable({shield:t,enabled:!0}),e.on("edit.shape",_.bind(r.onLabelEdit,r)),e.on("dragend.shape",_.bind(r.onDragEnd,r)),e.on("resize.shape",_.bind(r.onResize,r)),e.on("remove.shape",_.bind(r.onRemove,r)),n=new Graph.svg.Text(o,s,r.props.label).clickable(!1).selectable(!1).render(t),i.shape=t.guid(),i.block=e.guid(),i.label=n.guid(),t=e=n=null},redraw:function(){var t,e,n=this.component("block"),r=this.component("shape"),i=this.component("label");t=n.bbox().toJson(),e=Graph.matrix().translate(t.x,t.y),
r.matrix().multiply(e),r.attr("transform",r.matrix().toString()),n.attr({x:0,y:0}),n.dirty(!0),n.resizable().redraw(),i.attr({x:t.width/2,y:t.height/2}),i.wrap(t.width-10),t=null,e=null},onResize:function(){this.redraw()},toString:function(){return"Graph.shape.activity.Action"}})}(),function(){Graph.shape.activity.Router=Graph.extend(Graph.shape.Shape,{props:{label:"Route",width:100,height:100,left:0,top:0},initComponent:function(){var t,e,n,r=this,i=r.components,o=[r.props.width/2,0,r.props.width,r.props.height/2,r.props.width/2,r.props.height,0,r.props.height/2],s=o[0],a=o[3];t=new Graph.svg.Group(r.props.left,r.props.top).selectable(!1),e=new Graph.svg.Polygon(o).data("text",r.props.label).render(t),e.draggable({ghost:!0}),e.resizable({shield:t}),e.editable(),e.connectable({shield:t}),e.on("edit",_.bind(r.onLabelEdit,r)),e.on("dragend",_.bind(r.onDragEnd,r)),e.on("resize",_.bind(r.onResize,r)),e.on("remove",_.bind(r.onRemove,r)),n=new Graph.svg.Text(s,a,r.props.label).clickable(!1).selectable(!1).render(t),
i.shape=t.guid(),i.block=e.guid(),i.label=n.guid(),t=e=n=null},redraw:function(){var t,e,n=this.component("block"),r=this.component("shape"),i=this.component("label");t=n.bbox().toJson(),e=Graph.matrix().translate(t.x,t.y),r.matrix().multiply(e),r.attr("transform",r.matrix().toString());var o=[t.width/2,0,t.width,t.height/2,t.width/2,t.height,0,t.height/2];n.attr({points:_.join(o,",")}),n.dirty(!0),n.resizable().redraw(),i.attr({x:t.width/2,y:t.height/2}),i.wrap(t.width-10),e=null,t=null}})}(),function(){Graph.shape.activity.Fork=Graph.extend(Graph.shape.Shape,{props:{width:100,height:50,left:0,top:0},initComponent:function(){var t,e=this,n=this.components;t=new Graph.svg.Group(e.props.left,e.props.top).selectable(!1),n.shape=t.guid()}})}(),function(){Graph.shape.activity.Join=Graph.extend(Graph.shape.Shape,{props:{width:140,height:12,left:0,top:0},initComponent:function(){var t,e,n=this,r=this.components;t=new Graph.svg.Group(n.props.left,n.props.top).addClass("graph-shape-activity-join").selectable(!1),
e=new Graph.svg.Rect(0,0,n.props.width,n.props.height,0).addClass("block").render(t),e.draggable({ghost:!0}),e.connectable({shield:t}),e.on("dragend",_.bind(n.onDragEnd,n)),r.shape=t.guid(),r.block=e.guid()}})}(),function(){Graph.shape.activity.Lane=Graph.extend(Graph.shape.Shape,{props:{label:"Participant Role",width:1e3,height:200,left:0,top:0},initComponent:function(){var t,e,n,r,i=this,o=i.components;t=new Graph.svg.Group(i.props.left,i.props.top).addClass("graph-shape-activity-lane").selectable(!1),e=new Graph.svg.Rect(0,0,i.props.width,i.props.height,0).addClass("block").render(t),e.resizable({shield:t}),e.draggable({ghost:!0}),e.on("dragend",_.bind(i.onDragEnd,i)),e.on("resize",_.bind(i.onResize,i)),e.on("remove",_.bind(i.onRemove,i)),n=new Graph.svg.Rect(0,0,30,i.props.height,0).addClass("header").selectable(!1).render(t);var s=15,a=i.props.height/2;r=new Graph.svg.Text(s,a,i.props.label).selectable(!1).clickable(!1).render(t),r.rotate(270,s,a).commit(),o.shape=t.guid(),o.block=e.guid(),
o.header=n.guid(),o.label=r.guid(),t=e=n=r=null},onDragEnd:function(){var t=this.component("block"),e=this.component("shape"),n=t.matrix();t.reset(),t.attr("transform",""),e.matrix().multiply(n),e.attr("transform",e.matrix().toString())},redraw:function(){var t,e,n=this.component("block"),r=this.component("shape"),i=this.component("header"),o=this.component("label");e=n.bbox().toJson(),t=Graph.matrix().translate(e.x,e.y),r.matrix().multiply(t),r.attr("transform",r.matrix().toString()),n.attr({x:0,y:0}),n.dirty(!0),n.resizable().redraw(),i.attr({x:0,y:0,height:e.height}),i.dirty(!0);var s=15,a=e.height/2;o.graph.matrix=Graph.matrix(),o.attr("transform",""),o.attr({x:s,y:a}),o.wrap(e.height-10),o.rotate(270,s,a).commit()},toString:function(){return"Graph.shape.activity.Lane"},onRemove:function(){this.component("label").remove(),this.component("header").remove(),this.component("shape").remove();for(var t in this.components)this.components[t]=null;Graph.registry.shape.unregister(this)}})}(),
function(){function t(t){var e=encodeURIComponent(t);return e=e.replace(/%([0-9A-F]{2})/g,function(t,e){var n=String.fromCharCode("0x"+e);return"%"===n?"%25":n}),decodeURIComponent(e)}function e(t,e){if(navigator.msSaveOrOpenBlob){var r=n(e);navigator.msSaveOrOpenBlob(r,t),r=null}else{var i=Graph.dom("<a/>");"download"in i?(i.download=t,i.href=e,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)):window.open(e,"_download","menubar=no,toolbar=no,status=no"),i=null}}function n(t){for(var e=window.atob(t.split(",")[1]),n=t.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(e.length),i=new Uint8Array(r),o=0,s=e.length;o<s;o++)i[o]=e.charCodeAt(o);return new Blob([r],{type:n})}function r(t,e,n){var r=i(t,e),o=new Image;o.onload=function(){var t,r,i;t=document.createElement("canvas"),t.width=o.width,t.height=o.height,r=t.getContext("2d"),r.drawImage(o,0,0);try{i=t.toDataURL(e.encoder,e.compression)}catch(t){i=!1}t=r=null,n(i)},o.onerror=function(){
n(!1)},o.src=r}function i(e,n){var r,i,a,p,h,c=Graph.dom("<div/>"),l=e.cloneNode(!0);"svg"==l.tagName?(l.setAttribute("width",n.width),l.setAttribute("height",n.height)):(a=Graph.dom("<svg/>"),a.setAttribute("xmlns",Graph.config.xmlns.svg),a.setAttribute("xmlns:xlink",Graph.config.xmlns.xlink),a.setAttribute("version",Graph.config.svg.version),a.setAttribute("width",n.width),a.setAttribute("height",n.height),a.appendChild(l),l=a),c.appendChild(l),r=o(e),i=Graph.dom("<style/>"),i.setAttribute("type","text/css"),i.innerHTML="<![CDATA[\n"+r+"\n]]>";var u=l.childNodes[0];return u?l.insertBefore(i,u):l.appendChild(i),p=s+c.innerHTML,h="data:image/svg+xml;base64,"+window.btoa(t(p)),l=c=null,h}function o(t){for(var e,n,r,i=document.styleSheets,o="",s=0,a=i.length;s<a;s++)if(e=i[s].cssRules,null!=e)for(var p=0,h=e.length;p<h;p++,r=null)n=e[p],void 0!==n.style&&n.selectorText&&(r=t.querySelector(n.selectorText),r?o+=n.selectorText+" { "+n.style.cssText+" }\n":n.cssText.match(/^@font-face/)&&(o+=n.cssText+"\n"));
return o}var s='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd" [<!ENTITY nbsp "&#160;">]>',a=Graph.data.Exporter=function(t,e){this.options=_.extend({},a.defaults,e||{}),this.element=t.node();var n,r,i;if(t.isPaper())n=t.elem.width(),r=t.elem.height(),i=t.layout().currentScale();else{var o=t.bbox().toJson();n=o.width,r=o.height,i=t.matrix(!0).scale()}_.assign(this.options,{width:n,height:r,scaleX:i.x,scaleY:i.y})};a.defaults={width:0,height:0,scaleX:1,scaleY:1},a.prototype.exportDataURI=function(){},a.prototype.exportSVG=function(){},a.prototype.exportJPEG=function(t,e){var n=_.extend({},this.options);n.encoder="image/jpeg",n.compression=e||.8,t=_.defaultTo(t,"download.jpg"),r(this.element,n,function(e){e&&document(t,e)})},a.prototype.exportPNG=function(t,n){var i=_.extend({},this.options);t=_.defaultTo(t,"download.png"),i.encoder="image/png",i.compression=n||.8,r(this.element,i,function(n){n&&e(t,n);
})}}(),function(){Graph.diagram.Diagram=Graph.extend({props:{name:null,type:""},constructor:function(t){},destroy:function(){}})}(),function(){Graph.diagram.Command=Graph.extend({history:[],add:function(){},undo:function(){},redo:function(){}})}(),function(){var t=Graph.diagram.Modeler=function(){};t.prototype.export=function(t){},t.prototype.import=function(t,e){}}(),function(){var t=Graph.diagram.Parser=function(){};t.prototype.parse=function(t,e){}}(),function(){var t=Graph.diagram.Rules=function(){this.rules={}};t.prototype.add=function(){}}(),function(){Graph.popup.Dialog=Graph.extend({props:{opened:!1,content:null,buttons:null,baseClass:""},components:{popup:null,container:null,backdrop:null},handlers:{backdropClick:null},constructor:function(t,e){_.isPlainObject(t)&&(e=t,t=Graph.$("body")),_.assign(this.props,e||{}),this.components.container=t||Graph.$("body"),this.initComponent()},initComponent:function(){var t=this,e=Graph.$('<div class="graph-popup-dialog"/>');e.addClass(this.props.baseClass),
console.log(this.props.baseClass),t.components.popup=e},component:function(){return this.components.popup},content:function(t){var e=this;return void 0===t?e.props.content:(_.isFunction(t)?Graph.when(t()).then(function(t){e.props.content=t,e.components.popup.html(t)}):(e.props.content=t,e.components.popup.html(t)),this)},open:function(){if(!this.opened)return this.components.container.append(this.components.popup),this.props.opened=!0,this.center(),this.backdrop(),this},close:function(){var t=this.components.backdrop;if(this.components.popup.detach(),this.props.opened=!1,this.handlers.backdropClick){t.off("click",this.handlers.backdropClick),this.handlers.backdropClick=null;var e=+t.data("user");e--,e<=0&&(e=0,t.detach()),t.data("user",e)}this.fire("close")},center:_.debounce(function(){var t=this.components.popup,e=t.width(),n=t.height();t.css({top:"50%",left:"50%","margin-top":-n/2,"margin-left":-e/2})},0),backdrop:function(){var t=this,e=Graph.$(".graph-popup-backdrop");e.length()||(e=Graph.$('<div class="graph-popup-backdrop"/>'),
e.data("user",0),e.on("click",function(t){t.stopPropagation()})),t.handlers.backdropClick=function(){t.close()},e.on("click",t.handlers.backdropClick);var n=+e.data("user");n++,e.data("user",n),t.components.popup.before(e),t.components.backdrop=e},destroy:function(){this.components.popup.remove(),this.components.popup=null,this.components.container=null}})}();
//# sourceMappingURL=graph.min.js.map
